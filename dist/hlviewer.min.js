/*! For license information please see hlviewer.min.js.LICENSE.txt */
!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.HLViewer=t():e.HLViewer=t()}(self,(()=>(()=>{var e={1961:(e,t,r)=>{"use strict";r.r(t),r.d(t,{glMatrix:()=>n,mat2:()=>a,mat2d:()=>s,mat3:()=>i,mat4:()=>o,quat:()=>c,quat2:()=>h,vec2:()=>d,vec3:()=>l,vec4:()=>u});var n={};r.r(n),r.d(n,{ARRAY_TYPE:()=>p,EPSILON:()=>f,RANDOM:()=>m,equals:()=>b,setMatrixArrayType:()=>g,toRadian:()=>v});var a={};r.r(a),r.d(a,{LDU:()=>O,add:()=>U,adjoint:()=>k,clone:()=>_,copy:()=>x,create:()=>M,determinant:()=>I,equals:()=>G,exactEquals:()=>V,frob:()=>N,fromRotation:()=>L,fromScaling:()=>D,fromValues:()=>S,identity:()=>T,invert:()=>R,mul:()=>W,multiply:()=>A,multiplyScalar:()=>j,multiplyScalarAndAdd:()=>X,rotate:()=>P,scale:()=>C,set:()=>E,str:()=>F,sub:()=>H,subtract:()=>B,transpose:()=>w});var s={};r.r(s),r.d(s,{add:()=>ue,clone:()=>z,copy:()=>$,create:()=>q,determinant:()=>J,equals:()=>pe,exactEquals:()=>fe,frob:()=>le,fromRotation:()=>ae,fromScaling:()=>se,fromTranslation:()=>ie,fromValues:()=>K,identity:()=>Y,invert:()=>Q,mul:()=>me,multiply:()=>ee,multiplyScalar:()=>he,multiplyScalarAndAdd:()=>de,rotate:()=>te,scale:()=>re,set:()=>Z,str:()=>oe,sub:()=>ge,subtract:()=>ce,translate:()=>ne});var i={};r.r(i),r.d(i,{add:()=>Ge,adjoint:()=>we,clone:()=>be,copy:()=>Me,create:()=>ye,determinant:()=>Re,equals:()=>qe,exactEquals:()=>He,frob:()=>Ve,fromMat2d:()=>Fe,fromMat4:()=>ve,fromQuat:()=>Ne,fromRotation:()=>Le,fromScaling:()=>De,fromTranslation:()=>Ce,fromValues:()=>_e,identity:()=>Te,invert:()=>Ee,mul:()=>ze,multiply:()=>ke,multiplyScalar:()=>Xe,multiplyScalarAndAdd:()=>We,normalFromMat4:()=>Oe,projection:()=>Ue,rotate:()=>Ae,scale:()=>Pe,set:()=>xe,str:()=>Be,sub:()=>$e,subtract:()=>je,translate:()=>Ie,transpose:()=>Se});var o={};r.r(o),r.d(o,{add:()=>Ut,adjoint:()=>nt,clone:()=>Ke,copy:()=>Ze,create:()=>Ye,determinant:()=>at,equals:()=>Xt,exactEquals:()=>jt,frob:()=>Ot,fromQuat:()=>Et,fromQuat2:()=>bt,fromRotation:()=>pt,fromRotationTranslation:()=>vt,fromRotationTranslationScale:()=>Tt,fromRotationTranslationScaleOrigin:()=>St,fromScaling:()=>ft,fromTranslation:()=>dt,fromValues:()=>Qe,fromXRotation:()=>mt,fromYRotation:()=>gt,fromZRotation:()=>yt,frustum:()=>wt,getRotation:()=>xt,getScaling:()=>_t,getTranslation:()=>Mt,identity:()=>et,invert:()=>rt,lookAt:()=>Dt,mul:()=>Wt,multiply:()=>st,multiplyScalar:()=>Vt,multiplyScalarAndAdd:()=>Gt,ortho:()=>Ct,orthoNO:()=>Pt,orthoZO:()=>Lt,perspective:()=>kt,perspectiveFromFieldOfView:()=>At,perspectiveNO:()=>Rt,perspectiveZO:()=>It,rotate:()=>lt,rotateX:()=>ut,rotateY:()=>ct,rotateZ:()=>ht,scale:()=>ot,set:()=>Je,str:()=>Nt,sub:()=>Ht,subtract:()=>Bt,targetTo:()=>Ft,translate:()=>it,transpose:()=>tt});var l={};r.r(l),r.d(l,{add:()=>Qt,angle:()=>Rr,bezier:()=>br,ceil:()=>rr,clone:()=>zt,copy:()=>Kt,create:()=>qt,cross:()=>gr,dist:()=>Nr,distance:()=>ur,div:()=>Fr,divide:()=>tr,dot:()=>mr,equals:()=>Pr,exactEquals:()=>Ar,floor:()=>nr,forEach:()=>Vr,fromValues:()=>Yt,hermite:()=>vr,inverse:()=>fr,len:()=>Ur,length:()=>$t,lerp:()=>yr,max:()=>sr,min:()=>ar,mul:()=>Dr,multiply:()=>er,negate:()=>dr,normalize:()=>pr,random:()=>Mr,rotateX:()=>Sr,rotateY:()=>Er,rotateZ:()=>wr,round:()=>ir,scale:()=>or,scaleAndAdd:()=>lr,set:()=>Zt,sqrDist:()=>Or,sqrLen:()=>Br,squaredDistance:()=>cr,squaredLength:()=>hr,str:()=>Ir,sub:()=>Lr,subtract:()=>Jt,transformMat3:()=>xr,transformMat4:()=>_r,transformQuat:()=>Tr,zero:()=>kr});var u={};r.r(u),r.d(u,{add:()=>qr,ceil:()=>Kr,clone:()=>jr,copy:()=>Wr,create:()=>Gr,cross:()=>dn,dist:()=>Sn,distance:()=>nn,div:()=>Tn,divide:()=>Yr,dot:()=>hn,equals:()=>Mn,exactEquals:()=>bn,floor:()=>Zr,forEach:()=>kn,fromValues:()=>Xr,inverse:()=>un,len:()=>wn,length:()=>sn,lerp:()=>fn,max:()=>Jr,min:()=>Qr,mul:()=>xn,multiply:()=>$r,negate:()=>ln,normalize:()=>cn,random:()=>pn,round:()=>en,scale:()=>tn,scaleAndAdd:()=>rn,set:()=>Hr,sqrDist:()=>En,sqrLen:()=>Rn,squaredDistance:()=>an,squaredLength:()=>on,str:()=>vn,sub:()=>_n,subtract:()=>zr,transformMat4:()=>mn,transformQuat:()=>gn,zero:()=>yn});var c={};r.r(c),r.d(c,{add:()=>sa,calculateW:()=>Un,clone:()=>ta,conjugate:()=>Hn,copy:()=>na,create:()=>In,dot:()=>la,equals:()=>ga,exactEquals:()=>ma,exp:()=>Bn,fromEuler:()=>zn,fromMat3:()=>qn,fromValues:()=>ra,getAngle:()=>Ln,getAxisAngle:()=>Cn,identity:()=>An,invert:()=>Wn,len:()=>ha,length:()=>ca,lerp:()=>ua,ln:()=>Vn,mul:()=>ia,multiply:()=>Dn,normalize:()=>pa,pow:()=>Gn,random:()=>Xn,rotateX:()=>Fn,rotateY:()=>Nn,rotateZ:()=>On,rotationTo:()=>ya,scale:()=>oa,set:()=>aa,setAxes:()=>ba,setAxisAngle:()=>Pn,slerp:()=>jn,sqlerp:()=>va,sqrLen:()=>fa,squaredLength:()=>da,str:()=>$n});var h={};r.r(h),r.d(h,{add:()=>Xa,clone:()=>_a,conjugate:()=>Ka,copy:()=>ka,create:()=>Ma,dot:()=>za,equals:()=>as,exactEquals:()=>ns,fromMat4:()=>Ra,fromRotation:()=>wa,fromRotationTranslation:()=>Sa,fromRotationTranslationValues:()=>Ta,fromTranslation:()=>Ea,fromValues:()=>xa,getDual:()=>Ca,getReal:()=>Pa,getTranslation:()=>Fa,identity:()=>Ia,invert:()=>Ya,len:()=>Qa,length:()=>Za,lerp:()=>$a,mul:()=>Ha,multiply:()=>Wa,normalize:()=>ts,rotateAroundAxis:()=>ja,rotateByQuatAppend:()=>Va,rotateByQuatPrepend:()=>Ga,rotateX:()=>Oa,rotateY:()=>Ua,rotateZ:()=>Ba,scale:()=>qa,set:()=>Aa,setDual:()=>Da,setReal:()=>La,sqrLen:()=>es,squaredLength:()=>Ja,str:()=>rs,translate:()=>Na});var d={};r.r(d),r.d(d,{add:()=>cs,angle:()=>Os,ceil:()=>ps,clone:()=>is,copy:()=>ls,create:()=>ss,cross:()=>Is,dist:()=>qs,distance:()=>_s,div:()=>Hs,divide:()=>fs,dot:()=>ks,equals:()=>Gs,exactEquals:()=>Vs,floor:()=>ms,forEach:()=>Ys,fromValues:()=>os,inverse:()=>ws,len:()=>js,length:()=>Ts,lerp:()=>As,max:()=>ys,min:()=>gs,mul:()=>Ws,multiply:()=>ds,negate:()=>Es,normalize:()=>Rs,random:()=>Ps,rotate:()=>Ns,round:()=>vs,scale:()=>bs,scaleAndAdd:()=>Ms,set:()=>us,sqrDist:()=>zs,sqrLen:()=>$s,squaredDistance:()=>xs,squaredLength:()=>Ss,str:()=>Bs,sub:()=>Xs,subtract:()=>hs,transformMat2:()=>Cs,transformMat2d:()=>Ls,transformMat3:()=>Ds,transformMat4:()=>Fs,zero:()=>Us});var f=1e-6,p="undefined"!=typeof Float32Array?Float32Array:Array,m=Math.random;function g(e){p=e}var y=Math.PI/180;function v(e){return e*y}function b(e,t){return Math.abs(e-t)<=f*Math.max(1,Math.abs(e),Math.abs(t))}function M(){var e=new p(4);return p!=Float32Array&&(e[1]=0,e[2]=0),e[0]=1,e[3]=1,e}function _(e){var t=new p(4);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t}function x(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e}function T(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e}function S(e,t,r,n){var a=new p(4);return a[0]=e,a[1]=t,a[2]=r,a[3]=n,a}function E(e,t,r,n,a){return e[0]=t,e[1]=r,e[2]=n,e[3]=a,e}function w(e,t){if(e===t){var r=t[1];e[1]=t[2],e[2]=r}else e[0]=t[0],e[1]=t[2],e[2]=t[1],e[3]=t[3];return e}function R(e,t){var r=t[0],n=t[1],a=t[2],s=t[3],i=r*s-a*n;return i?(i=1/i,e[0]=s*i,e[1]=-n*i,e[2]=-a*i,e[3]=r*i,e):null}function k(e,t){var r=t[0];return e[0]=t[3],e[1]=-t[1],e[2]=-t[2],e[3]=r,e}function I(e){return e[0]*e[3]-e[2]*e[1]}function A(e,t,r){var n=t[0],a=t[1],s=t[2],i=t[3],o=r[0],l=r[1],u=r[2],c=r[3];return e[0]=n*o+s*l,e[1]=a*o+i*l,e[2]=n*u+s*c,e[3]=a*u+i*c,e}function P(e,t,r){var n=t[0],a=t[1],s=t[2],i=t[3],o=Math.sin(r),l=Math.cos(r);return e[0]=n*l+s*o,e[1]=a*l+i*o,e[2]=n*-o+s*l,e[3]=a*-o+i*l,e}function C(e,t,r){var n=t[0],a=t[1],s=t[2],i=t[3],o=r[0],l=r[1];return e[0]=n*o,e[1]=a*o,e[2]=s*l,e[3]=i*l,e}function L(e,t){var r=Math.sin(t),n=Math.cos(t);return e[0]=n,e[1]=r,e[2]=-r,e[3]=n,e}function D(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=t[1],e}function F(e){return"mat2("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"}function N(e){return Math.hypot(e[0],e[1],e[2],e[3])}function O(e,t,r,n){return e[2]=n[2]/n[0],r[0]=n[0],r[1]=n[1],r[3]=n[3]-e[2]*r[1],[e,t,r]}function U(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e[3]=t[3]+r[3],e}function B(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e[3]=t[3]-r[3],e}function V(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]}function G(e,t){var r=e[0],n=e[1],a=e[2],s=e[3],i=t[0],o=t[1],l=t[2],u=t[3];return Math.abs(r-i)<=f*Math.max(1,Math.abs(r),Math.abs(i))&&Math.abs(n-o)<=f*Math.max(1,Math.abs(n),Math.abs(o))&&Math.abs(a-l)<=f*Math.max(1,Math.abs(a),Math.abs(l))&&Math.abs(s-u)<=f*Math.max(1,Math.abs(s),Math.abs(u))}function j(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e}function X(e,t,r,n){return e[0]=t[0]+r[0]*n,e[1]=t[1]+r[1]*n,e[2]=t[2]+r[2]*n,e[3]=t[3]+r[3]*n,e}Math.hypot||(Math.hypot=function(){for(var e=0,t=arguments.length;t--;)e+=arguments[t]*arguments[t];return Math.sqrt(e)});var W=A,H=B;function q(){var e=new p(6);return p!=Float32Array&&(e[1]=0,e[2]=0,e[4]=0,e[5]=0),e[0]=1,e[3]=1,e}function z(e){var t=new p(6);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t}function $(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e}function Y(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e[4]=0,e[5]=0,e}function K(e,t,r,n,a,s){var i=new p(6);return i[0]=e,i[1]=t,i[2]=r,i[3]=n,i[4]=a,i[5]=s,i}function Z(e,t,r,n,a,s,i){return e[0]=t,e[1]=r,e[2]=n,e[3]=a,e[4]=s,e[5]=i,e}function Q(e,t){var r=t[0],n=t[1],a=t[2],s=t[3],i=t[4],o=t[5],l=r*s-n*a;return l?(l=1/l,e[0]=s*l,e[1]=-n*l,e[2]=-a*l,e[3]=r*l,e[4]=(a*o-s*i)*l,e[5]=(n*i-r*o)*l,e):null}function J(e){return e[0]*e[3]-e[1]*e[2]}function ee(e,t,r){var n=t[0],a=t[1],s=t[2],i=t[3],o=t[4],l=t[5],u=r[0],c=r[1],h=r[2],d=r[3],f=r[4],p=r[5];return e[0]=n*u+s*c,e[1]=a*u+i*c,e[2]=n*h+s*d,e[3]=a*h+i*d,e[4]=n*f+s*p+o,e[5]=a*f+i*p+l,e}function te(e,t,r){var n=t[0],a=t[1],s=t[2],i=t[3],o=t[4],l=t[5],u=Math.sin(r),c=Math.cos(r);return e[0]=n*c+s*u,e[1]=a*c+i*u,e[2]=n*-u+s*c,e[3]=a*-u+i*c,e[4]=o,e[5]=l,e}function re(e,t,r){var n=t[0],a=t[1],s=t[2],i=t[3],o=t[4],l=t[5],u=r[0],c=r[1];return e[0]=n*u,e[1]=a*u,e[2]=s*c,e[3]=i*c,e[4]=o,e[5]=l,e}function ne(e,t,r){var n=t[0],a=t[1],s=t[2],i=t[3],o=t[4],l=t[5],u=r[0],c=r[1];return e[0]=n,e[1]=a,e[2]=s,e[3]=i,e[4]=n*u+s*c+o,e[5]=a*u+i*c+l,e}function ae(e,t){var r=Math.sin(t),n=Math.cos(t);return e[0]=n,e[1]=r,e[2]=-r,e[3]=n,e[4]=0,e[5]=0,e}function se(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=t[1],e[4]=0,e[5]=0,e}function ie(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e[4]=t[0],e[5]=t[1],e}function oe(e){return"mat2d("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+")"}function le(e){return Math.hypot(e[0],e[1],e[2],e[3],e[4],e[5],1)}function ue(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e[3]=t[3]+r[3],e[4]=t[4]+r[4],e[5]=t[5]+r[5],e}function ce(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e[3]=t[3]-r[3],e[4]=t[4]-r[4],e[5]=t[5]-r[5],e}function he(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e[4]=t[4]*r,e[5]=t[5]*r,e}function de(e,t,r,n){return e[0]=t[0]+r[0]*n,e[1]=t[1]+r[1]*n,e[2]=t[2]+r[2]*n,e[3]=t[3]+r[3]*n,e[4]=t[4]+r[4]*n,e[5]=t[5]+r[5]*n,e}function fe(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]}function pe(e,t){var r=e[0],n=e[1],a=e[2],s=e[3],i=e[4],o=e[5],l=t[0],u=t[1],c=t[2],h=t[3],d=t[4],p=t[5];return Math.abs(r-l)<=f*Math.max(1,Math.abs(r),Math.abs(l))&&Math.abs(n-u)<=f*Math.max(1,Math.abs(n),Math.abs(u))&&Math.abs(a-c)<=f*Math.max(1,Math.abs(a),Math.abs(c))&&Math.abs(s-h)<=f*Math.max(1,Math.abs(s),Math.abs(h))&&Math.abs(i-d)<=f*Math.max(1,Math.abs(i),Math.abs(d))&&Math.abs(o-p)<=f*Math.max(1,Math.abs(o),Math.abs(p))}var me=ee,ge=ce;function ye(){var e=new p(9);return p!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[5]=0,e[6]=0,e[7]=0),e[0]=1,e[4]=1,e[8]=1,e}function ve(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[4],e[4]=t[5],e[5]=t[6],e[6]=t[8],e[7]=t[9],e[8]=t[10],e}function be(e){var t=new p(9);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t}function Me(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e}function _e(e,t,r,n,a,s,i,o,l){var u=new p(9);return u[0]=e,u[1]=t,u[2]=r,u[3]=n,u[4]=a,u[5]=s,u[6]=i,u[7]=o,u[8]=l,u}function xe(e,t,r,n,a,s,i,o,l,u){return e[0]=t,e[1]=r,e[2]=n,e[3]=a,e[4]=s,e[5]=i,e[6]=o,e[7]=l,e[8]=u,e}function Te(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e}function Se(e,t){if(e===t){var r=t[1],n=t[2],a=t[5];e[1]=t[3],e[2]=t[6],e[3]=r,e[5]=t[7],e[6]=n,e[7]=a}else e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8];return e}function Ee(e,t){var r=t[0],n=t[1],a=t[2],s=t[3],i=t[4],o=t[5],l=t[6],u=t[7],c=t[8],h=c*i-o*u,d=-c*s+o*l,f=u*s-i*l,p=r*h+n*d+a*f;return p?(p=1/p,e[0]=h*p,e[1]=(-c*n+a*u)*p,e[2]=(o*n-a*i)*p,e[3]=d*p,e[4]=(c*r-a*l)*p,e[5]=(-o*r+a*s)*p,e[6]=f*p,e[7]=(-u*r+n*l)*p,e[8]=(i*r-n*s)*p,e):null}function we(e,t){var r=t[0],n=t[1],a=t[2],s=t[3],i=t[4],o=t[5],l=t[6],u=t[7],c=t[8];return e[0]=i*c-o*u,e[1]=a*u-n*c,e[2]=n*o-a*i,e[3]=o*l-s*c,e[4]=r*c-a*l,e[5]=a*s-r*o,e[6]=s*u-i*l,e[7]=n*l-r*u,e[8]=r*i-n*s,e}function Re(e){var t=e[0],r=e[1],n=e[2],a=e[3],s=e[4],i=e[5],o=e[6],l=e[7],u=e[8];return t*(u*s-i*l)+r*(-u*a+i*o)+n*(l*a-s*o)}function ke(e,t,r){var n=t[0],a=t[1],s=t[2],i=t[3],o=t[4],l=t[5],u=t[6],c=t[7],h=t[8],d=r[0],f=r[1],p=r[2],m=r[3],g=r[4],y=r[5],v=r[6],b=r[7],M=r[8];return e[0]=d*n+f*i+p*u,e[1]=d*a+f*o+p*c,e[2]=d*s+f*l+p*h,e[3]=m*n+g*i+y*u,e[4]=m*a+g*o+y*c,e[5]=m*s+g*l+y*h,e[6]=v*n+b*i+M*u,e[7]=v*a+b*o+M*c,e[8]=v*s+b*l+M*h,e}function Ie(e,t,r){var n=t[0],a=t[1],s=t[2],i=t[3],o=t[4],l=t[5],u=t[6],c=t[7],h=t[8],d=r[0],f=r[1];return e[0]=n,e[1]=a,e[2]=s,e[3]=i,e[4]=o,e[5]=l,e[6]=d*n+f*i+u,e[7]=d*a+f*o+c,e[8]=d*s+f*l+h,e}function Ae(e,t,r){var n=t[0],a=t[1],s=t[2],i=t[3],o=t[4],l=t[5],u=t[6],c=t[7],h=t[8],d=Math.sin(r),f=Math.cos(r);return e[0]=f*n+d*i,e[1]=f*a+d*o,e[2]=f*s+d*l,e[3]=f*i-d*n,e[4]=f*o-d*a,e[5]=f*l-d*s,e[6]=u,e[7]=c,e[8]=h,e}function Pe(e,t,r){var n=r[0],a=r[1];return e[0]=n*t[0],e[1]=n*t[1],e[2]=n*t[2],e[3]=a*t[3],e[4]=a*t[4],e[5]=a*t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e}function Ce(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=t[0],e[7]=t[1],e[8]=1,e}function Le(e,t){var r=Math.sin(t),n=Math.cos(t);return e[0]=n,e[1]=r,e[2]=0,e[3]=-r,e[4]=n,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e}function De(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=0,e[4]=t[1],e[5]=0,e[6]=0,e[7]=0,e[8]=1,e}function Fe(e,t){return e[0]=t[0],e[1]=t[1],e[2]=0,e[3]=t[2],e[4]=t[3],e[5]=0,e[6]=t[4],e[7]=t[5],e[8]=1,e}function Ne(e,t){var r=t[0],n=t[1],a=t[2],s=t[3],i=r+r,o=n+n,l=a+a,u=r*i,c=n*i,h=n*o,d=a*i,f=a*o,p=a*l,m=s*i,g=s*o,y=s*l;return e[0]=1-h-p,e[3]=c-y,e[6]=d+g,e[1]=c+y,e[4]=1-u-p,e[7]=f-m,e[2]=d-g,e[5]=f+m,e[8]=1-u-h,e}function Oe(e,t){var r=t[0],n=t[1],a=t[2],s=t[3],i=t[4],o=t[5],l=t[6],u=t[7],c=t[8],h=t[9],d=t[10],f=t[11],p=t[12],m=t[13],g=t[14],y=t[15],v=r*o-n*i,b=r*l-a*i,M=r*u-s*i,_=n*l-a*o,x=n*u-s*o,T=a*u-s*l,S=c*m-h*p,E=c*g-d*p,w=c*y-f*p,R=h*g-d*m,k=h*y-f*m,I=d*y-f*g,A=v*I-b*k+M*R+_*w-x*E+T*S;return A?(A=1/A,e[0]=(o*I-l*k+u*R)*A,e[1]=(l*w-i*I-u*E)*A,e[2]=(i*k-o*w+u*S)*A,e[3]=(a*k-n*I-s*R)*A,e[4]=(r*I-a*w+s*E)*A,e[5]=(n*w-r*k-s*S)*A,e[6]=(m*T-g*x+y*_)*A,e[7]=(g*M-p*T-y*b)*A,e[8]=(p*x-m*M+y*v)*A,e):null}function Ue(e,t,r){return e[0]=2/t,e[1]=0,e[2]=0,e[3]=0,e[4]=-2/r,e[5]=0,e[6]=-1,e[7]=1,e[8]=1,e}function Be(e){return"mat3("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+")"}function Ve(e){return Math.hypot(e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8])}function Ge(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e[3]=t[3]+r[3],e[4]=t[4]+r[4],e[5]=t[5]+r[5],e[6]=t[6]+r[6],e[7]=t[7]+r[7],e[8]=t[8]+r[8],e}function je(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e[3]=t[3]-r[3],e[4]=t[4]-r[4],e[5]=t[5]-r[5],e[6]=t[6]-r[6],e[7]=t[7]-r[7],e[8]=t[8]-r[8],e}function Xe(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e[4]=t[4]*r,e[5]=t[5]*r,e[6]=t[6]*r,e[7]=t[7]*r,e[8]=t[8]*r,e}function We(e,t,r,n){return e[0]=t[0]+r[0]*n,e[1]=t[1]+r[1]*n,e[2]=t[2]+r[2]*n,e[3]=t[3]+r[3]*n,e[4]=t[4]+r[4]*n,e[5]=t[5]+r[5]*n,e[6]=t[6]+r[6]*n,e[7]=t[7]+r[7]*n,e[8]=t[8]+r[8]*n,e}function He(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]&&e[8]===t[8]}function qe(e,t){var r=e[0],n=e[1],a=e[2],s=e[3],i=e[4],o=e[5],l=e[6],u=e[7],c=e[8],h=t[0],d=t[1],p=t[2],m=t[3],g=t[4],y=t[5],v=t[6],b=t[7],M=t[8];return Math.abs(r-h)<=f*Math.max(1,Math.abs(r),Math.abs(h))&&Math.abs(n-d)<=f*Math.max(1,Math.abs(n),Math.abs(d))&&Math.abs(a-p)<=f*Math.max(1,Math.abs(a),Math.abs(p))&&Math.abs(s-m)<=f*Math.max(1,Math.abs(s),Math.abs(m))&&Math.abs(i-g)<=f*Math.max(1,Math.abs(i),Math.abs(g))&&Math.abs(o-y)<=f*Math.max(1,Math.abs(o),Math.abs(y))&&Math.abs(l-v)<=f*Math.max(1,Math.abs(l),Math.abs(v))&&Math.abs(u-b)<=f*Math.max(1,Math.abs(u),Math.abs(b))&&Math.abs(c-M)<=f*Math.max(1,Math.abs(c),Math.abs(M))}var ze=ke,$e=je;function Ye(){var e=new p(16);return p!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0),e[0]=1,e[5]=1,e[10]=1,e[15]=1,e}function Ke(e){var t=new p(16);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function Ze(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function Qe(e,t,r,n,a,s,i,o,l,u,c,h,d,f,m,g){var y=new p(16);return y[0]=e,y[1]=t,y[2]=r,y[3]=n,y[4]=a,y[5]=s,y[6]=i,y[7]=o,y[8]=l,y[9]=u,y[10]=c,y[11]=h,y[12]=d,y[13]=f,y[14]=m,y[15]=g,y}function Je(e,t,r,n,a,s,i,o,l,u,c,h,d,f,p,m,g){return e[0]=t,e[1]=r,e[2]=n,e[3]=a,e[4]=s,e[5]=i,e[6]=o,e[7]=l,e[8]=u,e[9]=c,e[10]=h,e[11]=d,e[12]=f,e[13]=p,e[14]=m,e[15]=g,e}function et(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function tt(e,t){if(e===t){var r=t[1],n=t[2],a=t[3],s=t[6],i=t[7],o=t[11];e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=r,e[6]=t[9],e[7]=t[13],e[8]=n,e[9]=s,e[11]=t[14],e[12]=a,e[13]=i,e[14]=o}else e[0]=t[0],e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=t[1],e[5]=t[5],e[6]=t[9],e[7]=t[13],e[8]=t[2],e[9]=t[6],e[10]=t[10],e[11]=t[14],e[12]=t[3],e[13]=t[7],e[14]=t[11],e[15]=t[15];return e}function rt(e,t){var r=t[0],n=t[1],a=t[2],s=t[3],i=t[4],o=t[5],l=t[6],u=t[7],c=t[8],h=t[9],d=t[10],f=t[11],p=t[12],m=t[13],g=t[14],y=t[15],v=r*o-n*i,b=r*l-a*i,M=r*u-s*i,_=n*l-a*o,x=n*u-s*o,T=a*u-s*l,S=c*m-h*p,E=c*g-d*p,w=c*y-f*p,R=h*g-d*m,k=h*y-f*m,I=d*y-f*g,A=v*I-b*k+M*R+_*w-x*E+T*S;return A?(A=1/A,e[0]=(o*I-l*k+u*R)*A,e[1]=(a*k-n*I-s*R)*A,e[2]=(m*T-g*x+y*_)*A,e[3]=(d*x-h*T-f*_)*A,e[4]=(l*w-i*I-u*E)*A,e[5]=(r*I-a*w+s*E)*A,e[6]=(g*M-p*T-y*b)*A,e[7]=(c*T-d*M+f*b)*A,e[8]=(i*k-o*w+u*S)*A,e[9]=(n*w-r*k-s*S)*A,e[10]=(p*x-m*M+y*v)*A,e[11]=(h*M-c*x-f*v)*A,e[12]=(o*E-i*R-l*S)*A,e[13]=(r*R-n*E+a*S)*A,e[14]=(m*b-p*_-g*v)*A,e[15]=(c*_-h*b+d*v)*A,e):null}function nt(e,t){var r=t[0],n=t[1],a=t[2],s=t[3],i=t[4],o=t[5],l=t[6],u=t[7],c=t[8],h=t[9],d=t[10],f=t[11],p=t[12],m=t[13],g=t[14],y=t[15];return e[0]=o*(d*y-f*g)-h*(l*y-u*g)+m*(l*f-u*d),e[1]=-(n*(d*y-f*g)-h*(a*y-s*g)+m*(a*f-s*d)),e[2]=n*(l*y-u*g)-o*(a*y-s*g)+m*(a*u-s*l),e[3]=-(n*(l*f-u*d)-o*(a*f-s*d)+h*(a*u-s*l)),e[4]=-(i*(d*y-f*g)-c*(l*y-u*g)+p*(l*f-u*d)),e[5]=r*(d*y-f*g)-c*(a*y-s*g)+p*(a*f-s*d),e[6]=-(r*(l*y-u*g)-i*(a*y-s*g)+p*(a*u-s*l)),e[7]=r*(l*f-u*d)-i*(a*f-s*d)+c*(a*u-s*l),e[8]=i*(h*y-f*m)-c*(o*y-u*m)+p*(o*f-u*h),e[9]=-(r*(h*y-f*m)-c*(n*y-s*m)+p*(n*f-s*h)),e[10]=r*(o*y-u*m)-i*(n*y-s*m)+p*(n*u-s*o),e[11]=-(r*(o*f-u*h)-i*(n*f-s*h)+c*(n*u-s*o)),e[12]=-(i*(h*g-d*m)-c*(o*g-l*m)+p*(o*d-l*h)),e[13]=r*(h*g-d*m)-c*(n*g-a*m)+p*(n*d-a*h),e[14]=-(r*(o*g-l*m)-i*(n*g-a*m)+p*(n*l-a*o)),e[15]=r*(o*d-l*h)-i*(n*d-a*h)+c*(n*l-a*o),e}function at(e){var t=e[0],r=e[1],n=e[2],a=e[3],s=e[4],i=e[5],o=e[6],l=e[7],u=e[8],c=e[9],h=e[10],d=e[11],f=e[12],p=e[13],m=e[14],g=e[15];return(t*i-r*s)*(h*g-d*m)-(t*o-n*s)*(c*g-d*p)+(t*l-a*s)*(c*m-h*p)+(r*o-n*i)*(u*g-d*f)-(r*l-a*i)*(u*m-h*f)+(n*l-a*o)*(u*p-c*f)}function st(e,t,r){var n=t[0],a=t[1],s=t[2],i=t[3],o=t[4],l=t[5],u=t[6],c=t[7],h=t[8],d=t[9],f=t[10],p=t[11],m=t[12],g=t[13],y=t[14],v=t[15],b=r[0],M=r[1],_=r[2],x=r[3];return e[0]=b*n+M*o+_*h+x*m,e[1]=b*a+M*l+_*d+x*g,e[2]=b*s+M*u+_*f+x*y,e[3]=b*i+M*c+_*p+x*v,b=r[4],M=r[5],_=r[6],x=r[7],e[4]=b*n+M*o+_*h+x*m,e[5]=b*a+M*l+_*d+x*g,e[6]=b*s+M*u+_*f+x*y,e[7]=b*i+M*c+_*p+x*v,b=r[8],M=r[9],_=r[10],x=r[11],e[8]=b*n+M*o+_*h+x*m,e[9]=b*a+M*l+_*d+x*g,e[10]=b*s+M*u+_*f+x*y,e[11]=b*i+M*c+_*p+x*v,b=r[12],M=r[13],_=r[14],x=r[15],e[12]=b*n+M*o+_*h+x*m,e[13]=b*a+M*l+_*d+x*g,e[14]=b*s+M*u+_*f+x*y,e[15]=b*i+M*c+_*p+x*v,e}function it(e,t,r){var n,a,s,i,o,l,u,c,h,d,f,p,m=r[0],g=r[1],y=r[2];return t===e?(e[12]=t[0]*m+t[4]*g+t[8]*y+t[12],e[13]=t[1]*m+t[5]*g+t[9]*y+t[13],e[14]=t[2]*m+t[6]*g+t[10]*y+t[14],e[15]=t[3]*m+t[7]*g+t[11]*y+t[15]):(n=t[0],a=t[1],s=t[2],i=t[3],o=t[4],l=t[5],u=t[6],c=t[7],h=t[8],d=t[9],f=t[10],p=t[11],e[0]=n,e[1]=a,e[2]=s,e[3]=i,e[4]=o,e[5]=l,e[6]=u,e[7]=c,e[8]=h,e[9]=d,e[10]=f,e[11]=p,e[12]=n*m+o*g+h*y+t[12],e[13]=a*m+l*g+d*y+t[13],e[14]=s*m+u*g+f*y+t[14],e[15]=i*m+c*g+p*y+t[15]),e}function ot(e,t,r){var n=r[0],a=r[1],s=r[2];return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e[3]=t[3]*n,e[4]=t[4]*a,e[5]=t[5]*a,e[6]=t[6]*a,e[7]=t[7]*a,e[8]=t[8]*s,e[9]=t[9]*s,e[10]=t[10]*s,e[11]=t[11]*s,e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function lt(e,t,r,n){var a,s,i,o,l,u,c,h,d,p,m,g,y,v,b,M,_,x,T,S,E,w,R,k,I=n[0],A=n[1],P=n[2],C=Math.hypot(I,A,P);return C<f?null:(I*=C=1/C,A*=C,P*=C,a=Math.sin(r),i=1-(s=Math.cos(r)),o=t[0],l=t[1],u=t[2],c=t[3],h=t[4],d=t[5],p=t[6],m=t[7],g=t[8],y=t[9],v=t[10],b=t[11],M=I*I*i+s,_=A*I*i+P*a,x=P*I*i-A*a,T=I*A*i-P*a,S=A*A*i+s,E=P*A*i+I*a,w=I*P*i+A*a,R=A*P*i-I*a,k=P*P*i+s,e[0]=o*M+h*_+g*x,e[1]=l*M+d*_+y*x,e[2]=u*M+p*_+v*x,e[3]=c*M+m*_+b*x,e[4]=o*T+h*S+g*E,e[5]=l*T+d*S+y*E,e[6]=u*T+p*S+v*E,e[7]=c*T+m*S+b*E,e[8]=o*w+h*R+g*k,e[9]=l*w+d*R+y*k,e[10]=u*w+p*R+v*k,e[11]=c*w+m*R+b*k,t!==e&&(e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e)}function ut(e,t,r){var n=Math.sin(r),a=Math.cos(r),s=t[4],i=t[5],o=t[6],l=t[7],u=t[8],c=t[9],h=t[10],d=t[11];return t!==e&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[4]=s*a+u*n,e[5]=i*a+c*n,e[6]=o*a+h*n,e[7]=l*a+d*n,e[8]=u*a-s*n,e[9]=c*a-i*n,e[10]=h*a-o*n,e[11]=d*a-l*n,e}function ct(e,t,r){var n=Math.sin(r),a=Math.cos(r),s=t[0],i=t[1],o=t[2],l=t[3],u=t[8],c=t[9],h=t[10],d=t[11];return t!==e&&(e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=s*a-u*n,e[1]=i*a-c*n,e[2]=o*a-h*n,e[3]=l*a-d*n,e[8]=s*n+u*a,e[9]=i*n+c*a,e[10]=o*n+h*a,e[11]=l*n+d*a,e}function ht(e,t,r){var n=Math.sin(r),a=Math.cos(r),s=t[0],i=t[1],o=t[2],l=t[3],u=t[4],c=t[5],h=t[6],d=t[7];return t!==e&&(e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=s*a+u*n,e[1]=i*a+c*n,e[2]=o*a+h*n,e[3]=l*a+d*n,e[4]=u*a-s*n,e[5]=c*a-i*n,e[6]=h*a-o*n,e[7]=d*a-l*n,e}function dt(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=t[0],e[13]=t[1],e[14]=t[2],e[15]=1,e}function ft(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=t[1],e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=t[2],e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function pt(e,t,r){var n,a,s,i=r[0],o=r[1],l=r[2],u=Math.hypot(i,o,l);return u<f?null:(i*=u=1/u,o*=u,l*=u,n=Math.sin(t),s=1-(a=Math.cos(t)),e[0]=i*i*s+a,e[1]=o*i*s+l*n,e[2]=l*i*s-o*n,e[3]=0,e[4]=i*o*s-l*n,e[5]=o*o*s+a,e[6]=l*o*s+i*n,e[7]=0,e[8]=i*l*s+o*n,e[9]=o*l*s-i*n,e[10]=l*l*s+a,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e)}function mt(e,t){var r=Math.sin(t),n=Math.cos(t);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=n,e[6]=r,e[7]=0,e[8]=0,e[9]=-r,e[10]=n,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function gt(e,t){var r=Math.sin(t),n=Math.cos(t);return e[0]=n,e[1]=0,e[2]=-r,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=r,e[9]=0,e[10]=n,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function yt(e,t){var r=Math.sin(t),n=Math.cos(t);return e[0]=n,e[1]=r,e[2]=0,e[3]=0,e[4]=-r,e[5]=n,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function vt(e,t,r){var n=t[0],a=t[1],s=t[2],i=t[3],o=n+n,l=a+a,u=s+s,c=n*o,h=n*l,d=n*u,f=a*l,p=a*u,m=s*u,g=i*o,y=i*l,v=i*u;return e[0]=1-(f+m),e[1]=h+v,e[2]=d-y,e[3]=0,e[4]=h-v,e[5]=1-(c+m),e[6]=p+g,e[7]=0,e[8]=d+y,e[9]=p-g,e[10]=1-(c+f),e[11]=0,e[12]=r[0],e[13]=r[1],e[14]=r[2],e[15]=1,e}function bt(e,t){var r=new p(3),n=-t[0],a=-t[1],s=-t[2],i=t[3],o=t[4],l=t[5],u=t[6],c=t[7],h=n*n+a*a+s*s+i*i;return h>0?(r[0]=2*(o*i+c*n+l*s-u*a)/h,r[1]=2*(l*i+c*a+u*n-o*s)/h,r[2]=2*(u*i+c*s+o*a-l*n)/h):(r[0]=2*(o*i+c*n+l*s-u*a),r[1]=2*(l*i+c*a+u*n-o*s),r[2]=2*(u*i+c*s+o*a-l*n)),vt(e,t,r),e}function Mt(e,t){return e[0]=t[12],e[1]=t[13],e[2]=t[14],e}function _t(e,t){var r=t[0],n=t[1],a=t[2],s=t[4],i=t[5],o=t[6],l=t[8],u=t[9],c=t[10];return e[0]=Math.hypot(r,n,a),e[1]=Math.hypot(s,i,o),e[2]=Math.hypot(l,u,c),e}function xt(e,t){var r=new p(3);_t(r,t);var n=1/r[0],a=1/r[1],s=1/r[2],i=t[0]*n,o=t[1]*a,l=t[2]*s,u=t[4]*n,c=t[5]*a,h=t[6]*s,d=t[8]*n,f=t[9]*a,m=t[10]*s,g=i+c+m,y=0;return g>0?(y=2*Math.sqrt(g+1),e[3]=.25*y,e[0]=(h-f)/y,e[1]=(d-l)/y,e[2]=(o-u)/y):i>c&&i>m?(y=2*Math.sqrt(1+i-c-m),e[3]=(h-f)/y,e[0]=.25*y,e[1]=(o+u)/y,e[2]=(d+l)/y):c>m?(y=2*Math.sqrt(1+c-i-m),e[3]=(d-l)/y,e[0]=(o+u)/y,e[1]=.25*y,e[2]=(h+f)/y):(y=2*Math.sqrt(1+m-i-c),e[3]=(o-u)/y,e[0]=(d+l)/y,e[1]=(h+f)/y,e[2]=.25*y),e}function Tt(e,t,r,n){var a=t[0],s=t[1],i=t[2],o=t[3],l=a+a,u=s+s,c=i+i,h=a*l,d=a*u,f=a*c,p=s*u,m=s*c,g=i*c,y=o*l,v=o*u,b=o*c,M=n[0],_=n[1],x=n[2];return e[0]=(1-(p+g))*M,e[1]=(d+b)*M,e[2]=(f-v)*M,e[3]=0,e[4]=(d-b)*_,e[5]=(1-(h+g))*_,e[6]=(m+y)*_,e[7]=0,e[8]=(f+v)*x,e[9]=(m-y)*x,e[10]=(1-(h+p))*x,e[11]=0,e[12]=r[0],e[13]=r[1],e[14]=r[2],e[15]=1,e}function St(e,t,r,n,a){var s=t[0],i=t[1],o=t[2],l=t[3],u=s+s,c=i+i,h=o+o,d=s*u,f=s*c,p=s*h,m=i*c,g=i*h,y=o*h,v=l*u,b=l*c,M=l*h,_=n[0],x=n[1],T=n[2],S=a[0],E=a[1],w=a[2],R=(1-(m+y))*_,k=(f+M)*_,I=(p-b)*_,A=(f-M)*x,P=(1-(d+y))*x,C=(g+v)*x,L=(p+b)*T,D=(g-v)*T,F=(1-(d+m))*T;return e[0]=R,e[1]=k,e[2]=I,e[3]=0,e[4]=A,e[5]=P,e[6]=C,e[7]=0,e[8]=L,e[9]=D,e[10]=F,e[11]=0,e[12]=r[0]+S-(R*S+A*E+L*w),e[13]=r[1]+E-(k*S+P*E+D*w),e[14]=r[2]+w-(I*S+C*E+F*w),e[15]=1,e}function Et(e,t){var r=t[0],n=t[1],a=t[2],s=t[3],i=r+r,o=n+n,l=a+a,u=r*i,c=n*i,h=n*o,d=a*i,f=a*o,p=a*l,m=s*i,g=s*o,y=s*l;return e[0]=1-h-p,e[1]=c+y,e[2]=d-g,e[3]=0,e[4]=c-y,e[5]=1-u-p,e[6]=f+m,e[7]=0,e[8]=d+g,e[9]=f-m,e[10]=1-u-h,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function wt(e,t,r,n,a,s,i){var o=1/(r-t),l=1/(a-n),u=1/(s-i);return e[0]=2*s*o,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=2*s*l,e[6]=0,e[7]=0,e[8]=(r+t)*o,e[9]=(a+n)*l,e[10]=(i+s)*u,e[11]=-1,e[12]=0,e[13]=0,e[14]=i*s*2*u,e[15]=0,e}function Rt(e,t,r,n,a){var s,i=1/Math.tan(t/2);return e[0]=i/r,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=i,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,null!=a&&a!==1/0?(s=1/(n-a),e[10]=(a+n)*s,e[14]=2*a*n*s):(e[10]=-1,e[14]=-2*n),e}var kt=Rt;function It(e,t,r,n,a){var s,i=1/Math.tan(t/2);return e[0]=i/r,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=i,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,null!=a&&a!==1/0?(s=1/(n-a),e[10]=a*s,e[14]=a*n*s):(e[10]=-1,e[14]=-n),e}function At(e,t,r,n){var a=Math.tan(t.upDegrees*Math.PI/180),s=Math.tan(t.downDegrees*Math.PI/180),i=Math.tan(t.leftDegrees*Math.PI/180),o=Math.tan(t.rightDegrees*Math.PI/180),l=2/(i+o),u=2/(a+s);return e[0]=l,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=u,e[6]=0,e[7]=0,e[8]=-(i-o)*l*.5,e[9]=(a-s)*u*.5,e[10]=n/(r-n),e[11]=-1,e[12]=0,e[13]=0,e[14]=n*r/(r-n),e[15]=0,e}function Pt(e,t,r,n,a,s,i){var o=1/(t-r),l=1/(n-a),u=1/(s-i);return e[0]=-2*o,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*l,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*u,e[11]=0,e[12]=(t+r)*o,e[13]=(a+n)*l,e[14]=(i+s)*u,e[15]=1,e}var Ct=Pt;function Lt(e,t,r,n,a,s,i){var o=1/(t-r),l=1/(n-a),u=1/(s-i);return e[0]=-2*o,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*l,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=u,e[11]=0,e[12]=(t+r)*o,e[13]=(a+n)*l,e[14]=s*u,e[15]=1,e}function Dt(e,t,r,n){var a,s,i,o,l,u,c,h,d,p,m=t[0],g=t[1],y=t[2],v=n[0],b=n[1],M=n[2],_=r[0],x=r[1],T=r[2];return Math.abs(m-_)<f&&Math.abs(g-x)<f&&Math.abs(y-T)<f?et(e):(c=m-_,h=g-x,d=y-T,a=b*(d*=p=1/Math.hypot(c,h,d))-M*(h*=p),s=M*(c*=p)-v*d,i=v*h-b*c,(p=Math.hypot(a,s,i))?(a*=p=1/p,s*=p,i*=p):(a=0,s=0,i=0),o=h*i-d*s,l=d*a-c*i,u=c*s-h*a,(p=Math.hypot(o,l,u))?(o*=p=1/p,l*=p,u*=p):(o=0,l=0,u=0),e[0]=a,e[1]=o,e[2]=c,e[3]=0,e[4]=s,e[5]=l,e[6]=h,e[7]=0,e[8]=i,e[9]=u,e[10]=d,e[11]=0,e[12]=-(a*m+s*g+i*y),e[13]=-(o*m+l*g+u*y),e[14]=-(c*m+h*g+d*y),e[15]=1,e)}function Ft(e,t,r,n){var a=t[0],s=t[1],i=t[2],o=n[0],l=n[1],u=n[2],c=a-r[0],h=s-r[1],d=i-r[2],f=c*c+h*h+d*d;f>0&&(c*=f=1/Math.sqrt(f),h*=f,d*=f);var p=l*d-u*h,m=u*c-o*d,g=o*h-l*c;return(f=p*p+m*m+g*g)>0&&(p*=f=1/Math.sqrt(f),m*=f,g*=f),e[0]=p,e[1]=m,e[2]=g,e[3]=0,e[4]=h*g-d*m,e[5]=d*p-c*g,e[6]=c*m-h*p,e[7]=0,e[8]=c,e[9]=h,e[10]=d,e[11]=0,e[12]=a,e[13]=s,e[14]=i,e[15]=1,e}function Nt(e){return"mat4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+", "+e[9]+", "+e[10]+", "+e[11]+", "+e[12]+", "+e[13]+", "+e[14]+", "+e[15]+")"}function Ot(e){return Math.hypot(e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8],e[9],e[10],e[11],e[12],e[13],e[14],e[15])}function Ut(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e[3]=t[3]+r[3],e[4]=t[4]+r[4],e[5]=t[5]+r[5],e[6]=t[6]+r[6],e[7]=t[7]+r[7],e[8]=t[8]+r[8],e[9]=t[9]+r[9],e[10]=t[10]+r[10],e[11]=t[11]+r[11],e[12]=t[12]+r[12],e[13]=t[13]+r[13],e[14]=t[14]+r[14],e[15]=t[15]+r[15],e}function Bt(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e[3]=t[3]-r[3],e[4]=t[4]-r[4],e[5]=t[5]-r[5],e[6]=t[6]-r[6],e[7]=t[7]-r[7],e[8]=t[8]-r[8],e[9]=t[9]-r[9],e[10]=t[10]-r[10],e[11]=t[11]-r[11],e[12]=t[12]-r[12],e[13]=t[13]-r[13],e[14]=t[14]-r[14],e[15]=t[15]-r[15],e}function Vt(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e[4]=t[4]*r,e[5]=t[5]*r,e[6]=t[6]*r,e[7]=t[7]*r,e[8]=t[8]*r,e[9]=t[9]*r,e[10]=t[10]*r,e[11]=t[11]*r,e[12]=t[12]*r,e[13]=t[13]*r,e[14]=t[14]*r,e[15]=t[15]*r,e}function Gt(e,t,r,n){return e[0]=t[0]+r[0]*n,e[1]=t[1]+r[1]*n,e[2]=t[2]+r[2]*n,e[3]=t[3]+r[3]*n,e[4]=t[4]+r[4]*n,e[5]=t[5]+r[5]*n,e[6]=t[6]+r[6]*n,e[7]=t[7]+r[7]*n,e[8]=t[8]+r[8]*n,e[9]=t[9]+r[9]*n,e[10]=t[10]+r[10]*n,e[11]=t[11]+r[11]*n,e[12]=t[12]+r[12]*n,e[13]=t[13]+r[13]*n,e[14]=t[14]+r[14]*n,e[15]=t[15]+r[15]*n,e}function jt(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]&&e[8]===t[8]&&e[9]===t[9]&&e[10]===t[10]&&e[11]===t[11]&&e[12]===t[12]&&e[13]===t[13]&&e[14]===t[14]&&e[15]===t[15]}function Xt(e,t){var r=e[0],n=e[1],a=e[2],s=e[3],i=e[4],o=e[5],l=e[6],u=e[7],c=e[8],h=e[9],d=e[10],p=e[11],m=e[12],g=e[13],y=e[14],v=e[15],b=t[0],M=t[1],_=t[2],x=t[3],T=t[4],S=t[5],E=t[6],w=t[7],R=t[8],k=t[9],I=t[10],A=t[11],P=t[12],C=t[13],L=t[14],D=t[15];return Math.abs(r-b)<=f*Math.max(1,Math.abs(r),Math.abs(b))&&Math.abs(n-M)<=f*Math.max(1,Math.abs(n),Math.abs(M))&&Math.abs(a-_)<=f*Math.max(1,Math.abs(a),Math.abs(_))&&Math.abs(s-x)<=f*Math.max(1,Math.abs(s),Math.abs(x))&&Math.abs(i-T)<=f*Math.max(1,Math.abs(i),Math.abs(T))&&Math.abs(o-S)<=f*Math.max(1,Math.abs(o),Math.abs(S))&&Math.abs(l-E)<=f*Math.max(1,Math.abs(l),Math.abs(E))&&Math.abs(u-w)<=f*Math.max(1,Math.abs(u),Math.abs(w))&&Math.abs(c-R)<=f*Math.max(1,Math.abs(c),Math.abs(R))&&Math.abs(h-k)<=f*Math.max(1,Math.abs(h),Math.abs(k))&&Math.abs(d-I)<=f*Math.max(1,Math.abs(d),Math.abs(I))&&Math.abs(p-A)<=f*Math.max(1,Math.abs(p),Math.abs(A))&&Math.abs(m-P)<=f*Math.max(1,Math.abs(m),Math.abs(P))&&Math.abs(g-C)<=f*Math.max(1,Math.abs(g),Math.abs(C))&&Math.abs(y-L)<=f*Math.max(1,Math.abs(y),Math.abs(L))&&Math.abs(v-D)<=f*Math.max(1,Math.abs(v),Math.abs(D))}var Wt=st,Ht=Bt;function qt(){var e=new p(3);return p!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e}function zt(e){var t=new p(3);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}function $t(e){var t=e[0],r=e[1],n=e[2];return Math.hypot(t,r,n)}function Yt(e,t,r){var n=new p(3);return n[0]=e,n[1]=t,n[2]=r,n}function Kt(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e}function Zt(e,t,r,n){return e[0]=t,e[1]=r,e[2]=n,e}function Qt(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e}function Jt(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e}function er(e,t,r){return e[0]=t[0]*r[0],e[1]=t[1]*r[1],e[2]=t[2]*r[2],e}function tr(e,t,r){return e[0]=t[0]/r[0],e[1]=t[1]/r[1],e[2]=t[2]/r[2],e}function rr(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e[2]=Math.ceil(t[2]),e}function nr(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e[2]=Math.floor(t[2]),e}function ar(e,t,r){return e[0]=Math.min(t[0],r[0]),e[1]=Math.min(t[1],r[1]),e[2]=Math.min(t[2],r[2]),e}function sr(e,t,r){return e[0]=Math.max(t[0],r[0]),e[1]=Math.max(t[1],r[1]),e[2]=Math.max(t[2],r[2]),e}function ir(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e[2]=Math.round(t[2]),e}function or(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e}function lr(e,t,r,n){return e[0]=t[0]+r[0]*n,e[1]=t[1]+r[1]*n,e[2]=t[2]+r[2]*n,e}function ur(e,t){var r=t[0]-e[0],n=t[1]-e[1],a=t[2]-e[2];return Math.hypot(r,n,a)}function cr(e,t){var r=t[0]-e[0],n=t[1]-e[1],a=t[2]-e[2];return r*r+n*n+a*a}function hr(e){var t=e[0],r=e[1],n=e[2];return t*t+r*r+n*n}function dr(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e}function fr(e,t){return e[0]=1/t[0],e[1]=1/t[1],e[2]=1/t[2],e}function pr(e,t){var r=t[0],n=t[1],a=t[2],s=r*r+n*n+a*a;return s>0&&(s=1/Math.sqrt(s)),e[0]=t[0]*s,e[1]=t[1]*s,e[2]=t[2]*s,e}function mr(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function gr(e,t,r){var n=t[0],a=t[1],s=t[2],i=r[0],o=r[1],l=r[2];return e[0]=a*l-s*o,e[1]=s*i-n*l,e[2]=n*o-a*i,e}function yr(e,t,r,n){var a=t[0],s=t[1],i=t[2];return e[0]=a+n*(r[0]-a),e[1]=s+n*(r[1]-s),e[2]=i+n*(r[2]-i),e}function vr(e,t,r,n,a,s){var i=s*s,o=i*(2*s-3)+1,l=i*(s-2)+s,u=i*(s-1),c=i*(3-2*s);return e[0]=t[0]*o+r[0]*l+n[0]*u+a[0]*c,e[1]=t[1]*o+r[1]*l+n[1]*u+a[1]*c,e[2]=t[2]*o+r[2]*l+n[2]*u+a[2]*c,e}function br(e,t,r,n,a,s){var i=1-s,o=i*i,l=s*s,u=o*i,c=3*s*o,h=3*l*i,d=l*s;return e[0]=t[0]*u+r[0]*c+n[0]*h+a[0]*d,e[1]=t[1]*u+r[1]*c+n[1]*h+a[1]*d,e[2]=t[2]*u+r[2]*c+n[2]*h+a[2]*d,e}function Mr(e,t){t=t||1;var r=2*m()*Math.PI,n=2*m()-1,a=Math.sqrt(1-n*n)*t;return e[0]=Math.cos(r)*a,e[1]=Math.sin(r)*a,e[2]=n*t,e}function _r(e,t,r){var n=t[0],a=t[1],s=t[2],i=r[3]*n+r[7]*a+r[11]*s+r[15];return i=i||1,e[0]=(r[0]*n+r[4]*a+r[8]*s+r[12])/i,e[1]=(r[1]*n+r[5]*a+r[9]*s+r[13])/i,e[2]=(r[2]*n+r[6]*a+r[10]*s+r[14])/i,e}function xr(e,t,r){var n=t[0],a=t[1],s=t[2];return e[0]=n*r[0]+a*r[3]+s*r[6],e[1]=n*r[1]+a*r[4]+s*r[7],e[2]=n*r[2]+a*r[5]+s*r[8],e}function Tr(e,t,r){var n=r[0],a=r[1],s=r[2],i=r[3],o=t[0],l=t[1],u=t[2],c=a*u-s*l,h=s*o-n*u,d=n*l-a*o,f=a*d-s*h,p=s*c-n*d,m=n*h-a*c,g=2*i;return c*=g,h*=g,d*=g,f*=2,p*=2,m*=2,e[0]=o+c+f,e[1]=l+h+p,e[2]=u+d+m,e}function Sr(e,t,r,n){var a=[],s=[];return a[0]=t[0]-r[0],a[1]=t[1]-r[1],a[2]=t[2]-r[2],s[0]=a[0],s[1]=a[1]*Math.cos(n)-a[2]*Math.sin(n),s[2]=a[1]*Math.sin(n)+a[2]*Math.cos(n),e[0]=s[0]+r[0],e[1]=s[1]+r[1],e[2]=s[2]+r[2],e}function Er(e,t,r,n){var a=[],s=[];return a[0]=t[0]-r[0],a[1]=t[1]-r[1],a[2]=t[2]-r[2],s[0]=a[2]*Math.sin(n)+a[0]*Math.cos(n),s[1]=a[1],s[2]=a[2]*Math.cos(n)-a[0]*Math.sin(n),e[0]=s[0]+r[0],e[1]=s[1]+r[1],e[2]=s[2]+r[2],e}function wr(e,t,r,n){var a=[],s=[];return a[0]=t[0]-r[0],a[1]=t[1]-r[1],a[2]=t[2]-r[2],s[0]=a[0]*Math.cos(n)-a[1]*Math.sin(n),s[1]=a[0]*Math.sin(n)+a[1]*Math.cos(n),s[2]=a[2],e[0]=s[0]+r[0],e[1]=s[1]+r[1],e[2]=s[2]+r[2],e}function Rr(e,t){var r=e[0],n=e[1],a=e[2],s=t[0],i=t[1],o=t[2],l=Math.sqrt(r*r+n*n+a*a)*Math.sqrt(s*s+i*i+o*o),u=l&&mr(e,t)/l;return Math.acos(Math.min(Math.max(u,-1),1))}function kr(e){return e[0]=0,e[1]=0,e[2]=0,e}function Ir(e){return"vec3("+e[0]+", "+e[1]+", "+e[2]+")"}function Ar(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]}function Pr(e,t){var r=e[0],n=e[1],a=e[2],s=t[0],i=t[1],o=t[2];return Math.abs(r-s)<=f*Math.max(1,Math.abs(r),Math.abs(s))&&Math.abs(n-i)<=f*Math.max(1,Math.abs(n),Math.abs(i))&&Math.abs(a-o)<=f*Math.max(1,Math.abs(a),Math.abs(o))}var Cr,Lr=Jt,Dr=er,Fr=tr,Nr=ur,Or=cr,Ur=$t,Br=hr,Vr=(Cr=qt(),function(e,t,r,n,a,s){var i,o;for(t||(t=3),r||(r=0),o=n?Math.min(n*t+r,e.length):e.length,i=r;i<o;i+=t)Cr[0]=e[i],Cr[1]=e[i+1],Cr[2]=e[i+2],a(Cr,Cr,s),e[i]=Cr[0],e[i+1]=Cr[1],e[i+2]=Cr[2];return e});function Gr(){var e=new p(4);return p!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0,e[3]=0),e}function jr(e){var t=new p(4);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t}function Xr(e,t,r,n){var a=new p(4);return a[0]=e,a[1]=t,a[2]=r,a[3]=n,a}function Wr(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e}function Hr(e,t,r,n,a){return e[0]=t,e[1]=r,e[2]=n,e[3]=a,e}function qr(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e[3]=t[3]+r[3],e}function zr(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e[3]=t[3]-r[3],e}function $r(e,t,r){return e[0]=t[0]*r[0],e[1]=t[1]*r[1],e[2]=t[2]*r[2],e[3]=t[3]*r[3],e}function Yr(e,t,r){return e[0]=t[0]/r[0],e[1]=t[1]/r[1],e[2]=t[2]/r[2],e[3]=t[3]/r[3],e}function Kr(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e[2]=Math.ceil(t[2]),e[3]=Math.ceil(t[3]),e}function Zr(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e[2]=Math.floor(t[2]),e[3]=Math.floor(t[3]),e}function Qr(e,t,r){return e[0]=Math.min(t[0],r[0]),e[1]=Math.min(t[1],r[1]),e[2]=Math.min(t[2],r[2]),e[3]=Math.min(t[3],r[3]),e}function Jr(e,t,r){return e[0]=Math.max(t[0],r[0]),e[1]=Math.max(t[1],r[1]),e[2]=Math.max(t[2],r[2]),e[3]=Math.max(t[3],r[3]),e}function en(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e[2]=Math.round(t[2]),e[3]=Math.round(t[3]),e}function tn(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e}function rn(e,t,r,n){return e[0]=t[0]+r[0]*n,e[1]=t[1]+r[1]*n,e[2]=t[2]+r[2]*n,e[3]=t[3]+r[3]*n,e}function nn(e,t){var r=t[0]-e[0],n=t[1]-e[1],a=t[2]-e[2],s=t[3]-e[3];return Math.hypot(r,n,a,s)}function an(e,t){var r=t[0]-e[0],n=t[1]-e[1],a=t[2]-e[2],s=t[3]-e[3];return r*r+n*n+a*a+s*s}function sn(e){var t=e[0],r=e[1],n=e[2],a=e[3];return Math.hypot(t,r,n,a)}function on(e){var t=e[0],r=e[1],n=e[2],a=e[3];return t*t+r*r+n*n+a*a}function ln(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=-t[3],e}function un(e,t){return e[0]=1/t[0],e[1]=1/t[1],e[2]=1/t[2],e[3]=1/t[3],e}function cn(e,t){var r=t[0],n=t[1],a=t[2],s=t[3],i=r*r+n*n+a*a+s*s;return i>0&&(i=1/Math.sqrt(i)),e[0]=r*i,e[1]=n*i,e[2]=a*i,e[3]=s*i,e}function hn(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]*t[3]}function dn(e,t,r,n){var a=r[0]*n[1]-r[1]*n[0],s=r[0]*n[2]-r[2]*n[0],i=r[0]*n[3]-r[3]*n[0],o=r[1]*n[2]-r[2]*n[1],l=r[1]*n[3]-r[3]*n[1],u=r[2]*n[3]-r[3]*n[2],c=t[0],h=t[1],d=t[2],f=t[3];return e[0]=h*u-d*l+f*o,e[1]=-c*u+d*i-f*s,e[2]=c*l-h*i+f*a,e[3]=-c*o+h*s-d*a,e}function fn(e,t,r,n){var a=t[0],s=t[1],i=t[2],o=t[3];return e[0]=a+n*(r[0]-a),e[1]=s+n*(r[1]-s),e[2]=i+n*(r[2]-i),e[3]=o+n*(r[3]-o),e}function pn(e,t){var r,n,a,s,i,o;t=t||1;do{i=(r=2*m()-1)*r+(n=2*m()-1)*n}while(i>=1);do{o=(a=2*m()-1)*a+(s=2*m()-1)*s}while(o>=1);var l=Math.sqrt((1-i)/o);return e[0]=t*r,e[1]=t*n,e[2]=t*a*l,e[3]=t*s*l,e}function mn(e,t,r){var n=t[0],a=t[1],s=t[2],i=t[3];return e[0]=r[0]*n+r[4]*a+r[8]*s+r[12]*i,e[1]=r[1]*n+r[5]*a+r[9]*s+r[13]*i,e[2]=r[2]*n+r[6]*a+r[10]*s+r[14]*i,e[3]=r[3]*n+r[7]*a+r[11]*s+r[15]*i,e}function gn(e,t,r){var n=t[0],a=t[1],s=t[2],i=r[0],o=r[1],l=r[2],u=r[3],c=u*n+o*s-l*a,h=u*a+l*n-i*s,d=u*s+i*a-o*n,f=-i*n-o*a-l*s;return e[0]=c*u+f*-i+h*-l-d*-o,e[1]=h*u+f*-o+d*-i-c*-l,e[2]=d*u+f*-l+c*-o-h*-i,e[3]=t[3],e}function yn(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=0,e}function vn(e){return"vec4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"}function bn(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]}function Mn(e,t){var r=e[0],n=e[1],a=e[2],s=e[3],i=t[0],o=t[1],l=t[2],u=t[3];return Math.abs(r-i)<=f*Math.max(1,Math.abs(r),Math.abs(i))&&Math.abs(n-o)<=f*Math.max(1,Math.abs(n),Math.abs(o))&&Math.abs(a-l)<=f*Math.max(1,Math.abs(a),Math.abs(l))&&Math.abs(s-u)<=f*Math.max(1,Math.abs(s),Math.abs(u))}var _n=zr,xn=$r,Tn=Yr,Sn=nn,En=an,wn=sn,Rn=on,kn=function(){var e=Gr();return function(t,r,n,a,s,i){var o,l;for(r||(r=4),n||(n=0),l=a?Math.min(a*r+n,t.length):t.length,o=n;o<l;o+=r)e[0]=t[o],e[1]=t[o+1],e[2]=t[o+2],e[3]=t[o+3],s(e,e,i),t[o]=e[0],t[o+1]=e[1],t[o+2]=e[2],t[o+3]=e[3];return t}}();function In(){var e=new p(4);return p!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e[3]=1,e}function An(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e}function Pn(e,t,r){r*=.5;var n=Math.sin(r);return e[0]=n*t[0],e[1]=n*t[1],e[2]=n*t[2],e[3]=Math.cos(r),e}function Cn(e,t){var r=2*Math.acos(t[3]),n=Math.sin(r/2);return n>f?(e[0]=t[0]/n,e[1]=t[1]/n,e[2]=t[2]/n):(e[0]=1,e[1]=0,e[2]=0),r}function Ln(e,t){var r=la(e,t);return Math.acos(2*r*r-1)}function Dn(e,t,r){var n=t[0],a=t[1],s=t[2],i=t[3],o=r[0],l=r[1],u=r[2],c=r[3];return e[0]=n*c+i*o+a*u-s*l,e[1]=a*c+i*l+s*o-n*u,e[2]=s*c+i*u+n*l-a*o,e[3]=i*c-n*o-a*l-s*u,e}function Fn(e,t,r){r*=.5;var n=t[0],a=t[1],s=t[2],i=t[3],o=Math.sin(r),l=Math.cos(r);return e[0]=n*l+i*o,e[1]=a*l+s*o,e[2]=s*l-a*o,e[3]=i*l-n*o,e}function Nn(e,t,r){r*=.5;var n=t[0],a=t[1],s=t[2],i=t[3],o=Math.sin(r),l=Math.cos(r);return e[0]=n*l-s*o,e[1]=a*l+i*o,e[2]=s*l+n*o,e[3]=i*l-a*o,e}function On(e,t,r){r*=.5;var n=t[0],a=t[1],s=t[2],i=t[3],o=Math.sin(r),l=Math.cos(r);return e[0]=n*l+a*o,e[1]=a*l-n*o,e[2]=s*l+i*o,e[3]=i*l-s*o,e}function Un(e,t){var r=t[0],n=t[1],a=t[2];return e[0]=r,e[1]=n,e[2]=a,e[3]=Math.sqrt(Math.abs(1-r*r-n*n-a*a)),e}function Bn(e,t){var r=t[0],n=t[1],a=t[2],s=t[3],i=Math.sqrt(r*r+n*n+a*a),o=Math.exp(s),l=i>0?o*Math.sin(i)/i:0;return e[0]=r*l,e[1]=n*l,e[2]=a*l,e[3]=o*Math.cos(i),e}function Vn(e,t){var r=t[0],n=t[1],a=t[2],s=t[3],i=Math.sqrt(r*r+n*n+a*a),o=i>0?Math.atan2(i,s)/i:0;return e[0]=r*o,e[1]=n*o,e[2]=a*o,e[3]=.5*Math.log(r*r+n*n+a*a+s*s),e}function Gn(e,t,r){return Vn(e,t),oa(e,e,r),Bn(e,e),e}function jn(e,t,r,n){var a,s,i,o,l,u=t[0],c=t[1],h=t[2],d=t[3],p=r[0],m=r[1],g=r[2],y=r[3];return(s=u*p+c*m+h*g+d*y)<0&&(s=-s,p=-p,m=-m,g=-g,y=-y),1-s>f?(a=Math.acos(s),i=Math.sin(a),o=Math.sin((1-n)*a)/i,l=Math.sin(n*a)/i):(o=1-n,l=n),e[0]=o*u+l*p,e[1]=o*c+l*m,e[2]=o*h+l*g,e[3]=o*d+l*y,e}function Xn(e){var t=m(),r=m(),n=m(),a=Math.sqrt(1-t),s=Math.sqrt(t);return e[0]=a*Math.sin(2*Math.PI*r),e[1]=a*Math.cos(2*Math.PI*r),e[2]=s*Math.sin(2*Math.PI*n),e[3]=s*Math.cos(2*Math.PI*n),e}function Wn(e,t){var r=t[0],n=t[1],a=t[2],s=t[3],i=r*r+n*n+a*a+s*s,o=i?1/i:0;return e[0]=-r*o,e[1]=-n*o,e[2]=-a*o,e[3]=s*o,e}function Hn(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=t[3],e}function qn(e,t){var r,n=t[0]+t[4]+t[8];if(n>0)r=Math.sqrt(n+1),e[3]=.5*r,r=.5/r,e[0]=(t[5]-t[7])*r,e[1]=(t[6]-t[2])*r,e[2]=(t[1]-t[3])*r;else{var a=0;t[4]>t[0]&&(a=1),t[8]>t[3*a+a]&&(a=2);var s=(a+1)%3,i=(a+2)%3;r=Math.sqrt(t[3*a+a]-t[3*s+s]-t[3*i+i]+1),e[a]=.5*r,r=.5/r,e[3]=(t[3*s+i]-t[3*i+s])*r,e[s]=(t[3*s+a]+t[3*a+s])*r,e[i]=(t[3*i+a]+t[3*a+i])*r}return e}function zn(e,t,r,n){var a=.5*Math.PI/180;t*=a,r*=a,n*=a;var s=Math.sin(t),i=Math.cos(t),o=Math.sin(r),l=Math.cos(r),u=Math.sin(n),c=Math.cos(n);return e[0]=s*l*c-i*o*u,e[1]=i*o*c+s*l*u,e[2]=i*l*u-s*o*c,e[3]=i*l*c+s*o*u,e}function $n(e){return"quat("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"}var Yn,Kn,Zn,Qn,Jn,ea,ta=jr,ra=Xr,na=Wr,aa=Hr,sa=qr,ia=Dn,oa=tn,la=hn,ua=fn,ca=sn,ha=ca,da=on,fa=da,pa=cn,ma=bn,ga=Mn,ya=(Yn=qt(),Kn=Yt(1,0,0),Zn=Yt(0,1,0),function(e,t,r){var n=mr(t,r);return n<-.999999?(gr(Yn,Kn,t),Ur(Yn)<1e-6&&gr(Yn,Zn,t),pr(Yn,Yn),Pn(e,Yn,Math.PI),e):n>.999999?(e[0]=0,e[1]=0,e[2]=0,e[3]=1,e):(gr(Yn,t,r),e[0]=Yn[0],e[1]=Yn[1],e[2]=Yn[2],e[3]=1+n,pa(e,e))}),va=(Qn=In(),Jn=In(),function(e,t,r,n,a,s){return jn(Qn,t,a,s),jn(Jn,r,n,s),jn(e,Qn,Jn,2*s*(1-s)),e}),ba=(ea=ye(),function(e,t,r,n){return ea[0]=r[0],ea[3]=r[1],ea[6]=r[2],ea[1]=n[0],ea[4]=n[1],ea[7]=n[2],ea[2]=-t[0],ea[5]=-t[1],ea[8]=-t[2],pa(e,qn(e,ea))});function Ma(){var e=new p(8);return p!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0,e[4]=0,e[5]=0,e[6]=0,e[7]=0),e[3]=1,e}function _a(e){var t=new p(8);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t}function xa(e,t,r,n,a,s,i,o){var l=new p(8);return l[0]=e,l[1]=t,l[2]=r,l[3]=n,l[4]=a,l[5]=s,l[6]=i,l[7]=o,l}function Ta(e,t,r,n,a,s,i){var o=new p(8);o[0]=e,o[1]=t,o[2]=r,o[3]=n;var l=.5*a,u=.5*s,c=.5*i;return o[4]=l*n+u*r-c*t,o[5]=u*n+c*e-l*r,o[6]=c*n+l*t-u*e,o[7]=-l*e-u*t-c*r,o}function Sa(e,t,r){var n=.5*r[0],a=.5*r[1],s=.5*r[2],i=t[0],o=t[1],l=t[2],u=t[3];return e[0]=i,e[1]=o,e[2]=l,e[3]=u,e[4]=n*u+a*l-s*o,e[5]=a*u+s*i-n*l,e[6]=s*u+n*o-a*i,e[7]=-n*i-a*o-s*l,e}function Ea(e,t){return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e[4]=.5*t[0],e[5]=.5*t[1],e[6]=.5*t[2],e[7]=0,e}function wa(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=0,e[5]=0,e[6]=0,e[7]=0,e}function Ra(e,t){var r=In();xt(r,t);var n=new p(3);return Mt(n,t),Sa(e,r,n),e}function ka(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e}function Ia(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e[4]=0,e[5]=0,e[6]=0,e[7]=0,e}function Aa(e,t,r,n,a,s,i,o,l){return e[0]=t,e[1]=r,e[2]=n,e[3]=a,e[4]=s,e[5]=i,e[6]=o,e[7]=l,e}var Pa=na;function Ca(e,t){return e[0]=t[4],e[1]=t[5],e[2]=t[6],e[3]=t[7],e}var La=na;function Da(e,t){return e[4]=t[0],e[5]=t[1],e[6]=t[2],e[7]=t[3],e}function Fa(e,t){var r=t[4],n=t[5],a=t[6],s=t[7],i=-t[0],o=-t[1],l=-t[2],u=t[3];return e[0]=2*(r*u+s*i+n*l-a*o),e[1]=2*(n*u+s*o+a*i-r*l),e[2]=2*(a*u+s*l+r*o-n*i),e}function Na(e,t,r){var n=t[0],a=t[1],s=t[2],i=t[3],o=.5*r[0],l=.5*r[1],u=.5*r[2],c=t[4],h=t[5],d=t[6],f=t[7];return e[0]=n,e[1]=a,e[2]=s,e[3]=i,e[4]=i*o+a*u-s*l+c,e[5]=i*l+s*o-n*u+h,e[6]=i*u+n*l-a*o+d,e[7]=-n*o-a*l-s*u+f,e}function Oa(e,t,r){var n=-t[0],a=-t[1],s=-t[2],i=t[3],o=t[4],l=t[5],u=t[6],c=t[7],h=o*i+c*n+l*s-u*a,d=l*i+c*a+u*n-o*s,f=u*i+c*s+o*a-l*n,p=c*i-o*n-l*a-u*s;return Fn(e,t,r),n=e[0],a=e[1],s=e[2],i=e[3],e[4]=h*i+p*n+d*s-f*a,e[5]=d*i+p*a+f*n-h*s,e[6]=f*i+p*s+h*a-d*n,e[7]=p*i-h*n-d*a-f*s,e}function Ua(e,t,r){var n=-t[0],a=-t[1],s=-t[2],i=t[3],o=t[4],l=t[5],u=t[6],c=t[7],h=o*i+c*n+l*s-u*a,d=l*i+c*a+u*n-o*s,f=u*i+c*s+o*a-l*n,p=c*i-o*n-l*a-u*s;return Nn(e,t,r),n=e[0],a=e[1],s=e[2],i=e[3],e[4]=h*i+p*n+d*s-f*a,e[5]=d*i+p*a+f*n-h*s,e[6]=f*i+p*s+h*a-d*n,e[7]=p*i-h*n-d*a-f*s,e}function Ba(e,t,r){var n=-t[0],a=-t[1],s=-t[2],i=t[3],o=t[4],l=t[5],u=t[6],c=t[7],h=o*i+c*n+l*s-u*a,d=l*i+c*a+u*n-o*s,f=u*i+c*s+o*a-l*n,p=c*i-o*n-l*a-u*s;return On(e,t,r),n=e[0],a=e[1],s=e[2],i=e[3],e[4]=h*i+p*n+d*s-f*a,e[5]=d*i+p*a+f*n-h*s,e[6]=f*i+p*s+h*a-d*n,e[7]=p*i-h*n-d*a-f*s,e}function Va(e,t,r){var n=r[0],a=r[1],s=r[2],i=r[3],o=t[0],l=t[1],u=t[2],c=t[3];return e[0]=o*i+c*n+l*s-u*a,e[1]=l*i+c*a+u*n-o*s,e[2]=u*i+c*s+o*a-l*n,e[3]=c*i-o*n-l*a-u*s,o=t[4],l=t[5],u=t[6],c=t[7],e[4]=o*i+c*n+l*s-u*a,e[5]=l*i+c*a+u*n-o*s,e[6]=u*i+c*s+o*a-l*n,e[7]=c*i-o*n-l*a-u*s,e}function Ga(e,t,r){var n=t[0],a=t[1],s=t[2],i=t[3],o=r[0],l=r[1],u=r[2],c=r[3];return e[0]=n*c+i*o+a*u-s*l,e[1]=a*c+i*l+s*o-n*u,e[2]=s*c+i*u+n*l-a*o,e[3]=i*c-n*o-a*l-s*u,o=r[4],l=r[5],u=r[6],c=r[7],e[4]=n*c+i*o+a*u-s*l,e[5]=a*c+i*l+s*o-n*u,e[6]=s*c+i*u+n*l-a*o,e[7]=i*c-n*o-a*l-s*u,e}function ja(e,t,r,n){if(Math.abs(n)<f)return ka(e,t);var a=Math.hypot(r[0],r[1],r[2]);n*=.5;var s=Math.sin(n),i=s*r[0]/a,o=s*r[1]/a,l=s*r[2]/a,u=Math.cos(n),c=t[0],h=t[1],d=t[2],p=t[3];e[0]=c*u+p*i+h*l-d*o,e[1]=h*u+p*o+d*i-c*l,e[2]=d*u+p*l+c*o-h*i,e[3]=p*u-c*i-h*o-d*l;var m=t[4],g=t[5],y=t[6],v=t[7];return e[4]=m*u+v*i+g*l-y*o,e[5]=g*u+v*o+y*i-m*l,e[6]=y*u+v*l+m*o-g*i,e[7]=v*u-m*i-g*o-y*l,e}function Xa(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e[3]=t[3]+r[3],e[4]=t[4]+r[4],e[5]=t[5]+r[5],e[6]=t[6]+r[6],e[7]=t[7]+r[7],e}function Wa(e,t,r){var n=t[0],a=t[1],s=t[2],i=t[3],o=r[4],l=r[5],u=r[6],c=r[7],h=t[4],d=t[5],f=t[6],p=t[7],m=r[0],g=r[1],y=r[2],v=r[3];return e[0]=n*v+i*m+a*y-s*g,e[1]=a*v+i*g+s*m-n*y,e[2]=s*v+i*y+n*g-a*m,e[3]=i*v-n*m-a*g-s*y,e[4]=n*c+i*o+a*u-s*l+h*v+p*m+d*y-f*g,e[5]=a*c+i*l+s*o-n*u+d*v+p*g+f*m-h*y,e[6]=s*c+i*u+n*l-a*o+f*v+p*y+h*g-d*m,e[7]=i*c-n*o-a*l-s*u+p*v-h*m-d*g-f*y,e}var Ha=Wa;function qa(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e[4]=t[4]*r,e[5]=t[5]*r,e[6]=t[6]*r,e[7]=t[7]*r,e}var za=la;function $a(e,t,r,n){var a=1-n;return za(t,r)<0&&(n=-n),e[0]=t[0]*a+r[0]*n,e[1]=t[1]*a+r[1]*n,e[2]=t[2]*a+r[2]*n,e[3]=t[3]*a+r[3]*n,e[4]=t[4]*a+r[4]*n,e[5]=t[5]*a+r[5]*n,e[6]=t[6]*a+r[6]*n,e[7]=t[7]*a+r[7]*n,e}function Ya(e,t){var r=Ja(t);return e[0]=-t[0]/r,e[1]=-t[1]/r,e[2]=-t[2]/r,e[3]=t[3]/r,e[4]=-t[4]/r,e[5]=-t[5]/r,e[6]=-t[6]/r,e[7]=t[7]/r,e}function Ka(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=t[3],e[4]=-t[4],e[5]=-t[5],e[6]=-t[6],e[7]=t[7],e}var Za=ca,Qa=Za,Ja=da,es=Ja;function ts(e,t){var r=Ja(t);if(r>0){r=Math.sqrt(r);var n=t[0]/r,a=t[1]/r,s=t[2]/r,i=t[3]/r,o=t[4],l=t[5],u=t[6],c=t[7],h=n*o+a*l+s*u+i*c;e[0]=n,e[1]=a,e[2]=s,e[3]=i,e[4]=(o-n*h)/r,e[5]=(l-a*h)/r,e[6]=(u-s*h)/r,e[7]=(c-i*h)/r}return e}function rs(e){return"quat2("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+")"}function ns(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]}function as(e,t){var r=e[0],n=e[1],a=e[2],s=e[3],i=e[4],o=e[5],l=e[6],u=e[7],c=t[0],h=t[1],d=t[2],p=t[3],m=t[4],g=t[5],y=t[6],v=t[7];return Math.abs(r-c)<=f*Math.max(1,Math.abs(r),Math.abs(c))&&Math.abs(n-h)<=f*Math.max(1,Math.abs(n),Math.abs(h))&&Math.abs(a-d)<=f*Math.max(1,Math.abs(a),Math.abs(d))&&Math.abs(s-p)<=f*Math.max(1,Math.abs(s),Math.abs(p))&&Math.abs(i-m)<=f*Math.max(1,Math.abs(i),Math.abs(m))&&Math.abs(o-g)<=f*Math.max(1,Math.abs(o),Math.abs(g))&&Math.abs(l-y)<=f*Math.max(1,Math.abs(l),Math.abs(y))&&Math.abs(u-v)<=f*Math.max(1,Math.abs(u),Math.abs(v))}function ss(){var e=new p(2);return p!=Float32Array&&(e[0]=0,e[1]=0),e}function is(e){var t=new p(2);return t[0]=e[0],t[1]=e[1],t}function os(e,t){var r=new p(2);return r[0]=e,r[1]=t,r}function ls(e,t){return e[0]=t[0],e[1]=t[1],e}function us(e,t,r){return e[0]=t,e[1]=r,e}function cs(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e}function hs(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e}function ds(e,t,r){return e[0]=t[0]*r[0],e[1]=t[1]*r[1],e}function fs(e,t,r){return e[0]=t[0]/r[0],e[1]=t[1]/r[1],e}function ps(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e}function ms(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e}function gs(e,t,r){return e[0]=Math.min(t[0],r[0]),e[1]=Math.min(t[1],r[1]),e}function ys(e,t,r){return e[0]=Math.max(t[0],r[0]),e[1]=Math.max(t[1],r[1]),e}function vs(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e}function bs(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e}function Ms(e,t,r,n){return e[0]=t[0]+r[0]*n,e[1]=t[1]+r[1]*n,e}function _s(e,t){var r=t[0]-e[0],n=t[1]-e[1];return Math.hypot(r,n)}function xs(e,t){var r=t[0]-e[0],n=t[1]-e[1];return r*r+n*n}function Ts(e){var t=e[0],r=e[1];return Math.hypot(t,r)}function Ss(e){var t=e[0],r=e[1];return t*t+r*r}function Es(e,t){return e[0]=-t[0],e[1]=-t[1],e}function ws(e,t){return e[0]=1/t[0],e[1]=1/t[1],e}function Rs(e,t){var r=t[0],n=t[1],a=r*r+n*n;return a>0&&(a=1/Math.sqrt(a)),e[0]=t[0]*a,e[1]=t[1]*a,e}function ks(e,t){return e[0]*t[0]+e[1]*t[1]}function Is(e,t,r){var n=t[0]*r[1]-t[1]*r[0];return e[0]=e[1]=0,e[2]=n,e}function As(e,t,r,n){var a=t[0],s=t[1];return e[0]=a+n*(r[0]-a),e[1]=s+n*(r[1]-s),e}function Ps(e,t){t=t||1;var r=2*m()*Math.PI;return e[0]=Math.cos(r)*t,e[1]=Math.sin(r)*t,e}function Cs(e,t,r){var n=t[0],a=t[1];return e[0]=r[0]*n+r[2]*a,e[1]=r[1]*n+r[3]*a,e}function Ls(e,t,r){var n=t[0],a=t[1];return e[0]=r[0]*n+r[2]*a+r[4],e[1]=r[1]*n+r[3]*a+r[5],e}function Ds(e,t,r){var n=t[0],a=t[1];return e[0]=r[0]*n+r[3]*a+r[6],e[1]=r[1]*n+r[4]*a+r[7],e}function Fs(e,t,r){var n=t[0],a=t[1];return e[0]=r[0]*n+r[4]*a+r[12],e[1]=r[1]*n+r[5]*a+r[13],e}function Ns(e,t,r,n){var a=t[0]-r[0],s=t[1]-r[1],i=Math.sin(n),o=Math.cos(n);return e[0]=a*o-s*i+r[0],e[1]=a*i+s*o+r[1],e}function Os(e,t){var r=e[0],n=e[1],a=t[0],s=t[1],i=Math.sqrt(r*r+n*n)*Math.sqrt(a*a+s*s),o=i&&(r*a+n*s)/i;return Math.acos(Math.min(Math.max(o,-1),1))}function Us(e){return e[0]=0,e[1]=0,e}function Bs(e){return"vec2("+e[0]+", "+e[1]+")"}function Vs(e,t){return e[0]===t[0]&&e[1]===t[1]}function Gs(e,t){var r=e[0],n=e[1],a=t[0],s=t[1];return Math.abs(r-a)<=f*Math.max(1,Math.abs(r),Math.abs(a))&&Math.abs(n-s)<=f*Math.max(1,Math.abs(n),Math.abs(s))}var js=Ts,Xs=hs,Ws=ds,Hs=fs,qs=_s,zs=xs,$s=Ss,Ys=function(){var e=ss();return function(t,r,n,a,s,i){var o,l;for(r||(r=2),n||(n=0),l=a?Math.min(a*r+n,t.length):t.length,o=n;o<l;o+=r)e[0]=t[o],e[1]=t[o+1],s(e,e,i),t[o]=e[0],t[o+1]=e[1];return t}}()},172:(e,t,r)=>{"use strict";r.r(t),r.d(t,{Component:()=>E,Fragment:()=>S,cloneElement:()=>q,createContext:()=>z,createElement:()=>_,createRef:()=>T,h:()=>_,hydrate:()=>H,isValidElement:()=>i,options:()=>a,render:()=>W,toChildArray:()=>L});var n,a,s,i,o,l,u,c,h,d,f,p,m={},g=[],y=/acit|ex(?:s|g|n|p|$)|rph|grid|ows|mnc|ntw|ine[ch]|zoo|^ord|itera/i,v=Array.isArray;function b(e,t){for(var r in t)e[r]=t[r];return e}function M(e){var t=e.parentNode;t&&t.removeChild(e)}function _(e,t,r){var a,s,i,o={};for(i in t)"key"==i?a=t[i]:"ref"==i?s=t[i]:o[i]=t[i];if(arguments.length>2&&(o.children=arguments.length>3?n.call(arguments,2):r),"function"==typeof e&&null!=e.defaultProps)for(i in e.defaultProps)void 0===o[i]&&(o[i]=e.defaultProps[i]);return x(e,o,a,s,null)}function x(e,t,r,n,i){var o={type:e,props:t,key:r,ref:n,__k:null,__:null,__b:0,__e:null,__d:void 0,__c:null,constructor:void 0,__v:null==i?++s:i,__i:-1,__u:0};return null==i&&null!=a.vnode&&a.vnode(o),o}function T(){return{current:null}}function S(e){return e.children}function E(e,t){this.props=e,this.context=t}function w(e,t){if(null==t)return e.__?w(e.__,e.__i+1):null;for(var r;t<e.__k.length;t++)if(null!=(r=e.__k[t])&&null!=r.__e)return r.__e;return"function"==typeof e.type?w(e):null}function R(e){var t,r;if(null!=(e=e.__)&&null!=e.__c){for(e.__e=e.__c.base=null,t=0;t<e.__k.length;t++)if(null!=(r=e.__k[t])&&null!=r.__e){e.__e=e.__c.base=r.__e;break}return R(e)}}function k(e){(!e.__d&&(e.__d=!0)&&o.push(e)&&!I.__r++||l!==a.debounceRendering)&&((l=a.debounceRendering)||u)(I)}function I(){var e,t,r,n,s,i,l,u;for(o.sort(c);e=o.shift();)e.__d&&(t=o.length,n=void 0,i=(s=(r=e).__v).__e,l=[],u=[],r.__P&&((n=b({},s)).__v=s.__v+1,a.vnode&&a.vnode(n),U(r.__P,n,s,r.__n,r.__P.namespaceURI,32&s.__u?[i]:null,l,null==i?w(s):i,!!(32&s.__u),u),n.__v=s.__v,n.__.__k[n.__i]=n,B(l,n,u),n.__e!=i&&R(n)),o.length>t&&o.sort(c));I.__r=0}function A(e,t,r,n,a,s,i,o,l,u,c){var h,d,f,p,y,v=n&&n.__k||g,b=t.length;for(r.__d=l,P(r,t,v),l=r.__d,h=0;h<b;h++)null!=(f=r.__k[h])&&"boolean"!=typeof f&&"function"!=typeof f&&(d=-1===f.__i?m:v[f.__i]||m,f.__i=h,U(e,f,d,a,s,i,o,l,u,c),p=f.__e,f.ref&&d.ref!=f.ref&&(d.ref&&G(d.ref,null,f),c.push(f.ref,f.__c||p,f)),null==y&&null!=p&&(y=p),65536&f.__u||d.__k===f.__k?l=C(f,l,e):"function"==typeof f.type&&void 0!==f.__d?l=f.__d:p&&(l=p.nextSibling),f.__d=void 0,f.__u&=-196609);r.__d=l,r.__e=y}function P(e,t,r){var n,a,s,i,o,l=t.length,u=r.length,c=u,h=0;for(e.__k=[],n=0;n<l;n++)i=n+h,null!=(a=e.__k[n]=null==(a=t[n])||"boolean"==typeof a||"function"==typeof a?null:"string"==typeof a||"number"==typeof a||"bigint"==typeof a||a.constructor==String?x(null,a,null,null,null):v(a)?x(S,{children:a},null,null,null):void 0===a.constructor&&a.__b>0?x(a.type,a.props,a.key,a.ref?a.ref:null,a.__v):a)?(a.__=e,a.__b=e.__b+1,o=D(a,r,i,c),a.__i=o,s=null,-1!==o&&(c--,(s=r[o])&&(s.__u|=131072)),null==s||null===s.__v?(-1==o&&h--,"function"!=typeof a.type&&(a.__u|=65536)):o!==i&&(o==i-1?h--:o==i+1?h++:o>i?c>l-i?h+=o-i:h--:o<i&&(o==i-h?h-=o-i:h++),o!==n+h&&(a.__u|=65536))):(s=r[i])&&null==s.key&&s.__e&&0==(131072&s.__u)&&(s.__e==e.__d&&(e.__d=w(s)),j(s,s,!1),r[i]=null,c--);if(c)for(n=0;n<u;n++)null!=(s=r[n])&&0==(131072&s.__u)&&(s.__e==e.__d&&(e.__d=w(s)),j(s,s))}function C(e,t,r){var n,a;if("function"==typeof e.type){for(n=e.__k,a=0;n&&a<n.length;a++)n[a]&&(n[a].__=e,t=C(n[a],t,r));return t}e.__e!=t&&(t&&e.type&&!r.contains(t)&&(t=w(e)),r.insertBefore(e.__e,t||null),t=e.__e);do{t=t&&t.nextSibling}while(null!=t&&8===t.nodeType);return t}function L(e,t){return t=t||[],null==e||"boolean"==typeof e||(v(e)?e.some((function(e){L(e,t)})):t.push(e)),t}function D(e,t,r,n){var a=e.key,s=e.type,i=r-1,o=r+1,l=t[r];if(null===l||l&&a==l.key&&s===l.type&&0==(131072&l.__u))return r;if(n>(null!=l&&0==(131072&l.__u)?1:0))for(;i>=0||o<t.length;){if(i>=0){if((l=t[i])&&0==(131072&l.__u)&&a==l.key&&s===l.type)return i;i--}if(o<t.length){if((l=t[o])&&0==(131072&l.__u)&&a==l.key&&s===l.type)return o;o++}}return-1}function F(e,t,r){"-"===t[0]?e.setProperty(t,null==r?"":r):e[t]=null==r?"":"number"!=typeof r||y.test(t)?r:r+"px"}function N(e,t,r,n,a){var s;e:if("style"===t)if("string"==typeof r)e.style.cssText=r;else{if("string"==typeof n&&(e.style.cssText=n=""),n)for(t in n)r&&t in r||F(e.style,t,"");if(r)for(t in r)n&&r[t]===n[t]||F(e.style,t,r[t])}else if("o"===t[0]&&"n"===t[1])s=t!==(t=t.replace(/(PointerCapture)$|Capture$/i,"$1")),t=t.toLowerCase()in e||"onFocusOut"===t||"onFocusIn"===t?t.toLowerCase().slice(2):t.slice(2),e.l||(e.l={}),e.l[t+s]=r,r?n?r.u=n.u:(r.u=h,e.addEventListener(t,s?f:d,s)):e.removeEventListener(t,s?f:d,s);else{if("http://www.w3.org/2000/svg"==a)t=t.replace(/xlink(H|:h)/,"h").replace(/sName$/,"s");else if("width"!=t&&"height"!=t&&"href"!=t&&"list"!=t&&"form"!=t&&"tabIndex"!=t&&"download"!=t&&"rowSpan"!=t&&"colSpan"!=t&&"role"!=t&&"popover"!=t&&t in e)try{e[t]=null==r?"":r;break e}catch(e){}"function"==typeof r||(null==r||!1===r&&"-"!==t[4]?e.removeAttribute(t):e.setAttribute(t,"popover"==t&&1==r?"":r))}}function O(e){return function(t){if(this.l){var r=this.l[t.type+e];if(null==t.t)t.t=h++;else if(t.t<r.u)return;return r(a.event?a.event(t):t)}}}function U(e,t,r,n,s,i,o,l,u,c){var h,d,f,p,m,g,y,M,_,x,T,w,R,k,I,P,C=t.type;if(void 0!==t.constructor)return null;128&r.__u&&(u=!!(32&r.__u),i=[l=t.__e=r.__e]),(h=a.__b)&&h(t);e:if("function"==typeof C)try{if(M=t.props,_="prototype"in C&&C.prototype.render,x=(h=C.contextType)&&n[h.__c],T=h?x?x.props.value:h.__:n,r.__c?y=(d=t.__c=r.__c).__=d.__E:(_?t.__c=d=new C(M,T):(t.__c=d=new E(M,T),d.constructor=C,d.render=X),x&&x.sub(d),d.props=M,d.state||(d.state={}),d.context=T,d.__n=n,f=d.__d=!0,d.__h=[],d._sb=[]),_&&null==d.__s&&(d.__s=d.state),_&&null!=C.getDerivedStateFromProps&&(d.__s==d.state&&(d.__s=b({},d.__s)),b(d.__s,C.getDerivedStateFromProps(M,d.__s))),p=d.props,m=d.state,d.__v=t,f)_&&null==C.getDerivedStateFromProps&&null!=d.componentWillMount&&d.componentWillMount(),_&&null!=d.componentDidMount&&d.__h.push(d.componentDidMount);else{if(_&&null==C.getDerivedStateFromProps&&M!==p&&null!=d.componentWillReceiveProps&&d.componentWillReceiveProps(M,T),!d.__e&&(null!=d.shouldComponentUpdate&&!1===d.shouldComponentUpdate(M,d.__s,T)||t.__v===r.__v)){for(t.__v!==r.__v&&(d.props=M,d.state=d.__s,d.__d=!1),t.__e=r.__e,t.__k=r.__k,t.__k.forEach((function(e){e&&(e.__=t)})),w=0;w<d._sb.length;w++)d.__h.push(d._sb[w]);d._sb=[],d.__h.length&&o.push(d);break e}null!=d.componentWillUpdate&&d.componentWillUpdate(M,d.__s,T),_&&null!=d.componentDidUpdate&&d.__h.push((function(){d.componentDidUpdate(p,m,g)}))}if(d.context=T,d.props=M,d.__P=e,d.__e=!1,R=a.__r,k=0,_){for(d.state=d.__s,d.__d=!1,R&&R(t),h=d.render(d.props,d.state,d.context),I=0;I<d._sb.length;I++)d.__h.push(d._sb[I]);d._sb=[]}else do{d.__d=!1,R&&R(t),h=d.render(d.props,d.state,d.context),d.state=d.__s}while(d.__d&&++k<25);d.state=d.__s,null!=d.getChildContext&&(n=b(b({},n),d.getChildContext())),_&&!f&&null!=d.getSnapshotBeforeUpdate&&(g=d.getSnapshotBeforeUpdate(p,m)),A(e,v(P=null!=h&&h.type===S&&null==h.key?h.props.children:h)?P:[P],t,r,n,s,i,o,l,u,c),d.base=t.__e,t.__u&=-161,d.__h.length&&o.push(d),y&&(d.__E=d.__=null)}catch(e){if(t.__v=null,u||null!=i){for(t.__u|=u?160:32;l&&8===l.nodeType&&l.nextSibling;)l=l.nextSibling;i[i.indexOf(l)]=null,t.__e=l}else t.__e=r.__e,t.__k=r.__k;a.__e(e,t,r)}else null==i&&t.__v===r.__v?(t.__k=r.__k,t.__e=r.__e):t.__e=V(r.__e,t,r,n,s,i,o,u,c);(h=a.diffed)&&h(t)}function B(e,t,r){t.__d=void 0;for(var n=0;n<r.length;n++)G(r[n],r[++n],r[++n]);a.__c&&a.__c(t,e),e.some((function(t){try{e=t.__h,t.__h=[],e.some((function(e){e.call(t)}))}catch(e){a.__e(e,t.__v)}}))}function V(e,t,r,a,s,i,o,l,u){var c,h,d,f,p,g,y,b=r.props,_=t.props,x=t.type;if("svg"===x?s="http://www.w3.org/2000/svg":"math"===x?s="http://www.w3.org/1998/Math/MathML":s||(s="http://www.w3.org/1999/xhtml"),null!=i)for(c=0;c<i.length;c++)if((p=i[c])&&"setAttribute"in p==!!x&&(x?p.localName===x:3===p.nodeType)){e=p,i[c]=null;break}if(null==e){if(null===x)return document.createTextNode(_);e=document.createElementNS(s,x,_.is&&_),i=null,l=!1}if(null===x)b===_||l&&e.data===_||(e.data=_);else{if(i=i&&n.call(e.childNodes),b=r.props||m,!l&&null!=i)for(b={},c=0;c<e.attributes.length;c++)b[(p=e.attributes[c]).name]=p.value;for(c in b)if(p=b[c],"children"==c);else if("dangerouslySetInnerHTML"==c)d=p;else if("key"!==c&&!(c in _)){if("value"==c&&"defaultValue"in _||"checked"==c&&"defaultChecked"in _)continue;N(e,c,null,p,s)}for(c in _)p=_[c],"children"==c?f=p:"dangerouslySetInnerHTML"==c?h=p:"value"==c?g=p:"checked"==c?y=p:"key"===c||l&&"function"!=typeof p||b[c]===p||N(e,c,p,b[c],s);if(h)l||d&&(h.__html===d.__html||h.__html===e.innerHTML)||(e.innerHTML=h.__html),t.__k=[];else if(d&&(e.innerHTML=""),A(e,v(f)?f:[f],t,r,a,"foreignObject"===x?"http://www.w3.org/1999/xhtml":s,i,o,i?i[0]:r.__k&&w(r,0),l,u),null!=i)for(c=i.length;c--;)null!=i[c]&&M(i[c]);l||(c="value",void 0!==g&&(g!==e[c]||"progress"===x&&!g||"option"===x&&g!==b[c])&&N(e,c,g,b[c],s),c="checked",void 0!==y&&y!==e[c]&&N(e,c,y,b[c],s))}return e}function G(e,t,r){try{if("function"==typeof e){var n="function"==typeof e.__u;n&&e.__u(),n&&null==t||(e.__u=e(t))}else e.current=t}catch(e){a.__e(e,r)}}function j(e,t,r){var n,s;if(a.unmount&&a.unmount(e),(n=e.ref)&&(n.current&&n.current!==e.__e||G(n,null,t)),null!=(n=e.__c)){if(n.componentWillUnmount)try{n.componentWillUnmount()}catch(e){a.__e(e,t)}n.base=n.__P=null}if(n=e.__k)for(s=0;s<n.length;s++)n[s]&&j(n[s],t,r||"function"!=typeof e.type);r||null==e.__e||M(e.__e),e.__c=e.__=e.__e=e.__d=void 0}function X(e,t,r){return this.constructor(e,r)}function W(e,t,r){var s,i,o,l;a.__&&a.__(e,t),i=(s="function"==typeof r)?null:r&&r.__k||t.__k,o=[],l=[],U(t,e=(!s&&r||t).__k=_(S,null,[e]),i||m,m,t.namespaceURI,!s&&r?[r]:i?null:t.firstChild?n.call(t.childNodes):null,o,!s&&r?r:i?i.__e:t.firstChild,s,l),B(o,e,l)}function H(e,t){W(e,t,H)}function q(e,t,r){var a,s,i,o,l=b({},e.props);for(i in e.type&&e.type.defaultProps&&(o=e.type.defaultProps),t)"key"==i?a=t[i]:"ref"==i?s=t[i]:l[i]=void 0===t[i]&&void 0!==o?o[i]:t[i];return arguments.length>2&&(l.children=arguments.length>3?n.call(arguments,2):r),x(e.type,l,a||e.key,s||e.ref,null)}function z(e,t){var r={__c:t="__cC"+p++,__:e,Consumer:function(e,t){return e.children(t)},Provider:function(e){var r,n;return this.getChildContext||(r=[],(n={})[t]=this,this.getChildContext=function(){return n},this.componentWillUnmount=function(){r=null},this.shouldComponentUpdate=function(e){this.props.value!==e.value&&r.some((function(e){e.__e=!0,k(e)}))},this.sub=function(e){r.push(e);var t=e.componentWillUnmount;e.componentWillUnmount=function(){r&&r.splice(r.indexOf(e),1),t&&t.call(e)}}),e.children}};return r.Provider.__=r.Consumer.contextType=r}n=g.slice,a={__e:function(e,t,r,n){for(var a,s,i;t=t.__;)if((a=t.__c)&&!a.__)try{if((s=a.constructor)&&null!=s.getDerivedStateFromError&&(a.setState(s.getDerivedStateFromError(e)),i=a.__d),null!=a.componentDidCatch&&(a.componentDidCatch(e,n||{}),i=a.__d),i)return a.__E=a}catch(t){e=t}throw e}},s=0,i=function(e){return null!=e&&null==e.constructor},E.prototype.setState=function(e,t){var r;r=null!=this.__s&&this.__s!==this.state?this.__s:this.__s=b({},this.state),"function"==typeof e&&(e=e(b({},r),this.props)),e&&b(r,e),null!=e&&this.__v&&(t&&this._sb.push(t),k(this))},E.prototype.forceUpdate=function(e){this.__v&&(this.__e=!0,e&&this.__h.push(e),k(this))},E.prototype.render=S,o=[],u="function"==typeof Promise?Promise.prototype.then.bind(Promise.resolve()):setTimeout,c=function(e,t){return e.__v.__b-t.__v.__b},I.__r=0,h=0,d=O(!1),f=O(!0),p=0},8748:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BitStream=t.BitView=void 0;class r{constructor(e){this.view=new Uint8Array(e,0,e.byteLength)}getBits(e,t,r=!1){if(t>8*this.view.length-e)throw new Error("Bits out of bounds");let n=0;for(let r=0;r<t;){const a=t-r,s=7&e,i=this.view[e>>3],o=Math.min(a,8-s);n|=(i>>s&(1<<o)-1)<<r,e+=o,r+=o}return r?(32!==t&&n&1<<t-1&&(n|=-1^(1<<t)-1),n):n>>>0}getInt8(e){return this.getBits(e,8,!0)}getUint8(e){return this.getBits(e,8,!1)}getInt16(e){return this.getBits(e,16,!0)}getUint16(e){return this.getBits(e,16,!1)}getInt32(e){return this.getBits(e,32,!0)}getUint32(e){return this.getBits(e,32,!1)}getFloat32(e){return r.scratch.setUint32(0,this.getUint32(e)),r.scratch.getFloat32(0)}getFloat64(e){return r.scratch.setUint32(0,this.getUint32(e)),r.scratch.setUint32(4,this.getUint32(e+32)),r.scratch.getFloat64(0)}}t.BitView=r,r.scratch=new DataView(new ArrayBuffer(8));t.BitStream=class{constructor(e){this.view=new r(e),this.index=0}readBits(e,t=!1){const r=this.view.getBits(this.index,e,t);return this.index+=e,r}readInt8(){const e=this.view.getInt8(this.index);return this.index+=8,e}readUint8(){const e=this.view.getUint8(this.index);return this.index+=8,e}readInt16(){const e=this.view.getInt16(this.index);return this.index+=16,e}readUint16(){const e=this.view.getUint16(this.index);return this.index+=16,e}readInt32(){const e=this.view.getInt32(this.index);return this.index+=32,e}readUint32(){const e=this.view.getUint32(this.index);return this.index+=32,e}readFloat32(){const e=this.view.getFloat32(this.index);return this.index+=32,e}readFloat64(){const e=this.view.getFloat64(this.index);return this.index+=64,e}readString(e=0,t=!1){let r=0;const n=[];let a=!0;for(;!e||e&&r<e;){const t=this.readUint8();if(0===t&&(a=!1,!e))break;a&&n.push(t),r++}const s=String.fromCharCode.apply(null,n);if(!t)return s;try{return decodeURIComponent(s)}catch(e){return s}}}},1269:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Bsp=void 0;t.Bsp=class{constructor(e,t,r,n,a){this.skies=[],this.sprites={},this.name=e,this.entities=t,this.textures=r,this.models=n,this.lightmap=a}}},4932:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Config=void 0;class r{static init(e){return new r("string"==typeof e?{paths:{base:e,replays:`${e}/replays`,maps:`${e}/maps`,wads:`${e}/wads`,skies:`${e}/skies`,sounds:`${e}/sounds`}}:{paths:{base:e&&e.paths&&e.paths.base||"",replays:e&&e.paths&&e.paths.replays||"/replays",maps:e&&e.paths&&e.paths.maps||"/maps",wads:e&&e.paths&&e.paths.wads||"/wads",skies:e&&e.paths&&e.paths.skies||"/skies",sounds:e&&e.paths&&e.paths.sounds||"/sounds"}})}constructor(e){this.paths=Object.assign({},e.paths)}getBasePath(){return this.paths.base}getReplaysPath(){return this.paths.replays}getMapsPath(){return this.paths.maps}getWadsPath(){return this.paths.wads}getSkiesPath(){return this.paths.skies}getSoundsPath(){return this.paths.sounds}}t.Config=r},5359:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Fullscreen=void 0;const r=[{enabled:"fullscreenEnabled",element:"fullscreenElement",request:"requestFullscreen",exit:"exitFullscreen",change:"fullscreenchange",error:"fullscreenerror"},{enabled:"mozFullScreenEnabled",element:"mozFullScreenElement",request:"mozRequestFullScreen",exit:"mozCancelFullScreen",change:"mozfullscreenchange",error:"mozfullscreenerror"},{enabled:"webkitFullscreenEnabled",element:"webkitCurrentFullScreenElement",request:"webkitRequestFullscreen",exit:"webkitExitFullscreen",change:"webkitfullscreenchange",error:"webkitfullscreenerror"},{enabled:"msFullscreenEnabled",element:"msFullscreenElement",request:"msRequestFullscreen",exit:"msExitFullscreen",change:"MSFullscreenChange",error:"MSFullscreenError"}];let n=0;const a=document;for(let e=0;e<r.length;++e)if(void 0!==a[r[e].enabled]){n=e;break}class s{static element(){return a[r[n].element]}static enabled(){return a[r[n].enabled]}static isInFullscreen(){return null!==s.element()}static enter(e){e[r[n].request]()}static exit(){a[r[n].exit]()}static onChange(e){return window.addEventListener(r[n].change,e)}static onChangeRemove(e){window.removeEventListener(r[n].change,e)}static onError(e){return window.addEventListener(r[n].error,e)}}t.Fullscreen=s},7484:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Game=t.PlayerMode=void 0;const n=r(9431),a=r(4343),s=r(4605),i=r(7172),o=r(1776),l=r(4769),u=r(9866),c=r(9694),h=r(8559),d=r(8372),f=r(5121),p=r(3650),m=r(6194);var g;!function(e){e[e.FREE=0]="FREE",e[e.REPLAY=1]="REPLAY"}(g||(t.PlayerMode=g={}));class y{static init(e){if(!h.Context.checkWebGLSupport().hasSupport)return{status:"error",message:"No WebGL support!"};const t=document.createElement("canvas");if(!t)return{status:"error",message:"Failed to create <canvas> element!"};const r=h.Context.init(t);if(!r)return{status:"error",message:"Failed to initialize WebGL context"};const n=f.Renderer.init(r);if(!n)return{status:"error",message:"Failed to initialize renderer"};const a=m.WorldScene.init(r);if(!a)return{status:"error",message:"Failed to initialize world scene"};const s=p.SkyScene.init(r);if(!s)return{status:"error",message:"Failed to initialize sky scene"};return{status:"success",game:new y({canvas:t,config:e,context:r,renderer:n,worldScene:a,skyScene:s})}}constructor(e){this.pauseTime=0,this.isPaused=!1,this.lastTime=0,this.accumTime=0,this.timeStep=1/60,this.title="",this.pointerLocked=!1,this.touch=new o.Touch,this.mouse=new i.Mouse,this.keyboard=new u.Keyboard,this.entities=[],this.onLoadAll=e=>{if(e&&e.replay&&(this.changeReplay(e.replay.data),this.changeMode(g.REPLAY)),!e.map||!e.map.data)return;const t=e.map.data,r=e.skies;let n=!0;r.forEach((e=>{n=n&&e.isDone()})),n&&r.forEach((e=>e.data?t.skies.push(e.data):0)),Object.entries(e.sprites).forEach((([e,r])=>{r.data&&(t.sprites[e]=r.data)})),e.sounds.length>0&&e.sounds.forEach((e=>{e.data&&this.sounds.push(e.data)})),this.changeMap(t),this.events.emit("load",e)},this.draw=()=>{requestAnimationFrame(this.draw);const e=this.canvas,t=e.parentElement;if(t){const r=t.clientWidth,n=t.clientHeight;e.width===r&&e.height===n||(e.width=r,e.height=n,this.camera.aspect=e.clientWidth/e.clientHeight,this.camera.updateProjectionMatrix(),this.context.gl.viewport(0,0,this.context.gl.drawingBufferWidth,this.context.gl.drawingBufferHeight)),e.clientWidth===e.width&&e.clientHeight===e.height||(e.width=e.clientWidth,e.height=e.clientHeight,this.camera.aspect=e.clientWidth/e.clientHeight,this.camera.updateProjectionMatrix(),this.context.gl.viewport(0,0,this.context.gl.drawingBufferWidth,this.context.gl.drawingBufferHeight))}const r=a.now()/1e3,n=r-this.lastTime;for(this.accumTime+=n;this.accumTime>this.timeStep;)this.update(this.timeStep),this.accumTime-=this.timeStep;this.renderer.draw(),""!==this.mapName&&(this.skyScene.draw(this.camera),this.worldScene.draw(this.camera,this.entities)),this.lastTime=r},this.onTouchStart=e=>{const t=e.touches.item(0);t&&(this.touch.pressed=!0,this.touch.position[0]=t.clientX,this.touch.position[1]=t.clientY)},this.onTouchEnd=()=>{this.touch.pressed=!1,this.touch.delta[0]=0,this.touch.delta[1]=0},this.onTouchMove=e=>{const t=e.touches.item(0);t&&this.touch.pressed&&(this.touch.delta[0],this.touch.delta[0]=t.clientX-this.touch.position[0],this.touch.delta[1]=t.clientY-this.touch.position[1],this.touch.position[0]=t.clientX,this.touch.position[1]=t.clientY)},this.onMouseMove=e=>{this.pointerLocked&&(this.mouse.delta[0]=.5*e.movementX,this.mouse.delta[1]=.5*e.movementY,this.mouse.position[0]=e.pageX,this.mouse.position[1]=e.pageY)},this.keyDown=e=>(this.keyboard.keys[e.which]=1,!this.pointerLocked||(e.preventDefault(),!1)),this.keyUp=e=>(this.keyboard.keys[e.which]=0,!this.pointerLocked||(e.preventDefault(),!1)),this.onVisibilityChange=()=>{if(document.hidden){if(this.isPaused)return;this.pauseTime=a.now()/1e3,this.isPaused=!0}else{if(!this.isPaused)return;this.lastTime=a.now()/1e3-this.pauseTime+this.lastTime,this.isPaused=!1}},this.sounds=[],this.soundSystem=new c.SoundSystem,this.config=e.config,this.loader=new s.Loader(this.config),this.loader.events.on("loadall",this.onLoadAll),document.addEventListener("touchstart",this.onTouchStart,!1),document.addEventListener("touchend",this.onTouchEnd,!1),document.addEventListener("touchcancel",this.onTouchEnd,!1),document.addEventListener("touchmove",this.onTouchMove,!1),document.addEventListener("mousemove",this.onMouseMove,!1),window.addEventListener("keydown",this.keyDown),window.addEventListener("keyup",this.keyUp),window.addEventListener("visibilitychange",this.onVisibilityChange),this.canvas=e.canvas,this.camera=l.Camera.init(this.canvas.width/this.canvas.height),this.context=e.context,this.renderer=e.renderer,this.worldScene=e.worldScene,this.skyScene=e.skyScene,this.mode=g.FREE,this.player=new d.ReplayPlayer(this),this.events=(0,n.createNanoEvents)(),this.mapName=""}getCanvas(){return this.canvas}load(e){this.events.emit("loadstart"),this.loader.load(e)}changeMap(e){if(this.mapName.toLowerCase()===e.name.toLowerCase())return;this.mapName=e.name,this.worldScene.changeMap(e),this.skyScene.changeMap(e),this.entities=e.entities;const t=e.entities.find((e=>"info_player_start"===e.classname));t?(this.camera.position[0]=t.origin[0],this.camera.position[1]=t.origin[1],this.camera.position[2]=t.origin[2]):(this.camera.position[0]=0,this.camera.position[1]=0,this.camera.position[2]=0),this.camera.rotation[0]=0,this.camera.rotation[1]=0,this.camera.rotation[2]=0}changeReplay(e){this.events.emit("prereplaychange",this,e),this.player.changeReplay(e),this.events.emit("postreplaychange",this,e)}changeMode(e){this.mode=e,this.events.emit("modechange",e)}setTitle(e){this.title=e,this.events.emit("titlechange",e)}getTitle(){return this.title}update(e){this.events.emit("preupdate",this);const t=this.camera,r=this.keyboard,n=this.mouse,a=this.touch;if(this.mode===g.REPLAY)this.player.update(e);else if(this.mode===g.FREE){this.touch.pressed?(t.rotation[0]=Math.min(Math.max(t.rotation[0]+a.delta[1]/100,-Math.PI/2),Math.PI/2),t.rotation[1]-=a.delta[0]/100):(t.rotation[0]=Math.min(Math.max(t.rotation[0]+n.delta[1]/100,-Math.PI/2),Math.PI/2),t.rotation[1]-=n.delta[0]/100);const s=500*e,i=u.Keyboard.KEYS.W,o=u.Keyboard.KEYS.S,l=u.Keyboard.KEYS.A,c=u.Keyboard.KEYS.D,h=u.Keyboard.KEYS.C,d=u.Keyboard.KEYS.SPACE;r.keys[i]!==r.keys[o]&&(r.keys[i]?(t.position[1]-=Math.cos(t.rotation[1]+Math.PI/2)*s,t.position[0]+=Math.sin(t.rotation[1]+Math.PI/2)*s):r.keys[o]&&(t.position[1]-=Math.cos(t.rotation[1]-Math.PI/2)*s,t.position[0]+=Math.sin(t.rotation[1]-Math.PI/2)*s)),r.keys[l]!==r.keys[c]&&(r.keys[l]?(t.position[1]+=Math.cos(t.rotation[1])*s,t.position[0]-=Math.sin(t.rotation[1])*s):r.keys[c]&&(t.position[1]-=Math.cos(t.rotation[1])*s,t.position[0]+=Math.sin(t.rotation[1])*s)),r.keys[d]!==r.keys[h]&&(r.keys[d]?t.position[2]+=s:r.keys[h]&&(t.position[2]-=s))}n.delta[0]=0,n.delta[1]=0,this.events.emit("postupdate",this)}}t.Game=y},4769:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Camera=void 0;const n=r(1961);class a{static init(e){return new a(e)}constructor(e){this.projectionMatrix=n.mat4.create(),this.fov=n.glMatrix.toRadian(60),this.near=1,this.far=8192,this.viewMatrix=n.mat4.create(),this.position=n.vec3.create(),this.rotation=n.vec3.create(),this.aspect=e,this.updateProjectionMatrix()}updateProjectionMatrix(){n.mat4.perspective(this.projectionMatrix,this.fov,this.aspect,this.near,this.far)}updateViewMatrix(){n.mat4.identity(this.viewMatrix),n.mat4.rotateX(this.viewMatrix,this.viewMatrix,this.rotation[0]-Math.PI/2),n.mat4.rotateZ(this.viewMatrix,this.viewMatrix,Math.PI/2-this.rotation[1]),n.mat4.translate(this.viewMatrix,this.viewMatrix,[-this.position[0],-this.position[1],-this.position[2]])}}t.Camera=a},8559:(e,t)=>{"use strict";var r;Object.defineProperty(t,"__esModule",{value:!0}),t.Context=t.ShaderType=void 0,function(e){e[e.VERTEX=0]="VERTEX",e[e.FRAGMENT=1]="FRAGMENT"}(r||(t.ShaderType=r={}));class n{static init(e){const t=e.getContext("webgl",{alpha:!1});return t?new n(t):(console.error("Failed to get WebGL context"),null)}static checkWebGLSupport(){const e="Your browser does not seem to support WebGL",t="Your graphics card does not seem to support WebGL";if(!window.WebGLRenderingContext)return{hasSupport:!1,message:e};const r=document.createElement("canvas");try{return r.getContext("webgl")||r.getContext("experimental-webgl")?{hasSupport:!0,message:""}:{hasSupport:!1,message:t}}catch(e){return{hasSupport:!1,message:t}}}constructor(e){this.gl=e}createProgram(e){const t=this.gl;var n=t.createProgram();if(!n)return console.error("Failed to create WebGL program"),null;const a=this.createShader({source:e.vertexShaderSrc,type:r.VERTEX});if(!a)return console.error("Failed to compile vertex shader"),null;const s=this.createShader({source:e.fragmentShaderSrc,type:r.FRAGMENT});if(!s)return console.error("Failed to compile fragment shader"),null;if(t.attachShader(n,a),t.attachShader(n,s),t.linkProgram(n),t.validateProgram(n),!t.getProgramParameter(n,t.LINK_STATUS)){t.deleteProgram(n),t.deleteShader(a),t.deleteShader(s);const e=t.getProgramInfoLog(n);return console.error(`Could not initialize shader: ${e}`),null}if(!t.getProgramParameter(n,t.VALIDATE_STATUS)){t.deleteProgram(n),t.deleteShader(a),t.deleteShader(s);const e=t.getProgramInfoLog(n);return console.error(`Could not initialize shader: ${e}`),null}t.useProgram(n);const i={};for(let r=0;r<e.attributeNames.length;++r){const a=e.attributeNames[r],s=t.getAttribLocation(n,a);if(-1===s)return console.error(`gl.getAttribLocation failed for attrib named "${a}"`),t.deleteProgram(n),null;i[a]=s}const o={};for(let r=0;r<e.uniformNames.length;++r){const a=e.uniformNames[r],s=t.getUniformLocation(n,a);if(null===s)return console.error(`gl.getUniformLocation failed for uniform named "${a}"`),t.deleteProgram(n),null;o[a]=s}return{handle:n,attributes:i,uniforms:o}}createShader(e){const t=this.gl,n=e.type===r.VERTEX?t.createShader(t.VERTEX_SHADER):t.createShader(t.FRAGMENT_SHADER);return n?(t.shaderSource(n,e.source),t.compileShader(n),t.getShaderParameter(n,t.COMPILE_STATUS)?n:(console.error(t.getShaderInfoLog(n)),t.deleteShader(n),null)):(console.error("Failed to create shader program"),null)}getAnisotropyExtension(){return this.gl.getExtension("EXT_texture_filter_anisotropic")||this.gl.getExtension("MOZ_EXT_texture_filter_anisotropic")||this.gl.getExtension("WEBKIT_EXT_texture_filter_anisotropic")}getMaxAnisotropy(e){return this.gl.getParameter(e.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}}t.Context=n},5121:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Renderer=void 0;class r{static init(e){const t=e.gl;return t.clearColor(0,0,0,1),t.clearDepth(1),t.enable(t.DEPTH_TEST),t.depthFunc(t.LEQUAL),t.enable(t.BLEND),t.blendFunc(t.SRC_ALPHA,t.ONE_MINUS_SRC_ALPHA),t.enable(t.CULL_FACE),t.cullFace(t.FRONT),new r({context:e})}constructor(e){this.draw=()=>{const e=this.context.gl;e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT)},this.context=e.context}}t.Renderer=r},3650:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SkyScene=void 0;const n=r(3219);class a{static init(e){const t=n.SkyShader.init(e);return t?new a({context:e,shader:t}):(console.error("skyscenen't"),null)}constructor(e){this.vertexBuffer=null,this.indexBuffer=null,this.texture=null,this.isReady=!1,this.context=e.context,this.shader=e.shader}changeMap(e){if(6!==e.skies.length)return void(this.isReady=!1);const t=this.context.gl,r=t.createBuffer(),n=t.createBuffer(),a=t.createTexture();if(!r||!n||!a)throw new Error("shouldnt happen");const s=new Uint8Array([0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23]),i=new Float32Array([-1,-1,1,.499,.001,1,-1,1,.499,.249,1,1,1,.001,.249,-1,1,1,.001,.001,-1,-1,-1,.499,.749,-1,1,-1,.001,.749,1,1,-1,.001,.501,1,-1,-1,.499,.501,-1,1,-1,.501,.749,-1,1,1,.501,.501,1,1,1,.999,.501,1,1,-1,.999,.749,-1,-1,-1,.999,.249,1,-1,-1,.501,.249,1,-1,1,.501,.001,-1,-1,1,.999,.001,1,-1,-1,.499,.499,1,1,-1,.001,.499,1,1,1,.001,.251,1,-1,1,.499,.251,-1,-1,-1,.501,.499,-1,-1,1,.501,.251,-1,1,1,.999,.251,-1,1,-1,.999,.499].map(((e,t)=>t%5<3?4096*e:e)));t.bindBuffer(t.ARRAY_BUFFER,r),t.bufferData(t.ARRAY_BUFFER,i,t.STATIC_DRAW),t.enableVertexAttribArray(0),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,n),t.bufferData(t.ELEMENT_ARRAY_BUFFER,s,t.STATIC_DRAW);const o=document.createElement("canvas");o.width=512,o.height=1024;const l=o.getContext("2d");if(!l)throw new Error("sky ctx fail");const u={up:[0,0],rt:[0,256],dn:[0,512],ft:[256,0],lf:[256,256],bk:[256,512]};e.skies.forEach((e=>{const t=document.createElement("canvas"),r=t.getContext("2d");if(!r)throw new Error("Runtime error.");t.width=e.width,t.height=e.height;const n=r.getImageData(0,0,t.width,t.height);for(let t=0;t<e.data.length;++t)n.data[t]=e.data[t];r.putImageData(n,0,0);const a=e.name.slice(-2),s=u[a]?u[a]:[];if(!l)throw new Error("Runtime error.");l.drawImage(t,s[0],s[1])}));const c=l.getImageData(0,0,512,1024).data;t.bindTexture(t.TEXTURE_2D,a),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,512,1024,0,t.RGBA,t.UNSIGNED_BYTE,new Uint8Array(c)),t.generateMipmap(t.TEXTURE_2D),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.REPEAT),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.REPEAT),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR_MIPMAP_LINEAR),t.texParameterf(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.LINEAR);const h=this.context.getAnisotropyExtension();h&&t.texParameteri(t.TEXTURE_2D,h.TEXTURE_MAX_ANISOTROPY_EXT,this.context.getMaxAnisotropy(h)),this.vertexBuffer=r,this.indexBuffer=n,this.texture=a,this.isReady=!0}draw(e){if(!this.isReady)return;const t=this.context.gl,r=this.shader;r.useProgram(t),t.bindTexture(t.TEXTURE_2D,this.texture),t.bindBuffer(t.ARRAY_BUFFER,this.vertexBuffer),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this.indexBuffer),r.enableVertexAttribs(t),r.setVertexAttribPointers(t),r.setDiffuse(t,0);const n=e.position[0],a=e.position[1],s=e.position[2];e.position[0]=0,e.position[1]=0,e.position[2]=0,e.updateViewMatrix(),e.position[0]=n,e.position[1]=a,e.position[2]=s,r.setViewMatrix(t,e.viewMatrix),r.setProjectionMatrix(t,e.projectionMatrix),t.drawElements(t.TRIANGLES,36,t.UNSIGNED_BYTE,0),t.clear(t.DEPTH_BUFFER_BIT)}}t.SkyScene=a},3219:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SkyShader=void 0;class r{static init(e){const t=e.createProgram({vertexShaderSrc:"#ifdef GL_ES\nprecision highp float;\n#endif\n\nattribute vec3 position;\nattribute vec2 texCoord;\n\nvarying vec2 vTexCoord;\n\nuniform mat4 viewMatrix;\nuniform mat4 projectionMatrix;\n\nvoid main(void) {\n  vTexCoord = texCoord;\n  gl_Position = projectionMatrix * viewMatrix * vec4(position, 1);\n}",fragmentShaderSrc:"#ifdef GL_ES\nprecision highp float;\n#endif\n\nuniform sampler2D diffuse;\n\nvarying vec2 vTexCoord;\n\nvoid main(void) {\n  vec4 diffuseColor = texture2D(diffuse, vTexCoord);\n  gl_FragColor = vec4(diffuseColor.rgb, 1.0);\n}",attributeNames:["position","texCoord"],uniformNames:["viewMatrix","projectionMatrix","diffuse"]});return t?new r(t):(console.error("Failed to create sky shader program"),null)}constructor(e){this.program=e.handle,this.aPosition=e.attributes.position,this.aTexCoord=e.attributes.texCoord,this.uViewMx=e.uniforms.viewMatrix,this.uProjectionMx=e.uniforms.projectionMatrix,this.uDiffuse=e.uniforms.diffuse}useProgram(e){e.useProgram(this.program)}setViewMatrix(e,t){e.uniformMatrix4fv(this.uViewMx,!1,t)}setProjectionMatrix(e,t){e.uniformMatrix4fv(this.uProjectionMx,!1,t)}setDiffuse(e,t){e.uniform1i(this.uDiffuse,t)}enableVertexAttribs(e){e.enableVertexAttribArray(this.aPosition),e.enableVertexAttribArray(this.aTexCoord)}setVertexAttribPointers(e){e.vertexAttribPointer(this.aPosition,3,e.FLOAT,!1,20,0),e.vertexAttribPointer(this.aTexCoord,2,e.FLOAT,!1,20,12)}}t.SkyShader=r},9314:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.nextPowerOfTwo=t.isPowerOfTwo=t.resizeTexture=void 0;t.resizeTexture=(e,t,r,n,a)=>{const s=document.createElement("canvas"),i=s.getContext("2d");if(!i)throw new Error("Runtime error.");s.width=t,s.height=r;const o=document.createElement("canvas"),l=o.getContext("2d");if(!l)throw new Error("Runtime error.");o.width=n,o.height=a;const u=i.createImageData(t,r);for(let n=0,a=t*r*4;n<a;n+=4)u.data[n]=e[n],u.data[n+1]=e[n+1],u.data[n+2]=e[n+2],u.data[n+3]=e[n+3];return i.putImageData(u,0,0),l.drawImage(s,0,0,n,a),new Uint8Array(l.getImageData(0,0,n,a).data)};t.isPowerOfTwo=e=>0==(e&e-1);t.nextPowerOfTwo=e=>{--e;for(let t=1;t<32;t<<=1)e|=e>>t;return e+1}},6194:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.WorldScene=void 0;const n=r(1961),a=r(9807),s=r(4586),i=r(8506),o=r(9314);class l{static init(e){const t=a.MainShader.init(e);if(!t)return console.error("Failed to init MainShader"),null;t.useProgram(e.gl);const r=e.gl.createBuffer();return r?new l({buffer:r,context:e,shader:t}):(console.error("Failed to create WebGL buffer"),null)}constructor(e){this.modelMatrix=n.mat4.create(),this.sceneInfo={length:0,data:new Float32Array(0),models:[]},this.bsp=null,this.textures=[],this.sprites={},this.lightmap=null,this.buffer=e.buffer,this.context=e.context,this.shader=e.shader}changeMap(e){this.fillBuffer(e),this.loadTextures(e),this.loadSpriteTextures(e),this.loadLightmap(e),this.bsp=e}fillBuffer(e){const t=this.context.gl,r=e.models,n=["aaatrigger","clip","null","hint","nodraw","invisible","skip","trigger","sky","fog"];let a=0;for(let t=0;t<r.length;++t){const s=r[t];for(let t=0;t<s.faces.length;++t){const r=e.textures[s.faces[t].textureIndex];n.indexOf(r.name)>-1||(a+=s.faces[t].buffer.length)}}a+=42;const s={length:a,data:new Float32Array(a),models:[]};let i=0;for(let t=0;t<e.models.length;++t){const r=e.models[t],a={origin:r.origin,offset:i,length:0,isTransparent:!1,faces:[]};for(let t=0;t<r.faces.length;++t){const o=e.textures[r.faces[t].textureIndex];if(n.indexOf(o.name)>-1)continue;const l={offset:i,length:0,textureIndex:-1};for(let e=0;e<r.faces[t].buffer.length;++e)s.data[i++]=r.faces[t].buffer[e];a.isTransparent||"{"!==e.textures[r.faces[t].textureIndex].name[0]||(a.isTransparent=!0),l.textureIndex=r.faces[t].textureIndex,l.length=i-l.offset,a.faces.push(l)}a.length=i-a.offset,s.models.push(a)}s.models.push({origin:[0,0,0],offset:i,length:4,isTransparent:!1,faces:[{offset:i,length:4,textureIndex:0}]}),s.data[i++]=-.5,s.data[i++]=0,s.data[i++]=-.5,s.data[i++]=1,s.data[i++]=1,s.data[i++]=0,s.data[i++]=0,s.data[i++]=.5,s.data[i++]=0,s.data[i++]=.5,s.data[i++]=0,s.data[i++]=0,s.data[i++]=0,s.data[i++]=0,s.data[i++]=-.5,s.data[i++]=0,s.data[i++]=.5,s.data[i++]=1,s.data[i++]=0,s.data[i++]=0,s.data[i++]=0,s.data[i++]=-.5,s.data[i++]=0,s.data[i++]=-.5,s.data[i++]=1,s.data[i++]=1,s.data[i++]=0,s.data[i++]=0,s.data[i++]=.5,s.data[i++]=0,s.data[i++]=-.5,s.data[i++]=0,s.data[i++]=1,s.data[i++]=0,s.data[i++]=0,s.data[i++]=.5,s.data[i++]=0,s.data[i++]=.5,s.data[i++]=0,s.data[i++]=0,s.data[i++]=0,s.data[i++]=0,i=0;const o={data:new Float32Array(s.data),length:s.length,models:s.models.map((e=>({origin:[...e.origin],offset:e.offset,length:e.length,isTransparent:e.isTransparent,faces:e.faces.map((e=>({offset:e.offset,length:e.length,textureIndex:e.textureIndex})))})))};for(let e=0;e<o.models.length;++e){const t=o.models[e];t.faces.sort(((e,t)=>e.textureIndex-t.textureIndex));for(let e=0;e<t.faces.length;++e){const r=t.faces[e],n=i;for(let e=0;e<r.length;++e)o.data[i]=s.data[r.offset+e],i+=1;r.offset=n}const r=[];let n=-1;for(let e=0;e<t.faces.length;++e){const a=t.faces[e];a.textureIndex===n?r[r.length-1].length+=a.length:(r.push({offset:a.offset,length:a.length,textureIndex:a.textureIndex}),n=a.textureIndex)}t.faces=r}this.sceneInfo=o,t.bindBuffer(t.ARRAY_BUFFER,this.buffer),t.bufferData(t.ARRAY_BUFFER,this.sceneInfo.data,t.STATIC_DRAW)}loadTextures(e){const t=this.context.gl;for(let r=0;r<e.textures.length;++r){const n=t.createTexture();if(!n)throw new Error("fatal error");const a=e.textures[r];if(!(0,o.isPowerOfTwo)(a.width)||!(0,o.isPowerOfTwo)(a.height)){const e=a.width,t=a.height,r=(0,o.nextPowerOfTwo)(a.width),n=(0,o.nextPowerOfTwo)(a.height);a.data=(0,o.resizeTexture)(a.data,e,t,r,n),a.width=r,a.height=n}t.bindTexture(t.TEXTURE_2D,n),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,a.width,a.height,0,t.RGBA,t.UNSIGNED_BYTE,a.data),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR_MIPMAP_LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.REPEAT),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.REPEAT),t.generateMipmap(t.TEXTURE_2D);const s=this.context.getAnisotropyExtension();s&&t.texParameteri(t.TEXTURE_2D,s.TEXTURE_MAX_ANISOTROPY_EXT,this.context.getMaxAnisotropy(s)),this.textures.push({name:a.name,width:a.width,height:a.height,data:a.data,handle:n})}}loadSpriteTextures(e){const t=this.context.gl;for(const[r,n]of Object.entries(e.sprites)){const e=t.createTexture();if(!e)throw new Error("fatal error");const a=n.frames[0];if(!(0,o.isPowerOfTwo)(a.width)||!(0,o.isPowerOfTwo)(a.height)){const e=a.width,t=a.height,r=(0,o.nextPowerOfTwo)(a.width),n=(0,o.nextPowerOfTwo)(a.height);a.data=(0,o.resizeTexture)(a.data,e,t,r,n),a.width=r,a.height=n}t.bindTexture(t.TEXTURE_2D,e),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,a.width,a.height,0,t.RGBA,t.UNSIGNED_BYTE,a.data),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR_MIPMAP_LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.REPEAT),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.REPEAT),t.generateMipmap(t.TEXTURE_2D);const s=this.context.getAnisotropyExtension();s&&t.texParameteri(t.TEXTURE_2D,s.TEXTURE_MAX_ANISOTROPY_EXT,this.context.getMaxAnisotropy(s)),this.textures.push({name:r,width:a.width,height:a.height,data:a.data,handle:e}),this.sprites[r]=n}}loadLightmap(e){const t=this.context.gl,r=t.createTexture();if(!r)throw new Error("fatal error");t.bindTexture(t.TEXTURE_2D,r),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,e.lightmap.width,e.lightmap.height,0,t.RGBA,t.UNSIGNED_BYTE,e.lightmap.data),t.generateMipmap(t.TEXTURE_2D),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR_MIPMAP_LINEAR),this.lightmap={data:e.lightmap.data,handle:r}}draw(e,t){if(!this.bsp||!this.lightmap)return;const r=this.context.gl,n=this.shader;n.useProgram(r),e.updateProjectionMatrix(),e.updateViewMatrix(),n.setViewMatrix(r,e.viewMatrix),n.setProjectionMatrix(r,e.projectionMatrix),r.bindBuffer(r.ARRAY_BUFFER,this.buffer),n.enableVertexAttribs(r),n.setVertexAttribPointers(r),n.setDiffuse(r,0),n.setLightmap(r,1),r.activeTexture(r.TEXTURE1),r.bindTexture(r.TEXTURE_2D,this.lightmap.handle),r.activeTexture(r.TEXTURE0);const a=[],i=[];for(let e=1;e<t.length;++e){const r=t[e];if(r.model)if(r.rendermode&&r.rendermode!=s.RenderMode.Normal&&r.rendermode!=s.RenderMode.Solid)r.rendermode,s.RenderMode.Additive,i.push(r);else{if("*"===r.model[0]){if(this.sceneInfo.models[parseInt(r.model.substr(1))].isTransparent){i.push(r);continue}}else if(r.model.indexOf(".spr")>-1){i.push(r);continue}a.push(r)}}n.setOpacity(r,1),this.renderWorldSpawn(),this.renderOpaqueEntities(e,a),i.length&&(r.depthMask(!1),this.renderTransparentEntities(i,e),r.depthMask(!0))}renderWorldSpawn(){const e=this.sceneInfo.models[0],t=this.context.gl;n.mat4.identity(this.modelMatrix),this.shader.setModelMatrix(t,this.modelMatrix);for(let r=0;r<e.faces.length;++r){const n=e.faces[r];t.bindTexture(t.TEXTURE_2D,this.textures[n.textureIndex].handle),t.drawArrays(t.TRIANGLES,n.offset/7,n.length/7)}}renderOpaqueEntities(e,t){const r=this.context.gl,a=this.shader,o=this.modelMatrix;for(let l=0;l<t.length;++l){const u=t[l],c=parseInt(u.model.substr(1)),h=this.sceneInfo.models[c];if(h){const e=u.angles||[0,0,0],t=u.origin?n.vec3.fromValues(u.origin[0],u.origin[1],u.origin[2]):n.vec3.create(),s=new Float32Array(h.origin);n.vec3.add(t,t,s),n.mat4.identity(o),n.mat4.translate(o,o,t),n.mat4.rotateZ(o,o,e[1]*Math.PI/180),n.mat4.rotateX(this.modelMatrix,this.modelMatrix,e[2]*Math.PI/180),a.setModelMatrix(r,this.modelMatrix);for(let e=0;e<h.faces.length;++e){const t=h.faces[e];r.bindTexture(r.TEXTURE_2D,this.textures[t.textureIndex].handle),r.drawArrays(r.TRIANGLES,t.offset/7,t.length/7)}}else if(u.model.indexOf(".spr")>-1){const t=this.textures.find((e=>e.name===u.model)),l=this.sprites[u.model];if(t&&l){const c=u.origin?n.vec3.fromValues(u.origin[0],u.origin[1],u.origin[2]):n.vec3.create(),h=n.vec3.fromValues(t.width,1,t.height),d=u.angles?n.vec3.fromValues(u.angles[0],u.angles[2],u.angles[1]):n.vec3.create();switch(n.vec3.scale(h,h,u.scale||1),n.mat4.identity(o),n.mat4.translate(o,o,c),l.header.type){case i.SpriteType.VP_PARALLEL_UPRIGHT:case i.SpriteType.FACING_UPRIGHT:n.mat4.rotateZ(o,o,e.rotation[1]+Math.PI/2);break;case i.SpriteType.VP_PARALLEL:n.mat4.rotateZ(o,o,Math.atan2(c[1]-e.position[1],c[0]-e.position[0])+Math.PI/2),n.mat4.rotateX(o,o,Math.atan2(e.position[2]-c[2],Math.sqrt(Math.pow(e.position[0]-c[0],2)+Math.pow(e.position[1]-c[1],2))));break;case i.SpriteType.ORIENTED:n.mat4.rotateY(o,o,d[0]*Math.PI/180+Math.PI),n.mat4.rotateZ(o,o,d[1]*Math.PI/180+Math.PI),n.mat4.rotateX(o,o,d[2]*Math.PI/180-Math.PI/2);break;case i.SpriteType.VP_PARALLEL_ORIENTED:n.mat4.rotateY(o,o,d[0]*Math.PI/180+Math.PI),n.mat4.rotateZ(o,o,d[1]*Math.PI/180+Math.PI);break;default:throw new Error("Invalid sprite type")}n.mat4.scale(o,o,h),a.setModelMatrix(r,o),a.setOpacity(r,(u.renderamt||255)/255);switch(u.rendermode||s.RenderMode.Normal){case s.RenderMode.Normal:a.setOpacity(r,1),r.bindTexture(r.TEXTURE_2D,t.handle),r.drawArrays(r.TRIANGLES,this.sceneInfo.models[this.sceneInfo.models.length-1].offset/7,6);break;case s.RenderMode.Color:case s.RenderMode.Texture:a.setOpacity(r,(u.renderamt||255)/255),r.bindTexture(r.TEXTURE_2D,t.handle),r.drawArrays(r.TRIANGLES,this.sceneInfo.models[this.sceneInfo.models.length-1].offset/7,6);break;case s.RenderMode.Glow:r.blendFunc(r.SRC_ALPHA,r.DST_ALPHA),a.setOpacity(r,(u.renderamt||255)/255),r.bindTexture(r.TEXTURE_2D,t.handle),r.drawArrays(r.TRIANGLES,this.sceneInfo.models[this.sceneInfo.models.length-1].offset/7,6),r.blendFunc(r.SRC_ALPHA,r.ONE_MINUS_SRC_ALPHA);break;case s.RenderMode.Solid:a.setOpacity(r,(u.renderamt||255)/255),r.bindTexture(r.TEXTURE_2D,t.handle),r.drawArrays(r.TRIANGLES,this.sceneInfo.models[this.sceneInfo.models.length-1].offset/7,6);break;case s.RenderMode.Additive:r.blendFunc(r.SRC_ALPHA,r.DST_ALPHA),a.setOpacity(r,(u.renderamt||255)/255),r.bindTexture(r.TEXTURE_2D,t.handle),r.drawArrays(r.TRIANGLES,this.sceneInfo.models[this.sceneInfo.models.length-1].offset/7,6),r.blendFunc(r.SRC_ALPHA,r.ONE_MINUS_SRC_ALPHA)}}}}}renderTransparentEntities(e,t){const r=this.context.gl,a=this.shader,o=this.modelMatrix,l=e.map(((e,r)=>({index:r,distance:n.vec3.dist(t.position,e.origin||[0,0,0])}))).sort(((e,t)=>e.distance-t.distance));for(let u=0;u<l.length;++u){const c=e[l[u].index],h=parseInt(c.model.substr(1)),d=this.sceneInfo.models[h];if(d){const e=c.angles||[0,0,0],t=c.origin||[0,0,0];t[0]+=d.origin[0],t[1]+=d.origin[1],t[2]+=d.origin[2],n.mat4.identity(o),n.mat4.translate(o,o,t),n.mat4.rotateZ(o,o,e[1]*Math.PI/180),n.mat4.rotateX(this.modelMatrix,this.modelMatrix,e[2]*Math.PI/180),a.setModelMatrix(r,this.modelMatrix);switch(c.rendermode||s.RenderMode.Normal){case s.RenderMode.Normal:a.setOpacity(r,1);for(let e=0;e<d.faces.length;++e){const t=d.faces[e];r.bindTexture(r.TEXTURE_2D,this.textures[t.textureIndex].handle),r.drawArrays(r.TRIANGLES,t.offset/7,t.length/7)}break;case s.RenderMode.Color:a.setOpacity(r,(c.renderamt||255)/255);for(let e=0;e<d.faces.length;++e){const t=d.faces[e];r.bindTexture(r.TEXTURE_2D,this.textures[t.textureIndex].handle),r.drawArrays(r.TRIANGLES,t.offset/7,t.length/7)}break;case s.RenderMode.Texture:a.setOpacity(r,(c.renderamt||255)/255);for(let e=0;e<d.faces.length;++e){const t=d.faces[e];r.bindTexture(r.TEXTURE_2D,this.textures[t.textureIndex].handle),r.drawArrays(r.TRIANGLES,t.offset/7,t.length/7)}break;case s.RenderMode.Glow:a.setOpacity(r,(c.renderamt||255)/255);for(let e=0;e<d.faces.length;++e){const t=d.faces[e];r.bindTexture(r.TEXTURE_2D,this.textures[t.textureIndex].handle),r.drawArrays(r.TRIANGLES,t.offset/7,t.length/7)}break;case s.RenderMode.Solid:a.setOpacity(r,(c.renderamt||255)/255);for(let e=0;e<d.faces.length;++e){const t=d.faces[e];r.bindTexture(r.TEXTURE_2D,this.textures[t.textureIndex].handle),r.drawArrays(r.TRIANGLES,t.offset/7,t.length/7)}break;case s.RenderMode.Additive:r.blendFunc(r.SRC_ALPHA,r.DST_ALPHA),a.setOpacity(r,(c.renderamt||255)/255);for(let e=0;e<d.faces.length;++e){const t=d.faces[e];r.bindTexture(r.TEXTURE_2D,this.textures[t.textureIndex].handle),r.drawArrays(r.TRIANGLES,t.offset/7,t.length/7)}r.blendFunc(r.SRC_ALPHA,r.ONE_MINUS_SRC_ALPHA)}}else if(c.model.indexOf(".spr")>-1){const e=this.textures.find((e=>e.name===c.model)),l=this.sprites[c.model];if(e&&l){const u=c.origin?n.vec3.fromValues(c.origin[0],c.origin[1],c.origin[2]):n.vec3.create(),h=n.vec3.fromValues(e.width,1,e.height),d=c.angles?n.vec3.fromValues(c.angles[0],c.angles[2],c.angles[1]):n.vec3.create();switch(n.vec3.scale(h,h,c.scale||1),n.mat4.identity(o),n.mat4.translate(o,o,u),l.header.type){case i.SpriteType.VP_PARALLEL_UPRIGHT:case i.SpriteType.FACING_UPRIGHT:n.mat4.rotateZ(o,o,t.rotation[1]+Math.PI/2);break;case i.SpriteType.VP_PARALLEL:n.mat4.rotateZ(o,o,Math.atan2(u[1]-t.position[1],u[0]-t.position[0])+Math.PI/2),n.mat4.rotateX(o,o,Math.atan2(t.position[2]-u[2],Math.sqrt(Math.pow(t.position[0]-u[0],2)+Math.pow(t.position[1]-u[1],2))));break;case i.SpriteType.ORIENTED:n.mat4.rotateY(o,o,d[0]*Math.PI/180+Math.PI),n.mat4.rotateZ(o,o,d[1]*Math.PI/180+Math.PI),n.mat4.rotateX(o,o,d[2]*Math.PI/180-Math.PI/2);break;case i.SpriteType.VP_PARALLEL_ORIENTED:n.mat4.rotateY(o,o,d[0]*Math.PI/180+Math.PI),n.mat4.rotateZ(o,o,d[1]*Math.PI/180+Math.PI);break;default:throw new Error("Invalid sprite type")}n.mat4.scale(o,o,h),a.setModelMatrix(r,o),a.setOpacity(r,(c.renderamt||255)/255);switch(c.rendermode||s.RenderMode.Normal){case s.RenderMode.Normal:a.setOpacity(r,1),r.bindTexture(r.TEXTURE_2D,e.handle),r.drawArrays(r.TRIANGLES,this.sceneInfo.models[this.sceneInfo.models.length-1].offset/7,6);break;case s.RenderMode.Color:case s.RenderMode.Texture:a.setOpacity(r,(c.renderamt||255)/255),r.bindTexture(r.TEXTURE_2D,e.handle),r.drawArrays(r.TRIANGLES,this.sceneInfo.models[this.sceneInfo.models.length-1].offset/7,6);break;case s.RenderMode.Glow:r.blendFunc(r.SRC_ALPHA,r.DST_ALPHA),a.setOpacity(r,(c.renderamt||255)/255),r.bindTexture(r.TEXTURE_2D,e.handle),r.drawArrays(r.TRIANGLES,this.sceneInfo.models[this.sceneInfo.models.length-1].offset/7,6),r.blendFunc(r.SRC_ALPHA,r.ONE_MINUS_SRC_ALPHA);break;case s.RenderMode.Solid:a.setOpacity(r,(c.renderamt||255)/255),r.bindTexture(r.TEXTURE_2D,e.handle),r.drawArrays(r.TRIANGLES,this.sceneInfo.models[this.sceneInfo.models.length-1].offset/7,6);break;case s.RenderMode.Additive:r.blendFunc(r.SRC_ALPHA,r.DST_ALPHA),a.setOpacity(r,(c.renderamt||255)/255),r.bindTexture(r.TEXTURE_2D,e.handle),r.drawArrays(r.TRIANGLES,this.sceneInfo.models[this.sceneInfo.models.length-1].offset/7,6),r.blendFunc(r.SRC_ALPHA,r.ONE_MINUS_SRC_ALPHA)}}}}}}t.WorldScene=l},9807:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MainShader=void 0;class r{static init(e){const t=e.createProgram({vertexShaderSrc:"#ifdef GL_ES\nprecision highp float;\n#endif\n\nattribute vec3 position;\nattribute vec2 texCoord;\nattribute vec2 texCoord2;\n\nvarying vec2 vTexCoord;\nvarying vec2 vLightmapCoord;\n\nuniform mat4 modelMatrix;\nuniform mat4 viewMatrix;\nuniform mat4 projectionMatrix;\n\nvoid main(void) {\n  vTexCoord = texCoord;\n  vLightmapCoord = texCoord2;\n\n  gl_Position = projectionMatrix * viewMatrix * modelMatrix * vec4(position, 1);\n}",fragmentShaderSrc:"#ifdef GL_ES\nprecision highp float;\n#endif\n\nuniform sampler2D diffuse;\nuniform sampler2D lightmap;\nuniform float opacity;\n\nvarying vec2 vTexCoord;\nvarying vec2 vLightmapCoord;\n\nvoid main(void) {\n  vec4 diffuseColor = texture2D(diffuse, vTexCoord);\n  vec4 lightColor = texture2D(lightmap, vLightmapCoord);\n\n  gl_FragColor = vec4(diffuseColor.rgb * lightColor.rgb, diffuseColor.a * opacity);\n}",attributeNames:["position","texCoord","texCoord2"],uniformNames:["modelMatrix","viewMatrix","projectionMatrix","diffuse","lightmap","opacity"]});return t?new r(t):(console.error("Failed to create MainShader program"),null)}constructor(e){this.program=e.handle,this.aPosition=e.attributes.position,this.aTexCoord=e.attributes.texCoord,this.aTexCoord2=e.attributes.texCoord2,this.uModelMx=e.uniforms.modelMatrix,this.uViewMx=e.uniforms.viewMatrix,this.uProjectionMx=e.uniforms.projectionMatrix,this.uDiffuse=e.uniforms.diffuse,this.uLightmap=e.uniforms.lightmap,this.uOpacity=e.uniforms.opacity}useProgram(e){e.useProgram(this.program)}setModelMatrix(e,t){e.uniformMatrix4fv(this.uModelMx,!1,t)}setViewMatrix(e,t){e.uniformMatrix4fv(this.uViewMx,!1,t)}setProjectionMatrix(e,t){e.uniformMatrix4fv(this.uProjectionMx,!1,t)}setDiffuse(e,t){e.uniform1i(this.uDiffuse,t)}setLightmap(e,t){e.uniform1i(this.uLightmap,t)}setOpacity(e,t){e.uniform1f(this.uOpacity,t)}enableVertexAttribs(e){e.enableVertexAttribArray(this.aPosition),e.enableVertexAttribArray(this.aTexCoord),e.enableVertexAttribArray(this.aTexCoord2)}setVertexAttribPointers(e){e.vertexAttribPointer(this.aPosition,3,e.FLOAT,!1,28,0),e.vertexAttribPointer(this.aTexCoord,2,e.FLOAT,!1,28,12),e.vertexAttribPointer(this.aTexCoord2,2,e.FLOAT,!1,28,20)}}t.MainShader=r},9866:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Keyboard=void 0;class r{constructor(){this.keys=new Uint8Array(256);for(let e=0;e<256;++e)this.keys[0]=0}}t.Keyboard=r,function(e){let t;!function(e){e[e.A="A".charCodeAt(0)]="A",e[e.B="B".charCodeAt(0)]="B",e[e.C="C".charCodeAt(0)]="C",e[e.D="D".charCodeAt(0)]="D",e[e.E="E".charCodeAt(0)]="E",e[e.F="F".charCodeAt(0)]="F",e[e.G="G".charCodeAt(0)]="G",e[e.H="H".charCodeAt(0)]="H",e[e.I="I".charCodeAt(0)]="I",e[e.J="J".charCodeAt(0)]="J",e[e.K="K".charCodeAt(0)]="K",e[e.L="L".charCodeAt(0)]="L",e[e.M="M".charCodeAt(0)]="M",e[e.N="N".charCodeAt(0)]="N",e[e.O="O".charCodeAt(0)]="O",e[e.P="P".charCodeAt(0)]="P",e[e.Q="Q".charCodeAt(0)]="Q",e[e.R="R".charCodeAt(0)]="R",e[e.S="S".charCodeAt(0)]="S",e[e.T="T".charCodeAt(0)]="T",e[e.U="U".charCodeAt(0)]="U",e[e.V="V".charCodeAt(0)]="V",e[e.W="W".charCodeAt(0)]="W",e[e.X="X".charCodeAt(0)]="X",e[e.Y="Y".charCodeAt(0)]="Y",e[e.Z="Z".charCodeAt(0)]="Z",e[e.CTRL=17]="CTRL",e[e.ALT=18]="ALT",e[e.SPACE=32]="SPACE"}(t=e.KEYS||(e.KEYS={}))}(r||(t.Keyboard=r={}))},7172:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Mouse=void 0;const n=r(1961);t.Mouse=class{constructor(){this.click=!1,this.leftClick=!1,this.rightClick=!1,this.position=n.vec2.create(),this.delta=n.vec2.create()}}},1776:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Touch=void 0;const n=r(1961);t.Touch=class{constructor(){this.pressed=!1,this.position=n.vec2.create(),this.delta=n.vec2.create()}}},4605:function(e,t,r){"use strict";var n=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))((function(a,s){function i(e){try{l(n.next(e))}catch(e){s(e)}}function o(e){try{l(n.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?a(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(i,o)}l((n=n.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.Loader=void 0;const a=r(9431),s=r(2847),i=r(2130),o=r(9955),l=r(595),u=r(9163),c=r(8506),h=r(6566),d=r(9157);var f;!function(e){e[e.Loading=1]="Loading",e[e.Skipped=2]="Skipped",e[e.Error=3]="Error",e[e.Done=4]="Done"}(f||(f={}));class p{constructor(e){this.name=e,this.progress=0,this.status=f.Loading,this.data=null}isLoading(){return this.status===f.Loading}skip(){this.status=f.Skipped}isSkipped(){return this.status===f.Skipped}error(){this.status=f.Error}isError(){return this.status===f.Error}done(e){this.status=f.Done,this.data=e}isDone(){return this.status===f.Done}}class m extends p{constructor(){super(...arguments),this.type="replay"}}class g extends p{constructor(){super(...arguments),this.type="bsp"}}class y extends p{constructor(){super(...arguments),this.type="sky"}}class v extends p{constructor(){super(...arguments),this.type="wad"}}class b extends p{constructor(){super(...arguments),this.type="sound"}}class M extends p{constructor(){super(...arguments),this.type="sprite"}}t.Loader=class{constructor(e){this.sprites={},this.config=e,this.replay=void 0,this.map=void 0,this.skies=[],this.wads=[],this.sounds=[],this.events=(0,a.createNanoEvents)(),this.events.on("error",(e=>{console.error(e)}))}clear(){this.replay=void 0,this.map=void 0,this.skies.length=0,this.wads.length=0,this.sounds.length=0,this.sprites={}}checkStatus(){if(this.replay&&!this.replay.isDone())return;if(this.map&&!this.map.isDone())return;for(let e=0;e<this.skies.length;++e)if(this.skies[e].isLoading())return;for(let e=0;e<this.wads.length;++e)if(this.wads[e].isLoading())return;for(let e=0;e<this.sounds.length;++e)if(this.sounds[e].isLoading())return;const e=Object.entries(this.sprites);for(let t=0;t<e.length;++t)if(e[t][1].isLoading())return;this.events.emit("loadall",this)}load(e){const t=(0,i.extname)(e);".dem"===t?this.loadReplay(e):".bsp"===t?this.loadMap(e):this.events.emit("error","Invalid file extension",e)}loadReplay(e){return n(this,void 0,void 0,(function*(){this.replay=new m(e),this.events.emit("loadstart",this.replay);const t=this.config.getReplaysPath(),r=yield(0,h.xhr)(`${t}/${e}`,{method:"GET",isBinary:!0,progressCallback:(e,t)=>{this.replay&&(this.replay.progress=t),this.events.emit("progress",this.replay)}}).catch((e=>{this.replay&&this.replay.error(),this.events.emit("error",e,this.replay)}));if(this.replay.isError())return;const n=yield u.Replay.parseIntoChunks(r);this.replay.done(n),this.loadMap(n.maps[0].name+".bsp");n.maps[0].resources.sounds.forEach((e=>{e.used&&this.loadSound(e.name,e.index)})),this.events.emit("load",this.replay),this.checkStatus()}))}loadMap(e){return n(this,void 0,void 0,(function*(){this.map=new g(e),this.events.emit("loadstart",this.map);const t=this.config.getMapsPath(),r=yield(0,h.xhr)(`${t}/${e}`,{method:"GET",isBinary:!0,progressCallback:(e,t)=>{this.map&&(this.map.progress=t),this.events.emit("progress",this.map)}}).catch((e=>{this.map&&this.map.error(),this.events.emit("error",e,this.map)}));if(this.map.isError())return;const n=yield d.BspParser.parse(e,r);this.map.done(n),n.entities.map((e=>{if("string"==typeof e.model&&e.model.indexOf(".spr")>-1)return e.model})).filter(((e,t,r)=>e&&r.indexOf(e)===t)).forEach((e=>e&&this.loadSprite(e)));const a=n.entities[0].skyname;if(a){["bk","dn","ft","lf","rt","up"].map((e=>`${a}${e}`)).forEach((e=>this.loadSky(e)))}if(n.textures.find((e=>e.isExternal))){const e=n.entities[0].wad.map((e=>this.loadWad(e)));yield Promise.all(e)}this.events.emit("load",this.map),this.checkStatus()}))}loadSprite(e){return n(this,void 0,void 0,(function*(){const t=new M(e);this.sprites[e]=t,this.events.emit("loadstart",t);const r=yield(0,h.xhr)(`${this.config.getBasePath()}/${e}`,{method:"GET",isBinary:!0,progressCallback:(e,r)=>{t.progress=r,this.events.emit("progress",t)}}).catch((e=>{t.error(),this.events.emit("error",e,t),this.checkStatus()}));if(t.isError())return;const n=c.Sprite.parse(r);t.done(n),this.events.emit("load",t),this.checkStatus()}))}loadSky(e){return n(this,void 0,void 0,(function*(){const t=new y(e);this.skies.push(t),this.events.emit("loadstart",t);const r=this.config.getSkiesPath(),n=yield(0,h.xhr)(`${r}/${e}.tga`,{method:"GET",isBinary:!0,progressCallback:(e,r)=>{t.progress=r,this.events.emit("progress",t)}}).catch((e=>{t.error(),this.events.emit("error",e,t),this.checkStatus()}));if(t.isError())return;const a=o.Tga.parse(n,e);t.done(a),this.events.emit("load",t),this.checkStatus()}))}loadWad(e){return n(this,void 0,void 0,(function*(){const t=new v(e);this.wads.push(t),this.events.emit("loadstart",t);const r=this.config.getWadsPath(),n=yield(0,h.xhr)(`${r}/${e}`,{method:"GET",isBinary:!0,progressCallback:(e,r)=>{t.progress=r,this.events.emit("progress",t)}}).catch((e=>{t.error(),this.events.emit("error",e,t),this.checkStatus()}));if(t.isError())return;const a=yield l.Wad.parse(n);if(t.done(a),!this.map||!this.map.data)return;const s=this.map.data;a.entries.forEach((e=>{"texture"===e.type&&s.textures.forEach((t=>{var r,n;r=e.name,n=t.name,r.toLowerCase()===n.toLowerCase()&&(t.width=e.width,t.height=e.height,t.data=e.data)}))})),this.events.emit("load",t),this.checkStatus()}))}loadSound(e,t){return n(this,void 0,void 0,(function*(){const r=new b(e);this.sounds.push(r),this.events.emit("loadstart",r);const n=this.config.getSoundsPath(),a=yield(0,h.xhr)(`${n}/${e}`,{method:"GET",isBinary:!0,progressCallback:(e,t)=>{r.progress=t,this.events.emit("progress",r)}}).catch((e=>{r.error(),this.events.emit("error",e,r),this.checkStatus()}));if(r.isError())return;const i=yield s.Sound.create(a).catch((e=>{r.error(),this.events.emit("error",e,r),this.checkStatus()}));i&&!r.isError()&&(i.index=t,i.name=e,r.done(i),this.events.emit("load",r),this.checkStatus())}))}}},4586:(e,t)=>{"use strict";var r,n,a,s,i,o,l,u,c,h,d,f,p,m,g;Object.defineProperty(t,"__esModule",{value:!0}),t.BspEntityParser=t.RenderMode=t.RenderEffect=t.ZHLTLightFlags=t.EnvBeamSpawnFlags=t.CyclerWeaponTriggerCondition=t.ButtonTargetSpawnFlags=t.AmbientGenericSpawnFlags=t.AmbientGenericPreset=t.AiScriptedSequenceSpawnflags=t.AiScriptedSequenceFinishSchedule=t.AiScriptedSequenceMoveTo=t.WorldSpawnDefaultTeam=t.WorldSpawnNewUnit=t.WorldSpawnGameTitle=t.WorldSpawnStartDark=void 0,function(e){e[e.No=0]="No",e[e.Yes=1]="Yes"}(r||(t.WorldSpawnStartDark=r={})),function(e){e[e.No=0]="No",e[e.Yes=1]="Yes"}(n||(t.WorldSpawnGameTitle=n={})),function(e){e[e.No=0]="No",e[e.Yes=1]="Yes"}(a||(t.WorldSpawnNewUnit=a={})),function(e){e[e.FewestPlayers=0]="FewestPlayers",e[e.FirstTeam=1]="FirstTeam"}(s||(t.WorldSpawnDefaultTeam=s={})),function(e){e[e.No=0]="No",e[e.Walk=1]="Walk",e[e.Run=2]="Run",e[e.Instantaneous=4]="Instantaneous",e[e.No_TurnToFace=5]="No_TurnToFace"}(i||(t.AiScriptedSequenceMoveTo=i={})),function(e){e[e.DefaultAI=0]="DefaultAI",e[e.Ambush=1]="Ambush"}(o||(t.AiScriptedSequenceFinishSchedule=o={})),function(e){e[e.Repeatable=4]="Repeatable",e[e.LeaveCorpse=8]="LeaveCorpse"}(l||(t.AiScriptedSequenceSpawnflags=l={})),function(e){e[e.None=0]="None",e[e.HugeMachine=1]="HugeMachine",e[e.BigMachine=2]="BigMachine",e[e.Machine=3]="Machine",e[e.SlowFadeIn=4]="SlowFadeIn",e[e.FadeIn=5]="FadeIn",e[e.QuickFadeIn=6]="QuickFadeIn",e[e.SlowPulse=7]="SlowPulse",e[e.Pulse=8]="Pulse",e[e.QuickPulse=9]="QuickPulse",e[e.SlowOscillator=10]="SlowOscillator",e[e.Oscillator=11]="Oscillator",e[e.QuickOscillator=12]="QuickOscillator",e[e.GrungePitch=13]="GrungePitch",e[e.VeryLowPitch=14]="VeryLowPitch",e[e.LowPitch=15]="LowPitch",e[e.HighPitch=16]="HighPitch",e[e.VeryHighPitch=17]="VeryHighPitch",e[e.ScreamingPitch=18]="ScreamingPitch",e[e.OscillateSpinUpDown=19]="OscillateSpinUpDown",e[e.PulseSpinUpDown=20]="PulseSpinUpDown",e[e.RandomPitch=21]="RandomPitch",e[e.RandomPitchFast=22]="RandomPitchFast",e[e.IncrementalSpinup=23]="IncrementalSpinup",e[e.Alien=24]="Alien",e[e.Bizzare=25]="Bizzare",e[e.PlanetX=26]="PlanetX",e[e.Haunted=27]="Haunted"}(u||(t.AmbientGenericPreset=u={})),function(e){e[e.PlayEverywhere=1]="PlayEverywhere",e[e.SmallRadius=2]="SmallRadius",e[e.MediumRadius=4]="MediumRadius",e[e.LargeRadius=8]="LargeRadius",e[e.StartSilent=16]="StartSilent",e[e.NotToggled=32]="NotToggled"}(c||(t.AmbientGenericSpawnFlags=c={})),function(e){e[e.UseActivates=1]="UseActivates",e[e.StartOn=2]="StartOn"}(h||(t.ButtonTargetSpawnFlags=h={})),function(e){e[e.NoTrigger=0]="NoTrigger",e[e.SeePlayerMadAtPlayer=1]="SeePlayerMadAtPlayer",e[e.TakeDamage=2]="TakeDamage",e[e.HalfHealthRemaining=3]="HalfHealthRemaining",e[e.Death=4]="Death",e[e.HearWorld=7]="HearWorld",e[e.HearPlayer=8]="HearPlayer",e[e.HearCombat=9]="HearCombat",e[e.SeePlayerUnconditional=10]="SeePlayerUnconditional",e[e.SeePlayerNotInCombat=11]="SeePlayerNotInCombat"}(d||(t.CyclerWeaponTriggerCondition=d={})),function(e){e[e.StartOn=1]="StartOn",e[e.Toggle=2]="Toggle",e[e.RandomStrike=4]="RandomStrike",e[e.Ring=8]="Ring",e[e.StartSparks=16]="StartSparks",e[e.EndSparks=32]="EndSparks",e[e.DecalEnd=64]="DecalEnd",e[e.FadeStart=128]="FadeStart",e[e.FadeEnd=256]="FadeEnd"}(f||(t.EnvBeamSpawnFlags=f={})),function(e){e[e.Normal=0]="Normal",e[e.EmbeddedFix=1]="EmbeddedFix",e[e.OpaqueBlockLight=2]="OpaqueBlockLight",e[e.OpaqueEmbeddedFix=3]="OpaqueEmbeddedFix",e[e.OpaqueConcaveFix=6]="OpaqueConcaveFix"}(p||(t.ZHLTLightFlags=p={})),function(e){e[e.Normal=0]="Normal",e[e.SlowPulse=1]="SlowPulse",e[e.FastPulse=2]="FastPulse",e[e.SlowWidePulse=3]="SlowWidePulse",e[e.FastWidePulse=4]="FastWidePulse",e[e.SlowFadeAway=5]="SlowFadeAway",e[e.FastFadeAway=6]="FastFadeAway",e[e.SlowBecomeSolid=7]="SlowBecomeSolid",e[e.FastBecomeSolid=8]="FastBecomeSolid",e[e.SlowStrobe=9]="SlowStrobe",e[e.FastStrobe=10]="FastStrobe",e[e.FasterStrobe=11]="FasterStrobe",e[e.SlowFlicker=12]="SlowFlicker",e[e.FastFlicker=13]="FastFlicker",e[e.ConstantGlow=14]="ConstantGlow",e[e.DistortModels=15]="DistortModels",e[e.HologramDistort=16]="HologramDistort"}(m||(t.RenderEffect=m={})),function(e){e[e.Normal=0]="Normal",e[e.Color=1]="Color",e[e.Texture=2]="Texture",e[e.Glow=3]="Glow",e[e.Solid=4]="Solid",e[e.Additive=5]="Additive"}(g||(t.RenderMode=g={}));const y=e=>e.split(" ").map((e=>parseFloat(e))),v={worldspawn:e=>({classname:"worldspawn",wad:e.wad.split(";").filter((e=>e.length)).map((e=>e.replace(/\\/g,"/"))),mapversion:parseInt(e.mapversion),skyname:e.skyname,maxRange:parseFloat(e.MaxRange)||8192,message:e.message||"",sounds:parseInt(e.sounds)||0,light:parseInt(e.light)||0,waveHeight:parseFloat(e.WaveHeight)||0,startDark:parseInt(e.startdark)||0,newUnit:parseInt(e.newunit)||0,defaultTeam:parseInt(e.defaultteam)||0,gameTitle:parseInt(e.gametitle)||0}),aiscripted_sequence:e=>({classname:"aiscripted_sequence",spawnflags:parseInt(e.spawnflags),m_iszEntity:e.m_iszEntity,m_iszPlay:e.m_iszPlay||"",m_flRadius:parseInt(e.m_flRadius)||512,m_flRepeat:parseInt(e.m_flRepeat)||0,m_fMoveTo:parseInt(e.m_fMoveTo)||0,m_iFinishSchedule:parseInt(e.m_iFinishSchedule)||0}),ambient_generic:e=>({classname:"ambient_generic",origin:y(e.origin),targetName:e.targetname,message:e.message,health:parseInt(e.health)||10,preset:parseInt(e.preset)||0,startVolume:parseInt(e.volstart)||0,fadeIn:parseInt(e.fadein),fadeOut:parseInt(e.fadeout),pitch:parseInt(e.pitch),pitchStart:parseInt(e.pitchstart),spinUp:parseInt(e.spinup),spinDown:parseInt(e.spindown),lfoType:parseInt(e.lfotype),lfoRate:parseInt(e.lforate),lfoModPitch:parseInt(e.lfomodpitch),lfoModVolume:parseInt(e.lfomodvolume),cSpinUp:parseInt(e.cspinup),spawnFlags:parseInt(e.spawnflags)}),ammo_357:e=>({classname:"ammo_357",origin:y(e.origin),angles:y(e.angles),target:e.target,targetName:e.targetname||"",delay:parseInt(e.delay)||0,killTarget:e.killtarget||"",spawnFlags:e.spawnflags||0}),ammo_9mmAR:e=>({classname:"ammo_9mmAR",origin:y(e.origin),angles:y(e.angles),target:e.target,targetName:e.targetname||"",delay:parseInt(e.delay)||0,killTarget:e.killtarget||"",spawnFlags:e.spawnflags||0}),ammo_9mmbox:e=>({classname:"ammo_9mmbox",origin:y(e.origin),angles:y(e.angles),target:e.target,targetName:e.targetname||"",delay:parseInt(e.delay)||0,killTarget:e.killtarget||"",spawnFlags:e.spawnflags||0}),ammo_9mmclip:e=>({classname:"ammo_9mmclip",origin:y(e.origin),angles:y(e.angles),target:e.target,targetName:e.targetname||"",delay:parseInt(e.delay)||0,killTarget:e.killtarget||"",spawnFlags:e.spawnflags||0}),ammo_ARgrenades:e=>({classname:"ammo_ARgrenades",origin:y(e.origin),angles:y(e.angles),target:e.target,targetName:e.targetname||"",delay:parseInt(e.delay)||0,killTarget:e.killtarget||"",spawnFlags:e.spawnflags||0}),ammo_buckshot:e=>({classname:"ammo_buckshot",origin:y(e.origin),angles:y(e.angles),target:e.target,targetName:e.targetname||"",delay:parseInt(e.delay)||0,killTarget:e.killtarget||"",spawnFlags:e.spawnflags||0}),ammo_crossbow:e=>({classname:"ammo_crossbow",origin:y(e.origin),angles:y(e.angles),target:e.target,targetName:e.targetname||"",delay:parseInt(e.delay)||0,killTarget:e.killtarget||"",spawnFlags:e.spawnflags||0}),ammo_gaussclip:e=>({classname:"ammo_gaussclip",origin:y(e.origin),angles:y(e.angles),target:e.target,targetName:e.targetname||"",delay:parseInt(e.delay)||0,killTarget:e.killtarget||"",spawnFlags:e.spawnflags||0}),ammo_rpgclip:e=>({classname:"ammo_rpgclip",origin:y(e.origin),angles:y(e.angles),target:e.target,targetName:e.targetname||"",delay:parseInt(e.delay)||0,killTarget:e.killtarget||"",spawnFlags:e.spawnflags||0}),button_target:e=>({classname:"button_target",target:e.target,master:e.master,renderEffect:parseInt(e.renderfx)||0,renderMode:parseInt(e.rendermode)||0,renderAmmount:parseInt(e.renderamt)||255,renderColor:y(e.rendercolor||"0 0 0"),zhltLightFlags:parseInt(e.zhlt_lightflags)||0,lightOrigin:e.light_origin,spawnFlags:parseInt(e.spawnflags)||1}),cycler:e=>({classname:"cycler",origin:y(e.origin),angles:y(e.angles),targetName:e.targetname,model:e.model,sequence:e.sequence||"",renderEffect:parseInt(e.renderfx)||0,renderMode:parseInt(e.rendermode)||0,renderAmmount:parseInt(e.renderamt)||255,renderColor:y(e.rendercolor||"0 0 0")}),cycler_sprite:e=>({classname:"cycler_sprite",origin:y(e.origin),angles:y(e.angles),targetName:e.targetname,model:e.model,framerate:parseInt(e.framerate||"10"),renderEffect:parseInt(e.renderfx)||0,renderMode:parseInt(e.rendermode)||0,renderAmmount:parseInt(e.renderamt)||255,renderColor:y(e.rendercolor||"0 0 0")}),cyclear_weapon:e=>({classname:"cycler_weapon",origin:y(e.origin),angles:y(e.angles),target:e.target,targetName:e.targetname,triggerTarget:e.TriggerTarget||"",triggerCondition:parseInt(e.TriggerCondition)||0,model:e.model,sequence:e.sequence,renderEffect:parseInt(e.renderfx)||0,renderMode:parseInt(e.rendermode)||0,renderAmmount:parseInt(e.renderamt)||255,renderColor:y(e.rendercolor||"0 0 0")}),cyclear_wreckage:e=>({classname:"cycler_wreckage",origin:y(e.origin),angles:y(e.angles),targetName:e.targetname,model:e.model,framerate:parseInt(e.framerate)||10,scale:parseFloat(e.scale)||1,renderEffect:parseInt(e.renderfx)||0,renderMode:parseInt(e.rendermode)||0,renderAmmount:parseInt(e.renderamt)||255,renderColor:y(e.rendercolor||"0 0 0")}),env_beam:e=>({classname:"env_beam",renderEffect:parseInt(e.renderfx)||0,renderMode:parseInt(e.rendermode)||0,renderAmmount:parseInt(e.renderamt)||255,renderColor:y(e.rendercolor||"0 0 0"),radius:parseFloat(e.Radius)||256,life:parseInt(e.life)||1,boltWidth:parseInt(e.BoltWidth)||20,noiseAmplitude:parseInt(e.NoiseAmplitude)||0,texture:e.texture||"sprites/laserbeam.spr",textureScroll:parseInt(e.TextureScroll)||35,frameRate:parseInt(e.framerate)||0,frameStart:parseInt(e.framestart)||0,strikeTime:parseInt(e.StrikeTime)||1,damage:parseInt(e.damage)||1,spawnFlags:parseInt(e.spawnflags)})};t.BspEntityParser=class{static parse(e){const t=[];for(let r=0;r<e.length;++r){const n=e[r];n.classname||t.push({classname:"!",data:n}),v[n.classname]?t.push(v[n.classname](n)):t.push({classname:"?",originalClassname:n.classname,data:n})}return t}}},4055:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BspLightmapParser=void 0;class r{static init(e){return new r(e)}constructor(e){this.block=new Uint16Array(r.TEXTURE_SIZE),this.lightmap=e,this.texture=new Uint8Array(r.TEXTURE_SIZE*r.TEXTURE_SIZE*4),this.texture[this.texture.length-4]=255,this.texture[this.texture.length-3]=255,this.texture[this.texture.length-2]=255,this.texture[this.texture.length-1]=255}getTexture(){return this.texture}processFace(e,t,n){const a=this.getDimensions(e),s=this.readLightmap(n,a.width,a.height);if(s)for(let n=0;n<e.length/7;++n){let i=e[7*n]*t.s[0]+e[7*n+1]*t.s[1]+e[7*n+2]*t.s[2]+t.sShift-a.minU;i+=16*s.x+8,i/=16*r.TEXTURE_SIZE;let o=e[7*n]*t.t[0]+e[7*n+1]*t.t[1]+e[7*n+2]*t.t[2]+t.tShift-a.minV;o+=16*s.y+8,o/=16*r.TEXTURE_SIZE,e[7*n+5]=i,e[7*n+6]=o}}getDimensions(e){let t=Math.floor(e[3]),r=Math.floor(e[4]),n=Math.floor(e[3]),a=Math.floor(e[4]);for(let s=1;s<e.length/7;++s)Math.floor(e[7*s+3])<t&&(t=Math.floor(e[7*s+3])),Math.floor(e[7*s+4])<r&&(r=Math.floor(e[7*s+4])),Math.floor(e[7*s+3])>n&&(n=Math.floor(e[7*s+3])),Math.floor(e[7*s+4])>a&&(a=Math.floor(e[7*s+4]));return{width:Math.ceil(n/16)-Math.floor(t/16)+1,height:Math.ceil(a/16)-Math.floor(r/16)+1,minU:Math.floor(t),minV:Math.floor(r)}}readLightmap(e,t,n){if(n<=0||t<=0)return null;const a=this.findFreeSpace(t,n);if(a){const s=[a.x,a.y],i=[t,n],o=[r.TEXTURE_SIZE,r.TEXTURE_SIZE],l=t*n;for(let t=0;t<l;++t){const r=s[1]*o[0]+s[0]+o[0]*Math.floor(t/i[0])+t%i[0];this.texture[4*r]=Math.min(255,2*this.lightmap[e+3*t]),this.texture[4*r+1]=Math.min(255,2*this.lightmap[e+3*t+1]),this.texture[4*r+2]=Math.min(255,2*this.lightmap[e+3*t+2]),this.texture[4*r+3]=255}}return a}findFreeSpace(e,t){let n=0,a=0,s=r.TEXTURE_SIZE;for(let t=0;t<this.block.length-e;++t){let r,i=0;for(r=0;r<e&&!(this.block[t+r]>=s);++r)this.block[t+r]>i&&(i=this.block[t+r]);r===e&&(n=t,a=s=i)}if(s+t>r.TEXTURE_SIZE)return null;for(let r=0;r<e;++r)this.block[n+r]=s+t;return{x:n,y:a}}}t.BspLightmapParser=r,r.TEXTURE_SIZE=1024},9157:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BspParser=t.BspLumpIndex=void 0,t.parseModels=u;const n=r(2130),a=r(6947),s=r(1269),i=r(8529),o=r(4055),l=r(3791);function u(e,t,r,n,a,s,i,o){const l=[];for(let u=0;u<e.length;++u){const c=e[u],h=[],d=new Float32Array(3),f=new Float32Array(3),p=new Float32Array(3),m=new Float32Array(2),g=new Float32Array(2),y=new Float32Array(2),v=new Float32Array(2),b=new Float32Array(2),M=new Float32Array(2);let _=0===u?[0,0,0]:[0,0,0].map(((e,t)=>(c.maxs[t]-c.mins[t])/2+c.mins[t]));for(let e=c.firstFace;e<c.firstFace+c.faceCount;++e){const l={buffer:new Float32Array(21*(t[e].edgeCount-2)),textureIndex:-1},u=s[t[e].textureInfo],c=i[u.textureIndex],x=n.slice(t[e].firstEdge,t[e].firstEdge+t[e].edgeCount),T=r[Math.abs(x[0])][x[0]>0?0:1];d[0]=a[T][0],d[1]=a[T][1],d[2]=a[T][2],m[0]=d[0]*u.s[0]+d[1]*u.s[1]+d[2]*u.s[2]+u.sShift,m[1]=d[0]*u.t[0]+d[1]*u.t[1]+d[2]*u.t[2]+u.tShift,v[0]=0,v[1]=0;const S=r[Math.abs(x[1])][x[1]>0?0:1];f[0]=a[S][0],f[1]=a[S][1],f[2]=a[S][2],g[0]=f[0]*u.s[0]+f[1]*u.s[1]+f[2]*u.s[2]+u.sShift,g[1]=f[0]*u.t[0]+f[1]*u.t[1]+f[2]*u.t[2]+u.tShift,b[0]=0,b[1]=.999;let E=0;for(let n=2;n<t[e].edgeCount;++n){const e=r[Math.abs(x[n])][x[n]>0?0:1];p[0]=a[e][0],p[1]=a[e][1],p[2]=a[e][2],y[0]=p[0]*u.s[0]+p[1]*u.s[1]+p[2]*u.s[2]+u.sShift,y[1]=p[0]*u.t[0]+p[1]*u.t[1]+p[2]*u.t[2]+u.tShift,M[0]=.999,M[1]=.999,l.buffer[E++]=d[0],l.buffer[E++]=d[1],l.buffer[E++]=d[2],l.buffer[E++]=m[0],l.buffer[E++]=m[1],l.buffer[E++]=v[0],l.buffer[E++]=v[1],l.buffer[E++]=f[0],l.buffer[E++]=f[1],l.buffer[E++]=f[2],l.buffer[E++]=g[0],l.buffer[E++]=g[1],l.buffer[E++]=b[0],l.buffer[E++]=b[1],l.buffer[E++]=p[0],l.buffer[E++]=p[1],l.buffer[E++]=p[2],l.buffer[E++]=y[0],l.buffer[E++]=y[1],l.buffer[E++]=M[0],l.buffer[E++]=M[1],f[0]=p[0],f[1]=p[1],f[2]=p[2],g[0]=y[0],g[1]=y[1],b[0]=M[0],b[1]=M[1]}0!==u.flags&&-65536!==u.flags||o.processFace(l.buffer,u,t[e].lightmapOffset),l.textureIndex=u.textureIndex;for(let e=0;e<l.buffer.length/7;++e)l.buffer[7*e]-=_[0],l.buffer[7*e+1]-=_[1],l.buffer[7*e+2]-=_[2],l.buffer[7*e+3]/=c.width,l.buffer[7*e+4]/=c.height;h.push(l)}l.push({origin:_,faces:h})}return l}var c;!function(e){e[e.Entities=0]="Entities",e[e.Planes=1]="Planes",e[e.Textures=2]="Textures",e[e.Vertices=3]="Vertices",e[e.Visibility=4]="Visibility",e[e.Nodes=5]="Nodes",e[e.TexInfo=6]="TexInfo",e[e.Faces=7]="Faces",e[e.Lighting=8]="Lighting",e[e.ClipNodes=9]="ClipNodes",e[e.Leaves=10]="Leaves",e[e.MarkSurfaces=11]="MarkSurfaces",e[e.Edges=12]="Edges",e[e.SurfEdges=13]="SurfEdges",e[e.Models=14]="Models"}(c||(t.BspLumpIndex=c={}));t.BspParser=class{static parse(e,t){const r=new i.Reader(t);if(30!==r.ui())throw new Error("Invalid map version");const n=[];for(let e=0;e<15;++e)n.push({offset:r.ui(),length:r.ui()});const a=this.loadEntities(r,n[c.Entities].offset,n[c.Entities].length),l=this.loadTextures(r,n[c.Textures].offset),h=this.loadModels(r,n[c.Models].offset,n[c.Models].length),d=this.loadFaces(r,n[c.Faces].offset,n[c.Faces].length),f=this.loadEdges(r,n[c.Edges].offset,n[c.Edges].length),p=this.loadSurfEdges(r,n[c.SurfEdges].offset,n[c.SurfEdges].length),m=this.loadVertices(r,n[c.Vertices].offset,n[c.Vertices].length),g=this.loadTexInfo(r,n[c.TexInfo].offset,n[c.TexInfo].length),y=this.loadLightmap(r,n[c.Lighting].offset,n[c.Lighting].length),v=o.BspLightmapParser.init(y),b=u(h,d,f,p,m,g,l,v);return new s.Bsp(e,a,l,b,{width:o.BspLightmapParser.TEXTURE_SIZE,height:o.BspLightmapParser.TEXTURE_SIZE,data:v.getTexture()})}static loadFaces(e,t,r){e.seek(t);const n=[];for(let t=0;t<r/20;++t)n.push({plane:e.us(),planeSide:e.us(),firstEdge:e.ui(),edgeCount:e.us(),textureInfo:e.us(),styles:[e.ub(),e.ub(),e.ub(),e.ub()],lightmapOffset:e.ui()});return n}static loadModels(e,t,r){e.seek(t);const n=[];for(let t=0;t<r/64;++t)n.push({mins:[e.f(),e.f(),e.f()],maxs:[e.f(),e.f(),e.f()],origin:[e.f(),e.f(),e.f()],headNodes:[e.i(),e.i(),e.i(),e.i()],visLeaves:e.i(),firstFace:e.i(),faceCount:e.i()});return n}static loadEdges(e,t,r){e.seek(t);const n=[];for(let t=0;t<r/4;++t)n.push([e.us(),e.us()]);return n}static loadSurfEdges(e,t,r){e.seek(t);const n=[];for(let t=0;t<r/4;++t)n.push(e.i());return n}static loadVertices(e,t,r){e.seek(t);const n=[];for(let t=0;t<r/12;++t)n.push([e.f(),e.f(),e.f()]);return n}static loadTexInfo(e,t,r){e.seek(t);const n=[];for(let t=0;t<r/40;++t)n.push({s:[e.f(),e.f(),e.f()],sShift:e.f(),t:[e.f(),e.f(),e.f()],tShift:e.f(),textureIndex:e.i(),flags:e.i()});return n}static loadLightmap(e,t,r){return e.seek(t),e.arrx(r,i.ReaderDataType.UByte)}static loadTextureData(e){const t=e.nstr(16),r=e.ui(),n=e.ui(),a=!e.ui();if(a){const e=new Uint8Array(4);return e[0]=e[1]=e[2]=e[3]=255,{name:t,width:r,height:n,data:e,isExternal:a}}{e.skip(12);const s=r*n,o=e.arrx(s,i.ReaderDataType.UByte);e.skip(s/64*21),e.skip(2);const u=e.arrx(768,i.ReaderDataType.UByte);return{name:t,width:r,height:n,data:"{"===t[0]?(0,l.paletteWithLastTransToRGBA)(o,u):(0,l.paletteToRGBA)(o,u),isExternal:a}}}static loadTextures(e,t){e.seek(t);const r=e.ui(),n=[];for(let t=0;t<r;++t)n.push(e.ui());const a=[];for(let s=0;s<r;++s)4294967295===n[s]?a.push({name:"ERROR404",width:1,height:1,data:new Uint8Array([0,255,0,255]),isExternal:!1}):(e.seek(t+n[s]),a.push(this.loadTextureData(e)));return a}static loadEntities(e,t,r){e.seek(t);const s=(0,a.vdf)(e.nstr(r)),i=["origin","angles","_diffuse_light","_light","rendercolor","avelocity"],o=["renderamt","rendermode","scale"],l=s[0];return"worldspawn"===l.classname&&(l.model="*0",l.wad=l.wad||"",l.wad=l.wad.split(";").filter((e=>e.length)).map((e=>e.replace(/\\/g,"/"))).map((e=>(0,n.basename)(e)))),s.forEach((e=>{e.model&&(void 0===e.renderamt&&(e.renderamt=0),void 0===e.rendermode&&(e.rendermode=0),void 0===e.renderfx&&(e.renderfx=0),void 0===e.rendercolor&&(e.rendercolor="0 0 0")),i.forEach((t=>{e[t]&&(e[t]=e[t].split(" ").map((e=>Number.parseFloat(e))))})),o.forEach((t=>{e[t]&&(e[t]=Number.parseFloat(e[t]))}))})),s}}},8506:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Sprite=t.SpriteSyncType=t.SpriteAlphaType=t.SpriteType=void 0;const n=r(8529),a=r(3791);var s,i,o;!function(e){e[e.VP_PARALLEL_UPRIGHT=0]="VP_PARALLEL_UPRIGHT",e[e.FACING_UPRIGHT=1]="FACING_UPRIGHT",e[e.VP_PARALLEL=2]="VP_PARALLEL",e[e.ORIENTED=3]="ORIENTED",e[e.VP_PARALLEL_ORIENTED=4]="VP_PARALLEL_ORIENTED"}(s||(t.SpriteType=s={})),function(e){e[e.SPR_NORMAL=0]="SPR_NORMAL",e[e.SPR_ADDITIVE=1]="SPR_ADDITIVE",e[e.SPR_INDEXALPHA=2]="SPR_INDEXALPHA",e[e.SPR_ALPHTEST=3]="SPR_ALPHTEST"}(i||(t.SpriteAlphaType=i={})),function(e){e[e.SYNCHRONIZED=0]="SYNCHRONIZED",e[e.RANDOM=1]="RANDOM"}(o||(t.SpriteSyncType=o={}));class l{constructor(e,t){this.header=e,this.frames=t}static parse(e){const t=new n.Reader(e);if("IDSP"!==t.nstr(4))throw new Error("Invalid sprite file format");const r={version:t.i(),type:t.i(),alphaType:t.i(),radius:t.f(),width:t.i(),height:t.i(),frameCount:t.i(),beamLength:t.f(),syncType:t.i()},s=t.s(),o=t.arrx(3*s,n.ReaderDataType.UByte),u=[];for(let e=0;e<r.frameCount;++e){const e={group:t.i(),position:[t.i(),t.i()],width:t.i(),height:t.i(),data:new Uint8Array(r.width*r.height*4)},s=t.arrx(r.width*r.height,n.ReaderDataType.UByte);r.alphaType===i.SPR_ALPHTEST?e.data=(0,a.paletteWithLastTransToRGBA)(s,o):e.data=(0,a.paletteToRGBA)(s,o),u.push(e)}return new l(r,u)}}t.Sprite=l},9955:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Tga=void 0;const n=r(8529);class a{constructor(e,t,r,n){this.name=e,this.width=t,this.height=r,this.data=n}static parse(e,t){let r=new n.Reader(e),s={idLength:r.ub(),colorMapType:r.ub(),imageType:r.ub(),colorMap:{firstEntryIndex:r.us(),length:r.us(),size:r.ub()},image:{xOrigin:r.us(),yOrigin:r.us(),width:r.us(),height:r.us(),depth:r.ub(),descriptor:r.ub()}};if(s.idLength&&r.arrx(s.idLength,n.ReaderDataType.UByte),s.colorMapType)throw new Error("Not implemented");let i,o=s.image.width,l=s.image.height,u=o*l;if(2===s.imageType){let e=u*s.image.depth/8;if(i=r.arrx(e,n.ReaderDataType.UByte),24===s.image.depth){let e=new Uint8Array(4*u);for(let t=0;t<l;++t)for(let r=0;r<o;++r){let n=(l-1-t)*o+r;e[4*n]=i[3*(t*o+r)+2],e[4*n+1]=i[3*(t*o+r)+1],e[4*n+2]=i[3*(t*o+r)],e[4*n+3]=255}i=e}else if(32===s.image.depth){let e=new Uint8Array(4*u);for(let t=0;t<l;++t)for(let r=0;r<o;++r){let n=(l-1-t)*o+r;e[4*n]=i[4*(t*o+r)+2],e[4*n+1]=i[4*(t*o+r)+1],e[4*n+2]=i[4*(t*o+r)],e[4*n+3]=255}i=e}}else if(10===s.imageType&&(i=new Uint8Array(4*u),24===s.image.depth))for(let e=0;e<l;++e)for(let t=0;t<o;){let n=r.ub();if(128&n){n=1+(127&n);let a=r.ub(),s=r.ub(),u=r.ub();for(;t<o&&n;){let r=(l-1-e)*o+t;i[4*r]=u,i[4*r+1]=s,i[4*r+2]=a,i[4*r+3]=255,++t,--n}}else for(n=1+(127&n);t<o&&n;){let a=(l-1-e)*o+t;i[4*a+2]=r.ub(),i[4*a+1]=r.ub(),i[4*a]=r.ub(),i[4*a+3]=255,++t,--n}}return new a(t,s.image.width,s.image.height,i)}}t.Tga=a},3791:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.paletteToRGBA=function(e,t){const r=new Uint8Array(4*e.length),n=e.length;for(let a=0;a<n;++a)r[4*a]=t[3*e[a]],r[4*a+1]=t[3*e[a]+1],r[4*a+2]=t[3*e[a]+2],r[4*a+3]=255;return r},t.paletteWithLastTransToRGBA=function(e,t){const r=new Uint8Array(4*e.length),n=e.length;for(let a=0;a<n;++a)255===e[a]?r[4*a+3]=0:(r[4*a]=t[3*e[a]],r[4*a+1]=t[3*e[a]+1],r[4*a+2]=t[3*e[a]+2],r[4*a+3]=255);return r}},6947:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.vdf=function(e){let t=0,r="",n="";const a=[];for(let s=0;s<e.length;++s){const i=e[s];switch(t){case 0:if(/\s/.test(i))continue;if("{"!==i)return[];a.push({}),t=1;break;case 1:if(/\s/.test(i))continue;if("}"===i)t=0;else{if('"'!==i)return[];r="",t=2}break;case 2:'"'===i?t=3:r+=i;break;case 3:if(/\s/.test(i))continue;'"'===i&&(n="",t=4);break;case 4:'"'===i?(a[a.length-1][r]=n,t=1):n+=i}}return a}},595:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Wad=void 0;const n=r(8529),a=r(3791);function s(e,t){switch(e.seek(t.offset),t.type){case 64:return function(e){const t=e.nstr(16),r=e.ui(),s=e.ui();e.skip(16);const i=r*s,o=e.arrx(i,n.ReaderDataType.UByte);e.skip(i/64*21),e.skip(2);const l=e.arrx(768,n.ReaderDataType.UByte);return{type:"decal",name:t,width:r,height:s,data:"{"===t[0]?(0,a.paletteWithLastTransToRGBA)(o,l):(0,a.paletteToRGBA)(o,l)}}(e);case 66:return((e,t)=>({type:"cache",name:t.name}))(0,t);case 67:return function(e){const t=e.nstr(16),r=e.ui(),s=e.ui();e.skip(16);const i=r*s,o=e.arrx(i,n.ReaderDataType.UByte);e.skip(i/64*21),e.skip(2);const l=e.arrx(768,n.ReaderDataType.UByte);return{type:"texture",name:t,width:r,height:s,data:"{"===t[0]?(0,a.paletteWithLastTransToRGBA)(o,l):(0,a.paletteToRGBA)(o,l)}}(e);case 70:return function(e,t){const r=e.ui()&&256,s=e.ui(),i=e.ui(),o=e.ui(),l=[];for(let t=0;t<256;++t){const t=e.us(),n=e.us();l.push({x:t%r,y:Math.floor(t/r)/o*o,width:n,height:o})}const u=r*s,c=e.arrx(u,n.ReaderDataType.UByte);e.skip(2);const h=e.arrx(768,n.ReaderDataType.UByte);return{type:"font",name:t.name,width:r,height:s,rowCount:i,rowHeight:o,glyphs:l,data:(0,a.paletteWithLastTransToRGBA)(c,h)}}(e,t);default:return((e,t)=>({type:"unknown",name:t.name,data:e.arrx(t.length,n.ReaderDataType.UByte)}))(e,t)}}class i{constructor(e){this.entries=e}static parse(e){const t=new n.Reader(e);if("WAD3"!==t.nstr(4))throw new Error("Invalid WAD file format");const r=t.ui(),a=t.ui();t.seek(a);const o=[];for(let e=0;e<r;++e){const e={offset:t.ui(),diskLength:t.ui(),length:t.ui(),type:t.b(),isCompressed:t.b(),name:""};t.skip(2),e.name=t.nstr(16),o.push(e)}const l=o.map((e=>s(t,e)));return new i(l)}}t.Wad=i},1409:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.FullscreenButton=void 0;const n=r(172),a=r(682),s=r(5359),i=r(5618),o=r(3750);class l extends n.Component{constructor(){super(...arguments),this.state={isInFullscreen:!1},this.onClick=()=>{s.Fullscreen.isInFullscreen()?s.Fullscreen.exit():s.Fullscreen.enter(this.props.root)},this.onFullscreen=()=>{this.setState({isInFullscreen:s.Fullscreen.isInFullscreen()})}}componentDidMount(){s.Fullscreen.onChange(this.onFullscreen)}componentWillUnmount(){s.Fullscreen.onChangeRemove(this.onFullscreen)}render(){return(0,n.h)("div",{class:(0,a.classes)(o.ControlsStyle.button,i.FullscreenButtonStyle.button),onClick:this.onClick},this.state.isInFullscreen?(0,n.h)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 64 64",fill:"currentcolor"},(0,n.h)("path",{d:"M0 22 L22 22 L22 0 L14 0 L14 14 L0 14 M42 0 L42 22 L64 22 L64 14 L50 14 L50 0 M14 50 L0 50 L0 42 L22 42 L22 64 L14 64 M42 64 L42 42 L64 42 L64 50 L50 50 L50 64 Z"})):(0,n.h)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 64 64",fill:"currentcolor"},(0,n.h)("path",{d:"M0 22 L8 22 L8 8 L22 8 L22 0 L0 0 M42 0 L42 8 L56 8 L56 22 L64 22 L64 0 M0 64 L0 42 L8 42 L8 56 L22 56 L22 64 M64 64 L42 64 L42 56 L56 56 L56 42 L64 42 Z"})))}}t.FullscreenButton=l},5618:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.FullscreenButtonStyle=void 0;const n=r(682);t.FullscreenButtonStyle=(0,n.stylesheet)({button:{width:"30px",minWidth:"30px",height:"30px",padding:"5px"}})},6388:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PauseButton=function(e){return(0,n.h)("div",{class:a.ControlsStyle.button,onClick:e.onClick},(0,n.h)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 64 64",fill:"currentcolor"},(0,n.h)("path",{d:"M0 0 L0 64 L20 64 L20 0 M44 0 L64 0 L64 64 L44 64 Z"})))};const n=r(172),a=r(3750)},7060:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PlayButton=function(e){return(0,n.h)("div",{class:a.ControlsStyle.button,onClick:e.onClick},(0,n.h)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 64 64",fill:"currentcolor"},(0,n.h)("path",{d:"M0 0 L0 64 L64 32 Z"})))};const n=r(172),a=r(3750)},7661:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SettingsButton=void 0;const n=r(172),a=r(682),s=r(7484),i=r(7750),o=r(3750);class l extends n.Component{constructor(){super(...arguments),this.onFreeModeClick=()=>{this.props.game.mode!==s.PlayerMode.FREE&&(this.props.game.changeMode(s.PlayerMode.FREE),this.props.game.player.pause())},this.onReplayModeClick=()=>{this.props.game.mode!==s.PlayerMode.REPLAY&&this.props.game.changeMode(s.PlayerMode.REPLAY)},this.toggleMenu=()=>{this.setState({isOpen:!this.state.isOpen})}}render(){const e=!!this.props.game.player.replay;return(0,n.h)("div",{class:i.SettingsButtonStyle.settings},(0,n.h)("div",{class:(0,a.classes)(o.ControlsStyle.button,i.SettingsButtonStyle.button),onClick:this.toggleMenu},(0,n.h)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24"},(0,n.h)("path",{"fill-rule":"evenodd","clip-rule":"evenodd",fill:"#ffffff",d:"M23.9 10.7c0-0.3-0.4-0.6-0.8-0.6 -1.1 0-2.1-0.6-2.5-1.6 -0.4-1-0.1-2.2 0.7-3 0.3-0.2 0.3-0.6 0.1-0.9 -0.6-0.7-1.2-1.4-1.9-1.9 -0.3-0.2-0.7-0.2-0.9 0.1 -0.7 0.8-2 1.1-3 0.7 -1-0.4-1.7-1.5-1.6-2.6 0-0.4-0.2-0.7-0.6-0.7 -0.9-0.1-1.8-0.1-2.7 0C10.4 0.1 10.1 0.4 10.1 0.8 10.1 1.9 9.5 2.9 8.5 3.3 7.5 3.7 6.2 3.4 5.5 2.6c-0.2-0.3-0.6-0.3-0.9-0.1 -0.7 0.6-1.4 1.2-1.9 1.9C2.4 4.8 2.5 5.2 2.7 5.4c0.8 0.8 1.1 2 0.7 3 -0.4 1-1.4 1.6-2.6 1.6 -0.4 0-0.7 0.2-0.7 0.6 -0.1 0.9-0.1 1.8 0 2.7 0 0.3 0.4 0.6 0.8 0.6 1 0 2 0.6 2.5 1.6 0.4 1 0.2 2.2-0.7 3 -0.3 0.2-0.3 0.6-0.1 0.9 0.6 0.7 1.2 1.4 1.9 1.9 0.3 0.2 0.7 0.2 0.9-0.1 0.7-0.8 2-1.1 3-0.7 1 0.4 1.7 1.5 1.6 2.6 0 0.4 0.2 0.7 0.6 0.7C11.1 24 11.5 24 12 24c0.4 0 0.9 0 1.3-0.1 0.3 0 0.6-0.3 0.6-0.7 0-1.1 0.6-2.1 1.6-2.6 1-0.4 2.3-0.1 3 0.7 0.2 0.3 0.6 0.3 0.9 0.1 0.7-0.6 1.4-1.2 1.9-1.9 0.2-0.3 0.2-0.7-0.1-0.9 -0.8-0.8-1.1-2-0.7-3 0.4-1 1.4-1.6 2.5-1.6l0.1 0c0.3 0 0.7-0.2 0.7-0.6C24 12.5 24 11.6 23.9 10.7zM12 18c-3.3 0-6-2.7-6-6s2.7-6 6-6c3.3 0 6 2.7 6 6S15.3 18 12 18zM12 16"}))),(0,n.h)("div",{class:this.state.isOpen?i.SettingsButtonStyle.menuOpen:i.SettingsButtonStyle.menu},(0,n.h)("span",{class:i.SettingsButtonStyle.menuItemTitle},"Mode"),e?(0,n.h)("span",{class:this.props.game.mode===s.PlayerMode.REPLAY?i.SettingsButtonStyle.menuItemSelected:i.SettingsButtonStyle.menuItem,onClick:this.onReplayModeClick},"Replay"):(0,n.h)("span",null),(0,n.h)("span",{class:this.props.game.mode===s.PlayerMode.FREE?i.SettingsButtonStyle.menuItemSelected:i.SettingsButtonStyle.menuItem,onClick:this.onFreeModeClick},"Free")))}}t.SettingsButton=l},7750:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SettingsButtonStyle=void 0;const n=r(682);t.SettingsButtonStyle=(0,n.stylesheet)({settings:{position:"relative"},menu:Object.assign({},{display:"none",position:"absolute",left:"-38px",bottom:"48px",padding:"2px 6px",fontSize:"14px",backgroundColor:"rgba(0, 0, 0, 0.4)",flexFlow:"column",minWidth:"100px"}),menuOpen:Object.assign(Object.assign({},{display:"none",position:"absolute",left:"-38px",bottom:"48px",padding:"2px 6px",fontSize:"14px",backgroundColor:"rgba(0, 0, 0, 0.4)",flexFlow:"column",minWidth:"100px"}),{display:"flex"}),menuItemTitle:{padding:"6px 4px",borderBottom:"1px solid white",fontWeight:"bold"},menuItem:Object.assign({},{cursor:"pointer",margin:"4px 0",padding:"4px",$nest:{"&:last-child":{marginTop:0},"&:hover":{backgroundColor:"rgba(255, 255, 255, 0.1)"}}}),menuItemSelected:Object.assign(Object.assign({},{cursor:"pointer",margin:"4px 0",padding:"4px",$nest:{"&:last-child":{marginTop:0},"&:hover":{backgroundColor:"rgba(255, 255, 255, 0.1)"}}}),{backgroundColor:"rgba(255, 255, 255, 0.2) !important"}),button:{width:"32px",height:"32px",padding:"5px"}})},5999:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SpeedDownButton=function(e){return(0,n.h)("div",{class:(0,a.classes)(i.ControlsStyle.button,s.SpeedDownButtonStyle.button),onClick:e.onClick},(0,n.h)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 64 64",fill:"currentcolor"},(0,n.h)("path",{d:"M0 0 L0 64 L32 32 L32 64 L64 32 L32 0 L32 32 Z"})))};const n=r(172),a=r(682),s=r(3068),i=r(3750)},3068:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SpeedDownButtonStyle=void 0;const n=r(682);t.SpeedDownButtonStyle=(0,n.stylesheet)({button:{transform:"rotate(180deg)"}})},6656:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SpeedUpButton=function(e){return(0,n.h)("div",{class:a.ControlsStyle.button,onClick:e.onClick},(0,n.h)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 64 64",fill:"currentcolor"},(0,n.h)("path",{d:"M0 0 L0 64 L32 32 L32 64 L64 32 L32 0 L32 32 Z"})))};const n=r(172),a=r(3750)},7460:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.VolumeButton=function(e){return(0,n.h)("div",{class:(0,a.classes)(i.ControlsStyle.button,s.VolumeButton.button),onClick:e.onClick},(0,n.h)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 48 48",fill:"currentcolor"},(0,n.h)("path",{d:"M6 18v12h8l10 10V8L14 18H6zm27 6c0-3.53-2.04-6.58-5-8.05v16.11c2.96-1.48 5-4.53 5-8.06zM28 6.46v4.13c5.78 1.72 10 7.07 10 13.41s-4.22 11.69-10 13.41v4.13c8.01-1.82 14-8.97 14-17.54S36.01 8.28 28 6.46z"})))};const n=r(172),a=r(682),s=r(4569),i=r(3750)},4569:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.VolumeButton=void 0;const n=r(682);t.VolumeButton=(0,n.stylesheet)({button:{width:"28px",height:"28px",padding:"2px",marginRight:"5px"}})},3750:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ControlsStyle=void 0;const n=r(682);t.ControlsStyle=(0,n.stylesheet)({controls:Object.assign({},{zIndex:30,position:"absolute",width:"100%",bottom:0,padding:"0 16px",boxSizing:"border-box",backgroundColor:"rgba(0, 0, 0, 0.4)",userSelect:"none",opacity:0,transition:"opacity 0.2s"}),controlsVisible:Object.assign(Object.assign({},{zIndex:30,position:"absolute",width:"100%",bottom:0,padding:"0 16px",boxSizing:"border-box",backgroundColor:"rgba(0, 0, 0, 0.4)",userSelect:"none",opacity:0,transition:"opacity 0.2s"}),{opacity:1}),buttons:{height:"100%",display:"flex",justifyContent:"space-between",marginBottom:"6px",alignItems:"center"},button:{width:"32px",height:"32px",padding:"7px",boxSizing:"border-box",cursor:"pointer"},left:{display:"flex",alignItems:"center",$nest:{"& .button":{marginRight:"8px"}}},right:{display:"flex",alignItems:"center",width:"70px",height:"100%",justifyContent:"space-between"}})},8511:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.FreeMode=function(e){return(0,n.h)("div",{class:(0,a.classes)(e.class,s.FreeModeStyle.controls)},(0,n.h)("div",{class:i.ControlsStyle.buttons},(0,n.h)("div",{class:i.ControlsStyle.left}),(0,n.h)("div",{class:i.ControlsStyle.right},(0,n.h)(o.SettingsButton,{game:e.game}),(0,n.h)(l.FullscreenButton,{active:!1,root:e.root}))))};const n=r(172),a=r(682),s=r(5388),i=r(3750),o=r(7661),l=r(1409)},5388:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.FreeModeStyle=void 0;const n=r(682);t.FreeModeStyle=(0,n.stylesheet)({controls:{height:"44px"}})},7188:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Loading=void 0;const n=r(172),a=r(9609),s={replay:"Replay",bsp:"Map",sound:"Sounds",sky:"Skybox",sprite:"Sprites",wad:"Wads"};class i extends n.Component{constructor(){super(...arguments),this.state={items:{}},this.onItemLoad=e=>{const t=this.state.items[e.type]?this.state.items[e.type]:[];for(let r=0;r<t.length;++r)if(t[r]===e)return;t.push({name:e.name,progress:0}),this.setState({items:Object.assign(Object.assign({},this.state.items),{[e.type]:t})})},this.onItemProgress=e=>{if(!this.state.items[e.type])return;const t=this.state.items[e.type];for(let r=0;r<t.length;++r)if(t[r].name===e.name){t[r].progress=e.progress;break}this.forceUpdate()}}componentDidMount(){const e=this.props.game.loader.events;this.offLoadStart=e.on("loadstart",this.onItemLoad),this.offProgress=e.on("progress",this.onItemProgress)}componentWillUnmount(){this.offLoadStart&&this.offLoadStart(),this.offProgress&&this.offProgress()}formatItem(e,t){e=s[e];const r=Math.round(100*t)+"%";let n=29-e.length-r.length;n<2&&(n=9-r.length);return`${e}${Array(n).join(".")}${r}`}render(){return(0,n.h)("div",{class:this.props.visible?a.LoadingStyle.loading:a.LoadingStyle.loadingHidden},(0,n.h)("div",{class:a.LoadingStyle.spinner},(0,n.h)("svg",{xmlns:"http://www.w3.org/2000/svg",x:"0px",y:"0px",width:"80px",height:"80px",viewBox:"0 0 80 80",xmlSpace:"preserve"},(0,n.h)("path",{fill:"#ffffff",width:"10px",d:"M40,72C22.4,72,8,57.6,8,40C8,22.4,22.4,8,40,8c17.6,0,32,14.4,32,32c0,1.1-0.9,2-2,2s-2-0.9-2-2c0-15.4-12.6-28-28-28S12,24.6,12,40s12.6,28,28,28c1.1,0,2,0.9,2,2S41.1,72,40,72z"}))),(0,n.h)("ul",{class:a.LoadingStyle.log},Object.entries(this.state.items).map((([e,t])=>(0,n.h)("li",{key:e,class:a.LoadingStyle.logItem},this.formatItem(e,t.reduce(((e,t)=>e+t.progress),0)/t.length))))))}}t.Loading=i},9609:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LoadingStyle=void 0;const n=r(682);t.LoadingStyle=(0,n.stylesheet)({loading:Object.assign({},{position:"relative",width:"100%",height:"100%",opacity:1,transition:"opacity 2s ease, z-index 1s linear",zIndex:30}),loadingHidden:Object.assign(Object.assign({},{position:"relative",width:"100%",height:"100%",opacity:1,transition:"opacity 2s ease, z-index 1s linear",zIndex:30}),{opacity:0,userSelect:"none",zIndex:0}),spinner:{position:"absolute",left:"50%",top:"50%",marginLeft:"-40px",marginTop:"-40px",animation:"rotate 1s linear 0s infinite",height:"80px",width:"80px",animationName:(0,n.keyframes)({from:{transform:"rotate(0deg)"},to:{transform:"rotate(360deg)"}})},log:{position:"absolute",background:"rgba(0,0,0,0.4)",padding:"10px",fontFamily:"monospace",margin:"0",top:"16px",right:0,paddingLeft:"16px",listStyle:"none"},logItem:{display:"block"}})},1664:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ReplayMode=void 0;const n=r(172),a=r(711),s=r(1577),i=r(3833),o=r(7060),l=r(6388),u=r(7460),c=r(6656),h=r(5999),d=r(7661),f=r(1409),p=r(3750);class m extends n.Component{constructor(){super(...arguments),this.onPlayClick=()=>{this.props.game.player.play()},this.onPauseClick=()=>{this.props.game.player.pause()},this.onSpeedDown=()=>{this.props.game.player.speedDown()},this.onSpeedUp=()=>{this.props.game.player.speedUp()},this.onVolumeClick=()=>{this.props.game.soundSystem.toggleMute()},this.onPlayStateChange=()=>{this.forceUpdate()}}componentDidMount(){this.offPlay=this.props.game.player.events.on("play",this.onPlayStateChange),this.offPause=this.props.game.player.events.on("pause",this.onPlayStateChange),this.offStop=this.props.game.player.events.on("stop",this.onPlayStateChange)}componentWillUnmount(){this.offPlay&&this.offPlay(),this.offPause&&this.offPause(),this.offStop&&this.offStop()}render(){const e=this.props.game,t=e.player,r=t.isPlaying,m=t.isPaused;return(0,n.h)("div",{class:this.props.class},(0,n.h)(s.TimeLine,{game:e}),(0,n.h)("div",{class:p.ControlsStyle.buttons},(0,n.h)("div",{class:p.ControlsStyle.left},(0,n.h)(h.SpeedDownButton,{onClick:this.onSpeedDown}),m||!r?(0,n.h)(o.PlayButton,{onClick:this.onPlayClick}):(0,n.h)(l.PauseButton,{onClick:this.onPauseClick}),(0,n.h)(c.SpeedUpButton,{onClick:this.onSpeedUp}),(0,n.h)(u.VolumeButton,{onClick:this.onVolumeClick}),(0,n.h)(i.VolumeControl,{game:e}),(0,n.h)(a.Time,{player:t})),(0,n.h)("div",{class:p.ControlsStyle.right},(0,n.h)(d.SettingsButton,{game:e}),(0,n.h)(f.FullscreenButton,{active:!0,root:this.props.root}))))}}t.ReplayMode=m},3080:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RootStyle=void 0;const n=r(682);t.RootStyle=(0,n.stylesheet)({root:Object.assign({},{position:"relative",color:"white",width:"100%",height:"100%",cursor:"none",userSelect:"none"}),rootVisible:Object.assign(Object.assign({},{position:"relative",color:"white",width:"100%",height:"100%",cursor:"none",userSelect:"none"}),{cursor:"default"}),title:Object.assign({},{position:"absolute",top:"20px",left:"0",zIndex:20,padding:"10px 10px 10px 20px",backgroundColor:"rgba(0, 0, 0, 0.4)",fontSize:"13pt",fontFamily:"'Roboto', Arial, Helvetica, sans-serif",opacity:0,transition:"opacity 0.2s"}),titleVisible:Object.assign(Object.assign({},{position:"absolute",top:"20px",left:"0",zIndex:20,padding:"10px 10px 10px 20px",backgroundColor:"rgba(0, 0, 0, 0.4)",fontSize:"13pt",fontFamily:"'Roboto', Arial, Helvetica, sans-serif",opacity:0,transition:"opacity 0.2s"}),{opacity:1}),controls:Object.assign({},{zIndex:30,position:"absolute",width:"100%",bottom:0,padding:"0 16px",boxSizing:"border-box",backgroundColor:"rgba(0, 0, 0, 0.4)",userSelect:"none",opacity:0,transition:"opacity 0.2s"}),controlsVisible:Object.assign(Object.assign({},{zIndex:30,position:"absolute",width:"100%",bottom:0,padding:"0 16px",boxSizing:"border-box",backgroundColor:"rgba(0, 0, 0, 0.4)",userSelect:"none",opacity:0,transition:"opacity 0.2s"}),{opacity:1}),screen:{position:"absolute",top:0,left:0,width:"100%",height:"100%",zIndex:10}})},6897:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Root=void 0;const n=r(172),a=r(7188),s=r(8511),i=r(1664),o=r(5359),l=r(7484),u=r(3080);class c extends n.Component{constructor(e){super(e),this.node=null,this.fadeOut=0,this.onPointerLockChange=()=>{document.pointerLockElement===this.props.root?this.props.game.pointerLocked=!0:this.props.game.pointerLocked=!1},this.onContextMenu=e=>{e.preventDefault()},this.onWindowClick=()=>{this.setState({isActive:!1})},this.onRootClick=e=>{e.stopPropagation(),this.setState({isActive:!0}),this.fadeReset()},this.onKeyDown=e=>{if(!this.state.isActive)return;const t=this.props.game;switch(e.which){case 70:o.Fullscreen.isInFullscreen()?o.Fullscreen.exit():o.Fullscreen.enter(this.props.root),this.fadeReset();break;case 77:t.soundSystem.toggleMute(),this.fadeReset();break;case 38:t.soundSystem.setVolume(t.soundSystem.getVolume()+.05),this.fadeReset();break;case 40:t.soundSystem.setVolume(t.soundSystem.getVolume()-.05),this.fadeReset();break;case 74:case 37:t.player.seek(t.player.currentTime-5),this.fadeReset();break;case 76:case 39:t.player.seek(t.player.currentTime+5),this.fadeReset();break;case 75:case 32:if(this.props.game.mode!==l.PlayerMode.REPLAY)return;!t.player.isPlaying||t.player.isPaused?t.player.play():t.player.pause()}},this.onModeChange=()=>{this.forceUpdate()},this.onLoadStart=()=>{this.setState({isLoading:!0})},this.onLoadEnd=()=>{this.setState({isLoading:!1})},this.onTitleChange=e=>{this.setState({title:e})},this.onMouseEnter=()=>{this.setState({isMouseOver:!0}),this.fadeReset()},this.onMouseMove=()=>{this.state.isMouseOver&&!o.Fullscreen.isInFullscreen()&&this.fadeReset()},this.onMouseLeave=()=>{this.setState({isMouseOver:!1,isVisible:!1}),clearTimeout(this.fadeOut),this.fadeOut=0},this.fadeReset=()=>{this.state.isVisible||this.setState({isVisible:!0}),clearTimeout(this.fadeOut),this.fadeOut=setTimeout((()=>{this.setState({isVisible:!1}),this.fadeOut=0}),5e3)},this.onScreenClick=()=>{switch(this.props.game.mode){case l.PlayerMode.REPLAY:{const e=this.props.game.player;!e.isPlaying||e.isPaused?e.play():e.pause();break}case l.PlayerMode.FREE:this.props.root.requestPointerLock()}},this.onScreenDblClick=()=>{o.Fullscreen.isInFullscreen()?o.Fullscreen.exit():o.Fullscreen.enter(this.props.root)},this.state={title:e.game.title,isActive:!1,isLoading:!1,isMouseOver:!1,isVisible:!1}}componentDidMount(){if(!this.node)return;const e=this.props.game,t=this.props.root;this.node.appendChild(e.getCanvas()),this.offLoadStart=e.events.on("loadstart",this.onLoadStart),this.offLoad=e.events.on("load",this.onLoadEnd),this.offModeChange=e.events.on("modechange",this.onModeChange),this.offTitleChange=e.events.on("titlechange",this.onTitleChange),t.addEventListener("click",this.onRootClick),window.addEventListener("click",this.onWindowClick),window.addEventListener("keydown",this.onKeyDown),document.addEventListener("pointerlockchange",this.onPointerLockChange,!1),t.addEventListener("mouseover",this.onMouseEnter),t.addEventListener("mousemove",this.onMouseMove),t.addEventListener("mouseout",this.onMouseLeave),t.addEventListener("contextmenu",this.onContextMenu)}componentWillUnmount(){const e=this.props.root;this.offLoadStart&&this.offLoadStart(),this.offLoad&&this.offLoad(),this.offModeChange&&this.onModeChange(),this.offTitleChange&&this.offTitleChange(),e.removeEventListener("click",this.onRootClick),window.removeEventListener("click",this.onWindowClick),window.removeEventListener("keydown",this.onKeyDown),document.removeEventListener("pointerlockchange",this.onPointerLockChange,!1),e.removeEventListener("mouseover",this.onMouseEnter),e.removeEventListener("mousemove",this.onMouseMove),e.removeEventListener("mouseout",this.onMouseLeave),e.removeEventListener("contextmenu",this.onContextMenu)}render(){const e=this.props.game,t=this.state.isVisible;return(0,n.h)("div",{class:t?u.RootStyle.rootVisible:u.RootStyle.root},(0,n.h)("div",{class:t?u.RootStyle.titleVisible:u.RootStyle.title},this.state.title),(0,n.h)(a.Loading,{game:e,visible:this.state.isLoading}),(0,n.h)("div",{class:u.RootStyle.screen,ref:e=>this.node=e,onClick:this.onScreenClick,onDblClick:this.onScreenDblClick}),e.mode===l.PlayerMode.FREE?(0,n.h)(s.FreeMode,{class:t?u.RootStyle.controlsVisible:u.RootStyle.controls,game:e,root:this.props.root}):(0,n.h)(i.ReplayMode,{class:t?u.RootStyle.controlsVisible:u.RootStyle.controls,game:e,root:this.props.root,visible:this.state.isMouseOver}))}}t.Root=c},711:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Time=void 0;const n=r(172),a=r(4343),s=r(8388);class i extends n.Component{constructor(){super(...arguments),this.onPlay=()=>{this.setState({isPlaying:!0},this.update)},this.onPauseOrStop=()=>{this.setState({isPlaying:!1})},this.update=()=>{this.state.isPlaying&&(this.forceUpdate(),setTimeout(this.update,100))}}componentDidMount(){this.offPlay=this.props.player.events.on("play",this.onPlay),this.offPause=this.props.player.events.on("pause",this.onPauseOrStop),this.offStop=this.props.player.events.on("stop",this.onPauseOrStop)}componentWillUnmount(){this.offPlay&&this.offPlay(),this.offPause&&this.offPause(),this.offStop&&this.offStop()}render(){const e=(0,a.formatTime)(this.props.player.currentTime),t=(0,a.formatTime)(this.props.player.replay.length);return(0,n.h)("div",{class:s.Time.time},e," / ",t)}}t.Time=i},8388:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Time=void 0;const n=r(682);t.Time=(0,n.stylesheet)({time:{fontFamily:"'Roboto', Arial, Helvetica, sans-serif",fontSize:"10pt"}})},1577:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TimeLine=void 0;const n=r(172),a=r(4170);class s extends n.Component{constructor(e){super(e),this.onPostUpdate=()=>{const e=this.props.game.player;this.setState({progress:e.currentTime/e.replay.length})},this.onClick=e=>{const t=e.currentTarget.getClientRects()[0],r=1-(t.right-e.pageX)/(t.right-t.left);this.props.game.player.seekByPercent(100*r),this.props.game.player.pause()},this.onMouseEnter=()=>{this.setState({ghostKnobActive:!0})},this.onMouseMove=e=>{if(!this.state.ghostKnobActive)return;const t=e.currentTarget.getClientRects()[0],r=100*(1-(t.right-e.pageX)/(t.right-t.left))+"%";this.setState({ghostKnobPos:r})},this.onMouseLeave=()=>{this.setState({ghostKnobActive:!1})},this.state={progress:0,ghostKnobActive:!1,ghostKnobPos:"0%",onPostUpdate:null}}componentDidMount(){this.offPostUpdate=this.props.game.events.on("postupdate",this.onPostUpdate)}componentWillUnmount(){this.offPostUpdate&&this.offPostUpdate()}render(){const e=100*this.state.progress,t=e+"%",r=100-e+"%";return(0,n.h)("div",{class:a.TimeLine.timeline,onClick:this.onClick,onMouseEnter:this.onMouseEnter,onMouseMove:this.onMouseMove,onMouseLeave:this.onMouseLeave},(0,n.h)("div",{class:a.TimeLine.ghostLine}),(0,n.h)("div",{class:a.TimeLine.line,style:{right:r}}),(0,n.h)("div",{class:a.TimeLine.knob,style:{left:t}}),(0,n.h)("div",{class:a.TimeLine.ghostKnob,style:{left:this.state.ghostKnobPos}}))}}t.TimeLine=s},4170:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TimeLine=void 0;const n=r(682);t.TimeLine=(0,n.stylesheet)({timeline:{display:"flex",alignItems:"center",position:"relative",height:"26px",cursor:"pointer"},line:{height:"4px",backgroundColor:"#fff",position:"absolute",left:"0",right:"0",borderRadius:"2px"},ghostLine:{height:"4px",backgroundColor:"rgba(255, 255, 255, 0.5)",position:"absolute",left:"0",right:"0",borderRadius:"2px"},knob:{position:"absolute",width:"12px",height:"12px",backgroundColor:"#fff",borderRadius:"6px",left:"100%",marginLeft:"-6px"},ghostKnob:{position:"absolute",width:"8px",height:"8px",backgroundColor:"#fff",boxSizing:"border-box",borderRadius:"8px",left:"0",marginLeft:"-4px",display:"none",$nest:{"&:hover":{display:"block"}}}})},3833:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.VolumeControl=void 0;const n=r(172),a=r(7082);class s extends n.Component{constructor(e){super(e),this.onVolumeChange=()=>{this.setState({volume:this.props.game.soundSystem.getVolume()})},this.onClick=e=>{const t=e.currentTarget.getClientRects()[0],r=1-(t.right-e.pageX)/(t.right-t.left);this.props.game.soundSystem.setVolume(r)},this.onMouseEnter=()=>{this.setState({ghostKnobActive:!0})},this.onMouseMove=e=>{if(!this.state.ghostKnobActive)return;const t=e.currentTarget.getClientRects()[0],r=1-(t.right-e.pageX)/(t.right-t.left),n=Math.min(95,Math.max(5,100*r))+"%";this.setState({ghostKnobPos:n})},this.onMouseLeave=()=>{this.setState({ghostKnobActive:!1})},this.state={volume:e.game.soundSystem.getVolume(),ghostKnobActive:!1,ghostKnobPos:"5%"}}componentDidMount(){this.offVolumeChange=this.props.game.soundSystem.events.on("volumeChange",this.onVolumeChange)}componentWillUnmount(){this.offVolumeChange&&this.offVolumeChange()}render(){const e=100*this.state.volume,t=Math.min(95,Math.max(5,e))+"%",r=Math.min(95,Math.max(5,100-e))+"%";return(0,n.h)("div",{class:a.VolumeControl.control,onClick:this.onClick,onMouseEnter:this.onMouseEnter,onMouseMove:this.onMouseMove,onMouseLeave:this.onMouseLeave},(0,n.h)("div",{class:a.VolumeControl.ghostLine}),(0,n.h)("div",{class:a.VolumeControl.line,style:{right:r}}),(0,n.h)("div",{class:a.VolumeControl.knob,style:{left:t}}),(0,n.h)("div",{class:a.VolumeControl.ghostKnob,style:{left:this.state.ghostKnobPos}}))}}t.VolumeControl=s},7082:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.VolumeControl=void 0;const n=r(682);t.VolumeControl=(0,n.stylesheet)({control:{display:"flex",alignItems:"center",position:"relative",width:"80px",height:"26px",marginLeft:"6px",marginRight:"14px",cursor:"pointer"},line:{height:"4px",backgroundColor:"#fff",position:"absolute",left:"0",right:"0",borderRadius:"2px"},ghostLine:{height:"4px",backgroundColor:"rgba(255, 255, 255, 0.5)",position:"absolute",left:"0",right:"0",borderRadius:"2px"},knob:{position:"absolute",width:"12px",height:"12px",backgroundColor:"#fff",borderRadius:"6px",left:"100%",marginLeft:"-6px"},ghostKnob:{position:"absolute",width:"8px",height:"8px",backgroundColor:"#fff",boxSizing:"border-box",borderRadius:"8px",left:"0",marginLeft:"-4px",display:"none",$nest:{"&:hover":{display:"block"}}}})},9849:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PlayerInterface=void 0;const n=r(172),a=r(6897);t.PlayerInterface=class{constructor(e,t){this.game=e,this.rootNode=t}getRootNode(){return this.rootNode}draw(){(0,n.render)((0,n.h)(a.Root,{game:this.game,root:this.rootNode}),this.rootNode)}}},8529:(e,t)=>{"use strict";var r;Object.defineProperty(t,"__esModule",{value:!0}),t.Reader=t.ReaderDataType=void 0,function(e){e[e.UByte=0]="UByte",e[e.Byte=1]="Byte",e[e.UShort=2]="UShort",e[e.Short=3]="Short",e[e.UInt=4]="UInt",e[e.Int=5]="Int",e[e.Float=6]="Float",e[e.Double=7]="Double",e[e.NString=8]="NString",e[e.String=9]="String"}(r||(t.ReaderDataType=r={}));t.Reader=class{constructor(e){this.data=new DataView(e),this.offset=0}length(){return this.data.byteLength}tell(){return this.offset}seek(e){this.offset=Math.max(0,e)}skip(e){this.seek(this.tell()+e)}b(){const e=this.data.getInt8(this.offset);return this.skip(1),e}ub(){const e=this.data.getUint8(this.offset);return this.skip(1),e}s(e=!0){const t=this.data.getInt16(this.offset,e);return this.skip(2),t}us(e=!0){const t=this.data.getUint16(this.offset,e);return this.skip(2),t}i(e=!0){const t=this.data.getInt32(this.tell(),e);return this.skip(4),t}ui(e=!0){const t=this.data.getUint32(this.tell(),e);return this.skip(4),t}f(e=!0){const t=this.data.getFloat32(this.tell(),e);return this.skip(4),t}lf(e=!0){const t=this.data.getFloat64(this.tell(),e);return this.skip(8),t}str(){let e=this.ub(),t="";for(;0!==e;)t+=String.fromCharCode(e),e=this.ub();return t}nstr(e){if(e<0)return"";let t="";for(;e>0;){e-=1;const r=this.ub();if(0===r)break;t+=String.fromCharCode(r)}return 0!==e&&this.skip(e),t}arr(e,t){t.bind(this);const r=[];for(;e-- >0;)r.push(t());return r}arrx(e,t,n=0){let a;switch(t){case r.UByte:a=new Uint8Array(this.data.buffer,this.tell(),e),this.skip(e);break;case r.Byte:a=new Int8Array(this.data.buffer,this.tell(),e),this.skip(e);break;case r.UShort:a=new Uint16Array(this.data.buffer,this.tell(),e),this.skip(2*e);break;case r.Short:a=new Int16Array(this.data.buffer,this.tell(),e),this.skip(2*e);break;case r.UInt:a=new Uint32Array(this.data.buffer,this.tell(),e),this.skip(4*e);break;case r.Int:a=new Int32Array(this.data.buffer,this.tell(),e),this.skip(4*e);break;case r.Float:a=new Float32Array(this.data.buffer,this.tell(),e),this.skip(4*e);break;case r.Double:a=new Float64Array(this.data.buffer,this.tell(),e),this.skip(8*e);break;case r.NString:for(a=[];e-- >0;)a.push(a.nstr(n));break;case r.String:for(a=[];e-- >0;)a.push(a.str())}return a}}},4080:(e,t)=>{"use strict";var r;Object.defineProperty(t,"__esModule",{value:!0}),t.DeltaType=void 0,function(e){e[e.DT_BYTE=1]="DT_BYTE",e[e.DT_SHORT=2]="DT_SHORT",e[e.DT_FLOAT=4]="DT_FLOAT",e[e.DT_INTEGER=8]="DT_INTEGER",e[e.DT_ANGLE=16]="DT_ANGLE",e[e.DT_TIMEWINDOW_8=32]="DT_TIMEWINDOW_8",e[e.DT_TIMEWINDOW_BIG=64]="DT_TIMEWINDOW_BIG",e[e.DT_STRING=128]="DT_STRING",e[e.DT_SIGNED=-2147483648]="DT_SIGNED"}(r||(t.DeltaType=r={}))},3712:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.FrameDataReader=void 0;const n=r(6231),a=r(1752),s=r(8748),i=r(8529);class o{static bad(){throw new Error("Invalid message type")}static nop(){return null}static disconnect(e){return{reason:e.str()}}static event(e,t){let r=new s.BitStream(e.data.buffer);r.index=8*e.tell();let n=[],i=r.readBits(5);for(let e=0;e<i;++e){let e={index:r.readBits(10)};if(r.readBits(1)){e.packetIndex=r.readBits(11),r.readBits(1)&&(e.delta=(0,a.readDelta)(r,t.event_t))}r.readBits(1)&&(e.fireTime=r.readBits(16)),n.push(e)}return r.index%8>0?e.seek(Math.floor(r.index/8)+1):e.seek(r.index/8),{events:n}}static version(e){return{version:e.ui()}}static setView(e){return{entityIndex:e.s()}}static sound(e){let t=new s.BitStream(e.data.buffer);t.index=8*e.tell();let r=t.readBits(9),a=1;0!=(1&r)&&(a=t.readBits(8)/255);let i=1;0!=(2&r)&&(i=t.readBits(8)/64);let o,l=t.readBits(3),u=t.readBits(11);o=0!=(4&r)?t.readBits(16):t.readBits(8);let c,h,d,f=t.readBits(1),p=t.readBits(1),m=t.readBits(1);f&&(c=(0,n.readCoord)(t)),p&&(h=(0,n.readCoord)(t)),m&&(d=(0,n.readCoord)(t));let g=1;return 0!=(8&r)&&(g=t.readBits(8)),t.index%8>0?e.seek(Math.floor(t.index/8)+1):e.seek(t.index/8),{flags:r,volume:a,attenuation:i,channel:l,entityIndex:u,soundIndex:o,xPosition:c,yPosition:h,zPosition:d,pitch:g}}static time(e){return{time:e.f()}}static print(e){return{message:e.str()}}static stuffText(e){return{commands:e.str().split(";").map((e=>{let t=e.split(/\s*("[^"]+"|[^\s"]+)/).map((e=>e.replace(/^"(.*)"$/,"$1").trim())).filter((e=>e));return{func:t[0],params:t.slice(1)}}))}}static setAngle(e){return{pitch:e.s(),yaw:e.s(),roll:e.s()}}static serverInfo(e){let t={protocol:e.i(),spawnCount:e.i(),mapCrc:e.i(),clientDllHash:e.arrx(16,i.ReaderDataType.UByte),maxPlayers:e.ub(),playerIndex:e.ub(),isDeathmatch:e.ub(),gameDir:e.str(),hostName:e.str(),mapFileName:e.str(),mapCycle:e.str()};return e.skip(1),t}static lightStyle(e){return{index:e.ub(),lightInfo:e.str()}}static updateUserInfo(e){return{clientIndex:e.ub(),clientUserId:e.ui(),clientUserInfo:e.str(),clientCdKeyHash:e.arrx(16,i.ReaderDataType.UByte)}}static deltaDescription(e,t){let r={name:e.str(),fields:[]},n=new s.BitStream(e.data.buffer),i=e.us();n.index=8*e.tell();for(let e=0;e<i;++e)r.fields.push((0,a.readDelta)(n,t.delta_description_t));return t[r.name]=r.fields,n.index%8>0?e.seek(Math.floor(n.index/8)+1):e.seek(n.index/8),r}static clientData(e,t){let r=new s.BitStream(e.data.buffer);r.index=8*e.tell(),r.readBits(1)&&(r.index+=8);let n=t.clientdata_t,i=(0,a.readDelta)(r,n),o=t.weapon_data_t;for(;r.readBits(1);)r.index+=6,(0,a.readDelta)(r,o);return r.index%8>0?e.seek(Math.floor(r.index/8)+1):e.seek(r.index/8),{clientData:i}}static stopSound(e){return{entityIndex:e.s()}}static pings(e){let t=new s.BitStream(e.data.buffer);t.index=8*e.tell();let r=[];for(;t.readBits(1);)r.push({slot:t.readBits(8),ping:t.readBits(8),loss:t.readBits(8)});return t.index%8>0?e.seek(Math.floor(t.index/8)+1):e.seek(t.index/8),r}static particle(e){return{position:[e.s()/8,e.s()/8,e.s()/8],direction:[e.b(),e.b(),e.b()],count:e.ub(),color:e.ub()}}static damage(){return null}static spawnStatic(e){let t={modelIndex:e.s(),sequence:e.b(),frame:e.b(),colorMap:e.s(),skin:e.b(),position:[],rotation:[]};return t.position[0]=e.s()/8,t.rotation[0]=1.40625*e.b(),t.position[1]=e.s()/8,t.rotation[1]=1.40625*e.b(),t.position[2]=e.s()/8,t.rotation[2]=1.40625*e.b(),t.renderMode=e.b(),t.renderMode&&(t.renderAmt=e.b(),t.renderColor=[e.ub(),e.ub(),e.ub()],t.renderFx=e.b()),t}static eventReliable(e,t){let r=new s.BitStream(e.data.buffer);r.index=8*e.tell();let n,i=r.readBits(10),o=(0,a.readDelta)(r,t.event_t),l=r.readBits(1);return l&&(n=r.readBits(16)),r.index%8>0?e.seek(Math.floor(r.index/8)+1):e.seek(r.index/8),{eventIndex:i,eventData:o,delayBit:l,delay:n}}static spawnBaseLine(e,t){let r=new s.BitStream(e.data.buffer);r.index=8*e.tell();let n=[];for(;;){let e,s=r.readBits(11);if(2047===s)break;e=1&r.readBits(2)?s>0&&s<=32?"entity_state_player_t":"entity_state_t":"custom_entity_state_t",n[s]=(0,a.readDelta)(r,t[e])}if(31!==r.readBits(5))throw new Error("Bad spawnbaseline");let i=r.readBits(6),o=[];for(let e=0;e<i;++e)o.push((0,a.readDelta)(r,t.entity_state_t));return r.index%8>0?e.seek(Math.floor(r.index/8)+1):e.seek(r.index/8),{entities:n,extraData:o}}static tempEntity(e){let t={};switch(e.ub()){case 0:case 19:case 20:case 21:case 108:e.skip(24);break;case 1:e.skip(20);break;case 2:case 4:case 9:case 10:case 11:e.skip(6);break;case 3:case 23:e.skip(11);break;case 5:case 17:case 22:case 100:case 112:case 122:e.skip(10);break;case 6:case 27:case 102:case 115:e.skip(12);break;case 7:case 30:case 31:case 106:case 110:e.skip(17);break;case 8:case 18:case 24:case 28:case 119:e.skip(16);break;case 12:e.skip(8);break;case 13:e.skip(8),e.s()&&e.skip(2);break;case 14:case 104:case 109:case 118:case 123:e.skip(9);break;case 15:case 25:case 113:case 114:e.skip(19);break;case 29:t.channel=e.b(),t.x=e.s(),t.y=e.s(),t.effect=e.b(),t.textColor=[e.ub(),e.ub(),e.ub(),e.ub()],t.effectColor=[e.ub(),e.ub(),e.ub(),e.ub()],t.fadeInTime=e.s(),t.fadeOutTime=e.s(),t.holdTime=e.s(),t.effect&&(t.effectTime=e.s()),t.message=e.str();break;case 99:e.skip(2);break;case 101:case 103:e.skip(14);break;case 105:case 121:e.skip(5);break;case 107:e.skip(13);break;case 111:case 116:case 117:case 124:e.skip(7);break;case 120:case 126:e.skip(18);break;case 125:e.skip(1);break;case 127:e.skip(15);break;default:throw new Error("Unknown temp entity type")}return t}static setPause(e){return{isPaused:e.b()}}static signOnNum(e){return{sign:e.b()}}static centerPrint(e){return{message:e.str()}}static killedMonster(){return null}static foundSecret(){return null}static spawnStaticSound(e){return{position:[e.s()/8,e.s()/8,e.s()/8],soundIndex:e.us(),volume:e.ub()/255,attenuation:e.ub()/64,entityIndex:e.us(),pitch:e.ub(),flags:e.ub()}}static intermission(){return null}static finale(e){return{text:e.str()}}static cdTrack(e){return{track:e.b(),loopTrack:e.b()}}static restore(e){let t=e.str(),r=e.ub(),n=[];for(let t=0;t<r;++t)n.push(e.str());return{saveName:t,maps:n}}static cutscene(e){return{text:e.str()}}static weaponAnim(e){return{sequenceNumber:e.b(),weaponModelBodyGroup:e.b()}}static decalName(e){return{positionIndex:e.ub(),decalName:e.str()}}static roomType(e){return{type:e.us()}}static addAngle(e){return{angleToAdd:e.s()/(360/65536)}}static newUserMsg(e){return{index:e.ub(),size:e.b(),name:e.nstr(16)}}static packetEntities(e,t){let r=new s.BitStream(e.data.buffer);r.index=8*e.tell();let n=[];r.readBits(16);let i=0;for(;;){if(0===r.readBits(16))break;if(r.index-=16,r.readBits(1))i++;else{r.readBits(1)?i=r.readBits(11):i+=r.readBits(6)}let e=r.readBits(1);r.readBits(1)&&(r.index+=6);let s="entity_state_t";i>0&&i<=32?s="entity_state_player_t":e&&(s="custom_entity_state_t"),n.push((0,a.readDelta)(r,t[s]))}return r.index%8>0?e.seek(Math.floor(r.index/8)+1):e.seek(r.index/8),{entityStates:n}}static deltaPacketEntities(e,t){let r=new s.BitStream(e.data.buffer);r.index=8*e.tell(),r.readBits(16),r.index+=8;let n=[],i=0;for(;;){if(0===r.readBits(16))break;r.index-=16;let e=r.readBits(1);if(r.readBits(1)?i=r.readBits(11):i+=r.readBits(6),e)continue;let s=r.readBits(1),o="entity_state_t";i>0&&i<32?o="entity_state_player_t":s&&(o="custom_entity_state_t"),n[i]=(0,a.readDelta)(r,t[o])}return r.index%8>0?e.seek(Math.floor(r.index/8)+1):e.seek(r.index/8),{entityStates:n}}static choke(){return null}static resourceList(e){let t=new s.BitStream(e.data.buffer);t.index=8*e.tell();let r=[],n=t.readBits(12);for(let e=0;e<n;++e){let e={};e.type=t.readBits(4),e.name=t.readString(),e.index=t.readBits(12),e.size=t.readBits(24),4&t.readBits(3)&&(t.index+=128),t.readBits(1)&&(t.index+=256),r.push(e)}if(t.readBits(1))for(;t.readBits(1);){let e=t.readBits(1)?5:10;t.index+=e}return t.index%8>0?e.seek(Math.floor(t.index/8)+1):e.seek(t.index/8),r}static newMoveVars(e){return{gravity:e.f(),stopSpeed:e.f(),maxSpeed:e.f(),spectatorMaxSpeed:e.f(),acceleration:e.f(),airAcceleration:e.f(),waterAcceleration:e.f(),friction:e.f(),edgeFriction:e.f(),waterFriction:e.f(),entityGravity:e.f(),bounce:e.f(),stepSize:e.f(),maxVelocity:e.f(),zMax:e.f(),waveHeight:e.f(),footsteps:e.b(),rollAngle:e.f(),rollSpeed:e.f(),skyColor:[e.f(),e.f(),e.f()],skyVec:[e.f(),e.f(),e.f()],skyName:e.str()}}static resourceRequest(e){let t={spawnCount:e.i()};return e.skip(4),t}static customization(e){let t,r=e.ub(),n=e.ub(),a=e.str(),s=e.us(),i=e.ui(),o=e.ub();return 4&o&&(t=[e.i(),e.i(),e.i(),e.i()]),{playerIndex:r,type:n,name:a,index:s,downloadSize:i,flags:o,md5hash:t}}static crosshairAngle(e){return{pitch:e.b(),yaw:e.b()}}static soundFade(e){return{initialPercent:e.ub(),holdTime:e.ub(),fadeOutTime:e.ub(),fadeInTime:e.ub()}}static fileTxferFailed(e){return{filename:e.str()}}static hltv(e){return{mode:e.ub()}}static director(e){let t=e.ub();return{flag:e.ub(),message:e.nstr(t-1)}}static voiceInit(e){return{codecName:e.str(),quality:e.b()}}static voiceData(e){let t=e.ub(),r=e.us();return{playerIndex:t,data:e.arrx(r,i.ReaderDataType.UByte)}}static sendExtraInfo(e){return{fallbackDir:e.str(),canCheat:e.ub()}}static timeScale(e){return{timeScale:e.f()}}static resourceLocation(e){return{url:e.str()}}static sendCvarValue(e){return{name:e.str()}}static sendCvarValue2(e){return{requestId:e.ui(),name:e.str()}}static read(e,t,r){if(0===t)return null;const n=o.handlers[t];return n?n(e,r):null}}t.FrameDataReader=o,o.handlers=[o.bad,o.nop,o.disconnect,o.event,o.version,o.setView,o.sound,o.time,o.print,o.stuffText,o.setAngle,o.serverInfo,o.lightStyle,o.updateUserInfo,o.deltaDescription,o.clientData,o.stopSound,o.pings,o.particle,o.damage,o.spawnStatic,o.eventReliable,o.spawnBaseLine,o.tempEntity,o.setPause,o.signOnNum,o.centerPrint,o.killedMonster,o.foundSecret,o.spawnStaticSound,o.intermission,o.finale,o.cdTrack,o.restore,o.cutscene,o.weaponAnim,o.decalName,o.roomType,o.addAngle,o.newUserMsg,o.packetEntities,o.deltaPacketEntities,o.choke,o.resourceList,o.newMoveVars,o.resourceRequest,o.customization,o.crosshairAngle,o.soundFade,o.fileTxferFailed,o.hltv,o.director,o.voiceInit,o.voiceData,o.sendExtraInfo,o.timeScale,o.resourceLocation,o.sendCvarValue,o.sendCvarValue2],function(e){let t;!function(e){e[e.BAD=0]="BAD",e[e.NOP=1]="NOP",e[e.DISCONNECT=2]="DISCONNECT",e[e.EVENT=3]="EVENT",e[e.VERSION=4]="VERSION",e[e.SETVIEW=5]="SETVIEW",e[e.SOUND=6]="SOUND",e[e.TIME=7]="TIME",e[e.PRINT=8]="PRINT",e[e.STUFFTEXT=9]="STUFFTEXT",e[e.SETANGLE=10]="SETANGLE",e[e.SERVERINFO=11]="SERVERINFO",e[e.LIGHTSTYLE=12]="LIGHTSTYLE",e[e.UPDATEUSERINFO=13]="UPDATEUSERINFO",e[e.DELTADESCRIPTION=14]="DELTADESCRIPTION",e[e.CLIENTDATA=15]="CLIENTDATA",e[e.STOPSOUND=16]="STOPSOUND",e[e.PINGS=17]="PINGS",e[e.PARTICLE=18]="PARTICLE",e[e.DAMAGE=19]="DAMAGE",e[e.SPAWNSTATIC=20]="SPAWNSTATIC",e[e.EVENT_RELIABLE=21]="EVENT_RELIABLE",e[e.SPAWNBASELINE=22]="SPAWNBASELINE",e[e.TEMPENTITY=23]="TEMPENTITY",e[e.SETPAUSE=24]="SETPAUSE",e[e.SIGNONNUM=25]="SIGNONNUM",e[e.CENTERPRINT=26]="CENTERPRINT",e[e.KILLEDMONSTER=27]="KILLEDMONSTER",e[e.FOUNDSECRET=28]="FOUNDSECRET",e[e.SPAWNSTATICSOUND=29]="SPAWNSTATICSOUND",e[e.INTERMISSION=30]="INTERMISSION",e[e.FINALE=31]="FINALE",e[e.CDTRACK=32]="CDTRACK",e[e.RESTORE=33]="RESTORE",e[e.CUTSCENE=34]="CUTSCENE",e[e.WEAPONANIM=35]="WEAPONANIM",e[e.DECALNAME=36]="DECALNAME",e[e.ROOMTYPE=37]="ROOMTYPE",e[e.ADDANGLE=38]="ADDANGLE",e[e.NEWUSERMSG=39]="NEWUSERMSG",e[e.PACKETENTITIES=40]="PACKETENTITIES",e[e.DELTAPACKETENTITIES=41]="DELTAPACKETENTITIES",e[e.CHOKE=42]="CHOKE",e[e.RESOURCELIST=43]="RESOURCELIST",e[e.NEWMOVEVARS=44]="NEWMOVEVARS",e[e.RESOURCEREQUEST=45]="RESOURCEREQUEST",e[e.CUSTOMIZATION=46]="CUSTOMIZATION",e[e.CROSSHAIRANGLE=47]="CROSSHAIRANGLE",e[e.SOUNDFADE=48]="SOUNDFADE",e[e.FILETXFERFAILED=49]="FILETXFERFAILED",e[e.HLTV=50]="HLTV",e[e.DIRECTOR=51]="DIRECTOR",e[e.VOICEINIT=52]="VOICEINIT",e[e.VOICEDATA=53]="VOICEDATA",e[e.SENDEXTRAINFO=54]="SENDEXTRAINFO",e[e.TIMESCALE=55]="TIMESCALE",e[e.RESOURCELOCATION=56]="RESOURCELOCATION",e[e.SENDCVARVALUE=57]="SENDCVARVALUE",e[e.SENDCVARVALUE2=58]="SENDCVARVALUE2"}(t=e.SVC||(e.SVC={}))}(o||(t.FrameDataReader=o={}))},9163:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Replay=void 0;const n=r(605),a=r(5470),s=r(7022),i=r(8529),o=r(3712),l=r(1752),u=e=>({demoProtocol:e.ui(),netProtocol:e.ui(),mapName:e.nstr(260),modName:e.nstr(260),mapCrc:e.i(),dirOffset:e.ui()}),c=(e,t)=>{e.seek(t);let r=e.ui(),n=[];for(let t=0;t<r;++t)n.push({id:e.ui(),name:e.nstr(64),flags:e.ui(),cdTrack:e.i(),time:e.f(),frames:e.ui(),offset:e.ui(),length:e.ui()});return n},h=(e,t,r)=>{let n={type:e.ub(),time:e.f(),tick:e.ui()};switch(n.type){case 0:case 1:e.skip(4),n.camera={position:[e.f(),e.f(),e.f()],orientation:[e.f(),e.f(),e.f()]},e.skip(436),n.data=((e,t,r)=>{let n=e.ui(),a=e.tell()+n,s=[];for(;e.tell()<a;){let n=e.ub();if(1===n)continue;if(n>=64){r[n]&&r[n].size>-1?e.skip(r[n].size):e.skip(e.ub());continue}let i=o.FrameDataReader.read(e,n,t);i?(39===n&&(r[i.index]=i),s.push({type:n,data:i})):e.seek(a)}return e.seek(a),s})(e,t,r);break;case 2:case 5:break;case 3:n.command=e.nstr(64);break;case 4:e.skip(32);break;case 6:e.skip(84);break;case 7:e.skip(8);break;case 8:n.sound={channel:e.i(),sample:e.nstr(e.ui()),attenuation:e.f(),volume:e.f(),flags:e.ui(),pitch:e.i()};break;case 9:e.skip(e.ui());break;default:n.error=!0}return n};class d{constructor(e,t){this.header=e,this.mapName=this.header.mapName,this.directories=t}static parseFromArrayBuffer(e){let t=new i.Reader(e);if("HLDEMO"!==t.nstr(8))throw new Error("Invalid replay format");let r={};r.demoProtocol=t.ui(),r.netProtocol=t.ui(),r.mapName=t.nstr(260),r.modName=t.nstr(260),r.mapCrc=t.i(),r.dirOffset=t.ui(),t.seek(r.dirOffset);let n=t.ui(),a=[];for(let e=0;e<n;++e)a.push({id:t.ui(),name:t.nstr(64),flags:t.ui(),cdTrack:t.i(),time:t.f(),frames:t.ui(),offset:t.ui(),length:t.ui(),macros:[]});for(let e=0;e<a.length;++e){t.seek(a[e].offset);let r=!1;for(;!r;){let n={type:t.b(),time:t.f(),frame:t.ui()};switch(n.type){case 0:case 1:t.skip(4),n.camera={position:[t.f(),t.f(),t.f()],orientation:[t.f(),t.f(),t.f()]},t.skip(436),t.skip(t.ui());break;case 2:break;case 3:n.command=t.nstr(64);break;case 4:t.skip(32);break;case 5:r=!0;break;case 6:t.skip(84);break;case 7:t.skip(8);break;case 8:t.skip(4),t.skip(t.ui()+16);break;case 9:t.skip(t.ui());break;default:{const e=Number(t.tell()-9).toString(16),r=[`Unexpected macro (${n.type})`,` at offset = ${e}.`].join("");throw new Error(r)}}a[e].macros.push(n)}}return new d(r,a)}static parseFullFromArrayBuffer(e){let t=new i.Reader(e);if("HLDEMO"!==t.nstr(8))throw new Error("Invalid replay format");let r={};r.demoProtocol=t.ui(),r.netProtocol=t.ui(),r.mapName=t.nstr(260),r.modName=t.nstr(260),r.mapCrc=t.i(),r.dirOffset=t.ui(),t.seek(r.dirOffset);let n=t.ui(),a=[];for(let e=0;e<n;++e)a.push({id:t.ui(),name:t.nstr(64),flags:t.ui(),cdTrack:t.i(),time:t.f(),frames:t.ui(),offset:t.ui(),length:t.ui(),macros:[]});let s=(0,l.getInitialDeltaDecoders)(),u=[];for(let e=0;e<a.length;++e){t.seek(a[e].offset);let r=!1;for(;!r;){let n={type:t.b(),time:t.f(),frame:t.ui()};switch(n.type){case 0:case 1:{t.skip(4),n.camera={position:[t.f(),t.f(),t.f()],orientation:[t.f(),t.f(),t.f()],forward:[t.f(),t.f(),t.f()],right:[t.f(),t.f(),t.f()],up:[t.f(),t.f(),t.f()]},n.RefParams={frametime:t.f(),time:t.f(),intermission:t.i(),paused:t.i(),spectator:t.i(),onground:t.i(),waterlevel:t.i(),velocity:[t.f(),t.f(),t.f()],origin:[t.f(),t.f(),t.f()],viewHeight:[t.f(),t.f(),t.f()],idealPitch:t.f(),viewAngles:[t.f(),t.f(),t.f()],health:t.i(),crosshairAngle:[t.f(),t.f(),t.f()],viewSize:t.f(),punchAngle:[t.f(),t.f(),t.f()],maxClients:t.i(),viewEntity:t.i(),playerCount:t.i(),maxEntities:t.i(),demoPlayback:t.i(),hardware:t.i(),smoothing:t.i(),ptr_cmd:t.i(),ptr_movevars:t.i(),viewport:[t.i(),t.i(),t.i(),t.i()],nextView:t.i(),onlyClientDraw:t.i()},n.UserCmd={lerp_msec:t.s(),msec:t.ub(),UNUSED1:t.ub(),viewAngles:[t.f(),t.f(),t.f()],forwardMove:t.f(),sideMove:t.f(),upMove:t.f(),lightLevel:t.b(),UNUSED2:t.ub(),buttons:t.us(),impulse:t.b(),weaponSelect:t.b(),UNUSED:t.s(),impactIndex:t.i(),impactPosition:[t.f(),t.f(),t.f()]},n.MoveVars={gravity:t.f(),stopSpeed:t.f(),maxSpeed:t.f(),spectatorMaxSpeed:t.f(),acceleration:t.f(),airAcceleration:t.f(),waterAcceleration:t.f(),friction:t.f(),edgeFriction:t.f(),waterFriction:t.f(),entityGravity:t.f(),bounce:t.f(),stepSize:t.f(),maxVelocity:t.f(),zMax:t.f(),waveHeight:t.f(),footsteps:t.i(),skyName:t.nstr(32),rollAngle:t.f(),rollSpeed:t.f(),skyColor:[t.f(),t.f(),t.f()],skyVec:[t.f(),t.f(),t.f()]},n.view=[t.f(),t.f(),t.f()],n.viewModel=t.i(),n.incoming_sequence=t.i(),n.incoming_acknowledged=t.i(),n.incoming_reliable_acknowledged=t.i(),n.incoming_reliable_sequence=t.i(),n.outgoing_sequence=t.i(),n.reliable_sequence=t.i(),n.last_reliable_sequence=t.i();let e=t.ui()+t.tell();for(n.frameData=[];t.tell()<e;){let r=t.ub();if(1===r)continue;if(r>=64){u[r]&&u[r].size>-1?t.skip(u[r].size):t.skip(t.ub());continue}let a=o.FrameDataReader.read(t,r,s);a?(39===r&&(u[a.index]=a),n.frameData.push({type:r,frameData:a})):t.seek(e)}t.seek(e);break}case 2:break;case 3:n.command=t.nstr(64);break;case 4:n.clientData={position:[t.f(),t.f(),t.f()],rotation:[t.f(),t.f(),t.f()],weaponFlags:t.ui(),fov:t.f()};break;case 5:r=!0;break;case 6:n.event={flags:t.ui(),index:t.ui(),delay:t.f(),args:{flags:t.ui(),entityIndex:t.ui(),position:[t.f(),t.f(),t.f()],rotation:[t.f(),t.f(),t.f()],velocity:[t.f(),t.f(),t.f()],ducking:t.ui(),fparam1:t.f(),fparam2:t.f(),iparam1:t.i(),iparam2:t.i(),bparam1:t.i(),bparam2:t.i()}};break;case 7:n.weaponAnimation={animation:t.i(),body:t.i()};break;case 8:n.sound={channel:t.i(),sample:t.nstr(t.ui()),attenuation:t.f(),volume:t.f(),flags:t.ui(),pitch:t.i()};break;case 9:t.skip(t.ui());break;default:{const e=Number(t.tell()-9).toString(16),r=`Unexpected macro (${n.type}) at offset = ${e}`;throw new Error(r)}}a[e].macros.push(n)}}return new d(r,a)}static parseIntoChunks(e){let t=new i.Reader(e);if(!(e=>"HLDEMO"===e.nstr(8))(t))throw new Error("Invalid replay file format");let r,d,f,p,m,g=[],y=(0,l.getInitialDeltaDecoders)(),v=[],b=u(t),M=c(t,b.dirOffset),_=new s.ReplayState;for(m=M[0].offset+M[0].length,t.seek(M[0].offset);t.tell()<m;){let e=h(t,y,v);if(_.feedFrame(e),e.error)throw new Error("Encountered error while reading replay");if(e.type<2){let t=e.data.find((e=>e.type===o.FrameDataReader.SVC.SERVERINFO));t&&(r=new n.ReplayMap(t.data.mapFileName),g.push(r));let a=e.data.find((e=>e.type===o.FrameDataReader.SVC.RESOURCELIST));a&&r&&r.setResources(a.data)}}if(!(r instanceof n.ReplayMap))throw new Error("Error while parsing replay.");for(p=t.tell(),d=new a.ReplayChunk(_,0),r.addChunk(d),m=M[1].offset+M[1].length,t.seek(M[1].offset);;){let e=t.tell();if(e>=m){let r=f.time-d.startTime;d.timeLength=r;let n=e-p;t.seek(p),d.setData(t.arrx(n,i.ReaderDataType.UByte)),t.seek(e);break}let s=h(t,y,v);if(_.feedFrame(s),f=s,s.error)throw new Error("Encountered error while reading replay");if(s.type<2){let l=s.data.find((e=>e.type===o.FrameDataReader.SVC.SERVERINFO));if(l){r=new n.ReplayMap(l.data.mapFileName),g.push(r);let o=f.time-d.startTime;d.timeLength=o;let u=e-p,c=t.tell();t.seek(p),d.setData(t.arrx(u,i.ReaderDataType.UByte)),t.seek(c),p=e,d=new a.ReplayChunk(_,s.time),r.addChunk(d)}let u=s.data.find((e=>e.type===o.FrameDataReader.SVC.RESOURCELIST));if(u&&r.setResources(u.data),l)continue;for(let e=0;e<s.data.length;++e){let t=s.data[e];if(t.type===o.FrameDataReader.SVC.SOUND||t.type===o.FrameDataReader.SVC.SPAWNSTATICSOUND){let e=r.resources.sounds.find((e=>e.index===t.data.soundIndex));e&&(e.used=!0)}else if(t.type===o.FrameDataReader.SVC.STUFFTEXT){let e=r.resources.sounds,n=t.data.commands;for(let t=0;t<n.length;++t){let r=n[t],a=r.func;if(("speak"===a||"spk"===a)&&1===r.params.length){let t=r.params[0]+".wav",n=e.find((e=>e.name===t));n&&(n.used=!0)}}}}}else if(8===s.type){let e=r.resources.sounds.find((e=>e.name===s.sound.sample));e&&(e.used=!0)}if(d.startTime+10<s.time){let n=e-p,o=t.tell();t.seek(p),d.setData(t.arrx(n,i.ReaderDataType.UByte)),t.seek(o),p=e,d=new a.ReplayChunk(_,s.time),r.addChunk(d)}}return{length:M[1].time,maps:g,deltaDecoders:y,customMessages:v}}static readHeader(e){return u(e)}static readDirectories(e,t){return c(e,t)}static readFrame(e,t,r){return h(e,t,r)}static readFrameData(e,t,r){return h(e,t,r)}}t.Replay=d},5470:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ReplayChunk=void 0;const n=r(8529);t.ReplayChunk=class{constructor(e,t){this.state=e.clone(),this.startTime=t,this.timeLength=10,this.data=null,this.reader=null}setData(e){this.data=new Uint8Array(e.length);for(let t=0;t<e.length;++t)this.data[t]=e[t];this.reader=new n.Reader(this.data.buffer)}}},605:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ReplayMap=void 0;const n=r(2130);t.ReplayMap=class{constructor(e){this.name=(0,n.basename)(e,".bsp"),this.chunks=[],this.resources={sounds:[],skins:[],models:[],decals:[],custom:[],events:[]}}setResources(e){e.forEach((e=>{switch(e.type){case 0:e.used=!1,this.resources.sounds.push(e);break;case 1:this.resources.skins.push(e);break;case 2:this.resources.models.push(e);break;case 3:this.resources.decals.push(e);break;case 4:this.resources.custom.push(e);break;case 5:this.resources.events.push(e)}}))}addChunk(e){this.chunks.push(e)}}},7022:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ReplayState=void 0;class r{constructor(e=null){e?(this.cameraPos=JSON.parse(JSON.stringify(e.cameraPos)),this.cameraRot=JSON.parse(JSON.stringify(e.cameraRot)),this.entities=JSON.parse(JSON.stringify(e.entities))):(this.cameraPos=[0,0,0],this.cameraRot=[0,0,0],this.entities=[])}feedFrame(e){switch(e.type){case 0:case 1:this.cameraPos[0]=e.camera.position[0],this.cameraPos[1]=e.camera.position[1],this.cameraPos[2]=e.camera.position[2],this.cameraRot[0]=e.camera.orientation[0],this.cameraRot[1]=e.camera.orientation[1],this.cameraRot[2]=e.camera.orientation[2]}}clone(){return new r(this)}}t.ReplayState=r},6231:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.readCoord=function(e){let t=e.readBits(1),r=e.readBits(1);if(!t&&!r)return 0;let n=e.readBits(1),a=0,s=0;t&&(a=e.readBits(12));r&&(s=e.readBits(3));let i=a+s/32;n&&(i=-i);return i}},1752:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getInitialDeltaDecoders=void 0,t.readDelta=function(e,t){let r={},a=e.readBits(3),s=[];for(let t=0;t<a;++t)s.push(e.readBits(8));let i=!1;for(let o=0;o<a;++o){for(let a=0;a<8;++a){let l=a+8*o;if(l===t.length){i=!0;break}if(s[o]&1<<a)if(t[l].flags&n.DeltaType.DT_BYTE)if(t[l].flags&n.DeltaType.DT_SIGNED){let n=e.readBits(1)?-1:1,a=e.readBits(t[l].bits-1),s=t[l].divisor;r[t[l].name]=n*a/s}else{let n=e.readBits(t[l].bits),a=t[l].divisor;r[t[l].name]=n/a}else if(t[l].flags&n.DeltaType.DT_SHORT)if(t[l].flags&n.DeltaType.DT_SIGNED){let n=e.readBits(1)?-1:1,a=e.readBits(t[l].bits-1),s=t[l].divisor;r[t[l].name]=n*a/s}else{let n=e.readBits(t[l].bits),a=t[l].divisor;r[t[l].name]=n/a}else if(t[l].flags&n.DeltaType.DT_INTEGER)if(t[l].flags&n.DeltaType.DT_SIGNED){let n=e.readBits(1)?-1:1,a=e.readBits(t[l].bits-1),s=t[l].divisor;r[t[l].name]=n*a/s}else{let n=e.readBits(t[l].bits),a=t[l].divisor;r[t[l].name]=n/a}else if(t[l].flags&n.DeltaType.DT_FLOAT||t[l].flags&n.DeltaType.DT_TIMEWINDOW_8||t[l].flags&n.DeltaType.DT_TIMEWINDOW_BIG)if(t[l].flags&n.DeltaType.DT_SIGNED){let n=e.readBits(1)?-1:1,a=e.readBits(t[l].bits-1),s=t[l].divisor;r[t[l].name]=n*a/s}else{let n=e.readBits(t[l].bits),a=t[l].divisor;r[t[l].name]=n/a}else if(t[l].flags&n.DeltaType.DT_ANGLE){let n=e.readBits(t[l].bits),a=360/(1<<t[l].bits);r[t[l].name]=n*a}else t[l].flags&n.DeltaType.DT_STRING&&(r[t[l].name]=e.readString())}if(i)break}return r};const n=r(4080);const a={delta_description_t:[{name:"flags",bits:32,divisor:1,flags:n.DeltaType.DT_INTEGER},{name:"name",bits:8,divisor:1,flags:n.DeltaType.DT_STRING},{name:"offset",bits:16,divisor:1,flags:n.DeltaType.DT_INTEGER},{name:"size",bits:8,divisor:1,flags:n.DeltaType.DT_INTEGER},{name:"bits",bits:8,divisor:1,flags:n.DeltaType.DT_INTEGER},{name:"divisor",bits:32,divisor:4e3,flags:n.DeltaType.DT_FLOAT},{name:"preMultiplier",bits:32,divisor:4e3,flags:n.DeltaType.DT_FLOAT}]};t.getInitialDeltaDecoders=()=>Object.assign({},a)},8372:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ReplayPlayer=void 0;const n=r(1961),a=r(9431),s=r(9163),i=r(7022),o=(e,t)=>{e.camera.position[0]=t.cameraPos[0],e.camera.position[1]=t.cameraPos[1],e.camera.position[2]=t.cameraPos[2],e.camera.rotation[0]=n.glMatrix.toRadian(t.cameraRot[0]),e.camera.rotation[1]=n.glMatrix.toRadian(t.cameraRot[1]),e.camera.rotation[2]=n.glMatrix.toRadian(t.cameraRot[2])};t.ReplayPlayer=class{constructor(e){this.currentMap=0,this.currentChunk=0,this.currentTime=0,this.currentTick=0,this.isPlaying=!1,this.isPaused=!1,this.speed=1,this.reset(),this.game=e,this.state=new i.ReplayState,this.replay=null,this.events=(0,a.createNanoEvents)()}reset(){if(this.currentMap=0,this.currentChunk=0,this.currentTime=0,this.currentTick=0,this.isPlaying=!1,this.isPaused=!1,this.speed=1,this.replay){let e=this.replay.maps[0].chunks[0];e.reader.seek(0),this.state=e.state.clone()}}changeReplay(e){this.replay=e,this.reset()}play(){this.isPlaying?this.isPaused&&(this.isPaused=!1):this.isPlaying=!0,this.events.emit("play")}pause(){this.isPlaying&&(this.isPaused=!0),this.events.emit("pause")}stop(){this.reset(),this.events.emit("stop")}speedUp(){this.speed=Math.min(2*this.speed,4)}speedDown(){this.speed=Math.max(this.speed/2,.25)}seek(e){let t=Math.max(0,Math.min(this.replay.length,e)),r=this.replay.maps;for(let e=0;e<r.length;++e){let n=r[e].chunks;for(let r=0;r<n.length;++r){let a=n[r],i=a.startTime,l=i+a.timeLength;if(t>=i&&t<l){this.currentMap=e,this.currentChunk=r,this.currentTime=t,this.state=a.state.clone();let n=this.replay.deltaDecoders,i=this.replay.customMessages,l=a.reader;for(l.seek(0);;){let e=l.tell(),r=s.Replay.readFrame(l,n,i);if(!(r.time<=t)){l.seek(e);break}this.state.feedFrame(r),this.currentTick=r.tick}return void o(this.game,this.state)}}}}seekByPercent(e){e=Math.max(0,Math.min(e,100))/100,e*=this.replay.length,this.seek(e)}update(e){if(!this.isPlaying||this.isPaused)return;let t=this.replay.deltaDecoders,r=this.replay.customMessages,n=this.replay.maps[this.currentMap],a=n.chunks[this.currentChunk],i=a.reader,l=this.currentTime+e*this.speed,u=!1;for(;;){let e=i.tell();if(e>=a.data.length){if(this.currentChunk===n.chunks.length-1){if(this.currentMap===this.replay.maps.length-1){u=!0;break}this.currentChunk=0,this.currentMap++,n=this.replay.maps[this.currentMap],a=n.chunks[this.currentChunk]}else this.currentChunk++,a=n.chunks[this.currentChunk];i=a.reader,i.seek(0),e=0;continue}let o=this.game.sounds,c=s.Replay.readFrame(i,t,r);if(c.type<2)for(let e=0;e<c.data.length;++e){let t=c.data[e];if(6===t.type){let e=t.data,r=o.find((t=>t.index===e.soundIndex));if(r&&"common/null.wav"!==r.name){let t=e.channel,n=e.volume;this.game.soundSystem.play(r,t,n)}}else if(29===t.type){let e=t.data,r=o.find((t=>t.index===e.soundIndex));r&&r.name}else 9===t.type&&t.data.commands.forEach((e=>{switch(e.func){case"speak":case"spk":case"play":{let t=e.params[0]+".wav",r=o.find((e=>e.name===t));if(!r)return;this.game.soundSystem.play(r,1,.7);break}case"playvol":{let t,r=e.params[0]+".wav";t=isNaN(e.params[1])?1:parseFloat(e.params[1]);let n=o.find((e=>e.name===r));if(!n)return;this.game.soundSystem.play(n,1,t);break}}}))}else if(8===c.type){let e=c.sound.sample,t=o.find((t=>t.name===e));if(t&&"common/null.wav"!==t.name){let e=c.sound.channel,r=c.sound.volume;this.game.soundSystem.play(t,e,r)}}if(!(c.time<=l)){i.seek(e);break}this.state.feedFrame(c),this.currentTick=c.tick}o(this.game,this.state),this.currentTime=l,u&&this.stop()}}},2847:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Sound=void 0;const n=r(9694);class a{constructor(e){this.index=-1,this.name="",this.buffer=e}static create(e){return new Promise(((t,r)=>{n.SoundSystem.getContext().decodeAudioData(e,(e=>{t(new a(e))}),(e=>{r(e)}))}))}}t.Sound=a},9694:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SoundSystem=void 0;const n=r(9431),a=window,s=new(a.AudioContext||a.webkitAudioContext);t.SoundSystem=class{constructor(){this.context=s,this.events=(0,n.createNanoEvents)();const e=parseFloat(localStorage.getItem("volume")||"0.3");localStorage.setItem("volume",e.toString()),this.channels=[],this.preMuteVolume=1,this.masterGain=this.context.createGain(),this.masterGain.gain.value=e,this.masterGain.connect(this.context.destination);for(let e=0;e<8;++e)this.channels.push({source:null,gain:this.context.createGain()}),this.channels[e].gain.connect(this.masterGain)}static getContext(){return s}play(e,t,r){this.stop(t);const n=this.channels[t].gain;n.gain.value=Math.max(0,Math.min(1,r));const a=this.context.createBufferSource();a.buffer=e.buffer,a.connect(n),a.start(0),this.channels[t].source=a}stop(e){const t=this.channels[e].source;t&&t.stop(0)}getVolume(){return this.masterGain.gain.value}setVolume(e){const t=this.masterGain.gain.value;t>0&&0===e&&(this.preMuteVolume=t),this.masterGain.gain.value=e,localStorage.setItem("volume",e.toString()),this.events.emit("volumeChange",e)}toggleMute(){0===this.getVolume()?this.setVolume(this.preMuteVolume):this.setVolume(0)}}},4343:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.formatTime=t.now=void 0;const r=window;let n;"undefined"!=typeof performance&&(performance.now()?n=()=>r.performance.now():r.performance.mozNow?n=()=>r.performance.mozNow():r.performance.msNow?n=()=>r.performance.msNow():r.performance.oNow?n=()=>r.performance.oNow():r.performance.webkitNow?n=()=>r.performance.webkitNow():Date.now&&(n=()=>Date.now())),t.now=n||(()=>(new Date).getTime());t.formatTime=e=>{const t=Math.floor(e/60),r=Math.floor(e-60*t);return(t<10?"0"+t:t.toString())+":"+(r<10?"0"+r:r.toString())}},2130:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.basename=function(e,t){return e.slice(e.lastIndexOf("/")+1).replace(t||"","")},t.extname=function(e){const t=e.lastIndexOf("/"),r=e.lastIndexOf(".");return t<r?e.slice(r):""}},6566:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.xhr=function(e,t){let r=t.method||"GET",n=t.isBinary,a=t.progressCallback;if(!e)throw new Error("Url parameter missing");return new Promise(((t,s)=>{let i=new XMLHttpRequest;n&&(i.responseType="arraybuffer"),n&&a&&i.addEventListener("progress",(e=>{if(e.lengthComputable)a(i,e.loaded/e.total);else{let t=i.getResponseHeader("content-length"),r=0;t&&(r=parseFloat(t));let n=i.getResponseHeader("content-encoding");if(r&&n&&n.indexOf("gzip")>-1){r*=4;let t=Math.min(.99,e.loaded/r);a(i,t)}else a(i,0)}})),i.addEventListener("readystatechange",(e=>{4===e.target.readyState&&(200===e.target.status?(a&&a(i,1),t(e.target.response)):s({status:e.target.status}))})),i.open(r,e,!0),i.send()}))}},8156:(e,t,r)=>{"use strict";const n=r(7484),a=r(4932),s=r(9849);class i{constructor(e){this.game=e}load(e){this.game.load(e)}setTitle(e){this.game.setTitle(e)}getTitle(){return this.game.getTitle()}}var o;i.VERSION="0.7.5",function(e){e.init=function(e,t){const r=document.querySelector(e);if(!r)return null;const o=a.Config.init(t),l=n.Game.init(o);if("success"===l.status){const e=l.game;return new s.PlayerInterface(e,r).draw(),e.draw(),new i(e)}return null}}(o||(o={})),e.exports=o},682:(e,t,r)=>{"use strict";r.r(t),r.d(t,{TypeStyle:()=>R,classes:()=>x,createTypeStyle:()=>V,cssRaw:()=>P,cssRule:()=>C,extend:()=>T,fontFace:()=>D,forceRenderStyles:()=>L,getStyles:()=>F,keyframes:()=>N,media:()=>S,reinit:()=>O,setStylesTarget:()=>A,style:()=>U,stylesheet:()=>B,types:()=>k});let n=0;const a=Object.create(null),s=["animation-iteration-count","border-image-outset","border-image-slice","border-image-width","box-flex","box-flex-group","box-ordinal-group","column-count","columns","counter-increment","counter-reset","flex","flex-grow","flex-positive","flex-shrink","flex-negative","flex-order","font-weight","grid-area","grid-column","grid-column-end","grid-column-span","grid-column-start","grid-row","grid-row-end","grid-row-span","grid-row-start","line-clamp","line-height","opacity","order","orphans","tab-size","widows","z-index","zoom","fill-opacity","flood-opacity","stop-opacity","stroke-dasharray","stroke-dashoffset","stroke-miterlimit","stroke-opacity","stroke-width"];for(const e of s)for(const t of["-webkit-","-ms-","-moz-","-o-",""])a[t+e]=!0;function i(e,t){return t&&"number"==typeof t&&!a[e]?`${e}:${t}px`:`${e}:${t}`}function o(e){return e.sort(((e,t)=>e[0]>t[0]?1:-1))}function l(e){return e.map((([e,t])=>Array.isArray(t)?t.map((t=>i(e,t))).join(";"):i(e,t))).join(";")}function u(e,t){return-1===e.indexOf("&")?`${t} ${e}`:e.replace(/&/g,t)}function c(e,t,r,n,a){const{style:s,nested:i,isUnique:h}=function(e,t){const r=[],n=[];for(const t of Object.keys(e)){const s=t.trim(),i=e[t];36!==s.charCodeAt(0)&&null!=i&&("object"!=typeof i||Array.isArray(i)?r.push([(a=s,a.replace(/[A-Z]/g,(e=>`-${e.toLowerCase()}`)).replace(/^ms-/,"-ms-")),i]):n.push([s,i]))}var a;return{style:l(o(r)),nested:t?n:o(n),isUnique:!!e.$unique}}(t,""!==e);let d=s;if(64===e.charCodeAt(0)){const t={selector:e,styles:[],rules:[],style:a?"":s};r.push(t),s&&a&&t.styles.push({selector:a,style:s,isUnique:h});for(const[e,r]of i)d+=e+c(e,r,t.rules,t.styles,a)}else{const t=a?u(e,a):e;s&&n.push({selector:t,style:s,isUnique:h});for(const[e,a]of i)d+=e+c(e,a,r,n,t)}return d}function h(e,t,r,a,s,i){for(const{selector:r,style:o,isUnique:l}of a){const a=i?u(r,s):r,c=l?`u\0${(++n).toString(36)}`:`s\0${t}\0${o}`,h=new g(o,c);h.add(new m(a,`k\0${t}\0${a}`)),e.add(h)}for(const{selector:n,style:a,rules:o,styles:l}of r){const r=new y(n,a,`r\0${t}\0${n}\0${a}`);h(r,t,o,l,s,i),e.add(r)}}function d(e){let t="";for(let r=0;r<e.length;r++)t+=e[r];return t}const f={add:()=>{},change:()=>{},remove:()=>{}};class p{constructor(e=f){this.changes=e,this.sheet=[],this.changeId=0,this._keys=[],this._children=Object.create(null),this._counters=Object.create(null)}add(e){const t=this._counters[e.id]||0,r=this._children[e.id]||e.clone();if(this._counters[e.id]=t+1,0===t)this._children[r.id]=r,this._keys.push(r.id),this.sheet.push(r.getStyles()),this.changeId++,this.changes.add(r,this._keys.length-1);else if(r instanceof p&&e instanceof p){const t=this._keys.indexOf(e.id),n=r.changeId;r.merge(e),r.changeId!==n&&(this.sheet.splice(t,1,r.getStyles()),this.changeId++,this.changes.change(r,t,t))}}remove(e){const t=this._counters[e.id];if(t){this._counters[e.id]=t-1;const r=this._children[e.id],n=this._keys.indexOf(r.id);if(1===t)delete this._counters[e.id],delete this._children[e.id],this._keys.splice(n,1),this.sheet.splice(n,1),this.changeId++,this.changes.remove(r,n);else if(r instanceof p&&e instanceof p){const t=r.changeId;r.unmerge(e),r.changeId!==t&&(this.sheet.splice(n,1,r.getStyles()),this.changeId++,this.changes.change(r,n,n))}}}values(){return this._keys.map((e=>this._children[e]))}merge(e){for(const t of e.values())this.add(t);return this}unmerge(e){for(const t of e.values())this.remove(t);return this}clone(){return(new p).merge(this)}}class m{constructor(e,t){this.selector=e,this.id=t}getStyles(){return this.selector}clone(){return this}}class g extends p{constructor(e,t){super(),this.style=e,this.id=t}getStyles(){return`${this.sheet.join(",")}{${this.style}}`}clone(){return new g(this.style,this.id).merge(this)}}class y extends p{constructor(e,t,r){super(),this.rule=e,this.style=t,this.id=r}getStyles(){return`${this.rule}{${this.style}${d(this.sheet)}}`}clone(){return new y(this.rule,this.style,this.id).merge(this)}}function v(e,t){const r=`f${function(e){let t=5381,r=e.length;for(;r--;)t=33*t^e.charCodeAt(r);return(t>>>0).toString(36)}(e)}`;return r}class b extends p{constructor(e,t){super(t),this.id=e}registerStyle(e){const t=[],r=[],n=c("&",e,t,r),a=v(n);return h(this,n,t,r,`.${a}`,!0),a}registerKeyframes(e){return this.registerHashRule("@keyframes",e)}registerHashRule(e,t){const r=[],n=[],a=c("",t,r,n),s=v(a),i=new y(`${e} ${s}`,"",`h\0${a}\0${e}`);return h(i,a,r,n,"",!1),this.add(i),s}registerRule(e,t){const r=[],n=[];h(this,c(e,t,r,n),r,n,"",!1)}registerCss(e){return this.registerRule("",e)}getStyles(){return d(this.sheet)}clone(){return new b(this.id,this.changes).merge(this)}}function M(e){var t={};for(var r in e){var n=e[r];if("$nest"===r){var a=n;for(var s in a){var i=a[s];t[s]=M(i)}}else"$debugName"===r?t.$displayName=n:t[r]=n}return t}var _="undefined"==typeof requestAnimationFrame?function(e){return setTimeout(e)}:"undefined"==typeof window?requestAnimationFrame:requestAnimationFrame.bind(window);function x(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return e.map((function(e){return e&&"object"==typeof e?Object.keys(e).map((function(t){return!!e[t]&&t})):[e]})).reduce((function(e,t){return e.concat(t)}),[]).filter((function(e){return!!e})).join(" ")}function T(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];for(var r={},n=0,a=e;n<a.length;n++){var s=a[n];if(null!=s&&!1!==s)for(var i in s){var o=s[i];(o||0===o)&&("$nest"===i&&o?r[i]=r.$nest?T(r.$nest,o):o:-1!==i.indexOf("&")||0===i.indexOf("@media")?r[i]=r[i]?T(r[i],o):o:r[i]=o)}}return r}var S=function(e){for(var t,r=[],n=1;n<arguments.length;n++)r[n-1]=arguments[n];var a=[];return e.type&&a.push(e.type),e.orientation&&a.push("(orientation: "+e.orientation+")"),e.minWidth&&a.push("(min-width: "+E(e.minWidth)+")"),e.maxWidth&&a.push("(max-width: "+E(e.maxWidth)+")"),e.minHeight&&a.push("(min-height: "+E(e.minHeight)+")"),e.maxHeight&&a.push("(max-height: "+E(e.maxHeight)+")"),e.prefersColorScheme&&a.push("(prefers-color-scheme: "+e.prefersColorScheme+")"),{$nest:(t={},t["@media "+a.join(" and ")]=T.apply(void 0,r),t)}},E=function(e){return"string"==typeof e?e:e+"px"},w=function(){return new b(`f${(++n).toString(36)}`,e);var e},R=function(){function e(e){var t=this,r=e.autoGenerateTag;this.cssRaw=function(e){e&&(t._raw+=e||"",t._pendingRawChange=!0,t._styleUpdated())},this.cssRule=function(e){for(var r=[],n=1;n<arguments.length;n++)r[n-1]=arguments[n];var a=M(T.apply(void 0,r));t._freeStyle.registerRule(e,a),t._styleUpdated()},this.forceRenderStyles=function(){var e=t._getTag();e&&(e.textContent=t.getStyles())},this.fontFace=function(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];for(var n=t._freeStyle,a=0,s=e;a<s.length;a++){var i=s[a];n.registerRule("@font-face",i)}t._styleUpdated()},this.getStyles=function(){return(t._raw||"")+t._freeStyle.getStyles()},this.keyframes=function(e){var r=function(e){var t={};for(var r in e)"$debugName"!==r&&(t[r]=e[r]);return e.$debugName&&(t.$displayName=e.$debugName),t}(e),n=t._freeStyle.registerKeyframes(r);return t._styleUpdated(),n},this.reinit=function(){var e=w();t._freeStyle=e,t._lastFreeStyleChangeId=e.changeId,t._raw="",t._pendingRawChange=!1;var r=t._getTag();r&&(r.textContent="")},this.setStylesTarget=function(e){t._tag&&(t._tag.textContent=""),t._tag=e,t.forceRenderStyles()},this.stylesheet=function(e){for(var r={},n=0,a=Object.getOwnPropertyNames(e);n<a.length;n++){var s=a[n],i=e[s];i&&(i.$debugName=s,r[s]=t.style(i))}return r};var n=w();this._autoGenerateTag=r,this._freeStyle=n,this._lastFreeStyleChangeId=n.changeId,this._pending=0,this._pendingRawChange=!1,this._raw="",this._tag=void 0,this.style=this.style.bind(this)}return e.prototype._afterAllSync=function(e){var t=this;this._pending++;var r=this._pending;_((function(){r===t._pending&&e()}))},e.prototype._getTag=function(){if(this._tag)return this._tag;if(this._autoGenerateTag){var e="undefined"==typeof window?{textContent:""}:document.createElement("style");return"undefined"!=typeof document&&document.head.appendChild(e),this._tag=e,e}},e.prototype._styleUpdated=function(){var e=this,t=this._freeStyle.changeId,r=this._lastFreeStyleChangeId;(this._pendingRawChange||t!==r)&&(this._lastFreeStyleChangeId=t,this._pendingRawChange=!1,this._afterAllSync((function(){return e.forceRenderStyles()})))},e.prototype.style=function(){var e=this._freeStyle.registerStyle(M(T.apply(void 0,arguments)));return this._styleUpdated(),e},e}(),k=r(2385),I=new R({autoGenerateTag:!0}),A=I.setStylesTarget,P=I.cssRaw,C=I.cssRule,L=I.forceRenderStyles,D=I.fontFace,F=I.getStyles,N=I.keyframes,O=I.reinit,U=I.style,B=I.stylesheet;function V(e){var t=new R({autoGenerateTag:!1});return e&&t.setStylesTarget(e),t}},2385:()=>{},9431:(e,t,r)=>{"use strict";r.r(t),r.d(t,{createNanoEvents:()=>n});let n=()=>({emit(e,...t){for(let r=0,n=this.events[e]||[],a=n.length;r<a;r++)n[r](...t)},events:{},on(e,t){return(this.events[e]||=[]).push(t),()=>{this.events[e]=this.events[e]?.filter((e=>t!==e))}}})}},t={};function r(n){var a=t[n];if(void 0!==a)return a.exports;var s=t[n]={exports:{}};return e[n].call(s.exports,s,s.exports,r),s.exports}return r.d=(e,t)=>{for(var n in t)r.o(t,n)&&!r.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r(8156)})()));
//# sourceMappingURL=hlviewer.min.js.map