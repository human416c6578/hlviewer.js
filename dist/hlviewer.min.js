/*! For license information please see hlviewer.min.js.LICENSE.txt */
!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.HLViewer=t():e.HLViewer=t()}(self,(()=>(()=>{var e={1961:(e,t,r)=>{"use strict";r.r(t),r.d(t,{glMatrix:()=>s,mat2:()=>n,mat2d:()=>a,mat3:()=>i,mat4:()=>o,quat:()=>u,quat2:()=>h,vec2:()=>d,vec3:()=>l,vec4:()=>c});var s={};r.r(s),r.d(s,{ARRAY_TYPE:()=>p,EPSILON:()=>f,RANDOM:()=>m,equals:()=>b,setMatrixArrayType:()=>g,toRadian:()=>v});var n={};r.r(n),r.d(n,{LDU:()=>O,add:()=>B,adjoint:()=>k,clone:()=>M,copy:()=>x,create:()=>_,determinant:()=>I,equals:()=>G,exactEquals:()=>V,frob:()=>N,fromRotation:()=>L,fromScaling:()=>D,fromValues:()=>T,identity:()=>S,invert:()=>R,mul:()=>W,multiply:()=>P,multiplyScalar:()=>j,multiplyScalarAndAdd:()=>X,rotate:()=>A,scale:()=>C,set:()=>E,str:()=>F,sub:()=>H,subtract:()=>U,transpose:()=>w});var a={};r.r(a),r.d(a,{add:()=>ce,clone:()=>$,copy:()=>z,create:()=>q,determinant:()=>J,equals:()=>pe,exactEquals:()=>fe,frob:()=>le,fromRotation:()=>ne,fromScaling:()=>ae,fromTranslation:()=>ie,fromValues:()=>K,identity:()=>Y,invert:()=>Q,mul:()=>me,multiply:()=>ee,multiplyScalar:()=>he,multiplyScalarAndAdd:()=>de,rotate:()=>te,scale:()=>re,set:()=>Z,str:()=>oe,sub:()=>ge,subtract:()=>ue,translate:()=>se});var i={};r.r(i),r.d(i,{add:()=>Ge,adjoint:()=>we,clone:()=>be,copy:()=>_e,create:()=>ye,determinant:()=>Re,equals:()=>qe,exactEquals:()=>He,frob:()=>Ve,fromMat2d:()=>Fe,fromMat4:()=>ve,fromQuat:()=>Ne,fromRotation:()=>Le,fromScaling:()=>De,fromTranslation:()=>Ce,fromValues:()=>Me,identity:()=>Se,invert:()=>Ee,mul:()=>$e,multiply:()=>ke,multiplyScalar:()=>Xe,multiplyScalarAndAdd:()=>We,normalFromMat4:()=>Oe,projection:()=>Be,rotate:()=>Pe,scale:()=>Ae,set:()=>xe,str:()=>Ue,sub:()=>ze,subtract:()=>je,translate:()=>Ie,transpose:()=>Te});var o={};r.r(o),r.d(o,{add:()=>Bt,adjoint:()=>st,clone:()=>Ke,copy:()=>Ze,create:()=>Ye,determinant:()=>nt,equals:()=>Xt,exactEquals:()=>jt,frob:()=>Ot,fromQuat:()=>Et,fromQuat2:()=>bt,fromRotation:()=>pt,fromRotationTranslation:()=>vt,fromRotationTranslationScale:()=>St,fromRotationTranslationScaleOrigin:()=>Tt,fromScaling:()=>ft,fromTranslation:()=>dt,fromValues:()=>Qe,fromXRotation:()=>mt,fromYRotation:()=>gt,fromZRotation:()=>yt,frustum:()=>wt,getRotation:()=>xt,getScaling:()=>Mt,getTranslation:()=>_t,identity:()=>et,invert:()=>rt,lookAt:()=>Dt,mul:()=>Wt,multiply:()=>at,multiplyScalar:()=>Vt,multiplyScalarAndAdd:()=>Gt,ortho:()=>Ct,orthoNO:()=>At,orthoZO:()=>Lt,perspective:()=>kt,perspectiveFromFieldOfView:()=>Pt,perspectiveNO:()=>Rt,perspectiveZO:()=>It,rotate:()=>lt,rotateX:()=>ct,rotateY:()=>ut,rotateZ:()=>ht,scale:()=>ot,set:()=>Je,str:()=>Nt,sub:()=>Ht,subtract:()=>Ut,targetTo:()=>Ft,translate:()=>it,transpose:()=>tt});var l={};r.r(l),r.d(l,{add:()=>Qt,angle:()=>Rr,bezier:()=>br,ceil:()=>rr,clone:()=>$t,copy:()=>Kt,create:()=>qt,cross:()=>gr,dist:()=>Nr,distance:()=>cr,div:()=>Fr,divide:()=>tr,dot:()=>mr,equals:()=>Ar,exactEquals:()=>Pr,floor:()=>sr,forEach:()=>Vr,fromValues:()=>Yt,hermite:()=>vr,inverse:()=>fr,len:()=>Br,length:()=>zt,lerp:()=>yr,max:()=>ar,min:()=>nr,mul:()=>Dr,multiply:()=>er,negate:()=>dr,normalize:()=>pr,random:()=>_r,rotateX:()=>Tr,rotateY:()=>Er,rotateZ:()=>wr,round:()=>ir,scale:()=>or,scaleAndAdd:()=>lr,set:()=>Zt,sqrDist:()=>Or,sqrLen:()=>Ur,squaredDistance:()=>ur,squaredLength:()=>hr,str:()=>Ir,sub:()=>Lr,subtract:()=>Jt,transformMat3:()=>xr,transformMat4:()=>Mr,transformQuat:()=>Sr,zero:()=>kr});var c={};r.r(c),r.d(c,{add:()=>qr,ceil:()=>Kr,clone:()=>jr,copy:()=>Wr,create:()=>Gr,cross:()=>hs,dist:()=>Ss,distance:()=>ss,div:()=>xs,divide:()=>Yr,dot:()=>us,equals:()=>bs,exactEquals:()=>vs,floor:()=>Zr,forEach:()=>Rs,fromValues:()=>Xr,inverse:()=>ls,len:()=>Es,length:()=>as,lerp:()=>ds,max:()=>Jr,min:()=>Qr,mul:()=>Ms,multiply:()=>zr,negate:()=>os,normalize:()=>cs,random:()=>fs,round:()=>es,scale:()=>ts,scaleAndAdd:()=>rs,set:()=>Hr,sqrDist:()=>Ts,sqrLen:()=>ws,squaredDistance:()=>ns,squaredLength:()=>is,str:()=>ys,sub:()=>_s,subtract:()=>$r,transformMat4:()=>ps,transformQuat:()=>ms,zero:()=>gs});var u={};r.r(u),r.d(u,{add:()=>nn,calculateW:()=>Os,clone:()=>en,conjugate:()=>Ws,copy:()=>rn,create:()=>ks,dot:()=>ln,equals:()=>gn,exactEquals:()=>mn,exp:()=>Bs,fromEuler:()=>qs,fromMat3:()=>Hs,fromValues:()=>tn,getAngle:()=>Cs,getAxisAngle:()=>As,identity:()=>Is,invert:()=>Xs,len:()=>hn,length:()=>un,lerp:()=>cn,ln:()=>Us,mul:()=>an,multiply:()=>Ls,normalize:()=>pn,pow:()=>Vs,random:()=>js,rotateX:()=>Ds,rotateY:()=>Fs,rotateZ:()=>Ns,rotationTo:()=>yn,scale:()=>on,set:()=>sn,setAxes:()=>bn,setAxisAngle:()=>Ps,slerp:()=>Gs,sqlerp:()=>vn,sqrLen:()=>fn,squaredLength:()=>dn,str:()=>$s});var h={};r.r(h),r.d(h,{add:()=>Xn,clone:()=>Mn,conjugate:()=>Kn,copy:()=>kn,create:()=>_n,dot:()=>$n,equals:()=>na,exactEquals:()=>sa,fromMat4:()=>Rn,fromRotation:()=>wn,fromRotationTranslation:()=>Tn,fromRotationTranslationValues:()=>Sn,fromTranslation:()=>En,fromValues:()=>xn,getDual:()=>Cn,getReal:()=>An,getTranslation:()=>Fn,identity:()=>In,invert:()=>Yn,len:()=>Qn,length:()=>Zn,lerp:()=>zn,mul:()=>Hn,multiply:()=>Wn,normalize:()=>ta,rotateAroundAxis:()=>jn,rotateByQuatAppend:()=>Vn,rotateByQuatPrepend:()=>Gn,rotateX:()=>On,rotateY:()=>Bn,rotateZ:()=>Un,scale:()=>qn,set:()=>Pn,setDual:()=>Dn,setReal:()=>Ln,sqrLen:()=>ea,squaredLength:()=>Jn,str:()=>ra,translate:()=>Nn});var d={};r.r(d),r.d(d,{add:()=>ua,angle:()=>Oa,ceil:()=>pa,clone:()=>ia,copy:()=>la,create:()=>aa,cross:()=>Ia,dist:()=>qa,distance:()=>Ma,div:()=>Ha,divide:()=>fa,dot:()=>ka,equals:()=>Ga,exactEquals:()=>Va,floor:()=>ma,forEach:()=>Ya,fromValues:()=>oa,inverse:()=>wa,len:()=>ja,length:()=>Sa,lerp:()=>Pa,max:()=>ya,min:()=>ga,mul:()=>Wa,multiply:()=>da,negate:()=>Ea,normalize:()=>Ra,random:()=>Aa,rotate:()=>Na,round:()=>va,scale:()=>ba,scaleAndAdd:()=>_a,set:()=>ca,sqrDist:()=>$a,sqrLen:()=>za,squaredDistance:()=>xa,squaredLength:()=>Ta,str:()=>Ua,sub:()=>Xa,subtract:()=>ha,transformMat2:()=>Ca,transformMat2d:()=>La,transformMat3:()=>Da,transformMat4:()=>Fa,zero:()=>Ba});var f=1e-6,p="undefined"!=typeof Float32Array?Float32Array:Array,m=Math.random;function g(e){p=e}var y=Math.PI/180;function v(e){return e*y}function b(e,t){return Math.abs(e-t)<=f*Math.max(1,Math.abs(e),Math.abs(t))}function _(){var e=new p(4);return p!=Float32Array&&(e[1]=0,e[2]=0),e[0]=1,e[3]=1,e}function M(e){var t=new p(4);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t}function x(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e}function S(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e}function T(e,t,r,s){var n=new p(4);return n[0]=e,n[1]=t,n[2]=r,n[3]=s,n}function E(e,t,r,s,n){return e[0]=t,e[1]=r,e[2]=s,e[3]=n,e}function w(e,t){if(e===t){var r=t[1];e[1]=t[2],e[2]=r}else e[0]=t[0],e[1]=t[2],e[2]=t[1],e[3]=t[3];return e}function R(e,t){var r=t[0],s=t[1],n=t[2],a=t[3],i=r*a-n*s;return i?(i=1/i,e[0]=a*i,e[1]=-s*i,e[2]=-n*i,e[3]=r*i,e):null}function k(e,t){var r=t[0];return e[0]=t[3],e[1]=-t[1],e[2]=-t[2],e[3]=r,e}function I(e){return e[0]*e[3]-e[2]*e[1]}function P(e,t,r){var s=t[0],n=t[1],a=t[2],i=t[3],o=r[0],l=r[1],c=r[2],u=r[3];return e[0]=s*o+a*l,e[1]=n*o+i*l,e[2]=s*c+a*u,e[3]=n*c+i*u,e}function A(e,t,r){var s=t[0],n=t[1],a=t[2],i=t[3],o=Math.sin(r),l=Math.cos(r);return e[0]=s*l+a*o,e[1]=n*l+i*o,e[2]=s*-o+a*l,e[3]=n*-o+i*l,e}function C(e,t,r){var s=t[0],n=t[1],a=t[2],i=t[3],o=r[0],l=r[1];return e[0]=s*o,e[1]=n*o,e[2]=a*l,e[3]=i*l,e}function L(e,t){var r=Math.sin(t),s=Math.cos(t);return e[0]=s,e[1]=r,e[2]=-r,e[3]=s,e}function D(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=t[1],e}function F(e){return"mat2("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"}function N(e){return Math.hypot(e[0],e[1],e[2],e[3])}function O(e,t,r,s){return e[2]=s[2]/s[0],r[0]=s[0],r[1]=s[1],r[3]=s[3]-e[2]*r[1],[e,t,r]}function B(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e[3]=t[3]+r[3],e}function U(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e[3]=t[3]-r[3],e}function V(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]}function G(e,t){var r=e[0],s=e[1],n=e[2],a=e[3],i=t[0],o=t[1],l=t[2],c=t[3];return Math.abs(r-i)<=f*Math.max(1,Math.abs(r),Math.abs(i))&&Math.abs(s-o)<=f*Math.max(1,Math.abs(s),Math.abs(o))&&Math.abs(n-l)<=f*Math.max(1,Math.abs(n),Math.abs(l))&&Math.abs(a-c)<=f*Math.max(1,Math.abs(a),Math.abs(c))}function j(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e}function X(e,t,r,s){return e[0]=t[0]+r[0]*s,e[1]=t[1]+r[1]*s,e[2]=t[2]+r[2]*s,e[3]=t[3]+r[3]*s,e}Math.hypot||(Math.hypot=function(){for(var e=0,t=arguments.length;t--;)e+=arguments[t]*arguments[t];return Math.sqrt(e)});var W=P,H=U;function q(){var e=new p(6);return p!=Float32Array&&(e[1]=0,e[2]=0,e[4]=0,e[5]=0),e[0]=1,e[3]=1,e}function $(e){var t=new p(6);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t}function z(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e}function Y(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e[4]=0,e[5]=0,e}function K(e,t,r,s,n,a){var i=new p(6);return i[0]=e,i[1]=t,i[2]=r,i[3]=s,i[4]=n,i[5]=a,i}function Z(e,t,r,s,n,a,i){return e[0]=t,e[1]=r,e[2]=s,e[3]=n,e[4]=a,e[5]=i,e}function Q(e,t){var r=t[0],s=t[1],n=t[2],a=t[3],i=t[4],o=t[5],l=r*a-s*n;return l?(l=1/l,e[0]=a*l,e[1]=-s*l,e[2]=-n*l,e[3]=r*l,e[4]=(n*o-a*i)*l,e[5]=(s*i-r*o)*l,e):null}function J(e){return e[0]*e[3]-e[1]*e[2]}function ee(e,t,r){var s=t[0],n=t[1],a=t[2],i=t[3],o=t[4],l=t[5],c=r[0],u=r[1],h=r[2],d=r[3],f=r[4],p=r[5];return e[0]=s*c+a*u,e[1]=n*c+i*u,e[2]=s*h+a*d,e[3]=n*h+i*d,e[4]=s*f+a*p+o,e[5]=n*f+i*p+l,e}function te(e,t,r){var s=t[0],n=t[1],a=t[2],i=t[3],o=t[4],l=t[5],c=Math.sin(r),u=Math.cos(r);return e[0]=s*u+a*c,e[1]=n*u+i*c,e[2]=s*-c+a*u,e[3]=n*-c+i*u,e[4]=o,e[5]=l,e}function re(e,t,r){var s=t[0],n=t[1],a=t[2],i=t[3],o=t[4],l=t[5],c=r[0],u=r[1];return e[0]=s*c,e[1]=n*c,e[2]=a*u,e[3]=i*u,e[4]=o,e[5]=l,e}function se(e,t,r){var s=t[0],n=t[1],a=t[2],i=t[3],o=t[4],l=t[5],c=r[0],u=r[1];return e[0]=s,e[1]=n,e[2]=a,e[3]=i,e[4]=s*c+a*u+o,e[5]=n*c+i*u+l,e}function ne(e,t){var r=Math.sin(t),s=Math.cos(t);return e[0]=s,e[1]=r,e[2]=-r,e[3]=s,e[4]=0,e[5]=0,e}function ae(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=t[1],e[4]=0,e[5]=0,e}function ie(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e[4]=t[0],e[5]=t[1],e}function oe(e){return"mat2d("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+")"}function le(e){return Math.hypot(e[0],e[1],e[2],e[3],e[4],e[5],1)}function ce(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e[3]=t[3]+r[3],e[4]=t[4]+r[4],e[5]=t[5]+r[5],e}function ue(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e[3]=t[3]-r[3],e[4]=t[4]-r[4],e[5]=t[5]-r[5],e}function he(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e[4]=t[4]*r,e[5]=t[5]*r,e}function de(e,t,r,s){return e[0]=t[0]+r[0]*s,e[1]=t[1]+r[1]*s,e[2]=t[2]+r[2]*s,e[3]=t[3]+r[3]*s,e[4]=t[4]+r[4]*s,e[5]=t[5]+r[5]*s,e}function fe(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]}function pe(e,t){var r=e[0],s=e[1],n=e[2],a=e[3],i=e[4],o=e[5],l=t[0],c=t[1],u=t[2],h=t[3],d=t[4],p=t[5];return Math.abs(r-l)<=f*Math.max(1,Math.abs(r),Math.abs(l))&&Math.abs(s-c)<=f*Math.max(1,Math.abs(s),Math.abs(c))&&Math.abs(n-u)<=f*Math.max(1,Math.abs(n),Math.abs(u))&&Math.abs(a-h)<=f*Math.max(1,Math.abs(a),Math.abs(h))&&Math.abs(i-d)<=f*Math.max(1,Math.abs(i),Math.abs(d))&&Math.abs(o-p)<=f*Math.max(1,Math.abs(o),Math.abs(p))}var me=ee,ge=ue;function ye(){var e=new p(9);return p!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[5]=0,e[6]=0,e[7]=0),e[0]=1,e[4]=1,e[8]=1,e}function ve(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[4],e[4]=t[5],e[5]=t[6],e[6]=t[8],e[7]=t[9],e[8]=t[10],e}function be(e){var t=new p(9);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t}function _e(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e}function Me(e,t,r,s,n,a,i,o,l){var c=new p(9);return c[0]=e,c[1]=t,c[2]=r,c[3]=s,c[4]=n,c[5]=a,c[6]=i,c[7]=o,c[8]=l,c}function xe(e,t,r,s,n,a,i,o,l,c){return e[0]=t,e[1]=r,e[2]=s,e[3]=n,e[4]=a,e[5]=i,e[6]=o,e[7]=l,e[8]=c,e}function Se(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e}function Te(e,t){if(e===t){var r=t[1],s=t[2],n=t[5];e[1]=t[3],e[2]=t[6],e[3]=r,e[5]=t[7],e[6]=s,e[7]=n}else e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8];return e}function Ee(e,t){var r=t[0],s=t[1],n=t[2],a=t[3],i=t[4],o=t[5],l=t[6],c=t[7],u=t[8],h=u*i-o*c,d=-u*a+o*l,f=c*a-i*l,p=r*h+s*d+n*f;return p?(p=1/p,e[0]=h*p,e[1]=(-u*s+n*c)*p,e[2]=(o*s-n*i)*p,e[3]=d*p,e[4]=(u*r-n*l)*p,e[5]=(-o*r+n*a)*p,e[6]=f*p,e[7]=(-c*r+s*l)*p,e[8]=(i*r-s*a)*p,e):null}function we(e,t){var r=t[0],s=t[1],n=t[2],a=t[3],i=t[4],o=t[5],l=t[6],c=t[7],u=t[8];return e[0]=i*u-o*c,e[1]=n*c-s*u,e[2]=s*o-n*i,e[3]=o*l-a*u,e[4]=r*u-n*l,e[5]=n*a-r*o,e[6]=a*c-i*l,e[7]=s*l-r*c,e[8]=r*i-s*a,e}function Re(e){var t=e[0],r=e[1],s=e[2],n=e[3],a=e[4],i=e[5],o=e[6],l=e[7],c=e[8];return t*(c*a-i*l)+r*(-c*n+i*o)+s*(l*n-a*o)}function ke(e,t,r){var s=t[0],n=t[1],a=t[2],i=t[3],o=t[4],l=t[5],c=t[6],u=t[7],h=t[8],d=r[0],f=r[1],p=r[2],m=r[3],g=r[4],y=r[5],v=r[6],b=r[7],_=r[8];return e[0]=d*s+f*i+p*c,e[1]=d*n+f*o+p*u,e[2]=d*a+f*l+p*h,e[3]=m*s+g*i+y*c,e[4]=m*n+g*o+y*u,e[5]=m*a+g*l+y*h,e[6]=v*s+b*i+_*c,e[7]=v*n+b*o+_*u,e[8]=v*a+b*l+_*h,e}function Ie(e,t,r){var s=t[0],n=t[1],a=t[2],i=t[3],o=t[4],l=t[5],c=t[6],u=t[7],h=t[8],d=r[0],f=r[1];return e[0]=s,e[1]=n,e[2]=a,e[3]=i,e[4]=o,e[5]=l,e[6]=d*s+f*i+c,e[7]=d*n+f*o+u,e[8]=d*a+f*l+h,e}function Pe(e,t,r){var s=t[0],n=t[1],a=t[2],i=t[3],o=t[4],l=t[5],c=t[6],u=t[7],h=t[8],d=Math.sin(r),f=Math.cos(r);return e[0]=f*s+d*i,e[1]=f*n+d*o,e[2]=f*a+d*l,e[3]=f*i-d*s,e[4]=f*o-d*n,e[5]=f*l-d*a,e[6]=c,e[7]=u,e[8]=h,e}function Ae(e,t,r){var s=r[0],n=r[1];return e[0]=s*t[0],e[1]=s*t[1],e[2]=s*t[2],e[3]=n*t[3],e[4]=n*t[4],e[5]=n*t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e}function Ce(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=t[0],e[7]=t[1],e[8]=1,e}function Le(e,t){var r=Math.sin(t),s=Math.cos(t);return e[0]=s,e[1]=r,e[2]=0,e[3]=-r,e[4]=s,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e}function De(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=0,e[4]=t[1],e[5]=0,e[6]=0,e[7]=0,e[8]=1,e}function Fe(e,t){return e[0]=t[0],e[1]=t[1],e[2]=0,e[3]=t[2],e[4]=t[3],e[5]=0,e[6]=t[4],e[7]=t[5],e[8]=1,e}function Ne(e,t){var r=t[0],s=t[1],n=t[2],a=t[3],i=r+r,o=s+s,l=n+n,c=r*i,u=s*i,h=s*o,d=n*i,f=n*o,p=n*l,m=a*i,g=a*o,y=a*l;return e[0]=1-h-p,e[3]=u-y,e[6]=d+g,e[1]=u+y,e[4]=1-c-p,e[7]=f-m,e[2]=d-g,e[5]=f+m,e[8]=1-c-h,e}function Oe(e,t){var r=t[0],s=t[1],n=t[2],a=t[3],i=t[4],o=t[5],l=t[6],c=t[7],u=t[8],h=t[9],d=t[10],f=t[11],p=t[12],m=t[13],g=t[14],y=t[15],v=r*o-s*i,b=r*l-n*i,_=r*c-a*i,M=s*l-n*o,x=s*c-a*o,S=n*c-a*l,T=u*m-h*p,E=u*g-d*p,w=u*y-f*p,R=h*g-d*m,k=h*y-f*m,I=d*y-f*g,P=v*I-b*k+_*R+M*w-x*E+S*T;return P?(P=1/P,e[0]=(o*I-l*k+c*R)*P,e[1]=(l*w-i*I-c*E)*P,e[2]=(i*k-o*w+c*T)*P,e[3]=(n*k-s*I-a*R)*P,e[4]=(r*I-n*w+a*E)*P,e[5]=(s*w-r*k-a*T)*P,e[6]=(m*S-g*x+y*M)*P,e[7]=(g*_-p*S-y*b)*P,e[8]=(p*x-m*_+y*v)*P,e):null}function Be(e,t,r){return e[0]=2/t,e[1]=0,e[2]=0,e[3]=0,e[4]=-2/r,e[5]=0,e[6]=-1,e[7]=1,e[8]=1,e}function Ue(e){return"mat3("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+")"}function Ve(e){return Math.hypot(e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8])}function Ge(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e[3]=t[3]+r[3],e[4]=t[4]+r[4],e[5]=t[5]+r[5],e[6]=t[6]+r[6],e[7]=t[7]+r[7],e[8]=t[8]+r[8],e}function je(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e[3]=t[3]-r[3],e[4]=t[4]-r[4],e[5]=t[5]-r[5],e[6]=t[6]-r[6],e[7]=t[7]-r[7],e[8]=t[8]-r[8],e}function Xe(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e[4]=t[4]*r,e[5]=t[5]*r,e[6]=t[6]*r,e[7]=t[7]*r,e[8]=t[8]*r,e}function We(e,t,r,s){return e[0]=t[0]+r[0]*s,e[1]=t[1]+r[1]*s,e[2]=t[2]+r[2]*s,e[3]=t[3]+r[3]*s,e[4]=t[4]+r[4]*s,e[5]=t[5]+r[5]*s,e[6]=t[6]+r[6]*s,e[7]=t[7]+r[7]*s,e[8]=t[8]+r[8]*s,e}function He(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]&&e[8]===t[8]}function qe(e,t){var r=e[0],s=e[1],n=e[2],a=e[3],i=e[4],o=e[5],l=e[6],c=e[7],u=e[8],h=t[0],d=t[1],p=t[2],m=t[3],g=t[4],y=t[5],v=t[6],b=t[7],_=t[8];return Math.abs(r-h)<=f*Math.max(1,Math.abs(r),Math.abs(h))&&Math.abs(s-d)<=f*Math.max(1,Math.abs(s),Math.abs(d))&&Math.abs(n-p)<=f*Math.max(1,Math.abs(n),Math.abs(p))&&Math.abs(a-m)<=f*Math.max(1,Math.abs(a),Math.abs(m))&&Math.abs(i-g)<=f*Math.max(1,Math.abs(i),Math.abs(g))&&Math.abs(o-y)<=f*Math.max(1,Math.abs(o),Math.abs(y))&&Math.abs(l-v)<=f*Math.max(1,Math.abs(l),Math.abs(v))&&Math.abs(c-b)<=f*Math.max(1,Math.abs(c),Math.abs(b))&&Math.abs(u-_)<=f*Math.max(1,Math.abs(u),Math.abs(_))}var $e=ke,ze=je;function Ye(){var e=new p(16);return p!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0),e[0]=1,e[5]=1,e[10]=1,e[15]=1,e}function Ke(e){var t=new p(16);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function Ze(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function Qe(e,t,r,s,n,a,i,o,l,c,u,h,d,f,m,g){var y=new p(16);return y[0]=e,y[1]=t,y[2]=r,y[3]=s,y[4]=n,y[5]=a,y[6]=i,y[7]=o,y[8]=l,y[9]=c,y[10]=u,y[11]=h,y[12]=d,y[13]=f,y[14]=m,y[15]=g,y}function Je(e,t,r,s,n,a,i,o,l,c,u,h,d,f,p,m,g){return e[0]=t,e[1]=r,e[2]=s,e[3]=n,e[4]=a,e[5]=i,e[6]=o,e[7]=l,e[8]=c,e[9]=u,e[10]=h,e[11]=d,e[12]=f,e[13]=p,e[14]=m,e[15]=g,e}function et(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function tt(e,t){if(e===t){var r=t[1],s=t[2],n=t[3],a=t[6],i=t[7],o=t[11];e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=r,e[6]=t[9],e[7]=t[13],e[8]=s,e[9]=a,e[11]=t[14],e[12]=n,e[13]=i,e[14]=o}else e[0]=t[0],e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=t[1],e[5]=t[5],e[6]=t[9],e[7]=t[13],e[8]=t[2],e[9]=t[6],e[10]=t[10],e[11]=t[14],e[12]=t[3],e[13]=t[7],e[14]=t[11],e[15]=t[15];return e}function rt(e,t){var r=t[0],s=t[1],n=t[2],a=t[3],i=t[4],o=t[5],l=t[6],c=t[7],u=t[8],h=t[9],d=t[10],f=t[11],p=t[12],m=t[13],g=t[14],y=t[15],v=r*o-s*i,b=r*l-n*i,_=r*c-a*i,M=s*l-n*o,x=s*c-a*o,S=n*c-a*l,T=u*m-h*p,E=u*g-d*p,w=u*y-f*p,R=h*g-d*m,k=h*y-f*m,I=d*y-f*g,P=v*I-b*k+_*R+M*w-x*E+S*T;return P?(P=1/P,e[0]=(o*I-l*k+c*R)*P,e[1]=(n*k-s*I-a*R)*P,e[2]=(m*S-g*x+y*M)*P,e[3]=(d*x-h*S-f*M)*P,e[4]=(l*w-i*I-c*E)*P,e[5]=(r*I-n*w+a*E)*P,e[6]=(g*_-p*S-y*b)*P,e[7]=(u*S-d*_+f*b)*P,e[8]=(i*k-o*w+c*T)*P,e[9]=(s*w-r*k-a*T)*P,e[10]=(p*x-m*_+y*v)*P,e[11]=(h*_-u*x-f*v)*P,e[12]=(o*E-i*R-l*T)*P,e[13]=(r*R-s*E+n*T)*P,e[14]=(m*b-p*M-g*v)*P,e[15]=(u*M-h*b+d*v)*P,e):null}function st(e,t){var r=t[0],s=t[1],n=t[2],a=t[3],i=t[4],o=t[5],l=t[6],c=t[7],u=t[8],h=t[9],d=t[10],f=t[11],p=t[12],m=t[13],g=t[14],y=t[15];return e[0]=o*(d*y-f*g)-h*(l*y-c*g)+m*(l*f-c*d),e[1]=-(s*(d*y-f*g)-h*(n*y-a*g)+m*(n*f-a*d)),e[2]=s*(l*y-c*g)-o*(n*y-a*g)+m*(n*c-a*l),e[3]=-(s*(l*f-c*d)-o*(n*f-a*d)+h*(n*c-a*l)),e[4]=-(i*(d*y-f*g)-u*(l*y-c*g)+p*(l*f-c*d)),e[5]=r*(d*y-f*g)-u*(n*y-a*g)+p*(n*f-a*d),e[6]=-(r*(l*y-c*g)-i*(n*y-a*g)+p*(n*c-a*l)),e[7]=r*(l*f-c*d)-i*(n*f-a*d)+u*(n*c-a*l),e[8]=i*(h*y-f*m)-u*(o*y-c*m)+p*(o*f-c*h),e[9]=-(r*(h*y-f*m)-u*(s*y-a*m)+p*(s*f-a*h)),e[10]=r*(o*y-c*m)-i*(s*y-a*m)+p*(s*c-a*o),e[11]=-(r*(o*f-c*h)-i*(s*f-a*h)+u*(s*c-a*o)),e[12]=-(i*(h*g-d*m)-u*(o*g-l*m)+p*(o*d-l*h)),e[13]=r*(h*g-d*m)-u*(s*g-n*m)+p*(s*d-n*h),e[14]=-(r*(o*g-l*m)-i*(s*g-n*m)+p*(s*l-n*o)),e[15]=r*(o*d-l*h)-i*(s*d-n*h)+u*(s*l-n*o),e}function nt(e){var t=e[0],r=e[1],s=e[2],n=e[3],a=e[4],i=e[5],o=e[6],l=e[7],c=e[8],u=e[9],h=e[10],d=e[11],f=e[12],p=e[13],m=e[14],g=e[15];return(t*i-r*a)*(h*g-d*m)-(t*o-s*a)*(u*g-d*p)+(t*l-n*a)*(u*m-h*p)+(r*o-s*i)*(c*g-d*f)-(r*l-n*i)*(c*m-h*f)+(s*l-n*o)*(c*p-u*f)}function at(e,t,r){var s=t[0],n=t[1],a=t[2],i=t[3],o=t[4],l=t[5],c=t[6],u=t[7],h=t[8],d=t[9],f=t[10],p=t[11],m=t[12],g=t[13],y=t[14],v=t[15],b=r[0],_=r[1],M=r[2],x=r[3];return e[0]=b*s+_*o+M*h+x*m,e[1]=b*n+_*l+M*d+x*g,e[2]=b*a+_*c+M*f+x*y,e[3]=b*i+_*u+M*p+x*v,b=r[4],_=r[5],M=r[6],x=r[7],e[4]=b*s+_*o+M*h+x*m,e[5]=b*n+_*l+M*d+x*g,e[6]=b*a+_*c+M*f+x*y,e[7]=b*i+_*u+M*p+x*v,b=r[8],_=r[9],M=r[10],x=r[11],e[8]=b*s+_*o+M*h+x*m,e[9]=b*n+_*l+M*d+x*g,e[10]=b*a+_*c+M*f+x*y,e[11]=b*i+_*u+M*p+x*v,b=r[12],_=r[13],M=r[14],x=r[15],e[12]=b*s+_*o+M*h+x*m,e[13]=b*n+_*l+M*d+x*g,e[14]=b*a+_*c+M*f+x*y,e[15]=b*i+_*u+M*p+x*v,e}function it(e,t,r){var s,n,a,i,o,l,c,u,h,d,f,p,m=r[0],g=r[1],y=r[2];return t===e?(e[12]=t[0]*m+t[4]*g+t[8]*y+t[12],e[13]=t[1]*m+t[5]*g+t[9]*y+t[13],e[14]=t[2]*m+t[6]*g+t[10]*y+t[14],e[15]=t[3]*m+t[7]*g+t[11]*y+t[15]):(s=t[0],n=t[1],a=t[2],i=t[3],o=t[4],l=t[5],c=t[6],u=t[7],h=t[8],d=t[9],f=t[10],p=t[11],e[0]=s,e[1]=n,e[2]=a,e[3]=i,e[4]=o,e[5]=l,e[6]=c,e[7]=u,e[8]=h,e[9]=d,e[10]=f,e[11]=p,e[12]=s*m+o*g+h*y+t[12],e[13]=n*m+l*g+d*y+t[13],e[14]=a*m+c*g+f*y+t[14],e[15]=i*m+u*g+p*y+t[15]),e}function ot(e,t,r){var s=r[0],n=r[1],a=r[2];return e[0]=t[0]*s,e[1]=t[1]*s,e[2]=t[2]*s,e[3]=t[3]*s,e[4]=t[4]*n,e[5]=t[5]*n,e[6]=t[6]*n,e[7]=t[7]*n,e[8]=t[8]*a,e[9]=t[9]*a,e[10]=t[10]*a,e[11]=t[11]*a,e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function lt(e,t,r,s){var n,a,i,o,l,c,u,h,d,p,m,g,y,v,b,_,M,x,S,T,E,w,R,k,I=s[0],P=s[1],A=s[2],C=Math.hypot(I,P,A);return C<f?null:(I*=C=1/C,P*=C,A*=C,n=Math.sin(r),i=1-(a=Math.cos(r)),o=t[0],l=t[1],c=t[2],u=t[3],h=t[4],d=t[5],p=t[6],m=t[7],g=t[8],y=t[9],v=t[10],b=t[11],_=I*I*i+a,M=P*I*i+A*n,x=A*I*i-P*n,S=I*P*i-A*n,T=P*P*i+a,E=A*P*i+I*n,w=I*A*i+P*n,R=P*A*i-I*n,k=A*A*i+a,e[0]=o*_+h*M+g*x,e[1]=l*_+d*M+y*x,e[2]=c*_+p*M+v*x,e[3]=u*_+m*M+b*x,e[4]=o*S+h*T+g*E,e[5]=l*S+d*T+y*E,e[6]=c*S+p*T+v*E,e[7]=u*S+m*T+b*E,e[8]=o*w+h*R+g*k,e[9]=l*w+d*R+y*k,e[10]=c*w+p*R+v*k,e[11]=u*w+m*R+b*k,t!==e&&(e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e)}function ct(e,t,r){var s=Math.sin(r),n=Math.cos(r),a=t[4],i=t[5],o=t[6],l=t[7],c=t[8],u=t[9],h=t[10],d=t[11];return t!==e&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[4]=a*n+c*s,e[5]=i*n+u*s,e[6]=o*n+h*s,e[7]=l*n+d*s,e[8]=c*n-a*s,e[9]=u*n-i*s,e[10]=h*n-o*s,e[11]=d*n-l*s,e}function ut(e,t,r){var s=Math.sin(r),n=Math.cos(r),a=t[0],i=t[1],o=t[2],l=t[3],c=t[8],u=t[9],h=t[10],d=t[11];return t!==e&&(e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=a*n-c*s,e[1]=i*n-u*s,e[2]=o*n-h*s,e[3]=l*n-d*s,e[8]=a*s+c*n,e[9]=i*s+u*n,e[10]=o*s+h*n,e[11]=l*s+d*n,e}function ht(e,t,r){var s=Math.sin(r),n=Math.cos(r),a=t[0],i=t[1],o=t[2],l=t[3],c=t[4],u=t[5],h=t[6],d=t[7];return t!==e&&(e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=a*n+c*s,e[1]=i*n+u*s,e[2]=o*n+h*s,e[3]=l*n+d*s,e[4]=c*n-a*s,e[5]=u*n-i*s,e[6]=h*n-o*s,e[7]=d*n-l*s,e}function dt(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=t[0],e[13]=t[1],e[14]=t[2],e[15]=1,e}function ft(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=t[1],e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=t[2],e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function pt(e,t,r){var s,n,a,i=r[0],o=r[1],l=r[2],c=Math.hypot(i,o,l);return c<f?null:(i*=c=1/c,o*=c,l*=c,s=Math.sin(t),a=1-(n=Math.cos(t)),e[0]=i*i*a+n,e[1]=o*i*a+l*s,e[2]=l*i*a-o*s,e[3]=0,e[4]=i*o*a-l*s,e[5]=o*o*a+n,e[6]=l*o*a+i*s,e[7]=0,e[8]=i*l*a+o*s,e[9]=o*l*a-i*s,e[10]=l*l*a+n,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e)}function mt(e,t){var r=Math.sin(t),s=Math.cos(t);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=s,e[6]=r,e[7]=0,e[8]=0,e[9]=-r,e[10]=s,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function gt(e,t){var r=Math.sin(t),s=Math.cos(t);return e[0]=s,e[1]=0,e[2]=-r,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=r,e[9]=0,e[10]=s,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function yt(e,t){var r=Math.sin(t),s=Math.cos(t);return e[0]=s,e[1]=r,e[2]=0,e[3]=0,e[4]=-r,e[5]=s,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function vt(e,t,r){var s=t[0],n=t[1],a=t[2],i=t[3],o=s+s,l=n+n,c=a+a,u=s*o,h=s*l,d=s*c,f=n*l,p=n*c,m=a*c,g=i*o,y=i*l,v=i*c;return e[0]=1-(f+m),e[1]=h+v,e[2]=d-y,e[3]=0,e[4]=h-v,e[5]=1-(u+m),e[6]=p+g,e[7]=0,e[8]=d+y,e[9]=p-g,e[10]=1-(u+f),e[11]=0,e[12]=r[0],e[13]=r[1],e[14]=r[2],e[15]=1,e}function bt(e,t){var r=new p(3),s=-t[0],n=-t[1],a=-t[2],i=t[3],o=t[4],l=t[5],c=t[6],u=t[7],h=s*s+n*n+a*a+i*i;return h>0?(r[0]=2*(o*i+u*s+l*a-c*n)/h,r[1]=2*(l*i+u*n+c*s-o*a)/h,r[2]=2*(c*i+u*a+o*n-l*s)/h):(r[0]=2*(o*i+u*s+l*a-c*n),r[1]=2*(l*i+u*n+c*s-o*a),r[2]=2*(c*i+u*a+o*n-l*s)),vt(e,t,r),e}function _t(e,t){return e[0]=t[12],e[1]=t[13],e[2]=t[14],e}function Mt(e,t){var r=t[0],s=t[1],n=t[2],a=t[4],i=t[5],o=t[6],l=t[8],c=t[9],u=t[10];return e[0]=Math.hypot(r,s,n),e[1]=Math.hypot(a,i,o),e[2]=Math.hypot(l,c,u),e}function xt(e,t){var r=new p(3);Mt(r,t);var s=1/r[0],n=1/r[1],a=1/r[2],i=t[0]*s,o=t[1]*n,l=t[2]*a,c=t[4]*s,u=t[5]*n,h=t[6]*a,d=t[8]*s,f=t[9]*n,m=t[10]*a,g=i+u+m,y=0;return g>0?(y=2*Math.sqrt(g+1),e[3]=.25*y,e[0]=(h-f)/y,e[1]=(d-l)/y,e[2]=(o-c)/y):i>u&&i>m?(y=2*Math.sqrt(1+i-u-m),e[3]=(h-f)/y,e[0]=.25*y,e[1]=(o+c)/y,e[2]=(d+l)/y):u>m?(y=2*Math.sqrt(1+u-i-m),e[3]=(d-l)/y,e[0]=(o+c)/y,e[1]=.25*y,e[2]=(h+f)/y):(y=2*Math.sqrt(1+m-i-u),e[3]=(o-c)/y,e[0]=(d+l)/y,e[1]=(h+f)/y,e[2]=.25*y),e}function St(e,t,r,s){var n=t[0],a=t[1],i=t[2],o=t[3],l=n+n,c=a+a,u=i+i,h=n*l,d=n*c,f=n*u,p=a*c,m=a*u,g=i*u,y=o*l,v=o*c,b=o*u,_=s[0],M=s[1],x=s[2];return e[0]=(1-(p+g))*_,e[1]=(d+b)*_,e[2]=(f-v)*_,e[3]=0,e[4]=(d-b)*M,e[5]=(1-(h+g))*M,e[6]=(m+y)*M,e[7]=0,e[8]=(f+v)*x,e[9]=(m-y)*x,e[10]=(1-(h+p))*x,e[11]=0,e[12]=r[0],e[13]=r[1],e[14]=r[2],e[15]=1,e}function Tt(e,t,r,s,n){var a=t[0],i=t[1],o=t[2],l=t[3],c=a+a,u=i+i,h=o+o,d=a*c,f=a*u,p=a*h,m=i*u,g=i*h,y=o*h,v=l*c,b=l*u,_=l*h,M=s[0],x=s[1],S=s[2],T=n[0],E=n[1],w=n[2],R=(1-(m+y))*M,k=(f+_)*M,I=(p-b)*M,P=(f-_)*x,A=(1-(d+y))*x,C=(g+v)*x,L=(p+b)*S,D=(g-v)*S,F=(1-(d+m))*S;return e[0]=R,e[1]=k,e[2]=I,e[3]=0,e[4]=P,e[5]=A,e[6]=C,e[7]=0,e[8]=L,e[9]=D,e[10]=F,e[11]=0,e[12]=r[0]+T-(R*T+P*E+L*w),e[13]=r[1]+E-(k*T+A*E+D*w),e[14]=r[2]+w-(I*T+C*E+F*w),e[15]=1,e}function Et(e,t){var r=t[0],s=t[1],n=t[2],a=t[3],i=r+r,o=s+s,l=n+n,c=r*i,u=s*i,h=s*o,d=n*i,f=n*o,p=n*l,m=a*i,g=a*o,y=a*l;return e[0]=1-h-p,e[1]=u+y,e[2]=d-g,e[3]=0,e[4]=u-y,e[5]=1-c-p,e[6]=f+m,e[7]=0,e[8]=d+g,e[9]=f-m,e[10]=1-c-h,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function wt(e,t,r,s,n,a,i){var o=1/(r-t),l=1/(n-s),c=1/(a-i);return e[0]=2*a*o,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=2*a*l,e[6]=0,e[7]=0,e[8]=(r+t)*o,e[9]=(n+s)*l,e[10]=(i+a)*c,e[11]=-1,e[12]=0,e[13]=0,e[14]=i*a*2*c,e[15]=0,e}function Rt(e,t,r,s,n){var a,i=1/Math.tan(t/2);return e[0]=i/r,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=i,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,null!=n&&n!==1/0?(a=1/(s-n),e[10]=(n+s)*a,e[14]=2*n*s*a):(e[10]=-1,e[14]=-2*s),e}var kt=Rt;function It(e,t,r,s,n){var a,i=1/Math.tan(t/2);return e[0]=i/r,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=i,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,null!=n&&n!==1/0?(a=1/(s-n),e[10]=n*a,e[14]=n*s*a):(e[10]=-1,e[14]=-s),e}function Pt(e,t,r,s){var n=Math.tan(t.upDegrees*Math.PI/180),a=Math.tan(t.downDegrees*Math.PI/180),i=Math.tan(t.leftDegrees*Math.PI/180),o=Math.tan(t.rightDegrees*Math.PI/180),l=2/(i+o),c=2/(n+a);return e[0]=l,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=c,e[6]=0,e[7]=0,e[8]=-(i-o)*l*.5,e[9]=(n-a)*c*.5,e[10]=s/(r-s),e[11]=-1,e[12]=0,e[13]=0,e[14]=s*r/(r-s),e[15]=0,e}function At(e,t,r,s,n,a,i){var o=1/(t-r),l=1/(s-n),c=1/(a-i);return e[0]=-2*o,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*l,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*c,e[11]=0,e[12]=(t+r)*o,e[13]=(n+s)*l,e[14]=(i+a)*c,e[15]=1,e}var Ct=At;function Lt(e,t,r,s,n,a,i){var o=1/(t-r),l=1/(s-n),c=1/(a-i);return e[0]=-2*o,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*l,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=c,e[11]=0,e[12]=(t+r)*o,e[13]=(n+s)*l,e[14]=a*c,e[15]=1,e}function Dt(e,t,r,s){var n,a,i,o,l,c,u,h,d,p,m=t[0],g=t[1],y=t[2],v=s[0],b=s[1],_=s[2],M=r[0],x=r[1],S=r[2];return Math.abs(m-M)<f&&Math.abs(g-x)<f&&Math.abs(y-S)<f?et(e):(u=m-M,h=g-x,d=y-S,n=b*(d*=p=1/Math.hypot(u,h,d))-_*(h*=p),a=_*(u*=p)-v*d,i=v*h-b*u,(p=Math.hypot(n,a,i))?(n*=p=1/p,a*=p,i*=p):(n=0,a=0,i=0),o=h*i-d*a,l=d*n-u*i,c=u*a-h*n,(p=Math.hypot(o,l,c))?(o*=p=1/p,l*=p,c*=p):(o=0,l=0,c=0),e[0]=n,e[1]=o,e[2]=u,e[3]=0,e[4]=a,e[5]=l,e[6]=h,e[7]=0,e[8]=i,e[9]=c,e[10]=d,e[11]=0,e[12]=-(n*m+a*g+i*y),e[13]=-(o*m+l*g+c*y),e[14]=-(u*m+h*g+d*y),e[15]=1,e)}function Ft(e,t,r,s){var n=t[0],a=t[1],i=t[2],o=s[0],l=s[1],c=s[2],u=n-r[0],h=a-r[1],d=i-r[2],f=u*u+h*h+d*d;f>0&&(u*=f=1/Math.sqrt(f),h*=f,d*=f);var p=l*d-c*h,m=c*u-o*d,g=o*h-l*u;return(f=p*p+m*m+g*g)>0&&(p*=f=1/Math.sqrt(f),m*=f,g*=f),e[0]=p,e[1]=m,e[2]=g,e[3]=0,e[4]=h*g-d*m,e[5]=d*p-u*g,e[6]=u*m-h*p,e[7]=0,e[8]=u,e[9]=h,e[10]=d,e[11]=0,e[12]=n,e[13]=a,e[14]=i,e[15]=1,e}function Nt(e){return"mat4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+", "+e[9]+", "+e[10]+", "+e[11]+", "+e[12]+", "+e[13]+", "+e[14]+", "+e[15]+")"}function Ot(e){return Math.hypot(e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8],e[9],e[10],e[11],e[12],e[13],e[14],e[15])}function Bt(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e[3]=t[3]+r[3],e[4]=t[4]+r[4],e[5]=t[5]+r[5],e[6]=t[6]+r[6],e[7]=t[7]+r[7],e[8]=t[8]+r[8],e[9]=t[9]+r[9],e[10]=t[10]+r[10],e[11]=t[11]+r[11],e[12]=t[12]+r[12],e[13]=t[13]+r[13],e[14]=t[14]+r[14],e[15]=t[15]+r[15],e}function Ut(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e[3]=t[3]-r[3],e[4]=t[4]-r[4],e[5]=t[5]-r[5],e[6]=t[6]-r[6],e[7]=t[7]-r[7],e[8]=t[8]-r[8],e[9]=t[9]-r[9],e[10]=t[10]-r[10],e[11]=t[11]-r[11],e[12]=t[12]-r[12],e[13]=t[13]-r[13],e[14]=t[14]-r[14],e[15]=t[15]-r[15],e}function Vt(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e[4]=t[4]*r,e[5]=t[5]*r,e[6]=t[6]*r,e[7]=t[7]*r,e[8]=t[8]*r,e[9]=t[9]*r,e[10]=t[10]*r,e[11]=t[11]*r,e[12]=t[12]*r,e[13]=t[13]*r,e[14]=t[14]*r,e[15]=t[15]*r,e}function Gt(e,t,r,s){return e[0]=t[0]+r[0]*s,e[1]=t[1]+r[1]*s,e[2]=t[2]+r[2]*s,e[3]=t[3]+r[3]*s,e[4]=t[4]+r[4]*s,e[5]=t[5]+r[5]*s,e[6]=t[6]+r[6]*s,e[7]=t[7]+r[7]*s,e[8]=t[8]+r[8]*s,e[9]=t[9]+r[9]*s,e[10]=t[10]+r[10]*s,e[11]=t[11]+r[11]*s,e[12]=t[12]+r[12]*s,e[13]=t[13]+r[13]*s,e[14]=t[14]+r[14]*s,e[15]=t[15]+r[15]*s,e}function jt(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]&&e[8]===t[8]&&e[9]===t[9]&&e[10]===t[10]&&e[11]===t[11]&&e[12]===t[12]&&e[13]===t[13]&&e[14]===t[14]&&e[15]===t[15]}function Xt(e,t){var r=e[0],s=e[1],n=e[2],a=e[3],i=e[4],o=e[5],l=e[6],c=e[7],u=e[8],h=e[9],d=e[10],p=e[11],m=e[12],g=e[13],y=e[14],v=e[15],b=t[0],_=t[1],M=t[2],x=t[3],S=t[4],T=t[5],E=t[6],w=t[7],R=t[8],k=t[9],I=t[10],P=t[11],A=t[12],C=t[13],L=t[14],D=t[15];return Math.abs(r-b)<=f*Math.max(1,Math.abs(r),Math.abs(b))&&Math.abs(s-_)<=f*Math.max(1,Math.abs(s),Math.abs(_))&&Math.abs(n-M)<=f*Math.max(1,Math.abs(n),Math.abs(M))&&Math.abs(a-x)<=f*Math.max(1,Math.abs(a),Math.abs(x))&&Math.abs(i-S)<=f*Math.max(1,Math.abs(i),Math.abs(S))&&Math.abs(o-T)<=f*Math.max(1,Math.abs(o),Math.abs(T))&&Math.abs(l-E)<=f*Math.max(1,Math.abs(l),Math.abs(E))&&Math.abs(c-w)<=f*Math.max(1,Math.abs(c),Math.abs(w))&&Math.abs(u-R)<=f*Math.max(1,Math.abs(u),Math.abs(R))&&Math.abs(h-k)<=f*Math.max(1,Math.abs(h),Math.abs(k))&&Math.abs(d-I)<=f*Math.max(1,Math.abs(d),Math.abs(I))&&Math.abs(p-P)<=f*Math.max(1,Math.abs(p),Math.abs(P))&&Math.abs(m-A)<=f*Math.max(1,Math.abs(m),Math.abs(A))&&Math.abs(g-C)<=f*Math.max(1,Math.abs(g),Math.abs(C))&&Math.abs(y-L)<=f*Math.max(1,Math.abs(y),Math.abs(L))&&Math.abs(v-D)<=f*Math.max(1,Math.abs(v),Math.abs(D))}var Wt=at,Ht=Ut;function qt(){var e=new p(3);return p!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e}function $t(e){var t=new p(3);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}function zt(e){var t=e[0],r=e[1],s=e[2];return Math.hypot(t,r,s)}function Yt(e,t,r){var s=new p(3);return s[0]=e,s[1]=t,s[2]=r,s}function Kt(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e}function Zt(e,t,r,s){return e[0]=t,e[1]=r,e[2]=s,e}function Qt(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e}function Jt(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e}function er(e,t,r){return e[0]=t[0]*r[0],e[1]=t[1]*r[1],e[2]=t[2]*r[2],e}function tr(e,t,r){return e[0]=t[0]/r[0],e[1]=t[1]/r[1],e[2]=t[2]/r[2],e}function rr(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e[2]=Math.ceil(t[2]),e}function sr(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e[2]=Math.floor(t[2]),e}function nr(e,t,r){return e[0]=Math.min(t[0],r[0]),e[1]=Math.min(t[1],r[1]),e[2]=Math.min(t[2],r[2]),e}function ar(e,t,r){return e[0]=Math.max(t[0],r[0]),e[1]=Math.max(t[1],r[1]),e[2]=Math.max(t[2],r[2]),e}function ir(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e[2]=Math.round(t[2]),e}function or(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e}function lr(e,t,r,s){return e[0]=t[0]+r[0]*s,e[1]=t[1]+r[1]*s,e[2]=t[2]+r[2]*s,e}function cr(e,t){var r=t[0]-e[0],s=t[1]-e[1],n=t[2]-e[2];return Math.hypot(r,s,n)}function ur(e,t){var r=t[0]-e[0],s=t[1]-e[1],n=t[2]-e[2];return r*r+s*s+n*n}function hr(e){var t=e[0],r=e[1],s=e[2];return t*t+r*r+s*s}function dr(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e}function fr(e,t){return e[0]=1/t[0],e[1]=1/t[1],e[2]=1/t[2],e}function pr(e,t){var r=t[0],s=t[1],n=t[2],a=r*r+s*s+n*n;return a>0&&(a=1/Math.sqrt(a)),e[0]=t[0]*a,e[1]=t[1]*a,e[2]=t[2]*a,e}function mr(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function gr(e,t,r){var s=t[0],n=t[1],a=t[2],i=r[0],o=r[1],l=r[2];return e[0]=n*l-a*o,e[1]=a*i-s*l,e[2]=s*o-n*i,e}function yr(e,t,r,s){var n=t[0],a=t[1],i=t[2];return e[0]=n+s*(r[0]-n),e[1]=a+s*(r[1]-a),e[2]=i+s*(r[2]-i),e}function vr(e,t,r,s,n,a){var i=a*a,o=i*(2*a-3)+1,l=i*(a-2)+a,c=i*(a-1),u=i*(3-2*a);return e[0]=t[0]*o+r[0]*l+s[0]*c+n[0]*u,e[1]=t[1]*o+r[1]*l+s[1]*c+n[1]*u,e[2]=t[2]*o+r[2]*l+s[2]*c+n[2]*u,e}function br(e,t,r,s,n,a){var i=1-a,o=i*i,l=a*a,c=o*i,u=3*a*o,h=3*l*i,d=l*a;return e[0]=t[0]*c+r[0]*u+s[0]*h+n[0]*d,e[1]=t[1]*c+r[1]*u+s[1]*h+n[1]*d,e[2]=t[2]*c+r[2]*u+s[2]*h+n[2]*d,e}function _r(e,t){t=t||1;var r=2*m()*Math.PI,s=2*m()-1,n=Math.sqrt(1-s*s)*t;return e[0]=Math.cos(r)*n,e[1]=Math.sin(r)*n,e[2]=s*t,e}function Mr(e,t,r){var s=t[0],n=t[1],a=t[2],i=r[3]*s+r[7]*n+r[11]*a+r[15];return i=i||1,e[0]=(r[0]*s+r[4]*n+r[8]*a+r[12])/i,e[1]=(r[1]*s+r[5]*n+r[9]*a+r[13])/i,e[2]=(r[2]*s+r[6]*n+r[10]*a+r[14])/i,e}function xr(e,t,r){var s=t[0],n=t[1],a=t[2];return e[0]=s*r[0]+n*r[3]+a*r[6],e[1]=s*r[1]+n*r[4]+a*r[7],e[2]=s*r[2]+n*r[5]+a*r[8],e}function Sr(e,t,r){var s=r[0],n=r[1],a=r[2],i=r[3],o=t[0],l=t[1],c=t[2],u=n*c-a*l,h=a*o-s*c,d=s*l-n*o,f=n*d-a*h,p=a*u-s*d,m=s*h-n*u,g=2*i;return u*=g,h*=g,d*=g,f*=2,p*=2,m*=2,e[0]=o+u+f,e[1]=l+h+p,e[2]=c+d+m,e}function Tr(e,t,r,s){var n=[],a=[];return n[0]=t[0]-r[0],n[1]=t[1]-r[1],n[2]=t[2]-r[2],a[0]=n[0],a[1]=n[1]*Math.cos(s)-n[2]*Math.sin(s),a[2]=n[1]*Math.sin(s)+n[2]*Math.cos(s),e[0]=a[0]+r[0],e[1]=a[1]+r[1],e[2]=a[2]+r[2],e}function Er(e,t,r,s){var n=[],a=[];return n[0]=t[0]-r[0],n[1]=t[1]-r[1],n[2]=t[2]-r[2],a[0]=n[2]*Math.sin(s)+n[0]*Math.cos(s),a[1]=n[1],a[2]=n[2]*Math.cos(s)-n[0]*Math.sin(s),e[0]=a[0]+r[0],e[1]=a[1]+r[1],e[2]=a[2]+r[2],e}function wr(e,t,r,s){var n=[],a=[];return n[0]=t[0]-r[0],n[1]=t[1]-r[1],n[2]=t[2]-r[2],a[0]=n[0]*Math.cos(s)-n[1]*Math.sin(s),a[1]=n[0]*Math.sin(s)+n[1]*Math.cos(s),a[2]=n[2],e[0]=a[0]+r[0],e[1]=a[1]+r[1],e[2]=a[2]+r[2],e}function Rr(e,t){var r=e[0],s=e[1],n=e[2],a=t[0],i=t[1],o=t[2],l=Math.sqrt(r*r+s*s+n*n)*Math.sqrt(a*a+i*i+o*o),c=l&&mr(e,t)/l;return Math.acos(Math.min(Math.max(c,-1),1))}function kr(e){return e[0]=0,e[1]=0,e[2]=0,e}function Ir(e){return"vec3("+e[0]+", "+e[1]+", "+e[2]+")"}function Pr(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]}function Ar(e,t){var r=e[0],s=e[1],n=e[2],a=t[0],i=t[1],o=t[2];return Math.abs(r-a)<=f*Math.max(1,Math.abs(r),Math.abs(a))&&Math.abs(s-i)<=f*Math.max(1,Math.abs(s),Math.abs(i))&&Math.abs(n-o)<=f*Math.max(1,Math.abs(n),Math.abs(o))}var Cr,Lr=Jt,Dr=er,Fr=tr,Nr=cr,Or=ur,Br=zt,Ur=hr,Vr=(Cr=qt(),function(e,t,r,s,n,a){var i,o;for(t||(t=3),r||(r=0),o=s?Math.min(s*t+r,e.length):e.length,i=r;i<o;i+=t)Cr[0]=e[i],Cr[1]=e[i+1],Cr[2]=e[i+2],n(Cr,Cr,a),e[i]=Cr[0],e[i+1]=Cr[1],e[i+2]=Cr[2];return e});function Gr(){var e=new p(4);return p!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0,e[3]=0),e}function jr(e){var t=new p(4);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t}function Xr(e,t,r,s){var n=new p(4);return n[0]=e,n[1]=t,n[2]=r,n[3]=s,n}function Wr(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e}function Hr(e,t,r,s,n){return e[0]=t,e[1]=r,e[2]=s,e[3]=n,e}function qr(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e[3]=t[3]+r[3],e}function $r(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e[3]=t[3]-r[3],e}function zr(e,t,r){return e[0]=t[0]*r[0],e[1]=t[1]*r[1],e[2]=t[2]*r[2],e[3]=t[3]*r[3],e}function Yr(e,t,r){return e[0]=t[0]/r[0],e[1]=t[1]/r[1],e[2]=t[2]/r[2],e[3]=t[3]/r[3],e}function Kr(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e[2]=Math.ceil(t[2]),e[3]=Math.ceil(t[3]),e}function Zr(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e[2]=Math.floor(t[2]),e[3]=Math.floor(t[3]),e}function Qr(e,t,r){return e[0]=Math.min(t[0],r[0]),e[1]=Math.min(t[1],r[1]),e[2]=Math.min(t[2],r[2]),e[3]=Math.min(t[3],r[3]),e}function Jr(e,t,r){return e[0]=Math.max(t[0],r[0]),e[1]=Math.max(t[1],r[1]),e[2]=Math.max(t[2],r[2]),e[3]=Math.max(t[3],r[3]),e}function es(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e[2]=Math.round(t[2]),e[3]=Math.round(t[3]),e}function ts(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e}function rs(e,t,r,s){return e[0]=t[0]+r[0]*s,e[1]=t[1]+r[1]*s,e[2]=t[2]+r[2]*s,e[3]=t[3]+r[3]*s,e}function ss(e,t){var r=t[0]-e[0],s=t[1]-e[1],n=t[2]-e[2],a=t[3]-e[3];return Math.hypot(r,s,n,a)}function ns(e,t){var r=t[0]-e[0],s=t[1]-e[1],n=t[2]-e[2],a=t[3]-e[3];return r*r+s*s+n*n+a*a}function as(e){var t=e[0],r=e[1],s=e[2],n=e[3];return Math.hypot(t,r,s,n)}function is(e){var t=e[0],r=e[1],s=e[2],n=e[3];return t*t+r*r+s*s+n*n}function os(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=-t[3],e}function ls(e,t){return e[0]=1/t[0],e[1]=1/t[1],e[2]=1/t[2],e[3]=1/t[3],e}function cs(e,t){var r=t[0],s=t[1],n=t[2],a=t[3],i=r*r+s*s+n*n+a*a;return i>0&&(i=1/Math.sqrt(i)),e[0]=r*i,e[1]=s*i,e[2]=n*i,e[3]=a*i,e}function us(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]*t[3]}function hs(e,t,r,s){var n=r[0]*s[1]-r[1]*s[0],a=r[0]*s[2]-r[2]*s[0],i=r[0]*s[3]-r[3]*s[0],o=r[1]*s[2]-r[2]*s[1],l=r[1]*s[3]-r[3]*s[1],c=r[2]*s[3]-r[3]*s[2],u=t[0],h=t[1],d=t[2],f=t[3];return e[0]=h*c-d*l+f*o,e[1]=-u*c+d*i-f*a,e[2]=u*l-h*i+f*n,e[3]=-u*o+h*a-d*n,e}function ds(e,t,r,s){var n=t[0],a=t[1],i=t[2],o=t[3];return e[0]=n+s*(r[0]-n),e[1]=a+s*(r[1]-a),e[2]=i+s*(r[2]-i),e[3]=o+s*(r[3]-o),e}function fs(e,t){var r,s,n,a,i,o;t=t||1;do{i=(r=2*m()-1)*r+(s=2*m()-1)*s}while(i>=1);do{o=(n=2*m()-1)*n+(a=2*m()-1)*a}while(o>=1);var l=Math.sqrt((1-i)/o);return e[0]=t*r,e[1]=t*s,e[2]=t*n*l,e[3]=t*a*l,e}function ps(e,t,r){var s=t[0],n=t[1],a=t[2],i=t[3];return e[0]=r[0]*s+r[4]*n+r[8]*a+r[12]*i,e[1]=r[1]*s+r[5]*n+r[9]*a+r[13]*i,e[2]=r[2]*s+r[6]*n+r[10]*a+r[14]*i,e[3]=r[3]*s+r[7]*n+r[11]*a+r[15]*i,e}function ms(e,t,r){var s=t[0],n=t[1],a=t[2],i=r[0],o=r[1],l=r[2],c=r[3],u=c*s+o*a-l*n,h=c*n+l*s-i*a,d=c*a+i*n-o*s,f=-i*s-o*n-l*a;return e[0]=u*c+f*-i+h*-l-d*-o,e[1]=h*c+f*-o+d*-i-u*-l,e[2]=d*c+f*-l+u*-o-h*-i,e[3]=t[3],e}function gs(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=0,e}function ys(e){return"vec4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"}function vs(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]}function bs(e,t){var r=e[0],s=e[1],n=e[2],a=e[3],i=t[0],o=t[1],l=t[2],c=t[3];return Math.abs(r-i)<=f*Math.max(1,Math.abs(r),Math.abs(i))&&Math.abs(s-o)<=f*Math.max(1,Math.abs(s),Math.abs(o))&&Math.abs(n-l)<=f*Math.max(1,Math.abs(n),Math.abs(l))&&Math.abs(a-c)<=f*Math.max(1,Math.abs(a),Math.abs(c))}var _s=$r,Ms=zr,xs=Yr,Ss=ss,Ts=ns,Es=as,ws=is,Rs=function(){var e=Gr();return function(t,r,s,n,a,i){var o,l;for(r||(r=4),s||(s=0),l=n?Math.min(n*r+s,t.length):t.length,o=s;o<l;o+=r)e[0]=t[o],e[1]=t[o+1],e[2]=t[o+2],e[3]=t[o+3],a(e,e,i),t[o]=e[0],t[o+1]=e[1],t[o+2]=e[2],t[o+3]=e[3];return t}}();function ks(){var e=new p(4);return p!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e[3]=1,e}function Is(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e}function Ps(e,t,r){r*=.5;var s=Math.sin(r);return e[0]=s*t[0],e[1]=s*t[1],e[2]=s*t[2],e[3]=Math.cos(r),e}function As(e,t){var r=2*Math.acos(t[3]),s=Math.sin(r/2);return s>f?(e[0]=t[0]/s,e[1]=t[1]/s,e[2]=t[2]/s):(e[0]=1,e[1]=0,e[2]=0),r}function Cs(e,t){var r=ln(e,t);return Math.acos(2*r*r-1)}function Ls(e,t,r){var s=t[0],n=t[1],a=t[2],i=t[3],o=r[0],l=r[1],c=r[2],u=r[3];return e[0]=s*u+i*o+n*c-a*l,e[1]=n*u+i*l+a*o-s*c,e[2]=a*u+i*c+s*l-n*o,e[3]=i*u-s*o-n*l-a*c,e}function Ds(e,t,r){r*=.5;var s=t[0],n=t[1],a=t[2],i=t[3],o=Math.sin(r),l=Math.cos(r);return e[0]=s*l+i*o,e[1]=n*l+a*o,e[2]=a*l-n*o,e[3]=i*l-s*o,e}function Fs(e,t,r){r*=.5;var s=t[0],n=t[1],a=t[2],i=t[3],o=Math.sin(r),l=Math.cos(r);return e[0]=s*l-a*o,e[1]=n*l+i*o,e[2]=a*l+s*o,e[3]=i*l-n*o,e}function Ns(e,t,r){r*=.5;var s=t[0],n=t[1],a=t[2],i=t[3],o=Math.sin(r),l=Math.cos(r);return e[0]=s*l+n*o,e[1]=n*l-s*o,e[2]=a*l+i*o,e[3]=i*l-a*o,e}function Os(e,t){var r=t[0],s=t[1],n=t[2];return e[0]=r,e[1]=s,e[2]=n,e[3]=Math.sqrt(Math.abs(1-r*r-s*s-n*n)),e}function Bs(e,t){var r=t[0],s=t[1],n=t[2],a=t[3],i=Math.sqrt(r*r+s*s+n*n),o=Math.exp(a),l=i>0?o*Math.sin(i)/i:0;return e[0]=r*l,e[1]=s*l,e[2]=n*l,e[3]=o*Math.cos(i),e}function Us(e,t){var r=t[0],s=t[1],n=t[2],a=t[3],i=Math.sqrt(r*r+s*s+n*n),o=i>0?Math.atan2(i,a)/i:0;return e[0]=r*o,e[1]=s*o,e[2]=n*o,e[3]=.5*Math.log(r*r+s*s+n*n+a*a),e}function Vs(e,t,r){return Us(e,t),on(e,e,r),Bs(e,e),e}function Gs(e,t,r,s){var n,a,i,o,l,c=t[0],u=t[1],h=t[2],d=t[3],p=r[0],m=r[1],g=r[2],y=r[3];return(a=c*p+u*m+h*g+d*y)<0&&(a=-a,p=-p,m=-m,g=-g,y=-y),1-a>f?(n=Math.acos(a),i=Math.sin(n),o=Math.sin((1-s)*n)/i,l=Math.sin(s*n)/i):(o=1-s,l=s),e[0]=o*c+l*p,e[1]=o*u+l*m,e[2]=o*h+l*g,e[3]=o*d+l*y,e}function js(e){var t=m(),r=m(),s=m(),n=Math.sqrt(1-t),a=Math.sqrt(t);return e[0]=n*Math.sin(2*Math.PI*r),e[1]=n*Math.cos(2*Math.PI*r),e[2]=a*Math.sin(2*Math.PI*s),e[3]=a*Math.cos(2*Math.PI*s),e}function Xs(e,t){var r=t[0],s=t[1],n=t[2],a=t[3],i=r*r+s*s+n*n+a*a,o=i?1/i:0;return e[0]=-r*o,e[1]=-s*o,e[2]=-n*o,e[3]=a*o,e}function Ws(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=t[3],e}function Hs(e,t){var r,s=t[0]+t[4]+t[8];if(s>0)r=Math.sqrt(s+1),e[3]=.5*r,r=.5/r,e[0]=(t[5]-t[7])*r,e[1]=(t[6]-t[2])*r,e[2]=(t[1]-t[3])*r;else{var n=0;t[4]>t[0]&&(n=1),t[8]>t[3*n+n]&&(n=2);var a=(n+1)%3,i=(n+2)%3;r=Math.sqrt(t[3*n+n]-t[3*a+a]-t[3*i+i]+1),e[n]=.5*r,r=.5/r,e[3]=(t[3*a+i]-t[3*i+a])*r,e[a]=(t[3*a+n]+t[3*n+a])*r,e[i]=(t[3*i+n]+t[3*n+i])*r}return e}function qs(e,t,r,s){var n=.5*Math.PI/180;t*=n,r*=n,s*=n;var a=Math.sin(t),i=Math.cos(t),o=Math.sin(r),l=Math.cos(r),c=Math.sin(s),u=Math.cos(s);return e[0]=a*l*u-i*o*c,e[1]=i*o*u+a*l*c,e[2]=i*l*c-a*o*u,e[3]=i*l*u+a*o*c,e}function $s(e){return"quat("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"}var zs,Ys,Ks,Zs,Qs,Js,en=jr,tn=Xr,rn=Wr,sn=Hr,nn=qr,an=Ls,on=ts,ln=us,cn=ds,un=as,hn=un,dn=is,fn=dn,pn=cs,mn=vs,gn=bs,yn=(zs=qt(),Ys=Yt(1,0,0),Ks=Yt(0,1,0),function(e,t,r){var s=mr(t,r);return s<-.999999?(gr(zs,Ys,t),Br(zs)<1e-6&&gr(zs,Ks,t),pr(zs,zs),Ps(e,zs,Math.PI),e):s>.999999?(e[0]=0,e[1]=0,e[2]=0,e[3]=1,e):(gr(zs,t,r),e[0]=zs[0],e[1]=zs[1],e[2]=zs[2],e[3]=1+s,pn(e,e))}),vn=(Zs=ks(),Qs=ks(),function(e,t,r,s,n,a){return Gs(Zs,t,n,a),Gs(Qs,r,s,a),Gs(e,Zs,Qs,2*a*(1-a)),e}),bn=(Js=ye(),function(e,t,r,s){return Js[0]=r[0],Js[3]=r[1],Js[6]=r[2],Js[1]=s[0],Js[4]=s[1],Js[7]=s[2],Js[2]=-t[0],Js[5]=-t[1],Js[8]=-t[2],pn(e,Hs(e,Js))});function _n(){var e=new p(8);return p!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0,e[4]=0,e[5]=0,e[6]=0,e[7]=0),e[3]=1,e}function Mn(e){var t=new p(8);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t}function xn(e,t,r,s,n,a,i,o){var l=new p(8);return l[0]=e,l[1]=t,l[2]=r,l[3]=s,l[4]=n,l[5]=a,l[6]=i,l[7]=o,l}function Sn(e,t,r,s,n,a,i){var o=new p(8);o[0]=e,o[1]=t,o[2]=r,o[3]=s;var l=.5*n,c=.5*a,u=.5*i;return o[4]=l*s+c*r-u*t,o[5]=c*s+u*e-l*r,o[6]=u*s+l*t-c*e,o[7]=-l*e-c*t-u*r,o}function Tn(e,t,r){var s=.5*r[0],n=.5*r[1],a=.5*r[2],i=t[0],o=t[1],l=t[2],c=t[3];return e[0]=i,e[1]=o,e[2]=l,e[3]=c,e[4]=s*c+n*l-a*o,e[5]=n*c+a*i-s*l,e[6]=a*c+s*o-n*i,e[7]=-s*i-n*o-a*l,e}function En(e,t){return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e[4]=.5*t[0],e[5]=.5*t[1],e[6]=.5*t[2],e[7]=0,e}function wn(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=0,e[5]=0,e[6]=0,e[7]=0,e}function Rn(e,t){var r=ks();xt(r,t);var s=new p(3);return _t(s,t),Tn(e,r,s),e}function kn(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e}function In(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e[4]=0,e[5]=0,e[6]=0,e[7]=0,e}function Pn(e,t,r,s,n,a,i,o,l){return e[0]=t,e[1]=r,e[2]=s,e[3]=n,e[4]=a,e[5]=i,e[6]=o,e[7]=l,e}var An=rn;function Cn(e,t){return e[0]=t[4],e[1]=t[5],e[2]=t[6],e[3]=t[7],e}var Ln=rn;function Dn(e,t){return e[4]=t[0],e[5]=t[1],e[6]=t[2],e[7]=t[3],e}function Fn(e,t){var r=t[4],s=t[5],n=t[6],a=t[7],i=-t[0],o=-t[1],l=-t[2],c=t[3];return e[0]=2*(r*c+a*i+s*l-n*o),e[1]=2*(s*c+a*o+n*i-r*l),e[2]=2*(n*c+a*l+r*o-s*i),e}function Nn(e,t,r){var s=t[0],n=t[1],a=t[2],i=t[3],o=.5*r[0],l=.5*r[1],c=.5*r[2],u=t[4],h=t[5],d=t[6],f=t[7];return e[0]=s,e[1]=n,e[2]=a,e[3]=i,e[4]=i*o+n*c-a*l+u,e[5]=i*l+a*o-s*c+h,e[6]=i*c+s*l-n*o+d,e[7]=-s*o-n*l-a*c+f,e}function On(e,t,r){var s=-t[0],n=-t[1],a=-t[2],i=t[3],o=t[4],l=t[5],c=t[6],u=t[7],h=o*i+u*s+l*a-c*n,d=l*i+u*n+c*s-o*a,f=c*i+u*a+o*n-l*s,p=u*i-o*s-l*n-c*a;return Ds(e,t,r),s=e[0],n=e[1],a=e[2],i=e[3],e[4]=h*i+p*s+d*a-f*n,e[5]=d*i+p*n+f*s-h*a,e[6]=f*i+p*a+h*n-d*s,e[7]=p*i-h*s-d*n-f*a,e}function Bn(e,t,r){var s=-t[0],n=-t[1],a=-t[2],i=t[3],o=t[4],l=t[5],c=t[6],u=t[7],h=o*i+u*s+l*a-c*n,d=l*i+u*n+c*s-o*a,f=c*i+u*a+o*n-l*s,p=u*i-o*s-l*n-c*a;return Fs(e,t,r),s=e[0],n=e[1],a=e[2],i=e[3],e[4]=h*i+p*s+d*a-f*n,e[5]=d*i+p*n+f*s-h*a,e[6]=f*i+p*a+h*n-d*s,e[7]=p*i-h*s-d*n-f*a,e}function Un(e,t,r){var s=-t[0],n=-t[1],a=-t[2],i=t[3],o=t[4],l=t[5],c=t[6],u=t[7],h=o*i+u*s+l*a-c*n,d=l*i+u*n+c*s-o*a,f=c*i+u*a+o*n-l*s,p=u*i-o*s-l*n-c*a;return Ns(e,t,r),s=e[0],n=e[1],a=e[2],i=e[3],e[4]=h*i+p*s+d*a-f*n,e[5]=d*i+p*n+f*s-h*a,e[6]=f*i+p*a+h*n-d*s,e[7]=p*i-h*s-d*n-f*a,e}function Vn(e,t,r){var s=r[0],n=r[1],a=r[2],i=r[3],o=t[0],l=t[1],c=t[2],u=t[3];return e[0]=o*i+u*s+l*a-c*n,e[1]=l*i+u*n+c*s-o*a,e[2]=c*i+u*a+o*n-l*s,e[3]=u*i-o*s-l*n-c*a,o=t[4],l=t[5],c=t[6],u=t[7],e[4]=o*i+u*s+l*a-c*n,e[5]=l*i+u*n+c*s-o*a,e[6]=c*i+u*a+o*n-l*s,e[7]=u*i-o*s-l*n-c*a,e}function Gn(e,t,r){var s=t[0],n=t[1],a=t[2],i=t[3],o=r[0],l=r[1],c=r[2],u=r[3];return e[0]=s*u+i*o+n*c-a*l,e[1]=n*u+i*l+a*o-s*c,e[2]=a*u+i*c+s*l-n*o,e[3]=i*u-s*o-n*l-a*c,o=r[4],l=r[5],c=r[6],u=r[7],e[4]=s*u+i*o+n*c-a*l,e[5]=n*u+i*l+a*o-s*c,e[6]=a*u+i*c+s*l-n*o,e[7]=i*u-s*o-n*l-a*c,e}function jn(e,t,r,s){if(Math.abs(s)<f)return kn(e,t);var n=Math.hypot(r[0],r[1],r[2]);s*=.5;var a=Math.sin(s),i=a*r[0]/n,o=a*r[1]/n,l=a*r[2]/n,c=Math.cos(s),u=t[0],h=t[1],d=t[2],p=t[3];e[0]=u*c+p*i+h*l-d*o,e[1]=h*c+p*o+d*i-u*l,e[2]=d*c+p*l+u*o-h*i,e[3]=p*c-u*i-h*o-d*l;var m=t[4],g=t[5],y=t[6],v=t[7];return e[4]=m*c+v*i+g*l-y*o,e[5]=g*c+v*o+y*i-m*l,e[6]=y*c+v*l+m*o-g*i,e[7]=v*c-m*i-g*o-y*l,e}function Xn(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e[3]=t[3]+r[3],e[4]=t[4]+r[4],e[5]=t[5]+r[5],e[6]=t[6]+r[6],e[7]=t[7]+r[7],e}function Wn(e,t,r){var s=t[0],n=t[1],a=t[2],i=t[3],o=r[4],l=r[5],c=r[6],u=r[7],h=t[4],d=t[5],f=t[6],p=t[7],m=r[0],g=r[1],y=r[2],v=r[3];return e[0]=s*v+i*m+n*y-a*g,e[1]=n*v+i*g+a*m-s*y,e[2]=a*v+i*y+s*g-n*m,e[3]=i*v-s*m-n*g-a*y,e[4]=s*u+i*o+n*c-a*l+h*v+p*m+d*y-f*g,e[5]=n*u+i*l+a*o-s*c+d*v+p*g+f*m-h*y,e[6]=a*u+i*c+s*l-n*o+f*v+p*y+h*g-d*m,e[7]=i*u-s*o-n*l-a*c+p*v-h*m-d*g-f*y,e}var Hn=Wn;function qn(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e[4]=t[4]*r,e[5]=t[5]*r,e[6]=t[6]*r,e[7]=t[7]*r,e}var $n=ln;function zn(e,t,r,s){var n=1-s;return $n(t,r)<0&&(s=-s),e[0]=t[0]*n+r[0]*s,e[1]=t[1]*n+r[1]*s,e[2]=t[2]*n+r[2]*s,e[3]=t[3]*n+r[3]*s,e[4]=t[4]*n+r[4]*s,e[5]=t[5]*n+r[5]*s,e[6]=t[6]*n+r[6]*s,e[7]=t[7]*n+r[7]*s,e}function Yn(e,t){var r=Jn(t);return e[0]=-t[0]/r,e[1]=-t[1]/r,e[2]=-t[2]/r,e[3]=t[3]/r,e[4]=-t[4]/r,e[5]=-t[5]/r,e[6]=-t[6]/r,e[7]=t[7]/r,e}function Kn(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=t[3],e[4]=-t[4],e[5]=-t[5],e[6]=-t[6],e[7]=t[7],e}var Zn=un,Qn=Zn,Jn=dn,ea=Jn;function ta(e,t){var r=Jn(t);if(r>0){r=Math.sqrt(r);var s=t[0]/r,n=t[1]/r,a=t[2]/r,i=t[3]/r,o=t[4],l=t[5],c=t[6],u=t[7],h=s*o+n*l+a*c+i*u;e[0]=s,e[1]=n,e[2]=a,e[3]=i,e[4]=(o-s*h)/r,e[5]=(l-n*h)/r,e[6]=(c-a*h)/r,e[7]=(u-i*h)/r}return e}function ra(e){return"quat2("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+")"}function sa(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]}function na(e,t){var r=e[0],s=e[1],n=e[2],a=e[3],i=e[4],o=e[5],l=e[6],c=e[7],u=t[0],h=t[1],d=t[2],p=t[3],m=t[4],g=t[5],y=t[6],v=t[7];return Math.abs(r-u)<=f*Math.max(1,Math.abs(r),Math.abs(u))&&Math.abs(s-h)<=f*Math.max(1,Math.abs(s),Math.abs(h))&&Math.abs(n-d)<=f*Math.max(1,Math.abs(n),Math.abs(d))&&Math.abs(a-p)<=f*Math.max(1,Math.abs(a),Math.abs(p))&&Math.abs(i-m)<=f*Math.max(1,Math.abs(i),Math.abs(m))&&Math.abs(o-g)<=f*Math.max(1,Math.abs(o),Math.abs(g))&&Math.abs(l-y)<=f*Math.max(1,Math.abs(l),Math.abs(y))&&Math.abs(c-v)<=f*Math.max(1,Math.abs(c),Math.abs(v))}function aa(){var e=new p(2);return p!=Float32Array&&(e[0]=0,e[1]=0),e}function ia(e){var t=new p(2);return t[0]=e[0],t[1]=e[1],t}function oa(e,t){var r=new p(2);return r[0]=e,r[1]=t,r}function la(e,t){return e[0]=t[0],e[1]=t[1],e}function ca(e,t,r){return e[0]=t,e[1]=r,e}function ua(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e}function ha(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e}function da(e,t,r){return e[0]=t[0]*r[0],e[1]=t[1]*r[1],e}function fa(e,t,r){return e[0]=t[0]/r[0],e[1]=t[1]/r[1],e}function pa(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e}function ma(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e}function ga(e,t,r){return e[0]=Math.min(t[0],r[0]),e[1]=Math.min(t[1],r[1]),e}function ya(e,t,r){return e[0]=Math.max(t[0],r[0]),e[1]=Math.max(t[1],r[1]),e}function va(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e}function ba(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e}function _a(e,t,r,s){return e[0]=t[0]+r[0]*s,e[1]=t[1]+r[1]*s,e}function Ma(e,t){var r=t[0]-e[0],s=t[1]-e[1];return Math.hypot(r,s)}function xa(e,t){var r=t[0]-e[0],s=t[1]-e[1];return r*r+s*s}function Sa(e){var t=e[0],r=e[1];return Math.hypot(t,r)}function Ta(e){var t=e[0],r=e[1];return t*t+r*r}function Ea(e,t){return e[0]=-t[0],e[1]=-t[1],e}function wa(e,t){return e[0]=1/t[0],e[1]=1/t[1],e}function Ra(e,t){var r=t[0],s=t[1],n=r*r+s*s;return n>0&&(n=1/Math.sqrt(n)),e[0]=t[0]*n,e[1]=t[1]*n,e}function ka(e,t){return e[0]*t[0]+e[1]*t[1]}function Ia(e,t,r){var s=t[0]*r[1]-t[1]*r[0];return e[0]=e[1]=0,e[2]=s,e}function Pa(e,t,r,s){var n=t[0],a=t[1];return e[0]=n+s*(r[0]-n),e[1]=a+s*(r[1]-a),e}function Aa(e,t){t=t||1;var r=2*m()*Math.PI;return e[0]=Math.cos(r)*t,e[1]=Math.sin(r)*t,e}function Ca(e,t,r){var s=t[0],n=t[1];return e[0]=r[0]*s+r[2]*n,e[1]=r[1]*s+r[3]*n,e}function La(e,t,r){var s=t[0],n=t[1];return e[0]=r[0]*s+r[2]*n+r[4],e[1]=r[1]*s+r[3]*n+r[5],e}function Da(e,t,r){var s=t[0],n=t[1];return e[0]=r[0]*s+r[3]*n+r[6],e[1]=r[1]*s+r[4]*n+r[7],e}function Fa(e,t,r){var s=t[0],n=t[1];return e[0]=r[0]*s+r[4]*n+r[12],e[1]=r[1]*s+r[5]*n+r[13],e}function Na(e,t,r,s){var n=t[0]-r[0],a=t[1]-r[1],i=Math.sin(s),o=Math.cos(s);return e[0]=n*o-a*i+r[0],e[1]=n*i+a*o+r[1],e}function Oa(e,t){var r=e[0],s=e[1],n=t[0],a=t[1],i=Math.sqrt(r*r+s*s)*Math.sqrt(n*n+a*a),o=i&&(r*n+s*a)/i;return Math.acos(Math.min(Math.max(o,-1),1))}function Ba(e){return e[0]=0,e[1]=0,e}function Ua(e){return"vec2("+e[0]+", "+e[1]+")"}function Va(e,t){return e[0]===t[0]&&e[1]===t[1]}function Ga(e,t){var r=e[0],s=e[1],n=t[0],a=t[1];return Math.abs(r-n)<=f*Math.max(1,Math.abs(r),Math.abs(n))&&Math.abs(s-a)<=f*Math.max(1,Math.abs(s),Math.abs(a))}var ja=Sa,Xa=ha,Wa=da,Ha=fa,qa=Ma,$a=xa,za=Ta,Ya=function(){var e=aa();return function(t,r,s,n,a,i){var o,l;for(r||(r=2),s||(s=0),l=n?Math.min(n*r+s,t.length):t.length,o=s;o<l;o+=r)e[0]=t[o],e[1]=t[o+1],a(e,e,i),t[o]=e[0],t[o+1]=e[1];return t}}()},172:(e,t,r)=>{"use strict";r.r(t),r.d(t,{Component:()=>E,Fragment:()=>T,cloneElement:()=>q,createContext:()=>$,createElement:()=>M,createRef:()=>S,h:()=>M,hydrate:()=>H,isValidElement:()=>i,options:()=>n,render:()=>W,toChildArray:()=>L});var s,n,a,i,o,l,c,u,h,d,f,p,m={},g=[],y=/acit|ex(?:s|g|n|p|$)|rph|grid|ows|mnc|ntw|ine[ch]|zoo|^ord|itera/i,v=Array.isArray;function b(e,t){for(var r in t)e[r]=t[r];return e}function _(e){var t=e.parentNode;t&&t.removeChild(e)}function M(e,t,r){var n,a,i,o={};for(i in t)"key"==i?n=t[i]:"ref"==i?a=t[i]:o[i]=t[i];if(arguments.length>2&&(o.children=arguments.length>3?s.call(arguments,2):r),"function"==typeof e&&null!=e.defaultProps)for(i in e.defaultProps)void 0===o[i]&&(o[i]=e.defaultProps[i]);return x(e,o,n,a,null)}function x(e,t,r,s,i){var o={type:e,props:t,key:r,ref:s,__k:null,__:null,__b:0,__e:null,__d:void 0,__c:null,constructor:void 0,__v:null==i?++a:i,__i:-1,__u:0};return null==i&&null!=n.vnode&&n.vnode(o),o}function S(){return{current:null}}function T(e){return e.children}function E(e,t){this.props=e,this.context=t}function w(e,t){if(null==t)return e.__?w(e.__,e.__i+1):null;for(var r;t<e.__k.length;t++)if(null!=(r=e.__k[t])&&null!=r.__e)return r.__e;return"function"==typeof e.type?w(e):null}function R(e){var t,r;if(null!=(e=e.__)&&null!=e.__c){for(e.__e=e.__c.base=null,t=0;t<e.__k.length;t++)if(null!=(r=e.__k[t])&&null!=r.__e){e.__e=e.__c.base=r.__e;break}return R(e)}}function k(e){(!e.__d&&(e.__d=!0)&&o.push(e)&&!I.__r++||l!==n.debounceRendering)&&((l=n.debounceRendering)||c)(I)}function I(){var e,t,r,s,a,i,l,c;for(o.sort(u);e=o.shift();)e.__d&&(t=o.length,s=void 0,i=(a=(r=e).__v).__e,l=[],c=[],r.__P&&((s=b({},a)).__v=a.__v+1,n.vnode&&n.vnode(s),B(r.__P,s,a,r.__n,r.__P.namespaceURI,32&a.__u?[i]:null,l,null==i?w(a):i,!!(32&a.__u),c),s.__v=a.__v,s.__.__k[s.__i]=s,U(l,s,c),s.__e!=i&&R(s)),o.length>t&&o.sort(u));I.__r=0}function P(e,t,r,s,n,a,i,o,l,c,u){var h,d,f,p,y,v=s&&s.__k||g,b=t.length;for(r.__d=l,A(r,t,v),l=r.__d,h=0;h<b;h++)null!=(f=r.__k[h])&&"boolean"!=typeof f&&"function"!=typeof f&&(d=-1===f.__i?m:v[f.__i]||m,f.__i=h,B(e,f,d,n,a,i,o,l,c,u),p=f.__e,f.ref&&d.ref!=f.ref&&(d.ref&&G(d.ref,null,f),u.push(f.ref,f.__c||p,f)),null==y&&null!=p&&(y=p),65536&f.__u||d.__k===f.__k?l=C(f,l,e):"function"==typeof f.type&&void 0!==f.__d?l=f.__d:p&&(l=p.nextSibling),f.__d=void 0,f.__u&=-196609);r.__d=l,r.__e=y}function A(e,t,r){var s,n,a,i,o,l=t.length,c=r.length,u=c,h=0;for(e.__k=[],s=0;s<l;s++)i=s+h,null!=(n=e.__k[s]=null==(n=t[s])||"boolean"==typeof n||"function"==typeof n?null:"string"==typeof n||"number"==typeof n||"bigint"==typeof n||n.constructor==String?x(null,n,null,null,null):v(n)?x(T,{children:n},null,null,null):void 0===n.constructor&&n.__b>0?x(n.type,n.props,n.key,n.ref?n.ref:null,n.__v):n)?(n.__=e,n.__b=e.__b+1,o=D(n,r,i,u),n.__i=o,a=null,-1!==o&&(u--,(a=r[o])&&(a.__u|=131072)),null==a||null===a.__v?(-1==o&&h--,"function"!=typeof n.type&&(n.__u|=65536)):o!==i&&(o==i-1?h--:o==i+1?h++:o>i?u>l-i?h+=o-i:h--:o<i&&(o==i-h?h-=o-i:h++),o!==s+h&&(n.__u|=65536))):(a=r[i])&&null==a.key&&a.__e&&0==(131072&a.__u)&&(a.__e==e.__d&&(e.__d=w(a)),j(a,a,!1),r[i]=null,u--);if(u)for(s=0;s<c;s++)null!=(a=r[s])&&0==(131072&a.__u)&&(a.__e==e.__d&&(e.__d=w(a)),j(a,a))}function C(e,t,r){var s,n;if("function"==typeof e.type){for(s=e.__k,n=0;s&&n<s.length;n++)s[n]&&(s[n].__=e,t=C(s[n],t,r));return t}e.__e!=t&&(t&&e.type&&!r.contains(t)&&(t=w(e)),r.insertBefore(e.__e,t||null),t=e.__e);do{t=t&&t.nextSibling}while(null!=t&&8===t.nodeType);return t}function L(e,t){return t=t||[],null==e||"boolean"==typeof e||(v(e)?e.some((function(e){L(e,t)})):t.push(e)),t}function D(e,t,r,s){var n=e.key,a=e.type,i=r-1,o=r+1,l=t[r];if(null===l||l&&n==l.key&&a===l.type&&0==(131072&l.__u))return r;if(s>(null!=l&&0==(131072&l.__u)?1:0))for(;i>=0||o<t.length;){if(i>=0){if((l=t[i])&&0==(131072&l.__u)&&n==l.key&&a===l.type)return i;i--}if(o<t.length){if((l=t[o])&&0==(131072&l.__u)&&n==l.key&&a===l.type)return o;o++}}return-1}function F(e,t,r){"-"===t[0]?e.setProperty(t,null==r?"":r):e[t]=null==r?"":"number"!=typeof r||y.test(t)?r:r+"px"}function N(e,t,r,s,n){var a;e:if("style"===t)if("string"==typeof r)e.style.cssText=r;else{if("string"==typeof s&&(e.style.cssText=s=""),s)for(t in s)r&&t in r||F(e.style,t,"");if(r)for(t in r)s&&r[t]===s[t]||F(e.style,t,r[t])}else if("o"===t[0]&&"n"===t[1])a=t!==(t=t.replace(/(PointerCapture)$|Capture$/i,"$1")),t=t.toLowerCase()in e||"onFocusOut"===t||"onFocusIn"===t?t.toLowerCase().slice(2):t.slice(2),e.l||(e.l={}),e.l[t+a]=r,r?s?r.u=s.u:(r.u=h,e.addEventListener(t,a?f:d,a)):e.removeEventListener(t,a?f:d,a);else{if("http://www.w3.org/2000/svg"==n)t=t.replace(/xlink(H|:h)/,"h").replace(/sName$/,"s");else if("width"!=t&&"height"!=t&&"href"!=t&&"list"!=t&&"form"!=t&&"tabIndex"!=t&&"download"!=t&&"rowSpan"!=t&&"colSpan"!=t&&"role"!=t&&"popover"!=t&&t in e)try{e[t]=null==r?"":r;break e}catch(e){}"function"==typeof r||(null==r||!1===r&&"-"!==t[4]?e.removeAttribute(t):e.setAttribute(t,"popover"==t&&1==r?"":r))}}function O(e){return function(t){if(this.l){var r=this.l[t.type+e];if(null==t.t)t.t=h++;else if(t.t<r.u)return;return r(n.event?n.event(t):t)}}}function B(e,t,r,s,a,i,o,l,c,u){var h,d,f,p,m,g,y,_,M,x,S,w,R,k,I,A,C=t.type;if(void 0!==t.constructor)return null;128&r.__u&&(c=!!(32&r.__u),i=[l=t.__e=r.__e]),(h=n.__b)&&h(t);e:if("function"==typeof C)try{if(_=t.props,M="prototype"in C&&C.prototype.render,x=(h=C.contextType)&&s[h.__c],S=h?x?x.props.value:h.__:s,r.__c?y=(d=t.__c=r.__c).__=d.__E:(M?t.__c=d=new C(_,S):(t.__c=d=new E(_,S),d.constructor=C,d.render=X),x&&x.sub(d),d.props=_,d.state||(d.state={}),d.context=S,d.__n=s,f=d.__d=!0,d.__h=[],d._sb=[]),M&&null==d.__s&&(d.__s=d.state),M&&null!=C.getDerivedStateFromProps&&(d.__s==d.state&&(d.__s=b({},d.__s)),b(d.__s,C.getDerivedStateFromProps(_,d.__s))),p=d.props,m=d.state,d.__v=t,f)M&&null==C.getDerivedStateFromProps&&null!=d.componentWillMount&&d.componentWillMount(),M&&null!=d.componentDidMount&&d.__h.push(d.componentDidMount);else{if(M&&null==C.getDerivedStateFromProps&&_!==p&&null!=d.componentWillReceiveProps&&d.componentWillReceiveProps(_,S),!d.__e&&(null!=d.shouldComponentUpdate&&!1===d.shouldComponentUpdate(_,d.__s,S)||t.__v===r.__v)){for(t.__v!==r.__v&&(d.props=_,d.state=d.__s,d.__d=!1),t.__e=r.__e,t.__k=r.__k,t.__k.forEach((function(e){e&&(e.__=t)})),w=0;w<d._sb.length;w++)d.__h.push(d._sb[w]);d._sb=[],d.__h.length&&o.push(d);break e}null!=d.componentWillUpdate&&d.componentWillUpdate(_,d.__s,S),M&&null!=d.componentDidUpdate&&d.__h.push((function(){d.componentDidUpdate(p,m,g)}))}if(d.context=S,d.props=_,d.__P=e,d.__e=!1,R=n.__r,k=0,M){for(d.state=d.__s,d.__d=!1,R&&R(t),h=d.render(d.props,d.state,d.context),I=0;I<d._sb.length;I++)d.__h.push(d._sb[I]);d._sb=[]}else do{d.__d=!1,R&&R(t),h=d.render(d.props,d.state,d.context),d.state=d.__s}while(d.__d&&++k<25);d.state=d.__s,null!=d.getChildContext&&(s=b(b({},s),d.getChildContext())),M&&!f&&null!=d.getSnapshotBeforeUpdate&&(g=d.getSnapshotBeforeUpdate(p,m)),P(e,v(A=null!=h&&h.type===T&&null==h.key?h.props.children:h)?A:[A],t,r,s,a,i,o,l,c,u),d.base=t.__e,t.__u&=-161,d.__h.length&&o.push(d),y&&(d.__E=d.__=null)}catch(e){if(t.__v=null,c||null!=i){for(t.__u|=c?160:32;l&&8===l.nodeType&&l.nextSibling;)l=l.nextSibling;i[i.indexOf(l)]=null,t.__e=l}else t.__e=r.__e,t.__k=r.__k;n.__e(e,t,r)}else null==i&&t.__v===r.__v?(t.__k=r.__k,t.__e=r.__e):t.__e=V(r.__e,t,r,s,a,i,o,c,u);(h=n.diffed)&&h(t)}function U(e,t,r){t.__d=void 0;for(var s=0;s<r.length;s++)G(r[s],r[++s],r[++s]);n.__c&&n.__c(t,e),e.some((function(t){try{e=t.__h,t.__h=[],e.some((function(e){e.call(t)}))}catch(e){n.__e(e,t.__v)}}))}function V(e,t,r,n,a,i,o,l,c){var u,h,d,f,p,g,y,b=r.props,M=t.props,x=t.type;if("svg"===x?a="http://www.w3.org/2000/svg":"math"===x?a="http://www.w3.org/1998/Math/MathML":a||(a="http://www.w3.org/1999/xhtml"),null!=i)for(u=0;u<i.length;u++)if((p=i[u])&&"setAttribute"in p==!!x&&(x?p.localName===x:3===p.nodeType)){e=p,i[u]=null;break}if(null==e){if(null===x)return document.createTextNode(M);e=document.createElementNS(a,x,M.is&&M),i=null,l=!1}if(null===x)b===M||l&&e.data===M||(e.data=M);else{if(i=i&&s.call(e.childNodes),b=r.props||m,!l&&null!=i)for(b={},u=0;u<e.attributes.length;u++)b[(p=e.attributes[u]).name]=p.value;for(u in b)if(p=b[u],"children"==u);else if("dangerouslySetInnerHTML"==u)d=p;else if("key"!==u&&!(u in M)){if("value"==u&&"defaultValue"in M||"checked"==u&&"defaultChecked"in M)continue;N(e,u,null,p,a)}for(u in M)p=M[u],"children"==u?f=p:"dangerouslySetInnerHTML"==u?h=p:"value"==u?g=p:"checked"==u?y=p:"key"===u||l&&"function"!=typeof p||b[u]===p||N(e,u,p,b[u],a);if(h)l||d&&(h.__html===d.__html||h.__html===e.innerHTML)||(e.innerHTML=h.__html),t.__k=[];else if(d&&(e.innerHTML=""),P(e,v(f)?f:[f],t,r,n,"foreignObject"===x?"http://www.w3.org/1999/xhtml":a,i,o,i?i[0]:r.__k&&w(r,0),l,c),null!=i)for(u=i.length;u--;)null!=i[u]&&_(i[u]);l||(u="value",void 0!==g&&(g!==e[u]||"progress"===x&&!g||"option"===x&&g!==b[u])&&N(e,u,g,b[u],a),u="checked",void 0!==y&&y!==e[u]&&N(e,u,y,b[u],a))}return e}function G(e,t,r){try{if("function"==typeof e){var s="function"==typeof e.__u;s&&e.__u(),s&&null==t||(e.__u=e(t))}else e.current=t}catch(e){n.__e(e,r)}}function j(e,t,r){var s,a;if(n.unmount&&n.unmount(e),(s=e.ref)&&(s.current&&s.current!==e.__e||G(s,null,t)),null!=(s=e.__c)){if(s.componentWillUnmount)try{s.componentWillUnmount()}catch(e){n.__e(e,t)}s.base=s.__P=null}if(s=e.__k)for(a=0;a<s.length;a++)s[a]&&j(s[a],t,r||"function"!=typeof e.type);r||null==e.__e||_(e.__e),e.__c=e.__=e.__e=e.__d=void 0}function X(e,t,r){return this.constructor(e,r)}function W(e,t,r){var a,i,o,l;n.__&&n.__(e,t),i=(a="function"==typeof r)?null:r&&r.__k||t.__k,o=[],l=[],B(t,e=(!a&&r||t).__k=M(T,null,[e]),i||m,m,t.namespaceURI,!a&&r?[r]:i?null:t.firstChild?s.call(t.childNodes):null,o,!a&&r?r:i?i.__e:t.firstChild,a,l),U(o,e,l)}function H(e,t){W(e,t,H)}function q(e,t,r){var n,a,i,o,l=b({},e.props);for(i in e.type&&e.type.defaultProps&&(o=e.type.defaultProps),t)"key"==i?n=t[i]:"ref"==i?a=t[i]:l[i]=void 0===t[i]&&void 0!==o?o[i]:t[i];return arguments.length>2&&(l.children=arguments.length>3?s.call(arguments,2):r),x(e.type,l,n||e.key,a||e.ref,null)}function $(e,t){var r={__c:t="__cC"+p++,__:e,Consumer:function(e,t){return e.children(t)},Provider:function(e){var r,s;return this.getChildContext||(r=[],(s={})[t]=this,this.getChildContext=function(){return s},this.componentWillUnmount=function(){r=null},this.shouldComponentUpdate=function(e){this.props.value!==e.value&&r.some((function(e){e.__e=!0,k(e)}))},this.sub=function(e){r.push(e);var t=e.componentWillUnmount;e.componentWillUnmount=function(){r&&r.splice(r.indexOf(e),1),t&&t.call(e)}}),e.children}};return r.Provider.__=r.Consumer.contextType=r}s=g.slice,n={__e:function(e,t,r,s){for(var n,a,i;t=t.__;)if((n=t.__c)&&!n.__)try{if((a=n.constructor)&&null!=a.getDerivedStateFromError&&(n.setState(a.getDerivedStateFromError(e)),i=n.__d),null!=n.componentDidCatch&&(n.componentDidCatch(e,s||{}),i=n.__d),i)return n.__E=n}catch(t){e=t}throw e}},a=0,i=function(e){return null!=e&&null==e.constructor},E.prototype.setState=function(e,t){var r;r=null!=this.__s&&this.__s!==this.state?this.__s:this.__s=b({},this.state),"function"==typeof e&&(e=e(b({},r),this.props)),e&&b(r,e),null!=e&&this.__v&&(t&&this._sb.push(t),k(this))},E.prototype.forceUpdate=function(e){this.__v&&(this.__e=!0,e&&this.__h.push(e),k(this))},E.prototype.render=T,o=[],c="function"==typeof Promise?Promise.prototype.then.bind(Promise.resolve()):setTimeout,u=function(e,t){return e.__v.__b-t.__v.__b},I.__r=0,h=0,d=O(!1),f=O(!0),p=0},8748:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BitStream=t.BitView=void 0;class r{constructor(e){this.view=new Uint8Array(e,0,e.byteLength)}getBits(e,t,r=!1){if(t>8*this.view.length-e)throw new Error("Bits out of bounds");let s=0;for(let r=0;r<t;){const n=t-r,a=7&e,i=this.view[e>>3],o=Math.min(n,8-a);s|=(i>>a&(1<<o)-1)<<r,e+=o,r+=o}return r?(32!==t&&s&1<<t-1&&(s|=-1^(1<<t)-1),s):s>>>0}getInt8(e){return this.getBits(e,8,!0)}getUint8(e){return this.getBits(e,8,!1)}getInt16(e){return this.getBits(e,16,!0)}getUint16(e){return this.getBits(e,16,!1)}getInt32(e){return this.getBits(e,32,!0)}getUint32(e){return this.getBits(e,32,!1)}getFloat32(e){return r.scratch.setUint32(0,this.getUint32(e)),r.scratch.getFloat32(0)}getFloat64(e){return r.scratch.setUint32(0,this.getUint32(e)),r.scratch.setUint32(4,this.getUint32(e+32)),r.scratch.getFloat64(0)}}t.BitView=r,r.scratch=new DataView(new ArrayBuffer(8));t.BitStream=class{constructor(e){this.view=new r(e),this.index=0}readBits(e,t=!1){const r=this.view.getBits(this.index,e,t);return this.index+=e,r}readInt8(){const e=this.view.getInt8(this.index);return this.index+=8,e}readUint8(){const e=this.view.getUint8(this.index);return this.index+=8,e}readInt16(){const e=this.view.getInt16(this.index);return this.index+=16,e}readUint16(){const e=this.view.getUint16(this.index);return this.index+=16,e}readInt32(){const e=this.view.getInt32(this.index);return this.index+=32,e}readUint32(){const e=this.view.getUint32(this.index);return this.index+=32,e}readFloat32(){const e=this.view.getFloat32(this.index);return this.index+=32,e}readFloat64(){const e=this.view.getFloat64(this.index);return this.index+=64,e}readString(e=0,t=!1){let r=0;const s=[];let n=!0;for(;!e||e&&r<e;){const t=this.readUint8();if(0===t&&(n=!1,!e))break;n&&s.push(t),r++}const a=String.fromCharCode.apply(null,s);if(!t)return a;try{return decodeURIComponent(a)}catch(e){return a}}}},1269:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Bsp=void 0;t.Bsp=class{constructor(e,t,r,s,n){this.skies=[],this.sprites={},this.name=e,this.entities=t,this.textures=r,this.models=s,this.lightmap=n}}},4932:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Config=void 0;class r{static init(e){return new r("string"==typeof e?{paths:{base:e,replays:`${e}/replays`,maps:`${e}/maps`,wads:`${e}/wads`,skies:`${e}/skies`,sounds:`${e}/sounds`}}:{paths:{base:e&&e.paths&&e.paths.base||"",replays:e&&e.paths&&e.paths.replays||"/replays",maps:e&&e.paths&&e.paths.maps||"/maps",wads:e&&e.paths&&e.paths.wads||"/wads",skies:e&&e.paths&&e.paths.skies||"/skies",sounds:e&&e.paths&&e.paths.sounds||"/sounds"}})}constructor(e){this.paths=Object.assign({},e.paths)}getBasePath(){return this.paths.base}getReplaysPath(){return this.paths.replays}getMapsPath(){return this.paths.maps}getWadsPath(){return this.paths.wads}getSkiesPath(){return this.paths.skies}getSoundsPath(){return this.paths.sounds}}t.Config=r},5359:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Fullscreen=void 0;const r=[{enabled:"fullscreenEnabled",element:"fullscreenElement",request:"requestFullscreen",exit:"exitFullscreen",change:"fullscreenchange",error:"fullscreenerror"},{enabled:"mozFullScreenEnabled",element:"mozFullScreenElement",request:"mozRequestFullScreen",exit:"mozCancelFullScreen",change:"mozfullscreenchange",error:"mozfullscreenerror"},{enabled:"webkitFullscreenEnabled",element:"webkitCurrentFullScreenElement",request:"webkitRequestFullscreen",exit:"webkitExitFullscreen",change:"webkitfullscreenchange",error:"webkitfullscreenerror"},{enabled:"msFullscreenEnabled",element:"msFullscreenElement",request:"msRequestFullscreen",exit:"msExitFullscreen",change:"MSFullscreenChange",error:"MSFullscreenError"}];let s=0;const n=document;for(let e=0;e<r.length;++e)if(void 0!==n[r[e].enabled]){s=e;break}class a{static element(){return n[r[s].element]}static enabled(){return n[r[s].enabled]}static isInFullscreen(){return null!==a.element()}static enter(e){e[r[s].request]()}static exit(){n[r[s].exit]()}static onChange(e){return window.addEventListener(r[s].change,e)}static onChangeRemove(e){window.removeEventListener(r[s].change,e)}static onError(e){return window.addEventListener(r[s].error,e)}}t.Fullscreen=a},7484:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Game=t.PlayerMode=void 0;const s=r(9431),n=r(4343),a=r(4605),i=r(7172),o=r(1776),l=r(4769),c=r(9866),u=r(9694),h=r(8559),d=r(8372),f=r(5121),p=r(3650),m=r(6194);var g;!function(e){e[e.FREE=0]="FREE",e[e.REPLAY=1]="REPLAY"}(g||(t.PlayerMode=g={}));class y{static init(e){if(!h.Context.checkWebGLSupport().hasSupport)return{status:"error",message:"No WebGL support!"};const t=document.createElement("canvas");if(!t)return{status:"error",message:"Failed to create <canvas> element!"};const r=h.Context.init(t);if(!r)return{status:"error",message:"Failed to initialize WebGL context"};const s=f.Renderer.init(r);if(!s)return{status:"error",message:"Failed to initialize renderer"};const n=m.WorldScene.init(r);if(!n)return{status:"error",message:"Failed to initialize world scene"};const a=p.SkyScene.init(r);if(!a)return{status:"error",message:"Failed to initialize sky scene"};return{status:"success",game:new y({canvas:t,config:e,context:r,renderer:s,worldScene:n,skyScene:a})}}constructor(e){this.pauseTime=0,this.isPaused=!1,this.lastTime=0,this.accumTime=0,this.timeStep=1/60,this.title="",this.speed="",this.fps="",this.buttons="",this.strafes="",this.gravity=1,this.isSpeedVisible=!0,this.isFpsVisible=!1,this.isButtonsVisible=!1,this.isStrafesVisible=!1,this.pointerLocked=!1,this.touch=new o.Touch,this.mouse=new i.Mouse,this.keyboard=new c.Keyboard,this.entities=[],this.onLoadAll=e=>{if(e&&e.replay&&(this.changeReplay(e.replay.data),this.changeMode(g.REPLAY)),!e.map||!e.map.data)return;const t=e.map.data,r=e.skies;let s=!0;r.forEach((e=>{s=s&&e.isDone()})),s&&r.forEach((e=>e.data?t.skies.push(e.data):0)),Object.entries(e.sprites).forEach((([e,r])=>{r.data&&(t.sprites[e]=r.data)})),e.sounds.length>0&&e.sounds.forEach((e=>{e.data&&this.sounds.push(e.data)})),this.changeMap(t),this.events.emit("load",e)},this.draw=()=>{requestAnimationFrame(this.draw);const e=this.canvas,t=e.parentElement;if(t){const r=t.clientWidth,s=t.clientHeight;e.width===r&&e.height===s||(e.width=r,e.height=s,this.camera.aspect=e.clientWidth/e.clientHeight,this.camera.updateProjectionMatrix(),this.context.gl.viewport(0,0,this.context.gl.drawingBufferWidth,this.context.gl.drawingBufferHeight)),e.clientWidth===e.width&&e.clientHeight===e.height||(e.width=e.clientWidth,e.height=e.clientHeight,this.camera.aspect=e.clientWidth/e.clientHeight,this.camera.updateProjectionMatrix(),this.context.gl.viewport(0,0,this.context.gl.drawingBufferWidth,this.context.gl.drawingBufferHeight))}const r=n.now()/1e3,s=r-this.lastTime;for(this.accumTime+=s;this.accumTime>this.timeStep;)this.update(this.timeStep),this.accumTime-=this.timeStep;this.renderer.draw(),""!==this.mapName&&(this.skyScene.draw(this.camera),this.worldScene.draw(this.camera,this.entities)),this.lastTime=r},this.onTouchStart=e=>{const t=e.touches.item(0);t&&(this.touch.pressed=!0,this.touch.position[0]=t.clientX,this.touch.position[1]=t.clientY)},this.onTouchEnd=()=>{this.touch.pressed=!1,this.touch.delta[0]=0,this.touch.delta[1]=0},this.onTouchMove=e=>{const t=e.touches.item(0);t&&this.touch.pressed&&(this.touch.delta[0],this.touch.delta[0]=t.clientX-this.touch.position[0],this.touch.delta[1]=t.clientY-this.touch.position[1],this.touch.position[0]=t.clientX,this.touch.position[1]=t.clientY)},this.onMouseMove=e=>{this.pointerLocked&&(this.mouse.delta[0]=.5*e.movementX,this.mouse.delta[1]=.5*e.movementY,this.mouse.position[0]=e.pageX,this.mouse.position[1]=e.pageY)},this.keyDown=e=>(this.keyboard.keys[e.which]=1,!this.pointerLocked||(e.preventDefault(),!1)),this.keyUp=e=>(this.keyboard.keys[e.which]=0,!this.pointerLocked||(e.preventDefault(),!1)),this.onVisibilityChange=()=>{if(document.hidden){if(this.isPaused)return;this.pauseTime=n.now()/1e3,this.isPaused=!0}else{if(!this.isPaused)return;this.lastTime=n.now()/1e3-this.pauseTime+this.lastTime,this.isPaused=!1}},this.sounds=[],this.soundSystem=new u.SoundSystem,this.config=e.config,this.loader=new a.Loader(this.config),this.loader.events.on("loadall",this.onLoadAll),document.addEventListener("touchstart",this.onTouchStart,!1),document.addEventListener("touchend",this.onTouchEnd,!1),document.addEventListener("touchcancel",this.onTouchEnd,!1),document.addEventListener("touchmove",this.onTouchMove,!1),document.addEventListener("mousemove",this.onMouseMove,!1),window.addEventListener("keydown",this.keyDown),window.addEventListener("keyup",this.keyUp),window.addEventListener("visibilitychange",this.onVisibilityChange),this.canvas=e.canvas,this.camera=l.Camera.init(this.canvas.width/this.canvas.height),this.context=e.context,this.renderer=e.renderer,this.worldScene=e.worldScene,this.skyScene=e.skyScene,this.mode=g.FREE,this.player=new d.ReplayPlayer(this),this.events=(0,s.createNanoEvents)(),this.mapName=""}getCanvas(){return this.canvas}load(e){this.events.emit("loadstart"),this.loader.load(e)}changeMap(e){if(this.mapName.toLowerCase()===e.name.toLowerCase())return;this.mapName=e.name,this.worldScene.changeMap(e),this.skyScene.changeMap(e),this.entities=e.entities;const t=e.entities.find((e=>"info_player_start"===e.classname));t?(this.camera.position[0]=t.origin[0],this.camera.position[1]=t.origin[1],this.camera.position[2]=t.origin[2]):(this.camera.position[0]=0,this.camera.position[1]=0,this.camera.position[2]=0),this.camera.rotation[0]=0,this.camera.rotation[1]=0,this.camera.rotation[2]=0}changeReplay(e){this.events.emit("prereplaychange",this,e),this.player.changeReplay(e),this.events.emit("postreplaychange",this,e)}changeMode(e){this.mode=e,this.events.emit("modechange",e),e===g.FREE?(this.isSpeedVisible=!1,this.isFpsVisible=!1,this.isButtonsVisible=!1,this.isStrafesVisible=!1):e===g.REPLAY&&(this.isSpeedVisible=!0)}setTitle(e){this.title=e,this.events.emit("titlechange",e)}setSpeed(e){this.speed=e,this.events.emit("speedchange",e)}setFps(e){this.fps=e,this.events.emit("fpschange",e)}setButtons(e){this.buttons=e,this.events.emit("buttonschange",e)}setStrafes(e){this.strafes=e,this.events.emit("strafeschange",e)}setGravity(e){this.gravity=e;let t="";t=1===e?"usp":"knife",this.events.emit("gravitychange",t)}getTitle(){return this.title}update(e){this.events.emit("preupdate",this);const t=this.camera,r=this.keyboard,s=this.mouse,n=this.touch;if(this.mode===g.REPLAY)this.player.update(e);else if(this.mode===g.FREE){this.touch.pressed?(t.rotation[0]=Math.min(Math.max(t.rotation[0]+n.delta[1]/100,-Math.PI/2),Math.PI/2),t.rotation[1]-=n.delta[0]/100):(t.rotation[0]=Math.min(Math.max(t.rotation[0]+s.delta[1]/100,-Math.PI/2),Math.PI/2),t.rotation[1]-=s.delta[0]/100);const a=500*e,i=c.Keyboard.KEYS.W,o=c.Keyboard.KEYS.S,l=c.Keyboard.KEYS.A,u=c.Keyboard.KEYS.D,h=c.Keyboard.KEYS.CTRL,d=c.Keyboard.KEYS.SPACE;r.keys[i]!==r.keys[o]&&(r.keys[i]?(t.position[1]-=Math.cos(t.rotation[1]+Math.PI/2)*a,t.position[0]+=Math.sin(t.rotation[1]+Math.PI/2)*a):r.keys[o]&&(t.position[1]-=Math.cos(t.rotation[1]-Math.PI/2)*a,t.position[0]+=Math.sin(t.rotation[1]-Math.PI/2)*a)),r.keys[l]!==r.keys[u]&&(r.keys[l]?(t.position[1]+=Math.cos(t.rotation[1])*a,t.position[0]-=Math.sin(t.rotation[1])*a):r.keys[u]&&(t.position[1]-=Math.cos(t.rotation[1])*a,t.position[0]+=Math.sin(t.rotation[1])*a)),r.keys[d]!==r.keys[h]&&(r.keys[d]?t.position[2]+=a:r.keys[h]&&(t.position[2]-=a))}s.delta[0]=0,s.delta[1]=0,this.events.emit("postupdate",this)}}t.Game=y},4769:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Camera=void 0;const s=r(1961);class n{static init(e){return new n(e)}constructor(e){this.projectionMatrix=s.mat4.create(),this.fov=s.glMatrix.toRadian(60),this.near=1,this.far=8192,this.viewMatrix=s.mat4.create(),this.position=s.vec3.create(),this.rotation=s.vec3.create(),this.aspect=e,this.updateProjectionMatrix()}updateProjectionMatrix(){s.mat4.perspective(this.projectionMatrix,this.fov,this.aspect,this.near,this.far)}updateViewMatrix(){s.mat4.identity(this.viewMatrix),s.mat4.rotateX(this.viewMatrix,this.viewMatrix,this.rotation[0]-Math.PI/2),s.mat4.rotateZ(this.viewMatrix,this.viewMatrix,Math.PI/2-this.rotation[1]),s.mat4.translate(this.viewMatrix,this.viewMatrix,[-this.position[0],-this.position[1],-this.position[2]])}}t.Camera=n},8559:(e,t)=>{"use strict";var r;Object.defineProperty(t,"__esModule",{value:!0}),t.Context=t.ShaderType=void 0,function(e){e[e.VERTEX=0]="VERTEX",e[e.FRAGMENT=1]="FRAGMENT"}(r||(t.ShaderType=r={}));class s{static init(e){const t=e.getContext("webgl",{alpha:!1});return t?new s(t):(console.error("Failed to get WebGL context"),null)}static checkWebGLSupport(){const e="Your browser does not seem to support WebGL",t="Your graphics card does not seem to support WebGL";if(!window.WebGLRenderingContext)return{hasSupport:!1,message:e};const r=document.createElement("canvas");try{return r.getContext("webgl")||r.getContext("experimental-webgl")?{hasSupport:!0,message:""}:{hasSupport:!1,message:t}}catch(e){return{hasSupport:!1,message:t}}}constructor(e){this.gl=e}createProgram(e){const t=this.gl;var s=t.createProgram();if(!s)return console.error("Failed to create WebGL program"),null;const n=this.createShader({source:e.vertexShaderSrc,type:r.VERTEX});if(!n)return console.error("Failed to compile vertex shader"),null;const a=this.createShader({source:e.fragmentShaderSrc,type:r.FRAGMENT});if(!a)return console.error("Failed to compile fragment shader"),null;if(t.attachShader(s,n),t.attachShader(s,a),t.linkProgram(s),t.validateProgram(s),!t.getProgramParameter(s,t.LINK_STATUS)){t.deleteProgram(s),t.deleteShader(n),t.deleteShader(a);const e=t.getProgramInfoLog(s);return console.error(`Could not initialize shader: ${e}`),null}if(!t.getProgramParameter(s,t.VALIDATE_STATUS)){t.deleteProgram(s),t.deleteShader(n),t.deleteShader(a);const e=t.getProgramInfoLog(s);return console.error(`Could not initialize shader: ${e}`),null}t.useProgram(s);const i={};for(let r=0;r<e.attributeNames.length;++r){const n=e.attributeNames[r],a=t.getAttribLocation(s,n);if(-1===a)return console.error(`gl.getAttribLocation failed for attrib named "${n}"`),t.deleteProgram(s),null;i[n]=a}const o={};for(let r=0;r<e.uniformNames.length;++r){const n=e.uniformNames[r],a=t.getUniformLocation(s,n);if(null===a)return console.error(`gl.getUniformLocation failed for uniform named "${n}"`),t.deleteProgram(s),null;o[n]=a}return{handle:s,attributes:i,uniforms:o}}createShader(e){const t=this.gl,s=e.type===r.VERTEX?t.createShader(t.VERTEX_SHADER):t.createShader(t.FRAGMENT_SHADER);return s?(t.shaderSource(s,e.source),t.compileShader(s),t.getShaderParameter(s,t.COMPILE_STATUS)?s:(console.error(t.getShaderInfoLog(s)),t.deleteShader(s),null)):(console.error("Failed to create shader program"),null)}getAnisotropyExtension(){return this.gl.getExtension("EXT_texture_filter_anisotropic")||this.gl.getExtension("MOZ_EXT_texture_filter_anisotropic")||this.gl.getExtension("WEBKIT_EXT_texture_filter_anisotropic")}getMaxAnisotropy(e){return this.gl.getParameter(e.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}}t.Context=s},5121:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Renderer=void 0;class r{static init(e){const t=e.gl;return t.clearColor(0,0,0,1),t.clearDepth(1),t.enable(t.DEPTH_TEST),t.depthFunc(t.LEQUAL),t.enable(t.BLEND),t.blendFunc(t.SRC_ALPHA,t.ONE_MINUS_SRC_ALPHA),t.enable(t.CULL_FACE),t.cullFace(t.FRONT),new r({context:e})}constructor(e){this.draw=()=>{const e=this.context.gl;e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT)},this.context=e.context}}t.Renderer=r},3650:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SkyScene=void 0;const s=r(3219);class n{static init(e){const t=s.SkyShader.init(e);return t?new n({context:e,shader:t}):(console.error("skyscenen't"),null)}constructor(e){this.vertexBuffer=null,this.indexBuffer=null,this.texture=null,this.isReady=!1,this.context=e.context,this.shader=e.shader}changeMap(e){if(6!==e.skies.length)return void(this.isReady=!1);const t=this.context.gl,r=t.createBuffer(),s=t.createBuffer(),n=t.createTexture();if(!r||!s||!n)throw new Error("shouldnt happen");const a=new Uint8Array([0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23]),i=new Float32Array([-1,-1,1,.499,.001,1,-1,1,.499,.249,1,1,1,.001,.249,-1,1,1,.001,.001,-1,-1,-1,.499,.749,-1,1,-1,.001,.749,1,1,-1,.001,.501,1,-1,-1,.499,.501,-1,1,-1,.501,.749,-1,1,1,.501,.501,1,1,1,.999,.501,1,1,-1,.999,.749,-1,-1,-1,.999,.249,1,-1,-1,.501,.249,1,-1,1,.501,.001,-1,-1,1,.999,.001,1,-1,-1,.499,.499,1,1,-1,.001,.499,1,1,1,.001,.251,1,-1,1,.499,.251,-1,-1,-1,.501,.499,-1,-1,1,.501,.251,-1,1,1,.999,.251,-1,1,-1,.999,.499].map(((e,t)=>t%5<3?4096*e:e)));t.bindBuffer(t.ARRAY_BUFFER,r),t.bufferData(t.ARRAY_BUFFER,i,t.STATIC_DRAW),t.enableVertexAttribArray(0),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,s),t.bufferData(t.ELEMENT_ARRAY_BUFFER,a,t.STATIC_DRAW);const o=document.createElement("canvas");o.width=512,o.height=1024;const l=o.getContext("2d");if(!l)throw new Error("sky ctx fail");const c={up:[0,0],rt:[0,256],dn:[0,512],ft:[256,0],lf:[256,256],bk:[256,512]};e.skies.forEach((e=>{const t=document.createElement("canvas"),r=t.getContext("2d");if(!r)throw new Error("Runtime error.");t.width=e.width,t.height=e.height;const s=r.getImageData(0,0,t.width,t.height);for(let t=0;t<e.data.length;++t)s.data[t]=e.data[t];r.putImageData(s,0,0);const n=e.name.slice(-2),a=c[n]?c[n]:[];if(!l)throw new Error("Runtime error.");l.drawImage(t,a[0],a[1])}));const u=l.getImageData(0,0,512,1024).data;t.bindTexture(t.TEXTURE_2D,n),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,512,1024,0,t.RGBA,t.UNSIGNED_BYTE,new Uint8Array(u)),t.generateMipmap(t.TEXTURE_2D),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.REPEAT),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.REPEAT),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR_MIPMAP_LINEAR),t.texParameterf(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.LINEAR);const h=this.context.getAnisotropyExtension();h&&t.texParameteri(t.TEXTURE_2D,h.TEXTURE_MAX_ANISOTROPY_EXT,this.context.getMaxAnisotropy(h)),this.vertexBuffer=r,this.indexBuffer=s,this.texture=n,this.isReady=!0}draw(e){if(!this.isReady)return;const t=this.context.gl,r=this.shader;r.useProgram(t),t.bindTexture(t.TEXTURE_2D,this.texture),t.bindBuffer(t.ARRAY_BUFFER,this.vertexBuffer),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this.indexBuffer),r.enableVertexAttribs(t),r.setVertexAttribPointers(t),r.setDiffuse(t,0);const s=e.position[0],n=e.position[1],a=e.position[2];e.position[0]=0,e.position[1]=0,e.position[2]=0,e.updateViewMatrix(),e.position[0]=s,e.position[1]=n,e.position[2]=a,r.setViewMatrix(t,e.viewMatrix),r.setProjectionMatrix(t,e.projectionMatrix),t.drawElements(t.TRIANGLES,36,t.UNSIGNED_BYTE,0),t.clear(t.DEPTH_BUFFER_BIT)}}t.SkyScene=n},3219:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SkyShader=void 0;class r{static init(e){const t=e.createProgram({vertexShaderSrc:"#ifdef GL_ES\nprecision highp float;\n#endif\n\nattribute vec3 position;\nattribute vec2 texCoord;\n\nvarying vec2 vTexCoord;\n\nuniform mat4 viewMatrix;\nuniform mat4 projectionMatrix;\n\nvoid main(void) {\n  vTexCoord = texCoord;\n  gl_Position = projectionMatrix * viewMatrix * vec4(position, 1);\n}",fragmentShaderSrc:"#ifdef GL_ES\nprecision highp float;\n#endif\n\nuniform sampler2D diffuse;\n\nvarying vec2 vTexCoord;\n\nvoid main(void) {\n  vec4 diffuseColor = texture2D(diffuse, vTexCoord);\n  gl_FragColor = vec4(diffuseColor.rgb, 1.0);\n}",attributeNames:["position","texCoord"],uniformNames:["viewMatrix","projectionMatrix","diffuse"]});return t?new r(t):(console.error("Failed to create sky shader program"),null)}constructor(e){this.program=e.handle,this.aPosition=e.attributes.position,this.aTexCoord=e.attributes.texCoord,this.uViewMx=e.uniforms.viewMatrix,this.uProjectionMx=e.uniforms.projectionMatrix,this.uDiffuse=e.uniforms.diffuse}useProgram(e){e.useProgram(this.program)}setViewMatrix(e,t){e.uniformMatrix4fv(this.uViewMx,!1,t)}setProjectionMatrix(e,t){e.uniformMatrix4fv(this.uProjectionMx,!1,t)}setDiffuse(e,t){e.uniform1i(this.uDiffuse,t)}enableVertexAttribs(e){e.enableVertexAttribArray(this.aPosition),e.enableVertexAttribArray(this.aTexCoord)}setVertexAttribPointers(e){e.vertexAttribPointer(this.aPosition,3,e.FLOAT,!1,20,0),e.vertexAttribPointer(this.aTexCoord,2,e.FLOAT,!1,20,12)}}t.SkyShader=r},9314:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.nextPowerOfTwo=t.isPowerOfTwo=t.resizeTexture=void 0;t.resizeTexture=(e,t,r,s,n)=>{const a=document.createElement("canvas"),i=a.getContext("2d");if(!i)throw new Error("Runtime error.");a.width=t,a.height=r;const o=document.createElement("canvas"),l=o.getContext("2d");if(!l)throw new Error("Runtime error.");o.width=s,o.height=n;const c=i.createImageData(t,r);for(let s=0,n=t*r*4;s<n;s+=4)c.data[s]=e[s],c.data[s+1]=e[s+1],c.data[s+2]=e[s+2],c.data[s+3]=e[s+3];return i.putImageData(c,0,0),l.drawImage(a,0,0,s,n),new Uint8Array(l.getImageData(0,0,s,n).data)};t.isPowerOfTwo=e=>0==(e&e-1);t.nextPowerOfTwo=e=>{--e;for(let t=1;t<32;t<<=1)e|=e>>t;return e+1}},6194:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.WorldScene=void 0;const s=r(1961),n=r(9807),a=r(4586),i=r(8506),o=r(9314);class l{static init(e){const t=n.MainShader.init(e);if(!t)return console.error("Failed to init MainShader"),null;t.useProgram(e.gl);const r=e.gl.createBuffer();return r?new l({buffer:r,context:e,shader:t}):(console.error("Failed to create WebGL buffer"),null)}constructor(e){this.modelMatrix=s.mat4.create(),this.sceneInfo={length:0,data:new Float32Array(0),models:[]},this.bsp=null,this.textures=[],this.sprites={},this.lightmap=null,this.buffer=e.buffer,this.context=e.context,this.shader=e.shader,this.entsNegativePitchPrefix=["ammo_","env_sprite","cycler","item_","monster_","weaponbox","worlditems","xen_"]}changeMap(e){this.fillBuffer(e),this.loadTextures(e),this.loadSpriteTextures(e),this.loadLightmap(e),this.bsp=e}fillBuffer(e){const t=this.context.gl,r=e.models,s=["aaatrigger","clip","null","hint","nodraw","invisible","skip","trigger","sky","fog"];let n=0;for(let t=0;t<r.length;++t){const a=r[t];for(let t=0;t<a.faces.length;++t){const r=e.textures[a.faces[t].textureIndex];s.indexOf(r.name)>-1||(n+=a.faces[t].buffer.length)}}n+=42;const a={length:n,data:new Float32Array(n),models:[]};let i=0;for(let t=0;t<e.models.length;++t){const r=e.models[t],n={origin:r.origin,offset:i,length:0,isTransparent:!1,faces:[]};for(let t=0;t<r.faces.length;++t){const o=e.textures[r.faces[t].textureIndex];if(s.indexOf(o.name)>-1)continue;const l={offset:i,length:0,textureIndex:-1};for(let e=0;e<r.faces[t].buffer.length;++e)a.data[i++]=r.faces[t].buffer[e];n.isTransparent||"{"!==e.textures[r.faces[t].textureIndex].name[0]||(n.isTransparent=!0),l.textureIndex=r.faces[t].textureIndex,l.length=i-l.offset,n.faces.push(l)}n.length=i-n.offset,a.models.push(n)}a.models.push({origin:[0,0,0],offset:i,length:4,isTransparent:!1,faces:[{offset:i,length:4,textureIndex:0}]}),a.data[i++]=-.5,a.data[i++]=0,a.data[i++]=-.5,a.data[i++]=1,a.data[i++]=1,a.data[i++]=0,a.data[i++]=0,a.data[i++]=.5,a.data[i++]=0,a.data[i++]=.5,a.data[i++]=0,a.data[i++]=0,a.data[i++]=0,a.data[i++]=0,a.data[i++]=-.5,a.data[i++]=0,a.data[i++]=.5,a.data[i++]=1,a.data[i++]=0,a.data[i++]=0,a.data[i++]=0,a.data[i++]=-.5,a.data[i++]=0,a.data[i++]=-.5,a.data[i++]=1,a.data[i++]=1,a.data[i++]=0,a.data[i++]=0,a.data[i++]=.5,a.data[i++]=0,a.data[i++]=-.5,a.data[i++]=0,a.data[i++]=1,a.data[i++]=0,a.data[i++]=0,a.data[i++]=.5,a.data[i++]=0,a.data[i++]=.5,a.data[i++]=0,a.data[i++]=0,a.data[i++]=0,a.data[i++]=0,i=0;const o={data:new Float32Array(a.data),length:a.length,models:a.models.map((e=>({origin:[...e.origin],offset:e.offset,length:e.length,isTransparent:e.isTransparent,faces:e.faces.map((e=>({offset:e.offset,length:e.length,textureIndex:e.textureIndex})))})))};for(let e=0;e<o.models.length;++e){const t=o.models[e];t.faces.sort(((e,t)=>e.textureIndex-t.textureIndex));for(let e=0;e<t.faces.length;++e){const r=t.faces[e],s=i;for(let e=0;e<r.length;++e)o.data[i]=a.data[r.offset+e],i+=1;r.offset=s}const r=[];let s=-1;for(let e=0;e<t.faces.length;++e){const n=t.faces[e];n.textureIndex===s?r[r.length-1].length+=n.length:(r.push({offset:n.offset,length:n.length,textureIndex:n.textureIndex}),s=n.textureIndex)}t.faces=r}this.sceneInfo=o,t.bindBuffer(t.ARRAY_BUFFER,this.buffer),t.bufferData(t.ARRAY_BUFFER,this.sceneInfo.data,t.STATIC_DRAW)}loadTextures(e){const t=this.context.gl;for(let r=0;r<e.textures.length;++r){const s=t.createTexture();if(!s)throw new Error("fatal error");const n=e.textures[r];if(!(0,o.isPowerOfTwo)(n.width)||!(0,o.isPowerOfTwo)(n.height)){const e=n.width,t=n.height,r=(0,o.nextPowerOfTwo)(n.width),s=(0,o.nextPowerOfTwo)(n.height);n.data=(0,o.resizeTexture)(n.data,e,t,r,s),n.width=r,n.height=s}t.bindTexture(t.TEXTURE_2D,s),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,n.width,n.height,0,t.RGBA,t.UNSIGNED_BYTE,n.data),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR_MIPMAP_LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.REPEAT),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.REPEAT),t.generateMipmap(t.TEXTURE_2D);const a=this.context.getAnisotropyExtension();a&&t.texParameteri(t.TEXTURE_2D,a.TEXTURE_MAX_ANISOTROPY_EXT,this.context.getMaxAnisotropy(a)),this.textures.push({name:n.name,width:n.width,height:n.height,data:n.data,handle:s})}}loadSpriteTextures(e){const t=this.context.gl;for(const[r,s]of Object.entries(e.sprites)){const e=t.createTexture();if(!e)throw new Error("fatal error");const n=s.frames[0];if(!(0,o.isPowerOfTwo)(n.width)||!(0,o.isPowerOfTwo)(n.height)){const e=n.width,t=n.height,r=(0,o.nextPowerOfTwo)(n.width),s=(0,o.nextPowerOfTwo)(n.height);n.data=(0,o.resizeTexture)(n.data,e,t,r,s),n.width=r,n.height=s}t.bindTexture(t.TEXTURE_2D,e),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,n.width,n.height,0,t.RGBA,t.UNSIGNED_BYTE,n.data),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR_MIPMAP_LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.REPEAT),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.REPEAT),t.generateMipmap(t.TEXTURE_2D);const a=this.context.getAnisotropyExtension();a&&t.texParameteri(t.TEXTURE_2D,a.TEXTURE_MAX_ANISOTROPY_EXT,this.context.getMaxAnisotropy(a)),this.textures.push({name:r,width:n.width,height:n.height,data:n.data,handle:e}),this.sprites[r]=s}}loadLightmap(e){const t=this.context.gl,r=t.createTexture();if(!r)throw new Error("fatal error");t.bindTexture(t.TEXTURE_2D,r),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,e.lightmap.width,e.lightmap.height,0,t.RGBA,t.UNSIGNED_BYTE,e.lightmap.data),t.generateMipmap(t.TEXTURE_2D),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR_MIPMAP_LINEAR),this.lightmap={data:e.lightmap.data,handle:r}}draw(e,t){if(!this.bsp||!this.lightmap)return;const r=this.context.gl,s=this.shader;s.useProgram(r),e.updateProjectionMatrix(),e.updateViewMatrix(),s.setViewMatrix(r,e.viewMatrix),s.setProjectionMatrix(r,e.projectionMatrix),r.bindBuffer(r.ARRAY_BUFFER,this.buffer),s.enableVertexAttribs(r),s.setVertexAttribPointers(r),s.setDiffuse(r,0),s.setLightmap(r,1),r.activeTexture(r.TEXTURE1),r.bindTexture(r.TEXTURE_2D,this.lightmap.handle),r.activeTexture(r.TEXTURE0);const n=[],i=[];for(let e=1;e<t.length;++e){const r=t[e];if(r.model)if(r.rendermode&&r.rendermode!=a.RenderMode.Normal&&r.rendermode!=a.RenderMode.Solid)r.rendermode,a.RenderMode.Additive,i.push(r);else{if("*"===r.model[0]){if(this.sceneInfo.models[parseInt(r.model.substr(1))].isTransparent){i.push(r);continue}}else if(r.model.indexOf(".spr")>-1){i.push(r);continue}n.push(r)}}s.setOpacity(r,1),this.renderWorldSpawn(),this.renderOpaqueEntities(e,n),i.length&&(r.depthMask(!1),this.renderTransparentEntities(i,e),r.depthMask(!0))}renderWorldSpawn(){const e=this.sceneInfo.models[0],t=this.context.gl;s.mat4.identity(this.modelMatrix),this.shader.setModelMatrix(t,this.modelMatrix);for(let r=0;r<e.faces.length;++r){const s=e.faces[r];t.bindTexture(t.TEXTURE_2D,this.textures[s.textureIndex].handle),t.drawArrays(t.TRIANGLES,s.offset/7,s.length/7)}}setRenderAngles(e,t,r){const n=Math.PI,a=1e-6;if(""===e)return s.mat4.rotateY(t,t,r[1]*(n/180)),s.mat4.rotateZ(t,t,-r[0]*(n/180)),s.mat4.rotateX(t,t,r[2]*(n/180)),!1;if("func_breakable"===e)r[1]=0,s.mat4.rotateY(t,t,0),s.mat4.rotateZ(t,t,-r[0]*(n/180)),s.mat4.rotateX(t,t,r[2]*(n/180));else if(this.IsEntNotSupportAngles(e))r=[0,0,0];else if("env_sprite"===e)Math.abs(r[1])>=a&&Math.abs(r[2])<a?(r[2]=0,s.mat4.rotateY(t,t,0),s.mat4.rotateZ(t,t,-r[0]*(n/180)),s.mat4.rotateX(t,t,r[1]*(n/180))):(s.mat4.rotateY(t,t,r[1]*(n/180)),s.mat4.rotateZ(t,t,-r[0]*(n/180)),s.mat4.rotateX(t,t,r[2]*(n/180)));else{let a=!1;for(const i of this.entsNegativePitchPrefix)if(e.startsWith(i)){s.mat4.rotateY(t,t,r[1]*(n/180)),s.mat4.rotateZ(t,t,r[0]*(n/180)),s.mat4.rotateX(t,t,r[2]*(n/180)),a=!0;break}a||(s.mat4.rotateY(t,t,r[1]*(n/180)),s.mat4.rotateZ(t,t,-r[0]*(n/180)),s.mat4.rotateX(t,t,r[2]*(n/180)))}return!(Math.abs(r[0])<a&&Math.abs(r[1])<a&&Math.abs(r[2])<a)}IsEntNotSupportAngles(e){return"func_wall"==e||"func_wall_toggle"==e||"func_illusionary"==e||"spark_shower"==e||"func_plat"==e||"func_door"==e||"momentary_door"==e||"func_water"==e||"func_conveyor"==e||"func_rot_button"==e||"func_button"==e||"env_blood"==e||"gibshooter"==e||"trigger"==e||"trigger_monsterjump"==e||"trigger_hurt"==e||"trigger_multiple"==e||"trigger_push"==e||"trigger_teleport"==e||"func_bomb_target"==e||"func_hostage_rescue"==e||"func_vip_safetyzone"==e||"func_escapezone"==e||"trigger_autosave"==e||"trigger_endsection"==e||"trigger_gravity"==e||"env_snow"==e||"func_snow"==e||"env_rain"==e||"func_rain"==e}renderOpaqueEntities(e,t){const r=this.context.gl,n=this.shader;let o=this.modelMatrix,l=s.mat4.create();const c=s.vec3.create();for(let u=0;u<t.length;++u){const h=t[u],d=parseInt(h.model.substr(1)),f=this.sceneInfo.models[d];if(f){const e=h.angles||[0,0,0],t=h.origin||[0,0,0];c[0]=t[0]+f.origin[0],c[1]=t[1]+f.origin[1],c[2]=t[2]+f.origin[2],s.mat4.identity(o),s.mat4.translate(o,o,c);let a=!1;s.mat4.identity(l),s.mat4.translate(l,l,c),e?(a=this.setRenderAngles(h.classname,l,e),n.setModelMatrix(r,a?l:o)):n.setModelMatrix(r,o);let i=-1;for(let e=0;e<f.faces.length;++e){const t=f.faces[e];t.textureIndex!==i&&(r.bindTexture(r.TEXTURE_2D,this.textures[t.textureIndex].handle),i=t.textureIndex),r.drawArrays(r.TRIANGLES,t.offset/7,t.length/7)}}else if(h.model.indexOf(".spr")>-1){const t=this.textures.find((e=>e.name===h.model)),l=this.sprites[h.model];if(t&&l){const c=h.origin?s.vec3.fromValues(h.origin[0],h.origin[1],h.origin[2]):s.vec3.create(),u=s.vec3.fromValues(t.width,1,t.height),d=h.angles?s.vec3.fromValues(h.angles[0],h.angles[2],h.angles[1]):s.vec3.create();switch(s.vec3.scale(u,u,h.scale||1),s.mat4.identity(o),s.mat4.translate(o,o,c),l.header.type){case i.SpriteType.VP_PARALLEL_UPRIGHT:case i.SpriteType.FACING_UPRIGHT:s.mat4.rotateZ(o,o,e.rotation[1]+Math.PI/2);break;case i.SpriteType.VP_PARALLEL:s.mat4.rotateZ(o,o,Math.atan2(c[1]-e.position[1],c[0]-e.position[0])+Math.PI/2),s.mat4.rotateX(o,o,Math.atan2(e.position[2]-c[2],Math.sqrt(Math.pow(e.position[0]-c[0],2)+Math.pow(e.position[1]-c[1],2))));break;case i.SpriteType.ORIENTED:s.mat4.rotateY(o,o,d[0]*Math.PI/180+Math.PI),s.mat4.rotateZ(o,o,d[1]*Math.PI/180+Math.PI),s.mat4.rotateX(o,o,d[2]*Math.PI/180-Math.PI/2);break;case i.SpriteType.VP_PARALLEL_ORIENTED:s.mat4.rotateY(o,o,d[0]*Math.PI/180+Math.PI),s.mat4.rotateZ(o,o,d[1]*Math.PI/180+Math.PI);break;default:throw new Error("Invalid sprite type")}s.mat4.scale(o,o,u),n.setModelMatrix(r,o),n.setOpacity(r,(h.renderamt||255)/255);switch(h.rendermode||a.RenderMode.Normal){case a.RenderMode.Normal:n.setOpacity(r,1),r.bindTexture(r.TEXTURE_2D,t.handle),r.drawArrays(r.TRIANGLES,this.sceneInfo.models[this.sceneInfo.models.length-1].offset/7,6);break;case a.RenderMode.Color:case a.RenderMode.Texture:n.setOpacity(r,(h.renderamt||255)/255),r.bindTexture(r.TEXTURE_2D,t.handle),r.drawArrays(r.TRIANGLES,this.sceneInfo.models[this.sceneInfo.models.length-1].offset/7,6);break;case a.RenderMode.Glow:r.blendFunc(r.SRC_ALPHA,r.DST_ALPHA),n.setOpacity(r,(h.renderamt||255)/255),r.bindTexture(r.TEXTURE_2D,t.handle),r.drawArrays(r.TRIANGLES,this.sceneInfo.models[this.sceneInfo.models.length-1].offset/7,6),r.blendFunc(r.SRC_ALPHA,r.ONE_MINUS_SRC_ALPHA);break;case a.RenderMode.Solid:n.setOpacity(r,(h.renderamt||255)/255),r.bindTexture(r.TEXTURE_2D,t.handle),r.drawArrays(r.TRIANGLES,this.sceneInfo.models[this.sceneInfo.models.length-1].offset/7,6);break;case a.RenderMode.Additive:r.blendFunc(r.SRC_ALPHA,r.DST_ALPHA),n.setOpacity(r,(h.renderamt||255)/255),r.bindTexture(r.TEXTURE_2D,t.handle),r.drawArrays(r.TRIANGLES,this.sceneInfo.models[this.sceneInfo.models.length-1].offset/7,6),r.blendFunc(r.SRC_ALPHA,r.ONE_MINUS_SRC_ALPHA)}}}}}renderTransparentEntities(e,t){const r=this.context.gl,n=this.shader,o=this.modelMatrix,l=s.mat4.create(),c=e.map(((e,r)=>{const n=e.origin||[0,0,0];return{index:r,distance:s.vec3.dist(t.position,n)}})).sort(((e,t)=>t.distance-e.distance));for(let u=0;u<c.length;++u){const h=e[c[u].index],d=parseInt(h.model.substr(1)),f=this.sceneInfo.models[d];if(f){const e=h.angles||[0,0,0],t=[h.origin&&h.origin[0]||0,h.origin&&h.origin[1]||0,h.origin&&h.origin[2]||0];f&&(t[0]+=f.origin[0],t[1]+=f.origin[1],t[2]+=f.origin[2]),s.mat4.identity(o),s.mat4.translate(o,o,s.vec3.fromValues(t[0],t[1],t[2]));let i=!1;s.mat4.identity(l),s.mat4.translate(l,l,s.vec3.fromValues(t[0],t[1],t[2])),h.angles?(i=this.setRenderAngles(h.classname,l,e),n.setModelMatrix(r,i?l:o)):n.setModelMatrix(r,o);switch(h.rendermode||a.RenderMode.Normal){case a.RenderMode.Normal:n.setOpacity(r,1);for(let e=0;e<f.faces.length;++e){const t=f.faces[e];r.bindTexture(r.TEXTURE_2D,this.textures[t.textureIndex].handle),r.drawArrays(r.TRIANGLES,t.offset/7,t.length/7)}break;case a.RenderMode.Color:n.setOpacity(r,(h.renderamt||255)/255);for(let e=0;e<f.faces.length;++e){const t=f.faces[e];r.bindTexture(r.TEXTURE_2D,this.textures[t.textureIndex].handle),r.drawArrays(r.TRIANGLES,t.offset/7,t.length/7)}break;case a.RenderMode.Texture:n.setOpacity(r,(h.renderamt||255)/255);for(let e=0;e<f.faces.length;++e){const t=f.faces[e];r.bindTexture(r.TEXTURE_2D,this.textures[t.textureIndex].handle),r.drawArrays(r.TRIANGLES,t.offset/7,t.length/7)}break;case a.RenderMode.Glow:n.setOpacity(r,(h.renderamt||255)/255);for(let e=0;e<f.faces.length;++e){const t=f.faces[e];r.bindTexture(r.TEXTURE_2D,this.textures[t.textureIndex].handle),r.drawArrays(r.TRIANGLES,t.offset/7,t.length/7)}break;case a.RenderMode.Solid:n.setOpacity(r,(h.renderamt||255)/255);for(let e=0;e<f.faces.length;++e){const t=f.faces[e];r.bindTexture(r.TEXTURE_2D,this.textures[t.textureIndex].handle),r.drawArrays(r.TRIANGLES,t.offset/7,t.length/7)}break;case a.RenderMode.Additive:r.blendFunc(r.SRC_ALPHA,r.DST_ALPHA),n.setOpacity(r,(h.renderamt||255)/255);for(let e=0;e<f.faces.length;++e){const t=f.faces[e];r.bindTexture(r.TEXTURE_2D,this.textures[t.textureIndex].handle),r.drawArrays(r.TRIANGLES,t.offset/7,t.length/7)}r.blendFunc(r.SRC_ALPHA,r.ONE_MINUS_SRC_ALPHA)}}else if(h.model.indexOf(".spr")>-1){const e=this.textures.find((e=>e.name===h.model)),l=this.sprites[h.model];if(e&&l){const c=h.origin?s.vec3.fromValues(h.origin[0],h.origin[1],h.origin[2]):s.vec3.create(),u=s.vec3.fromValues(e.width,1,e.height),d=h.angles?s.vec3.fromValues(h.angles[0],h.angles[2],h.angles[1]):s.vec3.create();switch(s.vec3.scale(u,u,h.scale||1),s.mat4.identity(o),s.mat4.translate(o,o,c),l.header.type){case i.SpriteType.VP_PARALLEL_UPRIGHT:case i.SpriteType.FACING_UPRIGHT:s.mat4.rotateZ(o,o,t.rotation[1]+Math.PI/2);break;case i.SpriteType.VP_PARALLEL:s.mat4.rotateZ(o,o,Math.atan2(c[1]-t.position[1],c[0]-t.position[0])+Math.PI/2),s.mat4.rotateX(o,o,Math.atan2(t.position[2]-c[2],Math.sqrt(Math.pow(t.position[0]-c[0],2)+Math.pow(t.position[1]-c[1],2))));break;case i.SpriteType.ORIENTED:s.mat4.rotateY(o,o,d[0]*Math.PI/180+Math.PI),s.mat4.rotateZ(o,o,d[1]*Math.PI/180+Math.PI),s.mat4.rotateX(o,o,d[2]*Math.PI/180-Math.PI/2);break;case i.SpriteType.VP_PARALLEL_ORIENTED:s.mat4.rotateY(o,o,d[0]*Math.PI/180+Math.PI),s.mat4.rotateZ(o,o,d[1]*Math.PI/180+Math.PI);break;default:throw new Error("Invalid sprite type")}s.mat4.scale(o,o,u),n.setModelMatrix(r,o),n.setOpacity(r,(h.renderamt||255)/255);switch(h.rendermode||a.RenderMode.Normal){case a.RenderMode.Normal:n.setOpacity(r,1),r.bindTexture(r.TEXTURE_2D,e.handle),r.drawArrays(r.TRIANGLES,this.sceneInfo.models[this.sceneInfo.models.length-1].offset/7,6);break;case a.RenderMode.Color:case a.RenderMode.Texture:n.setOpacity(r,(h.renderamt||255)/255),r.bindTexture(r.TEXTURE_2D,e.handle),r.drawArrays(r.TRIANGLES,this.sceneInfo.models[this.sceneInfo.models.length-1].offset/7,6);break;case a.RenderMode.Glow:r.blendFunc(r.SRC_ALPHA,r.DST_ALPHA),n.setOpacity(r,(h.renderamt||255)/255),r.bindTexture(r.TEXTURE_2D,e.handle),r.drawArrays(r.TRIANGLES,this.sceneInfo.models[this.sceneInfo.models.length-1].offset/7,6),r.blendFunc(r.SRC_ALPHA,r.ONE_MINUS_SRC_ALPHA);break;case a.RenderMode.Solid:n.setOpacity(r,(h.renderamt||255)/255),r.bindTexture(r.TEXTURE_2D,e.handle),r.drawArrays(r.TRIANGLES,this.sceneInfo.models[this.sceneInfo.models.length-1].offset/7,6);break;case a.RenderMode.Additive:r.blendFunc(r.SRC_ALPHA,r.DST_ALPHA),n.setOpacity(r,(h.renderamt||255)/255),r.bindTexture(r.TEXTURE_2D,e.handle),r.drawArrays(r.TRIANGLES,this.sceneInfo.models[this.sceneInfo.models.length-1].offset/7,6),r.blendFunc(r.SRC_ALPHA,r.ONE_MINUS_SRC_ALPHA)}}}}}}t.WorldScene=l},9807:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MainShader=void 0;class r{static init(e){const t=e.createProgram({vertexShaderSrc:"#ifdef GL_ES\nprecision highp float;\n#endif\n\nattribute vec3 position;\nattribute vec2 texCoord;\nattribute vec2 texCoord2;\n\nvarying vec2 vTexCoord;\nvarying vec2 vLightmapCoord;\n\nuniform mat4 modelMatrix;\nuniform mat4 viewMatrix;\nuniform mat4 projectionMatrix;\n\nvoid main(void) {\n  vTexCoord = texCoord;\n  vLightmapCoord = texCoord2;\n\n  gl_Position = projectionMatrix * viewMatrix * modelMatrix * vec4(position, 1);\n}",fragmentShaderSrc:"#ifdef GL_ES\nprecision highp float;\n#endif\n\nuniform sampler2D diffuse;\nuniform sampler2D lightmap;\nuniform float opacity;\n\nvarying vec2 vTexCoord;\nvarying vec2 vLightmapCoord;\n\nvoid main(void) {\n  vec4 diffuseColor = texture2D(diffuse, vTexCoord);\n  vec4 lightColor = texture2D(lightmap, vLightmapCoord);\n\n  gl_FragColor = vec4(diffuseColor.rgb * lightColor.rgb, diffuseColor.a * opacity);\n}",attributeNames:["position","texCoord","texCoord2"],uniformNames:["modelMatrix","viewMatrix","projectionMatrix","diffuse","lightmap","opacity"]});return t?new r(t):(console.error("Failed to create MainShader program"),null)}constructor(e){this.program=e.handle,this.aPosition=e.attributes.position,this.aTexCoord=e.attributes.texCoord,this.aTexCoord2=e.attributes.texCoord2,this.uModelMx=e.uniforms.modelMatrix,this.uViewMx=e.uniforms.viewMatrix,this.uProjectionMx=e.uniforms.projectionMatrix,this.uDiffuse=e.uniforms.diffuse,this.uLightmap=e.uniforms.lightmap,this.uOpacity=e.uniforms.opacity}useProgram(e){e.useProgram(this.program)}setModelMatrix(e,t){e.uniformMatrix4fv(this.uModelMx,!1,t)}setViewMatrix(e,t){e.uniformMatrix4fv(this.uViewMx,!1,t)}setProjectionMatrix(e,t){e.uniformMatrix4fv(this.uProjectionMx,!1,t)}setDiffuse(e,t){e.uniform1i(this.uDiffuse,t)}setLightmap(e,t){e.uniform1i(this.uLightmap,t)}setOpacity(e,t){e.uniform1f(this.uOpacity,t)}enableVertexAttribs(e){e.enableVertexAttribArray(this.aPosition),e.enableVertexAttribArray(this.aTexCoord),e.enableVertexAttribArray(this.aTexCoord2)}setVertexAttribPointers(e){e.vertexAttribPointer(this.aPosition,3,e.FLOAT,!1,28,0),e.vertexAttribPointer(this.aTexCoord,2,e.FLOAT,!1,28,12),e.vertexAttribPointer(this.aTexCoord2,2,e.FLOAT,!1,28,20)}}t.MainShader=r},9866:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Keyboard=void 0;class r{constructor(){this.keys=new Uint8Array(256);for(let e=0;e<256;++e)this.keys[0]=0}}t.Keyboard=r,function(e){let t;!function(e){e[e.A="A".charCodeAt(0)]="A",e[e.B="B".charCodeAt(0)]="B",e[e.C="C".charCodeAt(0)]="C",e[e.D="D".charCodeAt(0)]="D",e[e.E="E".charCodeAt(0)]="E",e[e.F="F".charCodeAt(0)]="F",e[e.G="G".charCodeAt(0)]="G",e[e.H="H".charCodeAt(0)]="H",e[e.I="I".charCodeAt(0)]="I",e[e.J="J".charCodeAt(0)]="J",e[e.K="K".charCodeAt(0)]="K",e[e.L="L".charCodeAt(0)]="L",e[e.M="M".charCodeAt(0)]="M",e[e.N="N".charCodeAt(0)]="N",e[e.O="O".charCodeAt(0)]="O",e[e.P="P".charCodeAt(0)]="P",e[e.Q="Q".charCodeAt(0)]="Q",e[e.R="R".charCodeAt(0)]="R",e[e.S="S".charCodeAt(0)]="S",e[e.T="T".charCodeAt(0)]="T",e[e.U="U".charCodeAt(0)]="U",e[e.V="V".charCodeAt(0)]="V",e[e.W="W".charCodeAt(0)]="W",e[e.X="X".charCodeAt(0)]="X",e[e.Y="Y".charCodeAt(0)]="Y",e[e.Z="Z".charCodeAt(0)]="Z",e[e.CTRL=17]="CTRL",e[e.ALT=18]="ALT",e[e.SPACE=32]="SPACE"}(t=e.KEYS||(e.KEYS={}))}(r||(t.Keyboard=r={}))},7172:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Mouse=void 0;const s=r(1961);t.Mouse=class{constructor(){this.click=!1,this.leftClick=!1,this.rightClick=!1,this.position=s.vec2.create(),this.delta=s.vec2.create()}}},1776:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Touch=void 0;const s=r(1961);t.Touch=class{constructor(){this.pressed=!1,this.position=s.vec2.create(),this.delta=s.vec2.create()}}},4605:function(e,t,r){"use strict";var s=this&&this.__awaiter||function(e,t,r,s){return new(r||(r=Promise))((function(n,a){function i(e){try{l(s.next(e))}catch(e){a(e)}}function o(e){try{l(s.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?n(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(i,o)}l((s=s.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.Loader=void 0;const n=r(9431),a=r(2847),i=r(2130),o=r(9955),l=r(595),c=r(9163),u=r(8506),h=r(6566),d=r(9157);var f;!function(e){e[e.Loading=1]="Loading",e[e.Skipped=2]="Skipped",e[e.Error=3]="Error",e[e.Done=4]="Done"}(f||(f={}));class p{constructor(e){this.name=e,this.progress=0,this.status=f.Loading,this.data=null}isLoading(){return this.status===f.Loading}skip(){this.status=f.Skipped}isSkipped(){return this.status===f.Skipped}error(){this.status=f.Error}isError(){return this.status===f.Error}done(e){this.status=f.Done,this.data=e}isDone(){return this.status===f.Done}}class m extends p{constructor(){super(...arguments),this.type="replay"}}class g extends p{constructor(){super(...arguments),this.type="bsp"}}class y extends p{constructor(){super(...arguments),this.type="sky"}}class v extends p{constructor(){super(...arguments),this.type="wad"}}class b extends p{constructor(){super(...arguments),this.type="sound"}}class _ extends p{constructor(){super(...arguments),this.type="sprite"}}t.Loader=class{constructor(e){this.sprites={},this.config=e,this.replay=void 0,this.map=void 0,this.skies=[],this.wads=[],this.sounds=[],this.events=(0,n.createNanoEvents)(),this.events.on("error",(e=>{console.error(e)}))}clear(){this.replay=void 0,this.map=void 0,this.skies.length=0,this.wads.length=0,this.sounds.length=0,this.sprites={}}checkStatus(){if(this.replay&&!this.replay.isDone())return;if(this.map&&!this.map.isDone())return;for(let e=0;e<this.skies.length;++e)if(this.skies[e].isLoading())return;for(let e=0;e<this.wads.length;++e)if(this.wads[e].isLoading())return;for(let e=0;e<this.sounds.length;++e)if(this.sounds[e].isLoading())return;const e=Object.entries(this.sprites);for(let t=0;t<e.length;++t)if(e[t][1].isLoading())return;this.events.emit("loadall",this)}load(e){const t=(0,i.extname)(e);".dem"===t||".rec"===t?this.loadReplay(e):".bsp"===t?this.loadMap(e):this.events.emit("error","Invalid file extension",e)}loadReplay(e){return s(this,void 0,void 0,(function*(){this.replay=new m(e),this.events.emit("loadstart",this.replay);const t=this.config.getReplaysPath(),r=yield(0,h.xhr)(`${t}/${e}`,{method:"GET",isBinary:!0,progressCallback:(e,t)=>{this.replay&&(this.replay.progress=t),this.events.emit("progress",this.replay)}}).catch((e=>{this.replay&&this.replay.error(),this.events.emit("error",e,this.replay)}));if(this.replay.isError())return;const s=yield c.Replay.parseCustomFile(r);this.replay.done(s),this.events.emit("load",this.replay),this.checkStatus()}))}loadMap(e){return s(this,void 0,void 0,(function*(){this.map=new g(e),this.events.emit("loadstart",this.map);const t=this.config.getMapsPath(),r=yield(0,h.xhr)(`${t}/${e}`,{method:"GET",isBinary:!0,progressCallback:(e,t)=>{this.map&&(this.map.progress=t),this.events.emit("progress",this.map)}}).catch((e=>{this.map&&this.map.error(),this.events.emit("error",e,this.map)}));if(this.map.isError())return;const s=yield d.BspParser.parse(e,r);this.map.done(s),s.entities.map((e=>{if("string"==typeof e.model&&e.model.indexOf(".spr")>-1)return e.model})).filter(((e,t,r)=>e&&r.indexOf(e)===t)).forEach((e=>e&&this.loadSprite(e)));const n=s.entities[0].skyname;if(n){["bk","dn","ft","lf","rt","up"].map((e=>`${n}${e}`)).forEach((e=>this.loadSky(e)))}if(s.textures.find((e=>e.isExternal))){const e=s.entities[0].wad.map((e=>this.loadWad(e)));yield Promise.all(e)}this.events.emit("load",this.map),this.checkStatus()}))}loadSprite(e){return s(this,void 0,void 0,(function*(){const t=new _(e);this.sprites[e]=t,this.events.emit("loadstart",t);const r=yield(0,h.xhr)(`${this.config.getBasePath()}/${e}`,{method:"GET",isBinary:!0,progressCallback:(e,r)=>{t.progress=r,this.events.emit("progress",t)}}).catch((e=>{t.error(),this.events.emit("error",e,t),this.checkStatus()}));if(t.isError())return;const s=u.Sprite.parse(r);t.done(s),this.events.emit("load",t),this.checkStatus()}))}loadSky(e){return s(this,void 0,void 0,(function*(){const t=new y(e);this.skies.push(t),this.events.emit("loadstart",t);const r=this.config.getSkiesPath(),s=yield(0,h.xhr)(`${r}/${e}.tga`,{method:"GET",isBinary:!0,progressCallback:(e,r)=>{t.progress=r,this.events.emit("progress",t)}}).catch((s=>{console.log(`Missing ${r}/${e}.tga`),t.error(),this.events.emit("error",s,t),this.checkStatus()}));if(t.isError())return;const n=o.Tga.parse(s,e);t.done(n),this.events.emit("load",t),this.checkStatus()}))}loadWad(e){return s(this,void 0,void 0,(function*(){const t=new v(e);this.wads.push(t),this.events.emit("loadstart",t);const r=this.config.getWadsPath(),s=yield(0,h.xhr)(`${r}/${e}`,{method:"GET",isBinary:!0,progressCallback:(e,r)=>{t.progress=r,this.events.emit("progress",t)}}).catch((s=>{console.log(`Missing ${r}/${e}.tga`),t.error(),this.events.emit("error",s,t),this.checkStatus()}));if(t.isError())return;const n=yield l.Wad.parse(s);if(t.done(n),!this.map||!this.map.data)return;const a=this.map.data;n.entries.forEach((e=>{"texture"===e.type&&a.textures.forEach((t=>{var r,s;r=e.name,s=t.name,r.toLowerCase()===s.toLowerCase()&&(t.width=e.width,t.height=e.height,t.data=e.data)}))})),this.events.emit("load",t),this.checkStatus()}))}loadSound(e,t){return s(this,void 0,void 0,(function*(){const r=new b(e);this.sounds.push(r),this.events.emit("loadstart",r);const s=this.config.getSoundsPath(),n=yield(0,h.xhr)(`${s}/${e}`,{method:"GET",isBinary:!0,progressCallback:(e,t)=>{r.progress=t,this.events.emit("progress",r)}}).catch((e=>{r.error(),this.events.emit("error",e,r),this.checkStatus()}));if(r.isError())return;const i=yield a.Sound.create(n).catch((e=>{r.error(),this.events.emit("error",e,r),this.checkStatus()}));i&&!r.isError()&&(i.index=t,i.name=e,r.done(i),this.events.emit("load",r),this.checkStatus())}))}}},4586:(e,t)=>{"use strict";var r,s,n,a,i,o,l,c,u,h,d,f,p,m,g;Object.defineProperty(t,"__esModule",{value:!0}),t.BspEntityParser=t.RenderMode=t.RenderEffect=t.ZHLTLightFlags=t.EnvBeamSpawnFlags=t.CyclerWeaponTriggerCondition=t.ButtonTargetSpawnFlags=t.AmbientGenericSpawnFlags=t.AmbientGenericPreset=t.AiScriptedSequenceSpawnflags=t.AiScriptedSequenceFinishSchedule=t.AiScriptedSequenceMoveTo=t.WorldSpawnDefaultTeam=t.WorldSpawnNewUnit=t.WorldSpawnGameTitle=t.WorldSpawnStartDark=void 0,function(e){e[e.No=0]="No",e[e.Yes=1]="Yes"}(r||(t.WorldSpawnStartDark=r={})),function(e){e[e.No=0]="No",e[e.Yes=1]="Yes"}(s||(t.WorldSpawnGameTitle=s={})),function(e){e[e.No=0]="No",e[e.Yes=1]="Yes"}(n||(t.WorldSpawnNewUnit=n={})),function(e){e[e.FewestPlayers=0]="FewestPlayers",e[e.FirstTeam=1]="FirstTeam"}(a||(t.WorldSpawnDefaultTeam=a={})),function(e){e[e.No=0]="No",e[e.Walk=1]="Walk",e[e.Run=2]="Run",e[e.Instantaneous=4]="Instantaneous",e[e.No_TurnToFace=5]="No_TurnToFace"}(i||(t.AiScriptedSequenceMoveTo=i={})),function(e){e[e.DefaultAI=0]="DefaultAI",e[e.Ambush=1]="Ambush"}(o||(t.AiScriptedSequenceFinishSchedule=o={})),function(e){e[e.Repeatable=4]="Repeatable",e[e.LeaveCorpse=8]="LeaveCorpse"}(l||(t.AiScriptedSequenceSpawnflags=l={})),function(e){e[e.None=0]="None",e[e.HugeMachine=1]="HugeMachine",e[e.BigMachine=2]="BigMachine",e[e.Machine=3]="Machine",e[e.SlowFadeIn=4]="SlowFadeIn",e[e.FadeIn=5]="FadeIn",e[e.QuickFadeIn=6]="QuickFadeIn",e[e.SlowPulse=7]="SlowPulse",e[e.Pulse=8]="Pulse",e[e.QuickPulse=9]="QuickPulse",e[e.SlowOscillator=10]="SlowOscillator",e[e.Oscillator=11]="Oscillator",e[e.QuickOscillator=12]="QuickOscillator",e[e.GrungePitch=13]="GrungePitch",e[e.VeryLowPitch=14]="VeryLowPitch",e[e.LowPitch=15]="LowPitch",e[e.HighPitch=16]="HighPitch",e[e.VeryHighPitch=17]="VeryHighPitch",e[e.ScreamingPitch=18]="ScreamingPitch",e[e.OscillateSpinUpDown=19]="OscillateSpinUpDown",e[e.PulseSpinUpDown=20]="PulseSpinUpDown",e[e.RandomPitch=21]="RandomPitch",e[e.RandomPitchFast=22]="RandomPitchFast",e[e.IncrementalSpinup=23]="IncrementalSpinup",e[e.Alien=24]="Alien",e[e.Bizzare=25]="Bizzare",e[e.PlanetX=26]="PlanetX",e[e.Haunted=27]="Haunted"}(c||(t.AmbientGenericPreset=c={})),function(e){e[e.PlayEverywhere=1]="PlayEverywhere",e[e.SmallRadius=2]="SmallRadius",e[e.MediumRadius=4]="MediumRadius",e[e.LargeRadius=8]="LargeRadius",e[e.StartSilent=16]="StartSilent",e[e.NotToggled=32]="NotToggled"}(u||(t.AmbientGenericSpawnFlags=u={})),function(e){e[e.UseActivates=1]="UseActivates",e[e.StartOn=2]="StartOn"}(h||(t.ButtonTargetSpawnFlags=h={})),function(e){e[e.NoTrigger=0]="NoTrigger",e[e.SeePlayerMadAtPlayer=1]="SeePlayerMadAtPlayer",e[e.TakeDamage=2]="TakeDamage",e[e.HalfHealthRemaining=3]="HalfHealthRemaining",e[e.Death=4]="Death",e[e.HearWorld=7]="HearWorld",e[e.HearPlayer=8]="HearPlayer",e[e.HearCombat=9]="HearCombat",e[e.SeePlayerUnconditional=10]="SeePlayerUnconditional",e[e.SeePlayerNotInCombat=11]="SeePlayerNotInCombat"}(d||(t.CyclerWeaponTriggerCondition=d={})),function(e){e[e.StartOn=1]="StartOn",e[e.Toggle=2]="Toggle",e[e.RandomStrike=4]="RandomStrike",e[e.Ring=8]="Ring",e[e.StartSparks=16]="StartSparks",e[e.EndSparks=32]="EndSparks",e[e.DecalEnd=64]="DecalEnd",e[e.FadeStart=128]="FadeStart",e[e.FadeEnd=256]="FadeEnd"}(f||(t.EnvBeamSpawnFlags=f={})),function(e){e[e.Normal=0]="Normal",e[e.EmbeddedFix=1]="EmbeddedFix",e[e.OpaqueBlockLight=2]="OpaqueBlockLight",e[e.OpaqueEmbeddedFix=3]="OpaqueEmbeddedFix",e[e.OpaqueConcaveFix=6]="OpaqueConcaveFix"}(p||(t.ZHLTLightFlags=p={})),function(e){e[e.Normal=0]="Normal",e[e.SlowPulse=1]="SlowPulse",e[e.FastPulse=2]="FastPulse",e[e.SlowWidePulse=3]="SlowWidePulse",e[e.FastWidePulse=4]="FastWidePulse",e[e.SlowFadeAway=5]="SlowFadeAway",e[e.FastFadeAway=6]="FastFadeAway",e[e.SlowBecomeSolid=7]="SlowBecomeSolid",e[e.FastBecomeSolid=8]="FastBecomeSolid",e[e.SlowStrobe=9]="SlowStrobe",e[e.FastStrobe=10]="FastStrobe",e[e.FasterStrobe=11]="FasterStrobe",e[e.SlowFlicker=12]="SlowFlicker",e[e.FastFlicker=13]="FastFlicker",e[e.ConstantGlow=14]="ConstantGlow",e[e.DistortModels=15]="DistortModels",e[e.HologramDistort=16]="HologramDistort"}(m||(t.RenderEffect=m={})),function(e){e[e.Normal=0]="Normal",e[e.Color=1]="Color",e[e.Texture=2]="Texture",e[e.Glow=3]="Glow",e[e.Solid=4]="Solid",e[e.Additive=5]="Additive"}(g||(t.RenderMode=g={}));const y=e=>e.split(" ").map((e=>parseFloat(e))),v={worldspawn:e=>({classname:"worldspawn",wad:e.wad.split(";").filter((e=>e.length)).map((e=>e.replace(/\\/g,"/"))),mapversion:parseInt(e.mapversion),skyname:e.skyname,maxRange:parseFloat(e.MaxRange)||8192,message:e.message||"",sounds:parseInt(e.sounds)||0,light:parseInt(e.light)||0,waveHeight:parseFloat(e.WaveHeight)||0,startDark:parseInt(e.startdark)||0,newUnit:parseInt(e.newunit)||0,defaultTeam:parseInt(e.defaultteam)||0,gameTitle:parseInt(e.gametitle)||0}),aiscripted_sequence:e=>({classname:"aiscripted_sequence",spawnflags:parseInt(e.spawnflags),m_iszEntity:e.m_iszEntity,m_iszPlay:e.m_iszPlay||"",m_flRadius:parseInt(e.m_flRadius)||512,m_flRepeat:parseInt(e.m_flRepeat)||0,m_fMoveTo:parseInt(e.m_fMoveTo)||0,m_iFinishSchedule:parseInt(e.m_iFinishSchedule)||0}),ambient_generic:e=>({classname:"ambient_generic",origin:y(e.origin),targetName:e.targetname,message:e.message,health:parseInt(e.health)||10,preset:parseInt(e.preset)||0,startVolume:parseInt(e.volstart)||0,fadeIn:parseInt(e.fadein),fadeOut:parseInt(e.fadeout),pitch:parseInt(e.pitch),pitchStart:parseInt(e.pitchstart),spinUp:parseInt(e.spinup),spinDown:parseInt(e.spindown),lfoType:parseInt(e.lfotype),lfoRate:parseInt(e.lforate),lfoModPitch:parseInt(e.lfomodpitch),lfoModVolume:parseInt(e.lfomodvolume),cSpinUp:parseInt(e.cspinup),spawnFlags:parseInt(e.spawnflags)}),ammo_357:e=>({classname:"ammo_357",origin:y(e.origin),angles:y(e.angles),target:e.target,targetName:e.targetname||"",delay:parseInt(e.delay)||0,killTarget:e.killtarget||"",spawnFlags:e.spawnflags||0}),ammo_9mmAR:e=>({classname:"ammo_9mmAR",origin:y(e.origin),angles:y(e.angles),target:e.target,targetName:e.targetname||"",delay:parseInt(e.delay)||0,killTarget:e.killtarget||"",spawnFlags:e.spawnflags||0}),ammo_9mmbox:e=>({classname:"ammo_9mmbox",origin:y(e.origin),angles:y(e.angles),target:e.target,targetName:e.targetname||"",delay:parseInt(e.delay)||0,killTarget:e.killtarget||"",spawnFlags:e.spawnflags||0}),ammo_9mmclip:e=>({classname:"ammo_9mmclip",origin:y(e.origin),angles:y(e.angles),target:e.target,targetName:e.targetname||"",delay:parseInt(e.delay)||0,killTarget:e.killtarget||"",spawnFlags:e.spawnflags||0}),ammo_ARgrenades:e=>({classname:"ammo_ARgrenades",origin:y(e.origin),angles:y(e.angles),target:e.target,targetName:e.targetname||"",delay:parseInt(e.delay)||0,killTarget:e.killtarget||"",spawnFlags:e.spawnflags||0}),ammo_buckshot:e=>({classname:"ammo_buckshot",origin:y(e.origin),angles:y(e.angles),target:e.target,targetName:e.targetname||"",delay:parseInt(e.delay)||0,killTarget:e.killtarget||"",spawnFlags:e.spawnflags||0}),ammo_crossbow:e=>({classname:"ammo_crossbow",origin:y(e.origin),angles:y(e.angles),target:e.target,targetName:e.targetname||"",delay:parseInt(e.delay)||0,killTarget:e.killtarget||"",spawnFlags:e.spawnflags||0}),ammo_gaussclip:e=>({classname:"ammo_gaussclip",origin:y(e.origin),angles:y(e.angles),target:e.target,targetName:e.targetname||"",delay:parseInt(e.delay)||0,killTarget:e.killtarget||"",spawnFlags:e.spawnflags||0}),ammo_rpgclip:e=>({classname:"ammo_rpgclip",origin:y(e.origin),angles:y(e.angles),target:e.target,targetName:e.targetname||"",delay:parseInt(e.delay)||0,killTarget:e.killtarget||"",spawnFlags:e.spawnflags||0}),button_target:e=>({classname:"button_target",target:e.target,master:e.master,renderEffect:parseInt(e.renderfx)||0,renderMode:parseInt(e.rendermode)||0,renderAmmount:parseInt(e.renderamt)||255,renderColor:y(e.rendercolor||"0 0 0"),zhltLightFlags:parseInt(e.zhlt_lightflags)||0,lightOrigin:e.light_origin,spawnFlags:parseInt(e.spawnflags)||1}),cycler:e=>({classname:"cycler",origin:y(e.origin),angles:y(e.angles),targetName:e.targetname,model:e.model,sequence:e.sequence||"",renderEffect:parseInt(e.renderfx)||0,renderMode:parseInt(e.rendermode)||0,renderAmmount:parseInt(e.renderamt)||255,renderColor:y(e.rendercolor||"0 0 0")}),cycler_sprite:e=>({classname:"cycler_sprite",origin:y(e.origin),angles:y(e.angles),targetName:e.targetname,model:e.model,framerate:parseInt(e.framerate||"10"),renderEffect:parseInt(e.renderfx)||0,renderMode:parseInt(e.rendermode)||0,renderAmmount:parseInt(e.renderamt)||255,renderColor:y(e.rendercolor||"0 0 0")}),cyclear_weapon:e=>({classname:"cycler_weapon",origin:y(e.origin),angles:y(e.angles),target:e.target,targetName:e.targetname,triggerTarget:e.TriggerTarget||"",triggerCondition:parseInt(e.TriggerCondition)||0,model:e.model,sequence:e.sequence,renderEffect:parseInt(e.renderfx)||0,renderMode:parseInt(e.rendermode)||0,renderAmmount:parseInt(e.renderamt)||255,renderColor:y(e.rendercolor||"0 0 0")}),cyclear_wreckage:e=>({classname:"cycler_wreckage",origin:y(e.origin),angles:y(e.angles),targetName:e.targetname,model:e.model,framerate:parseInt(e.framerate)||10,scale:parseFloat(e.scale)||1,renderEffect:parseInt(e.renderfx)||0,renderMode:parseInt(e.rendermode)||0,renderAmmount:parseInt(e.renderamt)||255,renderColor:y(e.rendercolor||"0 0 0")}),env_beam:e=>({classname:"env_beam",renderEffect:parseInt(e.renderfx)||0,renderMode:parseInt(e.rendermode)||0,renderAmmount:parseInt(e.renderamt)||255,renderColor:y(e.rendercolor||"0 0 0"),radius:parseFloat(e.Radius)||256,life:parseInt(e.life)||1,boltWidth:parseInt(e.BoltWidth)||20,noiseAmplitude:parseInt(e.NoiseAmplitude)||0,texture:e.texture||"sprites/laserbeam.spr",textureScroll:parseInt(e.TextureScroll)||35,frameRate:parseInt(e.framerate)||0,frameStart:parseInt(e.framestart)||0,strikeTime:parseInt(e.StrikeTime)||1,damage:parseInt(e.damage)||1,spawnFlags:parseInt(e.spawnflags)})};t.BspEntityParser=class{static parse(e){const t=[];for(let r=0;r<e.length;++r){const s=e[r];s.classname||t.push({classname:"!",data:s}),v[s.classname]?t.push(v[s.classname](s)):t.push({classname:"?",originalClassname:s.classname,data:s})}return t}}},4055:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BspLightmapParser=void 0;class r{static init(e){return new r(e)}constructor(e){this.block=new Uint16Array(r.TEXTURE_SIZE),this.lightmap=e,this.texture=new Uint8Array(r.TEXTURE_SIZE*r.TEXTURE_SIZE*4),this.texture[this.texture.length-4]=255,this.texture[this.texture.length-3]=255,this.texture[this.texture.length-2]=255,this.texture[this.texture.length-1]=255}getTexture(){return this.texture}processFace(e,t,s){const n=this.getDimensions(e),a=this.readLightmap(s,n.width,n.height);if(a)for(let s=0;s<e.length/7;++s){let i=e[7*s]*t.s[0]+e[7*s+1]*t.s[1]+e[7*s+2]*t.s[2]+t.sShift-n.minU;i+=16*a.x+8,i/=16*r.TEXTURE_SIZE;let o=e[7*s]*t.t[0]+e[7*s+1]*t.t[1]+e[7*s+2]*t.t[2]+t.tShift-n.minV;o+=16*a.y+8,o/=16*r.TEXTURE_SIZE,e[7*s+5]=i,e[7*s+6]=o}}getDimensions(e){let t=Math.floor(e[3]),r=Math.floor(e[4]),s=Math.floor(e[3]),n=Math.floor(e[4]);for(let a=1;a<e.length/7;++a)Math.floor(e[7*a+3])<t&&(t=Math.floor(e[7*a+3])),Math.floor(e[7*a+4])<r&&(r=Math.floor(e[7*a+4])),Math.floor(e[7*a+3])>s&&(s=Math.floor(e[7*a+3])),Math.floor(e[7*a+4])>n&&(n=Math.floor(e[7*a+4]));return{width:Math.ceil(s/16)-Math.floor(t/16)+1,height:Math.ceil(n/16)-Math.floor(r/16)+1,minU:Math.floor(t),minV:Math.floor(r)}}readLightmap(e,t,s){if(s<=0||t<=0)return null;const n=this.findFreeSpace(t,s);if(n){const a=[n.x,n.y],i=[t,s],o=[r.TEXTURE_SIZE,r.TEXTURE_SIZE],l=t*s;for(let t=0;t<l;++t){const r=a[1]*o[0]+a[0]+o[0]*Math.floor(t/i[0])+t%i[0];this.texture[4*r]=Math.min(255,2*this.lightmap[e+3*t]),this.texture[4*r+1]=Math.min(255,2*this.lightmap[e+3*t+1]),this.texture[4*r+2]=Math.min(255,2*this.lightmap[e+3*t+2]),this.texture[4*r+3]=255}}return n}findFreeSpace(e,t){let s=0,n=0,a=r.TEXTURE_SIZE;for(let t=0;t<this.block.length-e;++t){let r,i=0;for(r=0;r<e&&!(this.block[t+r]>=a);++r)this.block[t+r]>i&&(i=this.block[t+r]);r===e&&(s=t,n=a=i)}if(a+t>r.TEXTURE_SIZE)return null;for(let r=0;r<e;++r)this.block[s+r]=a+t;return{x:s,y:n}}}t.BspLightmapParser=r,r.TEXTURE_SIZE=1024},9157:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BspParser=t.BspLumpIndex=void 0,t.parseModels=c;const s=r(2130),n=r(6947),a=r(1269),i=r(8529),o=r(4055),l=r(3791);function c(e,t,r,s,n,a,i,o){const l=[];for(let c=0;c<e.length;++c){const u=e[c],h=[],d=new Float32Array(3),f=new Float32Array(3),p=new Float32Array(3),m=new Float32Array(2),g=new Float32Array(2),y=new Float32Array(2),v=new Float32Array(2),b=new Float32Array(2),_=new Float32Array(2);let M=0===c?[0,0,0]:[0,0,0].map(((e,t)=>(u.maxs[t]-u.mins[t])/2+u.mins[t]));for(let e=u.firstFace;e<u.firstFace+u.faceCount;++e){const l={buffer:new Float32Array(21*(t[e].edgeCount-2)),textureIndex:-1},c=a[t[e].textureInfo],u=i[c.textureIndex],x=s.slice(t[e].firstEdge,t[e].firstEdge+t[e].edgeCount),S=r[Math.abs(x[0])][x[0]>0?0:1];d[0]=n[S][0],d[1]=n[S][1],d[2]=n[S][2],m[0]=d[0]*c.s[0]+d[1]*c.s[1]+d[2]*c.s[2]+c.sShift,m[1]=d[0]*c.t[0]+d[1]*c.t[1]+d[2]*c.t[2]+c.tShift,v[0]=0,v[1]=0;const T=r[Math.abs(x[1])][x[1]>0?0:1];f[0]=n[T][0],f[1]=n[T][1],f[2]=n[T][2],g[0]=f[0]*c.s[0]+f[1]*c.s[1]+f[2]*c.s[2]+c.sShift,g[1]=f[0]*c.t[0]+f[1]*c.t[1]+f[2]*c.t[2]+c.tShift,b[0]=0,b[1]=.999;let E=0;for(let s=2;s<t[e].edgeCount;++s){const e=r[Math.abs(x[s])][x[s]>0?0:1];p[0]=n[e][0],p[1]=n[e][1],p[2]=n[e][2],y[0]=p[0]*c.s[0]+p[1]*c.s[1]+p[2]*c.s[2]+c.sShift,y[1]=p[0]*c.t[0]+p[1]*c.t[1]+p[2]*c.t[2]+c.tShift,_[0]=.999,_[1]=.999,l.buffer[E++]=d[0],l.buffer[E++]=d[1],l.buffer[E++]=d[2],l.buffer[E++]=m[0],l.buffer[E++]=m[1],l.buffer[E++]=v[0],l.buffer[E++]=v[1],l.buffer[E++]=f[0],l.buffer[E++]=f[1],l.buffer[E++]=f[2],l.buffer[E++]=g[0],l.buffer[E++]=g[1],l.buffer[E++]=b[0],l.buffer[E++]=b[1],l.buffer[E++]=p[0],l.buffer[E++]=p[1],l.buffer[E++]=p[2],l.buffer[E++]=y[0],l.buffer[E++]=y[1],l.buffer[E++]=_[0],l.buffer[E++]=_[1],f[0]=p[0],f[1]=p[1],f[2]=p[2],g[0]=y[0],g[1]=y[1],b[0]=_[0],b[1]=_[1]}0!==c.flags&&-65536!==c.flags||o.processFace(l.buffer,c,t[e].lightmapOffset),l.textureIndex=c.textureIndex;for(let e=0;e<l.buffer.length/7;++e)l.buffer[7*e]-=M[0],l.buffer[7*e+1]-=M[1],l.buffer[7*e+2]-=M[2],l.buffer[7*e+3]/=u.width,l.buffer[7*e+4]/=u.height;h.push(l)}l.push({origin:M,faces:h})}return l}var u;!function(e){e[e.Entities=0]="Entities",e[e.Planes=1]="Planes",e[e.Textures=2]="Textures",e[e.Vertices=3]="Vertices",e[e.Visibility=4]="Visibility",e[e.Nodes=5]="Nodes",e[e.TexInfo=6]="TexInfo",e[e.Faces=7]="Faces",e[e.Lighting=8]="Lighting",e[e.ClipNodes=9]="ClipNodes",e[e.Leaves=10]="Leaves",e[e.MarkSurfaces=11]="MarkSurfaces",e[e.Edges=12]="Edges",e[e.SurfEdges=13]="SurfEdges",e[e.Models=14]="Models"}(u||(t.BspLumpIndex=u={}));t.BspParser=class{static parse(e,t){const r=new i.Reader(t);if(30!==r.ui())throw new Error("Invalid map version");const s=[];for(let e=0;e<15;++e)s.push({offset:r.ui(),length:r.ui()});const n=this.loadEntities(r,s[u.Entities].offset,s[u.Entities].length),l=this.loadTextures(r,s[u.Textures].offset),h=this.loadModels(r,s[u.Models].offset,s[u.Models].length),d=this.loadFaces(r,s[u.Faces].offset,s[u.Faces].length),f=this.loadEdges(r,s[u.Edges].offset,s[u.Edges].length),p=this.loadSurfEdges(r,s[u.SurfEdges].offset,s[u.SurfEdges].length),m=this.loadVertices(r,s[u.Vertices].offset,s[u.Vertices].length),g=this.loadTexInfo(r,s[u.TexInfo].offset,s[u.TexInfo].length),y=this.loadLightmap(r,s[u.Lighting].offset,s[u.Lighting].length),v=o.BspLightmapParser.init(y),b=c(h,d,f,p,m,g,l,v);return new a.Bsp(e,n,l,b,{width:o.BspLightmapParser.TEXTURE_SIZE,height:o.BspLightmapParser.TEXTURE_SIZE,data:v.getTexture()})}static loadFaces(e,t,r){e.seek(t);const s=[];for(let t=0;t<r/20;++t)s.push({plane:e.us(),planeSide:e.us(),firstEdge:e.ui(),edgeCount:e.us(),textureInfo:e.us(),styles:[e.ub(),e.ub(),e.ub(),e.ub()],lightmapOffset:e.ui()});return s}static loadModels(e,t,r){e.seek(t);const s=[];for(let t=0;t<r/64;++t)s.push({mins:[e.f(),e.f(),e.f()],maxs:[e.f(),e.f(),e.f()],origin:[e.f(),e.f(),e.f()],headNodes:[e.i(),e.i(),e.i(),e.i()],visLeaves:e.i(),firstFace:e.i(),faceCount:e.i()});return s}static loadEdges(e,t,r){e.seek(t);const s=[];for(let t=0;t<r/4;++t)s.push([e.us(),e.us()]);return s}static loadSurfEdges(e,t,r){e.seek(t);const s=[];for(let t=0;t<r/4;++t)s.push(e.i());return s}static loadVertices(e,t,r){e.seek(t);const s=[];for(let t=0;t<r/12;++t)s.push([e.f(),e.f(),e.f()]);return s}static loadTexInfo(e,t,r){e.seek(t);const s=[];for(let t=0;t<r/40;++t)s.push({s:[e.f(),e.f(),e.f()],sShift:e.f(),t:[e.f(),e.f(),e.f()],tShift:e.f(),textureIndex:e.i(),flags:e.i()});return s}static loadLightmap(e,t,r){return e.seek(t),e.arrx(r,i.ReaderDataType.UByte)}static loadTextureData(e){const t=e.nstr(16),r=e.ui(),s=e.ui(),n=!e.ui();if(n){const e=new Uint8Array(4);return e[0]=e[1]=e[2]=e[3]=255,{name:t,width:r,height:s,data:e,isExternal:n}}{e.skip(12);const a=r*s,o=e.arrx(a,i.ReaderDataType.UByte);e.skip(a/64*21),e.skip(2);const c=e.arrx(768,i.ReaderDataType.UByte);return{name:t,width:r,height:s,data:"{"===t[0]?(0,l.paletteWithLastTransToRGBA)(o,c):(0,l.paletteToRGBA)(o,c),isExternal:n}}}static loadTextures(e,t){e.seek(t);const r=e.ui(),s=[];for(let t=0;t<r;++t)s.push(e.ui());const n=[];for(let a=0;a<r;++a)4294967295===s[a]?n.push({name:"ERROR404",width:1,height:1,data:new Uint8Array([0,255,0,255]),isExternal:!1}):(e.seek(t+s[a]),n.push(this.loadTextureData(e)));return n}static loadEntities(e,t,r){e.seek(t);const a=(0,n.vdf)(e.nstr(r)),i=["origin","angles","_diffuse_light","_light","rendercolor","avelocity"],o=["renderamt","rendermode","scale"],l=a[0];return"worldspawn"===l.classname&&(l.model="*0",l.wad=l.wad||"",l.wad=l.wad.split(";").filter((e=>e.length)).map((e=>e.replace(/\\/g,"/"))).map((e=>(0,s.basename)(e)))),a.forEach((e=>{e.model&&(void 0===e.renderamt&&(e.renderamt=0),void 0===e.rendermode&&(e.rendermode=0),void 0===e.renderfx&&(e.renderfx=0),void 0===e.rendercolor&&(e.rendercolor="0 0 0")),i.forEach((t=>{e[t]&&(e[t]=e[t].split(" ").map((e=>Number.parseFloat(e))))})),o.forEach((t=>{e[t]&&(e[t]=Number.parseFloat(e[t]))}))})),a}}},8506:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Sprite=t.SpriteSyncType=t.SpriteAlphaType=t.SpriteType=void 0;const s=r(8529),n=r(3791);var a,i,o;!function(e){e[e.VP_PARALLEL_UPRIGHT=0]="VP_PARALLEL_UPRIGHT",e[e.FACING_UPRIGHT=1]="FACING_UPRIGHT",e[e.VP_PARALLEL=2]="VP_PARALLEL",e[e.ORIENTED=3]="ORIENTED",e[e.VP_PARALLEL_ORIENTED=4]="VP_PARALLEL_ORIENTED"}(a||(t.SpriteType=a={})),function(e){e[e.SPR_NORMAL=0]="SPR_NORMAL",e[e.SPR_ADDITIVE=1]="SPR_ADDITIVE",e[e.SPR_INDEXALPHA=2]="SPR_INDEXALPHA",e[e.SPR_ALPHTEST=3]="SPR_ALPHTEST"}(i||(t.SpriteAlphaType=i={})),function(e){e[e.SYNCHRONIZED=0]="SYNCHRONIZED",e[e.RANDOM=1]="RANDOM"}(o||(t.SpriteSyncType=o={}));class l{constructor(e,t){this.header=e,this.frames=t}static parse(e){const t=new s.Reader(e);if("IDSP"!==t.nstr(4))throw new Error("Invalid sprite file format");const r={version:t.i(),type:t.i(),alphaType:t.i(),radius:t.f(),width:t.i(),height:t.i(),frameCount:t.i(),beamLength:t.f(),syncType:t.i()},a=t.s(),o=t.arrx(3*a,s.ReaderDataType.UByte),c=[];for(let e=0;e<r.frameCount;++e){const e={group:t.i(),position:[t.i(),t.i()],width:t.i(),height:t.i(),data:new Uint8Array(r.width*r.height*4)},a=t.arrx(r.width*r.height,s.ReaderDataType.UByte);r.alphaType===i.SPR_ALPHTEST?e.data=(0,n.paletteWithLastTransToRGBA)(a,o):e.data=(0,n.paletteToRGBA)(a,o),c.push(e)}return new l(r,c)}}t.Sprite=l},9955:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Tga=void 0;const s=r(8529);class n{constructor(e,t,r,s){this.name=e,this.width=t,this.height=r,this.data=s}static parse(e,t){let r=new s.Reader(e),a={idLength:r.ub(),colorMapType:r.ub(),imageType:r.ub(),colorMap:{firstEntryIndex:r.us(),length:r.us(),size:r.ub()},image:{xOrigin:r.us(),yOrigin:r.us(),width:r.us(),height:r.us(),depth:r.ub(),descriptor:r.ub()}};if(a.idLength&&r.arrx(a.idLength,s.ReaderDataType.UByte),a.colorMapType)throw new Error("Not implemented");let i,o=a.image.width,l=a.image.height,c=o*l;if(2===a.imageType){let e=c*a.image.depth/8;if(i=r.arrx(e,s.ReaderDataType.UByte),24===a.image.depth){let e=new Uint8Array(4*c);for(let t=0;t<l;++t)for(let r=0;r<o;++r){let s=(l-1-t)*o+r;e[4*s]=i[3*(t*o+r)+2],e[4*s+1]=i[3*(t*o+r)+1],e[4*s+2]=i[3*(t*o+r)],e[4*s+3]=255}i=e}else if(32===a.image.depth){let e=new Uint8Array(4*c);for(let t=0;t<l;++t)for(let r=0;r<o;++r){let s=(l-1-t)*o+r;e[4*s]=i[4*(t*o+r)+2],e[4*s+1]=i[4*(t*o+r)+1],e[4*s+2]=i[4*(t*o+r)],e[4*s+3]=255}i=e}}else if(10===a.imageType&&(i=new Uint8Array(4*c),24===a.image.depth))for(let e=0;e<l;++e)for(let t=0;t<o;){let s=r.ub();if(128&s){s=1+(127&s);let n=r.ub(),a=r.ub(),c=r.ub();for(;t<o&&s;){let r=(l-1-e)*o+t;i[4*r]=c,i[4*r+1]=a,i[4*r+2]=n,i[4*r+3]=255,++t,--s}}else for(s=1+(127&s);t<o&&s;){let n=(l-1-e)*o+t;i[4*n+2]=r.ub(),i[4*n+1]=r.ub(),i[4*n]=r.ub(),i[4*n+3]=255,++t,--s}}return new n(t,a.image.width,a.image.height,i)}}t.Tga=n},3791:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.paletteToRGBA=function(e,t){const r=new Uint8Array(4*e.length),s=e.length;for(let n=0;n<s;++n)r[4*n]=t[3*e[n]],r[4*n+1]=t[3*e[n]+1],r[4*n+2]=t[3*e[n]+2],r[4*n+3]=255;return r},t.paletteWithLastTransToRGBA=function(e,t){const r=new Uint8Array(4*e.length),s=e.length;for(let n=0;n<s;++n)255===e[n]?r[4*n+3]=0:(r[4*n]=t[3*e[n]],r[4*n+1]=t[3*e[n]+1],r[4*n+2]=t[3*e[n]+2],r[4*n+3]=255);return r}},6947:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.vdf=function(e){let t=0,r="",s="";const n=[];for(let a=0;a<e.length;++a){const i=e[a];switch(t){case 0:if(/\s/.test(i))continue;if("{"!==i)return[];n.push({}),t=1;break;case 1:if(/\s/.test(i))continue;if("}"===i)t=0;else{if('"'!==i)return[];r="",t=2}break;case 2:'"'===i?t=3:r+=i;break;case 3:if(/\s/.test(i))continue;'"'===i&&(s="",t=4);break;case 4:'"'===i?(n[n.length-1][r]=s,t=1):s+=i}}return n}},595:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Wad=void 0;const s=r(8529),n=r(3791);function a(e,t){switch(e.seek(t.offset),t.type){case 64:return function(e){const t=e.nstr(16),r=e.ui(),a=e.ui();e.skip(16);const i=r*a,o=e.arrx(i,s.ReaderDataType.UByte);e.skip(i/64*21),e.skip(2);const l=e.arrx(768,s.ReaderDataType.UByte);return{type:"decal",name:t,width:r,height:a,data:"{"===t[0]?(0,n.paletteWithLastTransToRGBA)(o,l):(0,n.paletteToRGBA)(o,l)}}(e);case 66:return((e,t)=>({type:"cache",name:t.name}))(0,t);case 67:return function(e){const t=e.nstr(16),r=e.ui(),a=e.ui();e.skip(16);const i=r*a,o=e.arrx(i,s.ReaderDataType.UByte);e.skip(i/64*21),e.skip(2);const l=e.arrx(768,s.ReaderDataType.UByte);return{type:"texture",name:t,width:r,height:a,data:"{"===t[0]?(0,n.paletteWithLastTransToRGBA)(o,l):(0,n.paletteToRGBA)(o,l)}}(e);case 70:return function(e,t){const r=e.ui()&&256,a=e.ui(),i=e.ui(),o=e.ui(),l=[];for(let t=0;t<256;++t){const t=e.us(),s=e.us();l.push({x:t%r,y:Math.floor(t/r)/o*o,width:s,height:o})}const c=r*a,u=e.arrx(c,s.ReaderDataType.UByte);e.skip(2);const h=e.arrx(768,s.ReaderDataType.UByte);return{type:"font",name:t.name,width:r,height:a,rowCount:i,rowHeight:o,glyphs:l,data:(0,n.paletteWithLastTransToRGBA)(u,h)}}(e,t);default:return((e,t)=>({type:"unknown",name:t.name,data:e.arrx(t.length,s.ReaderDataType.UByte)}))(e,t)}}class i{constructor(e){this.entries=e}static parse(e){const t=new s.Reader(e);if("WAD3"!==t.nstr(4))throw new Error("Invalid WAD file format");const r=t.ui(),n=t.ui();t.seek(n);const o=[];for(let e=0;e<r;++e){const e={offset:t.ui(),diskLength:t.ui(),length:t.ui(),type:t.b(),isCompressed:t.b(),name:""};t.skip(2),e.name=t.nstr(16),o.push(e)}const l=o.map((e=>a(t,e)));return new i(l)}}t.Wad=i},1409:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.FullscreenButton=void 0;const s=r(172),n=r(682),a=r(5359),i=r(5618),o=r(3750);class l extends s.Component{constructor(){super(...arguments),this.state={isInFullscreen:!1},this.onClick=()=>{a.Fullscreen.isInFullscreen()?a.Fullscreen.exit():a.Fullscreen.enter(this.props.root)},this.onFullscreen=()=>{this.setState({isInFullscreen:a.Fullscreen.isInFullscreen()})}}componentDidMount(){a.Fullscreen.onChange(this.onFullscreen)}componentWillUnmount(){a.Fullscreen.onChangeRemove(this.onFullscreen)}render(){return(0,s.h)("div",{class:(0,n.classes)(o.ControlsStyle.button,i.FullscreenButtonStyle.button),onClick:this.onClick},this.state.isInFullscreen?(0,s.h)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 64 64",fill:"currentcolor"},(0,s.h)("path",{d:"M0 22 L22 22 L22 0 L14 0 L14 14 L0 14 M42 0 L42 22 L64 22 L64 14 L50 14 L50 0 M14 50 L0 50 L0 42 L22 42 L22 64 L14 64 M42 64 L42 42 L64 42 L64 50 L50 50 L50 64 Z"})):(0,s.h)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 64 64",fill:"currentcolor"},(0,s.h)("path",{d:"M0 22 L8 22 L8 8 L22 8 L22 0 L0 0 M42 0 L42 8 L56 8 L56 22 L64 22 L64 0 M0 64 L0 42 L8 42 L8 56 L22 56 L22 64 M64 64 L42 64 L42 56 L56 56 L56 42 L64 42 Z"})))}}t.FullscreenButton=l},5618:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.FullscreenButtonStyle=void 0;const s=r(682);t.FullscreenButtonStyle=(0,s.stylesheet)({button:{width:"30px",minWidth:"30px",height:"30px",padding:"5px"}})},6388:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PauseButton=function(e){return(0,s.h)("div",{class:n.ControlsStyle.button,onClick:e.onClick},(0,s.h)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 64 64",fill:"currentcolor"},(0,s.h)("path",{d:"M0 0 L0 64 L20 64 L20 0 M44 0 L64 0 L64 64 L44 64 Z"})))};const s=r(172),n=r(3750)},7060:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PlayButton=function(e){return(0,s.h)("div",{class:n.ControlsStyle.button,onClick:e.onClick},(0,s.h)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 64 64",fill:"currentcolor"},(0,s.h)("path",{d:"M0 0 L0 64 L64 32 Z"})))};const s=r(172),n=r(3750)},7661:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SettingsButton=void 0;const s=r(172),n=r(682),a=r(7484),i=r(7750),o=r(3750);class l extends s.Component{constructor(){super(...arguments),this.onFreeModeClick=()=>{this.props.game.mode!==a.PlayerMode.FREE&&(this.props.game.changeMode(a.PlayerMode.FREE),this.props.game.player.pause())},this.onReplayModeClick=()=>{this.props.game.mode!==a.PlayerMode.REPLAY&&this.props.game.changeMode(a.PlayerMode.REPLAY)},this.onSpeedModeClick=()=>{this.props.game.mode!==a.PlayerMode.FREE&&(this.props.game.isSpeedVisible=!this.props.game.isSpeedVisible)},this.onFpsModeClick=()=>{this.props.game.mode!==a.PlayerMode.FREE&&(this.props.game.isFpsVisible=!this.props.game.isFpsVisible)},this.onButtonsModeClick=()=>{this.props.game.mode!==a.PlayerMode.FREE&&(this.props.game.isButtonsVisible=!this.props.game.isButtonsVisible)},this.onStrafesModeClick=()=>{this.props.game.mode!==a.PlayerMode.FREE&&(this.props.game.isStrafesVisible=!this.props.game.isStrafesVisible)},this.toggleMenu=()=>{this.setState({isOpen:!this.state.isOpen})}}render(){const e=!!this.props.game.player.replay;return(0,s.h)("div",{class:i.SettingsButtonStyle.settings},(0,s.h)("div",{class:(0,n.classes)(o.ControlsStyle.button,i.SettingsButtonStyle.button),onClick:this.toggleMenu},(0,s.h)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24"},(0,s.h)("path",{"fill-rule":"evenodd","clip-rule":"evenodd",fill:"#ffffff",d:"M23.9 10.7c0-0.3-0.4-0.6-0.8-0.6 -1.1 0-2.1-0.6-2.5-1.6 -0.4-1-0.1-2.2 0.7-3 0.3-0.2 0.3-0.6 0.1-0.9 -0.6-0.7-1.2-1.4-1.9-1.9 -0.3-0.2-0.7-0.2-0.9 0.1 -0.7 0.8-2 1.1-3 0.7 -1-0.4-1.7-1.5-1.6-2.6 0-0.4-0.2-0.7-0.6-0.7 -0.9-0.1-1.8-0.1-2.7 0C10.4 0.1 10.1 0.4 10.1 0.8 10.1 1.9 9.5 2.9 8.5 3.3 7.5 3.7 6.2 3.4 5.5 2.6c-0.2-0.3-0.6-0.3-0.9-0.1 -0.7 0.6-1.4 1.2-1.9 1.9C2.4 4.8 2.5 5.2 2.7 5.4c0.8 0.8 1.1 2 0.7 3 -0.4 1-1.4 1.6-2.6 1.6 -0.4 0-0.7 0.2-0.7 0.6 -0.1 0.9-0.1 1.8 0 2.7 0 0.3 0.4 0.6 0.8 0.6 1 0 2 0.6 2.5 1.6 0.4 1 0.2 2.2-0.7 3 -0.3 0.2-0.3 0.6-0.1 0.9 0.6 0.7 1.2 1.4 1.9 1.9 0.3 0.2 0.7 0.2 0.9-0.1 0.7-0.8 2-1.1 3-0.7 1 0.4 1.7 1.5 1.6 2.6 0 0.4 0.2 0.7 0.6 0.7C11.1 24 11.5 24 12 24c0.4 0 0.9 0 1.3-0.1 0.3 0 0.6-0.3 0.6-0.7 0-1.1 0.6-2.1 1.6-2.6 1-0.4 2.3-0.1 3 0.7 0.2 0.3 0.6 0.3 0.9 0.1 0.7-0.6 1.4-1.2 1.9-1.9 0.2-0.3 0.2-0.7-0.1-0.9 -0.8-0.8-1.1-2-0.7-3 0.4-1 1.4-1.6 2.5-1.6l0.1 0c0.3 0 0.7-0.2 0.7-0.6C24 12.5 24 11.6 23.9 10.7zM12 18c-3.3 0-6-2.7-6-6s2.7-6 6-6c3.3 0 6 2.7 6 6S15.3 18 12 18zM12 16"}))),(0,s.h)("div",{class:this.state.isOpen?i.SettingsButtonStyle.menuOpen:i.SettingsButtonStyle.menu},(0,s.h)("span",{class:i.SettingsButtonStyle.menuItemTitle},"Toggle Display"),(0,s.h)("span",{class:!0===this.props.game.isSpeedVisible?i.SettingsButtonStyle.menuItemSelected:i.SettingsButtonStyle.menuItem,onClick:this.onSpeedModeClick},"Speed"),(0,s.h)("span",{class:!0===this.props.game.isFpsVisible?i.SettingsButtonStyle.menuItemSelected:i.SettingsButtonStyle.menuItem,onClick:this.onFpsModeClick},"Fps"),(0,s.h)("span",{class:!0===this.props.game.isButtonsVisible?i.SettingsButtonStyle.menuItemSelected:i.SettingsButtonStyle.menuItem,onClick:this.onButtonsModeClick},"Keys"),(0,s.h)("span",{class:!0===this.props.game.isStrafesVisible?i.SettingsButtonStyle.menuItemSelected:i.SettingsButtonStyle.menuItem,onClick:this.onStrafesModeClick},"Stats"),(0,s.h)("span",{class:i.SettingsButtonStyle.menuItemTitle},"Mode"),e?(0,s.h)("span",{class:this.props.game.mode===a.PlayerMode.REPLAY?i.SettingsButtonStyle.menuItemSelected:i.SettingsButtonStyle.menuItem,onClick:this.onReplayModeClick},"Replay"):(0,s.h)("span",null),(0,s.h)("span",{class:this.props.game.mode===a.PlayerMode.FREE?i.SettingsButtonStyle.menuItemSelected:i.SettingsButtonStyle.menuItem,onClick:this.onFreeModeClick},"Free")))}}t.SettingsButton=l},7750:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SettingsButtonStyle=void 0;const s=r(682);t.SettingsButtonStyle=(0,s.stylesheet)({settings:{position:"relative"},menu:Object.assign({},{display:"none",position:"absolute",left:"-38px",bottom:"48px",padding:"2px 6px",fontSize:"14px",backgroundColor:"rgba(0, 0, 0, 0.4)",flexFlow:"column",minWidth:"100px"}),menuOpen:Object.assign(Object.assign({},{display:"none",position:"absolute",left:"-38px",bottom:"48px",padding:"2px 6px",fontSize:"14px",backgroundColor:"rgba(0, 0, 0, 0.4)",flexFlow:"column",minWidth:"100px"}),{display:"flex"}),menuItemTitle:{padding:"6px 4px",borderBottom:"1px solid white",fontWeight:"bold"},menuItem:Object.assign({},{cursor:"pointer",margin:"4px 0",padding:"4px",$nest:{"&:last-child":{marginTop:0},"&:hover":{backgroundColor:"rgba(255, 255, 255, 0.1)"}}}),menuItemSelected:Object.assign(Object.assign({},{cursor:"pointer",margin:"4px 0",padding:"4px",$nest:{"&:last-child":{marginTop:0},"&:hover":{backgroundColor:"rgba(255, 255, 255, 0.1)"}}}),{backgroundColor:"rgba(255, 255, 255, 0.2) !important"}),button:{width:"32px",height:"32px",padding:"5px"}})},5999:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SpeedDownButton=function(e){return(0,s.h)("div",{class:(0,n.classes)(i.ControlsStyle.button,a.SpeedDownButtonStyle.button),onClick:e.onClick},(0,s.h)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 64 64",fill:"currentcolor"},(0,s.h)("path",{d:"M0 0 L0 64 L32 32 L32 64 L64 32 L32 0 L32 32 Z"})))};const s=r(172),n=r(682),a=r(3068),i=r(3750)},3068:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SpeedDownButtonStyle=void 0;const s=r(682);t.SpeedDownButtonStyle=(0,s.stylesheet)({button:{transform:"rotate(180deg)"}})},6656:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SpeedUpButton=function(e){return(0,s.h)("div",{class:n.ControlsStyle.button,onClick:e.onClick},(0,s.h)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 64 64",fill:"currentcolor"},(0,s.h)("path",{d:"M0 0 L0 64 L32 32 L32 64 L64 32 L32 0 L32 32 Z"})))};const s=r(172),n=r(3750)},7460:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.VolumeButton=function(e){return(0,s.h)("div",{class:(0,n.classes)(i.ControlsStyle.button,a.VolumeButton.button),onClick:e.onClick},(0,s.h)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 48 48",fill:"currentcolor"},(0,s.h)("path",{d:"M6 18v12h8l10 10V8L14 18H6zm27 6c0-3.53-2.04-6.58-5-8.05v16.11c2.96-1.48 5-4.53 5-8.06zM28 6.46v4.13c5.78 1.72 10 7.07 10 13.41s-4.22 11.69-10 13.41v4.13c8.01-1.82 14-8.97 14-17.54S36.01 8.28 28 6.46z"})))};const s=r(172),n=r(682),a=r(4569),i=r(3750)},4569:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.VolumeButton=void 0;const s=r(682);t.VolumeButton=(0,s.stylesheet)({button:{width:"28px",height:"28px",padding:"2px",marginRight:"5px"}})},3750:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ControlsStyle=void 0;const s=r(682);t.ControlsStyle=(0,s.stylesheet)({controls:Object.assign({},{zIndex:30,position:"absolute",width:"100%",bottom:0,padding:"0 16px",boxSizing:"border-box",backgroundColor:"rgba(0, 0, 0, 0.4)",userSelect:"none",opacity:0,transition:"opacity 0.2s"}),controlsVisible:Object.assign(Object.assign({},{zIndex:30,position:"absolute",width:"100%",bottom:0,padding:"0 16px",boxSizing:"border-box",backgroundColor:"rgba(0, 0, 0, 0.4)",userSelect:"none",opacity:0,transition:"opacity 0.2s"}),{opacity:1}),buttons:{height:"100%",display:"flex",justifyContent:"space-between",marginBottom:"6px",alignItems:"center"},button:{width:"32px",height:"32px",padding:"7px",boxSizing:"border-box",cursor:"pointer"},left:{display:"flex",alignItems:"center",$nest:{"& .button":{marginRight:"8px"}}},right:{display:"flex",alignItems:"center",width:"70px",height:"100%",justifyContent:"space-between"}})},8511:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.FreeMode=function(e){return(0,s.h)("div",{class:(0,n.classes)(e.class,a.FreeModeStyle.controls)},(0,s.h)("div",{class:i.ControlsStyle.buttons},(0,s.h)("div",{class:i.ControlsStyle.left}),(0,s.h)("div",{class:i.ControlsStyle.right},(0,s.h)(o.SettingsButton,{game:e.game}),(0,s.h)(l.FullscreenButton,{active:!1,root:e.root}))))};const s=r(172),n=r(682),a=r(5388),i=r(3750),o=r(7661),l=r(1409)},5388:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.FreeModeStyle=void 0;const s=r(682);t.FreeModeStyle=(0,s.stylesheet)({controls:{height:"44px"}})},7188:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Loading=void 0;const s=r(172),n=r(9609),a={replay:"Replay",bsp:"Map",sound:"Sounds",sky:"Skybox",sprite:"Sprites",wad:"Wads"};class i extends s.Component{constructor(){super(...arguments),this.state={items:{}},this.onItemLoad=e=>{const t=this.state.items[e.type]?this.state.items[e.type]:[];for(let r=0;r<t.length;++r)if(t[r]===e)return;t.push({name:e.name,progress:0}),this.setState({items:Object.assign(Object.assign({},this.state.items),{[e.type]:t})})},this.onItemProgress=e=>{if(!this.state.items[e.type])return;const t=this.state.items[e.type];for(let r=0;r<t.length;++r)if(t[r].name===e.name){t[r].progress=e.progress;break}this.forceUpdate()}}componentDidMount(){const e=this.props.game.loader.events;this.offLoadStart=e.on("loadstart",this.onItemLoad),this.offProgress=e.on("progress",this.onItemProgress)}componentWillUnmount(){this.offLoadStart&&this.offLoadStart(),this.offProgress&&this.offProgress()}formatItem(e,t){e=a[e];const r=Math.round(100*t)+"%";let s=29-e.length-r.length;s<2&&(s=9-r.length);return`${e}${Array(s).join(".")}${r}`}render(){return(0,s.h)("div",{class:this.props.visible?n.LoadingStyle.loading:n.LoadingStyle.loadingHidden},(0,s.h)("div",{class:n.LoadingStyle.spinner},(0,s.h)("svg",{xmlns:"http://www.w3.org/2000/svg",x:"0px",y:"0px",width:"80px",height:"80px",viewBox:"0 0 80 80",xmlSpace:"preserve"},(0,s.h)("path",{fill:"#ffffff",width:"10px",d:"M40,72C22.4,72,8,57.6,8,40C8,22.4,22.4,8,40,8c17.6,0,32,14.4,32,32c0,1.1-0.9,2-2,2s-2-0.9-2-2c0-15.4-12.6-28-28-28S12,24.6,12,40s12.6,28,28,28c1.1,0,2,0.9,2,2S41.1,72,40,72z"}))),(0,s.h)("ul",{class:n.LoadingStyle.log},Object.entries(this.state.items).map((([e,t])=>(0,s.h)("li",{key:e,class:n.LoadingStyle.logItem},this.formatItem(e,t.reduce(((e,t)=>e+t.progress),0)/t.length))))))}}t.Loading=i},9609:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LoadingStyle=void 0;const s=r(682);t.LoadingStyle=(0,s.stylesheet)({loading:Object.assign({},{position:"relative",width:"100%",height:"100%",opacity:1,transition:"opacity 2s ease, z-index 1s linear",zIndex:30}),loadingHidden:Object.assign(Object.assign({},{position:"relative",width:"100%",height:"100%",opacity:1,transition:"opacity 2s ease, z-index 1s linear",zIndex:30}),{opacity:0,userSelect:"none",zIndex:0}),spinner:{position:"absolute",left:"50%",top:"50%",marginLeft:"-40px",marginTop:"-40px",animation:"rotate 1s linear 0s infinite",height:"80px",width:"80px",animationName:(0,s.keyframes)({from:{transform:"rotate(0deg)"},to:{transform:"rotate(360deg)"}})},log:{position:"absolute",background:"rgba(0,0,0,0.4)",padding:"10px",fontFamily:"monospace",margin:"0",top:"16px",right:0,paddingLeft:"16px",listStyle:"none"},logItem:{display:"block"}})},1664:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ReplayMode=void 0;const s=r(172),n=r(711),a=r(1577),i=r(3833),o=r(7060),l=r(6388),c=r(7460),u=r(6656),h=r(5999),d=r(7661),f=r(1409),p=r(3750);class m extends s.Component{constructor(){super(...arguments),this.onPlayClick=()=>{this.props.game.player.play()},this.onPauseClick=()=>{this.props.game.player.pause()},this.onSpeedDown=()=>{this.props.game.player.speedDown()},this.onSpeedUp=()=>{this.props.game.player.speedUp()},this.onVolumeClick=()=>{this.props.game.soundSystem.toggleMute()},this.onPlayStateChange=()=>{this.forceUpdate()}}componentDidMount(){this.offPlay=this.props.game.player.events.on("play",this.onPlayStateChange),this.offPause=this.props.game.player.events.on("pause",this.onPlayStateChange),this.offStop=this.props.game.player.events.on("stop",this.onPlayStateChange)}componentWillUnmount(){this.offPlay&&this.offPlay(),this.offPause&&this.offPause(),this.offStop&&this.offStop()}render(){const e=this.props.game,t=e.player,r=t.isPlaying,m=t.isPaused;return(0,s.h)("div",{class:this.props.class},(0,s.h)(a.TimeLine,{game:e}),(0,s.h)("div",{class:p.ControlsStyle.buttons},(0,s.h)("div",{class:p.ControlsStyle.left},(0,s.h)(h.SpeedDownButton,{onClick:this.onSpeedDown}),m||!r?(0,s.h)(o.PlayButton,{onClick:this.onPlayClick}):(0,s.h)(l.PauseButton,{onClick:this.onPauseClick}),(0,s.h)(u.SpeedUpButton,{onClick:this.onSpeedUp}),(0,s.h)(c.VolumeButton,{onClick:this.onVolumeClick}),(0,s.h)(i.VolumeControl,{game:e}),(0,s.h)(n.Time,{player:t})),(0,s.h)("div",{class:p.ControlsStyle.right},(0,s.h)(d.SettingsButton,{game:e}),(0,s.h)(f.FullscreenButton,{active:!0,root:this.props.root}))))}}t.ReplayMode=m},3080:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RootStyle=void 0;const s=r(682);t.RootStyle=(0,s.stylesheet)({root:Object.assign({},{position:"relative",color:"white",width:"100%",height:"100%",cursor:"none",userSelect:"none"}),rootVisible:Object.assign(Object.assign({},{position:"relative",color:"white",width:"100%",height:"100%",cursor:"none",userSelect:"none"}),{cursor:"default"}),title:Object.assign({},{position:"absolute",top:"20px",left:"0",zIndex:20,padding:"10px 10px 10px 20px",backgroundColor:"rgba(0, 0, 0, 0.4)",fontSize:"13pt",fontFamily:"'Roboto', Arial, Helvetica, sans-serif",opacity:0,transition:"opacity 0.2s"}),titleVisible:Object.assign(Object.assign({},{position:"absolute",top:"20px",left:"0",zIndex:20,padding:"10px 10px 10px 20px",backgroundColor:"rgba(0, 0, 0, 0.4)",fontSize:"13pt",fontFamily:"'Roboto', Arial, Helvetica, sans-serif",opacity:0,transition:"opacity 0.2s"}),{opacity:1}),keysVisible:{pointerEvents:"none",position:"absolute",top:"70%",left:"50%",zIndex:20,color:"rgba(50, 130, 255, 1.0)",fontSize:"12pt",fontWeight:"bold",fontFamily:"'Roboto', Arial, Helvetica, sans-serif",opacity:1,transition:"opacity 0.2s",transform:"translate(-50%, -50%)",textAlign:"center"},modelVisible:{pointerEvents:"none",position:"absolute",left:"50%",bottom:0,width:"65%",zIndex:11,opacity:1,transform:"translate(-50%, 0%)"},controls:Object.assign({},{zIndex:30,position:"absolute",width:"100%",bottom:0,padding:"0 16px",boxSizing:"border-box",backgroundColor:"rgba(0, 0, 0, 0.4)",userSelect:"none",opacity:0,transition:"opacity 0.2s"}),controlsVisible:Object.assign(Object.assign({},{zIndex:30,position:"absolute",width:"100%",bottom:0,padding:"0 16px",boxSizing:"border-box",backgroundColor:"rgba(0, 0, 0, 0.4)",userSelect:"none",opacity:0,transition:"opacity 0.2s"}),{opacity:1}),screen:{position:"absolute",top:0,left:0,width:"100%",height:"100%",zIndex:10}})},6897:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Root=void 0;const s=r(172),n=r(7188),a=r(8511),i=r(1664),o=r(5359),l=r(7484),c=r(3080);class u extends s.Component{constructor(e){super(e),this.node=null,this.fadeOut=0,this.onPointerLockChange=()=>{document.pointerLockElement===this.props.root?this.props.game.pointerLocked=!0:this.props.game.pointerLocked=!1},this.onContextMenu=e=>{e.preventDefault()},this.onWindowClick=()=>{this.setState({isActive:!1})},this.onRootClick=e=>{e.stopPropagation(),this.setState({isActive:!0}),this.fadeReset()},this.onKeyDown=e=>{if(!this.state.isActive)return;const t=this.props.game;switch(e.which){case 70:o.Fullscreen.isInFullscreen()?o.Fullscreen.exit():o.Fullscreen.enter(this.props.root),this.fadeReset();break;case 77:t.soundSystem.toggleMute(),this.fadeReset();break;case 38:t.soundSystem.setVolume(t.soundSystem.getVolume()+.05),this.fadeReset();break;case 40:t.soundSystem.setVolume(t.soundSystem.getVolume()-.05),this.fadeReset();break;case 74:case 37:t.player.seek(t.player.currentTime-5),this.fadeReset();break;case 76:case 39:t.player.seek(t.player.currentTime+5),this.fadeReset();break;case 75:case 32:if(this.props.game.mode!==l.PlayerMode.REPLAY)return;!t.player.isPlaying||t.player.isPaused?t.player.play():t.player.pause()}},this.onModeChange=()=>{this.forceUpdate()},this.onLoadStart=()=>{this.setState({isLoading:!0})},this.onLoadEnd=()=>{this.setState({isLoading:!1})},this.onTitleChange=e=>{this.setState({title:e})},this.onSpeedChange=e=>{this.setState({speed:e})},this.onFpsChange=e=>{this.setState({fps:e})},this.onButtonsChange=e=>{this.setState({buttons:e})},this.onStrafesChange=e=>{this.setState({strafes:e})},this.onGravityChange=e=>{this.setState({gravity:e})},this.onMouseEnter=()=>{this.setState({isMouseOver:!0}),this.fadeReset()},this.onMouseMove=()=>{this.state.isMouseOver&&!o.Fullscreen.isInFullscreen()&&this.fadeReset()},this.onMouseLeave=()=>{this.setState({isMouseOver:!1,isVisible:!1}),clearTimeout(this.fadeOut),this.fadeOut=0},this.fadeReset=()=>{this.state.isVisible||this.setState({isVisible:!0}),clearTimeout(this.fadeOut),this.fadeOut=setTimeout((()=>{this.setState({isVisible:!1}),this.fadeOut=0}),5e3)},this.onScreenClick=()=>{switch(this.props.game.mode){case l.PlayerMode.REPLAY:{const e=this.props.game.player;!e.isPlaying||e.isPaused?e.play():e.pause();break}case l.PlayerMode.FREE:this.props.root.requestPointerLock()}},this.onScreenDblClick=()=>{o.Fullscreen.isInFullscreen()?o.Fullscreen.exit():o.Fullscreen.enter(this.props.root)},this.state={title:e.game.title,speed:e.game.speed,fps:e.game.fps,buttons:e.game.buttons,strafes:e.game.strafes,gravity:"",isActive:!1,isLoading:!1,isMouseOver:!1,isVisible:!1}}componentDidMount(){if(!this.node)return;const e=this.props.game,t=this.props.root;this.node.appendChild(e.getCanvas()),this.offLoadStart=e.events.on("loadstart",this.onLoadStart),this.offLoad=e.events.on("load",this.onLoadEnd),this.offModeChange=e.events.on("modechange",this.onModeChange),this.offTitleChange=e.events.on("titlechange",this.onTitleChange),this.offSpeedChange=e.events.on("speedchange",this.onSpeedChange),this.offFpsChange=e.events.on("fpschange",this.onFpsChange),this.offButtonsChange=e.events.on("buttonschange",this.onButtonsChange),this.offStrafesChange=e.events.on("strafeschange",this.onStrafesChange),this.offGravityChange=e.events.on("gravitychange",this.onGravityChange),t.addEventListener("click",this.onRootClick),window.addEventListener("click",this.onWindowClick),window.addEventListener("keydown",this.onKeyDown),document.addEventListener("pointerlockchange",this.onPointerLockChange,!1),t.addEventListener("mouseover",this.onMouseEnter),t.addEventListener("mousemove",this.onMouseMove),t.addEventListener("mouseout",this.onMouseLeave),t.addEventListener("contextmenu",this.onContextMenu)}componentWillUnmount(){const e=this.props.root;this.offLoadStart&&this.offLoadStart(),this.offLoad&&this.offLoad(),this.offModeChange&&this.onModeChange(),this.offTitleChange&&this.offTitleChange(),this.offSpeedChange&&this.offSpeedChange(),this.offFpsChange&&this.offFpsChange(),this.offButtonsChange&&this.offButtonsChange(),this.offStrafesChange&&this.offStrafesChange(),this.offGravityChange&&this.offGravityChange(),e.removeEventListener("click",this.onRootClick),window.removeEventListener("click",this.onWindowClick),window.removeEventListener("keydown",this.onKeyDown),document.removeEventListener("pointerlockchange",this.onPointerLockChange,!1),e.removeEventListener("mouseover",this.onMouseEnter),e.removeEventListener("mousemove",this.onMouseMove),e.removeEventListener("mouseout",this.onMouseLeave),e.removeEventListener("contextmenu",this.onContextMenu)}render(){const{game:e}=this.props,{isVisible:t,title:r,speed:o,fps:u,buttons:h,strafes:d,gravity:f,isLoading:p,isMouseOver:m}=this.state,g=e.isSpeedVisible&&o,y=e.isFpsVisible&&u,v=e.isButtonsVisible&&h,b=e.isStrafesVisible&&h,_=`./img/${f}.png`;return(0,s.h)("div",{class:t?c.RootStyle.rootVisible:c.RootStyle.root},(0,s.h)("div",{class:t?c.RootStyle.titleVisible:c.RootStyle.title},r),(0,s.h)(n.Loading,{game:e,visible:p}),(0,s.h)("div",{class:c.RootStyle.screen,ref:e=>this.node=e,onClick:this.onScreenClick,onDblClick:this.onScreenDblClick},f?(0,s.h)("img",{class:c.RootStyle.modelVisible,src:_}):"",(0,s.h)("pre",{class:c.RootStyle.keysVisible},b?`${d}\n\n`:"",v?`${h}`:"",g?`\n${o} ups`:"",y?`\n${u} fps`:"")),e.mode===l.PlayerMode.FREE?(0,s.h)(a.FreeMode,{class:t?c.RootStyle.controlsVisible:c.RootStyle.controls,game:e,root:this.props.root}):(0,s.h)(i.ReplayMode,{class:t?c.RootStyle.controlsVisible:c.RootStyle.controls,game:e,root:this.props.root,visible:m}))}}t.Root=u},1577:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TimeLine=void 0;const s=r(172),n=r(4170);class a extends s.Component{constructor(e){super(e),this.onPostUpdate=()=>{const e=this.props.game.player;this.setState({progress:e.currentFrame/e.replay.data.frames.length})},this.onClick=e=>{const t=e.currentTarget.getClientRects()[0],r=1-(t.right-e.pageX)/(t.right-t.left);this.props.game.player.seekByPercent(100*r),this.props.game.player.pause()},this.onMouseEnter=()=>{this.setState({ghostKnobActive:!0})},this.onMouseMove=e=>{if(!this.state.ghostKnobActive)return;const t=e.currentTarget.getClientRects()[0],r=100*(1-(t.right-e.pageX)/(t.right-t.left))+"%";this.setState({ghostKnobPos:r})},this.onMouseLeave=()=>{this.setState({ghostKnobActive:!1})},this.state={progress:0,ghostKnobActive:!1,ghostKnobPos:"0%",onPostUpdate:null}}componentDidMount(){this.offPostUpdate=this.props.game.events.on("postupdate",this.onPostUpdate)}componentWillUnmount(){this.offPostUpdate&&this.offPostUpdate()}render(){const e=100*this.state.progress,t=e+"%",r=100-e+"%";return(0,s.h)("div",{class:n.TimeLine.timeline,onClick:this.onClick,onMouseEnter:this.onMouseEnter,onMouseMove:this.onMouseMove,onMouseLeave:this.onMouseLeave},(0,s.h)("div",{class:n.TimeLine.ghostLine}),(0,s.h)("div",{class:n.TimeLine.line,style:{right:r}}),(0,s.h)("div",{class:n.TimeLine.knob,style:{left:t}}),(0,s.h)("div",{class:n.TimeLine.ghostKnob,style:{left:this.state.ghostKnobPos}}))}}t.TimeLine=a},4170:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TimeLine=void 0;const s=r(682);t.TimeLine=(0,s.stylesheet)({timeline:{display:"flex",alignItems:"center",position:"relative",height:"26px",cursor:"pointer"},line:{height:"4px",backgroundColor:"#fff",position:"absolute",left:"0",right:"0",borderRadius:"2px"},ghostLine:{height:"4px",backgroundColor:"rgba(255, 255, 255, 0.5)",position:"absolute",left:"0",right:"0",borderRadius:"2px"},knob:{position:"absolute",width:"12px",height:"12px",backgroundColor:"#fff",borderRadius:"6px",left:"100%",marginLeft:"-6px"},ghostKnob:{position:"absolute",width:"8px",height:"8px",backgroundColor:"#fff",boxSizing:"border-box",borderRadius:"8px",left:"0",marginLeft:"-4px",display:"none",$nest:{"&:hover":{display:"block"}}}})},711:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Time=void 0;const s=r(172),n=r(4343),a=r(8388);class i extends s.Component{constructor(){super(...arguments),this.onPlay=()=>{this.setState({isPlaying:!0},this.update)},this.onPauseOrStop=()=>{this.setState({isPlaying:!1})},this.update=()=>{this.state.isPlaying&&(this.forceUpdate(),setTimeout(this.update,100))}}componentDidMount(){this.offPlay=this.props.player.events.on("play",this.onPlay),this.offPause=this.props.player.events.on("pause",this.onPauseOrStop),this.offStop=this.props.player.events.on("stop",this.onPauseOrStop)}componentWillUnmount(){this.offPlay&&this.offPlay(),this.offPause&&this.offPause(),this.offStop&&this.offStop()}render(){const e=(0,n.formatTime)(this.props.player.currentTime),t=(0,n.formatTime)(this.props.player.replay.data.time/1e3);return(0,s.h)("div",{class:a.Time.time},e," / ",t)}}t.Time=i},8388:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Time=void 0;const s=r(682);t.Time=(0,s.stylesheet)({time:{fontFamily:"'Roboto', Arial, Helvetica, sans-serif",fontSize:"10pt"}})},3833:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.VolumeControl=void 0;const s=r(172),n=r(7082);class a extends s.Component{constructor(e){super(e),this.onVolumeChange=()=>{this.setState({volume:this.props.game.soundSystem.getVolume()})},this.onClick=e=>{const t=e.currentTarget.getClientRects()[0],r=1-(t.right-e.pageX)/(t.right-t.left);this.props.game.soundSystem.setVolume(r)},this.onMouseEnter=()=>{this.setState({ghostKnobActive:!0})},this.onMouseMove=e=>{if(!this.state.ghostKnobActive)return;const t=e.currentTarget.getClientRects()[0],r=1-(t.right-e.pageX)/(t.right-t.left),s=Math.min(95,Math.max(5,100*r))+"%";this.setState({ghostKnobPos:s})},this.onMouseLeave=()=>{this.setState({ghostKnobActive:!1})},this.state={volume:e.game.soundSystem.getVolume(),ghostKnobActive:!1,ghostKnobPos:"5%"}}componentDidMount(){this.offVolumeChange=this.props.game.soundSystem.events.on("volumeChange",this.onVolumeChange)}componentWillUnmount(){this.offVolumeChange&&this.offVolumeChange()}render(){const e=100*this.state.volume,t=Math.min(95,Math.max(5,e))+"%",r=Math.min(95,Math.max(5,100-e))+"%";return(0,s.h)("div",{class:n.VolumeControl.control,onClick:this.onClick,onMouseEnter:this.onMouseEnter,onMouseMove:this.onMouseMove,onMouseLeave:this.onMouseLeave},(0,s.h)("div",{class:n.VolumeControl.ghostLine}),(0,s.h)("div",{class:n.VolumeControl.line,style:{right:r}}),(0,s.h)("div",{class:n.VolumeControl.knob,style:{left:t}}),(0,s.h)("div",{class:n.VolumeControl.ghostKnob,style:{left:this.state.ghostKnobPos}}))}}t.VolumeControl=a},7082:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.VolumeControl=void 0;const s=r(682);t.VolumeControl=(0,s.stylesheet)({control:{display:"flex",alignItems:"center",position:"relative",width:"80px",height:"26px",marginLeft:"6px",marginRight:"14px",cursor:"pointer"},line:{height:"4px",backgroundColor:"#fff",position:"absolute",left:"0",right:"0",borderRadius:"2px"},ghostLine:{height:"4px",backgroundColor:"rgba(255, 255, 255, 0.5)",position:"absolute",left:"0",right:"0",borderRadius:"2px"},knob:{position:"absolute",width:"12px",height:"12px",backgroundColor:"#fff",borderRadius:"6px",left:"100%",marginLeft:"-6px"},ghostKnob:{position:"absolute",width:"8px",height:"8px",backgroundColor:"#fff",boxSizing:"border-box",borderRadius:"8px",left:"0",marginLeft:"-4px",display:"none",$nest:{"&:hover":{display:"block"}}}})},9849:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PlayerInterface=void 0;const s=r(172),n=r(6897);t.PlayerInterface=class{constructor(e,t){this.game=e,this.rootNode=t}getRootNode(){return this.rootNode}draw(){(0,s.render)((0,s.h)(n.Root,{game:this.game,root:this.rootNode}),this.rootNode)}}},8529:(e,t)=>{"use strict";var r;Object.defineProperty(t,"__esModule",{value:!0}),t.Reader=t.ReaderDataType=void 0,function(e){e[e.UByte=0]="UByte",e[e.Byte=1]="Byte",e[e.UShort=2]="UShort",e[e.Short=3]="Short",e[e.UInt=4]="UInt",e[e.Int=5]="Int",e[e.Float=6]="Float",e[e.Double=7]="Double",e[e.NString=8]="NString",e[e.String=9]="String"}(r||(t.ReaderDataType=r={}));t.Reader=class{constructor(e){this.data=new DataView(e),this.offset=0}length(){return this.data.byteLength}tell(){return this.offset}seek(e){this.offset=Math.max(0,e)}skip(e){this.seek(this.tell()+e)}b(){const e=this.data.getInt8(this.offset);return this.skip(1),e}ub(){const e=this.data.getUint8(this.offset);return this.skip(1),e}s(e=!0){const t=this.data.getInt16(this.offset,e);return this.skip(2),t}us(e=!0){const t=this.data.getUint16(this.offset,e);return this.skip(2),t}i(e=!0){const t=this.data.getInt32(this.tell(),e);return this.skip(4),t}ui(e=!0){const t=this.data.getUint32(this.tell(),e);return this.skip(4),t}f(e=!0){const t=this.data.getFloat32(this.tell(),e);return this.skip(4),t}lf(e=!0){const t=this.data.getFloat64(this.tell(),e);return this.skip(8),t}str(){let e=this.ub(),t="";for(;0!==e;)t+=String.fromCharCode(e),e=this.ub();return t}nstr(e){if(e<0)return"";let t="";for(;e>0;){e-=1;const r=this.ub();if(0===r)break;t+=String.fromCharCode(r)}return 0!==e&&this.skip(e),t}arr(e,t){t.bind(this);const r=[];for(;e-- >0;)r.push(t());return r}arrx(e,t,s=0){let n;switch(t){case r.UByte:n=new Uint8Array(this.data.buffer,this.tell(),e),this.skip(e);break;case r.Byte:n=new Int8Array(this.data.buffer,this.tell(),e),this.skip(e);break;case r.UShort:n=new Uint16Array(this.data.buffer,this.tell(),e),this.skip(2*e);break;case r.Short:n=new Int16Array(this.data.buffer,this.tell(),e),this.skip(2*e);break;case r.UInt:n=new Uint32Array(this.data.buffer,this.tell(),e),this.skip(4*e);break;case r.Int:n=new Int32Array(this.data.buffer,this.tell(),e),this.skip(4*e);break;case r.Float:n=new Float32Array(this.data.buffer,this.tell(),e),this.skip(4*e);break;case r.Double:n=new Float64Array(this.data.buffer,this.tell(),e),this.skip(8*e);break;case r.NString:for(n=[];e-- >0;)n.push(n.nstr(s));break;case r.String:for(n=[];e-- >0;)n.push(n.str())}return n}}},8372:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ReplayPlayer=void 0;const s=r(1961),n=r(9431),a=r(7022),i=r(6876),o=(e,t)=>{e.camera.position[0]=t.cameraPos[0],e.camera.position[1]=t.cameraPos[1],e.camera.position[2]=t.cameraPos[2],e.camera.rotation[0]=s.glMatrix.toRadian(t.cameraRot[0]),e.camera.rotation[1]=s.glMatrix.toRadian(t.cameraRot[1]),e.camera.rotation[2]=s.glMatrix.toRadian(t.cameraRot[2])};t.ReplayPlayer=class{constructor(e){this.oldButtons=0,this.oldGravity=0,this.prevFrame=0,this.nextFrame=0,this.timeOffset=0,this.frameTime=0,this.currentFrame=0,this.currentTime=0,this.isPlaying=!1,this.isPaused=!1,this.speed=1,this.reset(),this.game=e,this.state=new a.ReplayState,this.replay=null,this.events=(0,n.createNanoEvents)()}reset(){if(this.nextFrame=0,this.prevFrame=0,this.frameTime=0,this.currentFrame=0,this.timeOffset=0,this.currentTime=0,this.isPlaying=!1,this.isPaused=!1,this.speed=1,this.replay){this.game.setTitle(this.replay.data.header.identifier+" "+this.replay.data.header.timestamp+" "+this.replay.data.header.additionalInfo);let e=this.replay.data.frames[0],t=new a.ReplayState;t.cameraPos=e.origin,t.cameraRot=e.rotation,this.state=t,this.frameTime=this.replay.data.time/this.replay.data.frames.length/1e3}}changeReplay(e){this.replay=e,this.reset()}play(){this.isPlaying?this.isPaused&&(this.isPaused=!1):this.isPlaying=!0,this.events.emit("play")}pause(){this.isPlaying&&(this.isPaused=!0),this.events.emit("pause")}stop(){this.reset(),this.events.emit("stop")}speedUp(){this.speed=Math.min(2*this.speed,1)}speedDown(){this.speed=Math.max(this.speed/2,.12)}seek(e){this.currentFrame>=this.replay.data.frames.length-1&&this.reset(),e*=this.speed,this.currentTime+=e;const t=this.frameTime;if(this.timeOffset+=e,this.timeOffset>=t){this.timeOffset-=t,this.prevFrame=this.currentFrame,this.nextFrame=this.currentFrame+1;const e=this.replay.data.frames[this.currentFrame],{velocity:r,fps:s,buttons:n,strafes:a,sync:i,gravity:o}=e,l=r.toString();if(this.game.setSpeed(l),this.game.setFps(s),o!==this.oldGravity&&this.game.setGravity(o),n!==this.oldButtons){const e=this.formatKeys(n);this.game.setButtons(e)}a&&this.game.setStrafes(`Strafes: ${a}\nSync: ${i}`),this.currentFrame++}if(this.currentFrame>0){const e=this.timeOffset/t,r=this.replay.data.frames[this.prevFrame],s=this.replay.data.frames[this.nextFrame],n=new i.Vector3(r.origin).lerp(new i.Vector3(s.origin),e),a=[0,0,0];a[0]=this.slerp(r.rotation[0],s.rotation[0],e),a[1]=this.slerp(r.rotation[1],s.rotation[1],e),a[2]=this.slerp(r.rotation[2],s.rotation[2],e),this.state.cameraPos=n.vec,this.state.cameraRot=a,o(this.game,this.state)}}formatKeys(e){return`${8&e?"W":"    "}    ${2&e?"JUMP":"         "}\n${512&e?"A":"    "}${16&e?"S":"    "}${1024&e?"D":"    "}    ${4&e?"DUCK":"         "}\n`}slerp(e,t,r){e%=360,t%=360;const s=this.getDist(e,t);return Math.abs(e-t)>180?e<t?(e+180-s*r+360)%360-180:(e+180+s*r+360)%360-180:e<t?(e+180+s*r+360)%360-180:(e+180-s*r+360)%360-180}getDist(e,t){const r=Math.abs(e-t);return 180-Math.abs(r-180)}seekByPercent(e){e=Math.max(0,Math.min(e,100))/100,this.currentTime=this.replay.data.time*e/1e3,this.currentFrame=Math.round(this.replay.data.frames.length*e),this.prevFrame=this.currentFrame,this.nextFrame=this.currentFrame,this.state.cameraPos=this.replay.data.frames[this.currentFrame].origin,this.state.cameraRot=this.replay.data.frames[this.currentFrame].rotation,o(this.game,this.state)}update(e){if(!this.isPlaying||this.isPaused)return;this.seek(e)}}},4080:(e,t)=>{"use strict";var r;Object.defineProperty(t,"__esModule",{value:!0}),t.DeltaType=void 0,function(e){e[e.DT_BYTE=1]="DT_BYTE",e[e.DT_SHORT=2]="DT_SHORT",e[e.DT_FLOAT=4]="DT_FLOAT",e[e.DT_INTEGER=8]="DT_INTEGER",e[e.DT_ANGLE=16]="DT_ANGLE",e[e.DT_TIMEWINDOW_8=32]="DT_TIMEWINDOW_8",e[e.DT_TIMEWINDOW_BIG=64]="DT_TIMEWINDOW_BIG",e[e.DT_STRING=128]="DT_STRING",e[e.DT_SIGNED=-2147483648]="DT_SIGNED"}(r||(t.DeltaType=r={}))},3712:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.FrameDataReader=void 0;const s=r(6231),n=r(1752),a=r(8748),i=r(8529);class o{static bad(){throw new Error("Invalid message type")}static nop(){return null}static disconnect(e){return{reason:e.str()}}static event(e,t){let r=new a.BitStream(e.data.buffer);r.index=8*e.tell();let s=[],i=r.readBits(5);for(let e=0;e<i;++e){let e={index:r.readBits(10)};if(r.readBits(1)){e.packetIndex=r.readBits(11),r.readBits(1)&&(e.delta=(0,n.readDelta)(r,t.event_t))}r.readBits(1)&&(e.fireTime=r.readBits(16)),s.push(e)}return r.index%8>0?e.seek(Math.floor(r.index/8)+1):e.seek(r.index/8),{events:s}}static version(e){return{version:e.ui()}}static setView(e){return{entityIndex:e.s()}}static sound(e){let t=new a.BitStream(e.data.buffer);t.index=8*e.tell();let r=t.readBits(9),n=1;0!=(1&r)&&(n=t.readBits(8)/255);let i=1;0!=(2&r)&&(i=t.readBits(8)/64);let o,l=t.readBits(3),c=t.readBits(11);o=0!=(4&r)?t.readBits(16):t.readBits(8);let u,h,d,f=t.readBits(1),p=t.readBits(1),m=t.readBits(1);f&&(u=(0,s.readCoord)(t)),p&&(h=(0,s.readCoord)(t)),m&&(d=(0,s.readCoord)(t));let g=1;return 0!=(8&r)&&(g=t.readBits(8)),t.index%8>0?e.seek(Math.floor(t.index/8)+1):e.seek(t.index/8),{flags:r,volume:n,attenuation:i,channel:l,entityIndex:c,soundIndex:o,xPosition:u,yPosition:h,zPosition:d,pitch:g}}static time(e){return{time:e.f()}}static print(e){return{message:e.str()}}static stuffText(e){return{commands:e.str().split(";").map((e=>{let t=e.split(/\s*("[^"]+"|[^\s"]+)/).map((e=>e.replace(/^"(.*)"$/,"$1").trim())).filter((e=>e));return{func:t[0],params:t.slice(1)}}))}}static setAngle(e){return{pitch:e.s(),yaw:e.s(),roll:e.s()}}static serverInfo(e){let t={protocol:e.i(),spawnCount:e.i(),mapCrc:e.i(),clientDllHash:e.arrx(16,i.ReaderDataType.UByte),maxPlayers:e.ub(),playerIndex:e.ub(),isDeathmatch:e.ub(),gameDir:e.str(),hostName:e.str(),mapFileName:e.str(),mapCycle:e.str()};return e.skip(1),t}static lightStyle(e){return{index:e.ub(),lightInfo:e.str()}}static updateUserInfo(e){return{clientIndex:e.ub(),clientUserId:e.ui(),clientUserInfo:e.str(),clientCdKeyHash:e.arrx(16,i.ReaderDataType.UByte)}}static deltaDescription(e,t){let r={name:e.str(),fields:[]},s=new a.BitStream(e.data.buffer),i=e.us();s.index=8*e.tell();for(let e=0;e<i;++e)r.fields.push((0,n.readDelta)(s,t.delta_description_t));return t[r.name]=r.fields,s.index%8>0?e.seek(Math.floor(s.index/8)+1):e.seek(s.index/8),r}static clientData(e,t){let r=new a.BitStream(e.data.buffer);r.index=8*e.tell(),r.readBits(1)&&(r.index+=8);let s=t.clientdata_t,i=(0,n.readDelta)(r,s),o=t.weapon_data_t;for(;r.readBits(1);)r.index+=6,(0,n.readDelta)(r,o);return r.index%8>0?e.seek(Math.floor(r.index/8)+1):e.seek(r.index/8),{clientData:i}}static stopSound(e){return{entityIndex:e.s()}}static pings(e){let t=new a.BitStream(e.data.buffer);t.index=8*e.tell();let r=[];for(;t.readBits(1);)r.push({slot:t.readBits(8),ping:t.readBits(8),loss:t.readBits(8)});return t.index%8>0?e.seek(Math.floor(t.index/8)+1):e.seek(t.index/8),r}static particle(e){return{position:[e.s()/8,e.s()/8,e.s()/8],direction:[e.b(),e.b(),e.b()],count:e.ub(),color:e.ub()}}static damage(){return null}static spawnStatic(e){let t={modelIndex:e.s(),sequence:e.b(),frame:e.b(),colorMap:e.s(),skin:e.b(),position:[],rotation:[]};return t.position[0]=e.s()/8,t.rotation[0]=1.40625*e.b(),t.position[1]=e.s()/8,t.rotation[1]=1.40625*e.b(),t.position[2]=e.s()/8,t.rotation[2]=1.40625*e.b(),t.renderMode=e.b(),t.renderMode&&(t.renderAmt=e.b(),t.renderColor=[e.ub(),e.ub(),e.ub()],t.renderFx=e.b()),t}static eventReliable(e,t){let r=new a.BitStream(e.data.buffer);r.index=8*e.tell();let s,i=r.readBits(10),o=(0,n.readDelta)(r,t.event_t),l=r.readBits(1);return l&&(s=r.readBits(16)),r.index%8>0?e.seek(Math.floor(r.index/8)+1):e.seek(r.index/8),{eventIndex:i,eventData:o,delayBit:l,delay:s}}static spawnBaseLine(e,t){let r=new a.BitStream(e.data.buffer);r.index=8*e.tell();let s=[];for(;;){let e,a=r.readBits(11);if(2047===a)break;e=1&r.readBits(2)?a>0&&a<=32?"entity_state_player_t":"entity_state_t":"custom_entity_state_t",s[a]=(0,n.readDelta)(r,t[e])}if(31!==r.readBits(5))throw new Error("Bad spawnbaseline");let i=r.readBits(6),o=[];for(let e=0;e<i;++e)o.push((0,n.readDelta)(r,t.entity_state_t));return r.index%8>0?e.seek(Math.floor(r.index/8)+1):e.seek(r.index/8),{entities:s,extraData:o}}static tempEntity(e){let t={};switch(e.ub()){case 0:case 19:case 20:case 21:case 108:e.skip(24);break;case 1:e.skip(20);break;case 2:case 4:case 9:case 10:case 11:e.skip(6);break;case 3:case 23:e.skip(11);break;case 5:case 17:case 22:case 100:case 112:case 122:e.skip(10);break;case 6:case 27:case 102:case 115:e.skip(12);break;case 7:case 30:case 31:case 106:case 110:e.skip(17);break;case 8:case 18:case 24:case 28:case 119:e.skip(16);break;case 12:e.skip(8);break;case 13:e.skip(8),e.s()&&e.skip(2);break;case 14:case 104:case 109:case 118:case 123:e.skip(9);break;case 15:case 25:case 113:case 114:e.skip(19);break;case 29:t.channel=e.b(),t.x=e.s(),t.y=e.s(),t.effect=e.b(),t.textColor=[e.ub(),e.ub(),e.ub(),e.ub()],t.effectColor=[e.ub(),e.ub(),e.ub(),e.ub()],t.fadeInTime=e.s(),t.fadeOutTime=e.s(),t.holdTime=e.s(),t.effect&&(t.effectTime=e.s()),t.message=e.str();break;case 99:e.skip(2);break;case 101:case 103:e.skip(14);break;case 105:case 121:e.skip(5);break;case 107:e.skip(13);break;case 111:case 116:case 117:case 124:e.skip(7);break;case 120:case 126:e.skip(18);break;case 125:e.skip(1);break;case 127:e.skip(15);break;default:throw new Error("Unknown temp entity type")}return t}static setPause(e){return{isPaused:e.b()}}static signOnNum(e){return{sign:e.b()}}static centerPrint(e){return{message:e.str()}}static killedMonster(){return null}static foundSecret(){return null}static spawnStaticSound(e){return{position:[e.s()/8,e.s()/8,e.s()/8],soundIndex:e.us(),volume:e.ub()/255,attenuation:e.ub()/64,entityIndex:e.us(),pitch:e.ub(),flags:e.ub()}}static intermission(){return null}static finale(e){return{text:e.str()}}static cdTrack(e){return{track:e.b(),loopTrack:e.b()}}static restore(e){let t=e.str(),r=e.ub(),s=[];for(let t=0;t<r;++t)s.push(e.str());return{saveName:t,maps:s}}static cutscene(e){return{text:e.str()}}static weaponAnim(e){return{sequenceNumber:e.b(),weaponModelBodyGroup:e.b()}}static decalName(e){return{positionIndex:e.ub(),decalName:e.str()}}static roomType(e){return{type:e.us()}}static addAngle(e){return{angleToAdd:e.s()/(360/65536)}}static newUserMsg(e){return{index:e.ub(),size:e.b(),name:e.nstr(16)}}static packetEntities(e,t){let r=new a.BitStream(e.data.buffer);r.index=8*e.tell();let s=[];r.readBits(16);let i=0;for(;;){if(0===r.readBits(16))break;if(r.index-=16,r.readBits(1))i++;else{r.readBits(1)?i=r.readBits(11):i+=r.readBits(6)}let e=r.readBits(1);r.readBits(1)&&(r.index+=6);let a="entity_state_t";i>0&&i<=32?a="entity_state_player_t":e&&(a="custom_entity_state_t"),s.push((0,n.readDelta)(r,t[a]))}return r.index%8>0?e.seek(Math.floor(r.index/8)+1):e.seek(r.index/8),{entityStates:s}}static deltaPacketEntities(e,t){let r=new a.BitStream(e.data.buffer);r.index=8*e.tell(),r.readBits(16),r.index+=8;let s=[],i=0;for(;;){if(0===r.readBits(16))break;r.index-=16;let e=r.readBits(1);if(r.readBits(1)?i=r.readBits(11):i+=r.readBits(6),e)continue;let a=r.readBits(1),o="entity_state_t";i>0&&i<32?o="entity_state_player_t":a&&(o="custom_entity_state_t"),s[i]=(0,n.readDelta)(r,t[o])}return r.index%8>0?e.seek(Math.floor(r.index/8)+1):e.seek(r.index/8),{entityStates:s}}static choke(){return null}static resourceList(e){let t=new a.BitStream(e.data.buffer);t.index=8*e.tell();let r=[],s=t.readBits(12);for(let e=0;e<s;++e){let e={};e.type=t.readBits(4),e.name=t.readString(),e.index=t.readBits(12),e.size=t.readBits(24),4&t.readBits(3)&&(t.index+=128),t.readBits(1)&&(t.index+=256),r.push(e)}if(t.readBits(1))for(;t.readBits(1);){let e=t.readBits(1)?5:10;t.index+=e}return t.index%8>0?e.seek(Math.floor(t.index/8)+1):e.seek(t.index/8),r}static newMoveVars(e){return{gravity:e.f(),stopSpeed:e.f(),maxSpeed:e.f(),spectatorMaxSpeed:e.f(),acceleration:e.f(),airAcceleration:e.f(),waterAcceleration:e.f(),friction:e.f(),edgeFriction:e.f(),waterFriction:e.f(),entityGravity:e.f(),bounce:e.f(),stepSize:e.f(),maxVelocity:e.f(),zMax:e.f(),waveHeight:e.f(),footsteps:e.b(),rollAngle:e.f(),rollSpeed:e.f(),skyColor:[e.f(),e.f(),e.f()],skyVec:[e.f(),e.f(),e.f()],skyName:e.str()}}static resourceRequest(e){let t={spawnCount:e.i()};return e.skip(4),t}static customization(e){let t,r=e.ub(),s=e.ub(),n=e.str(),a=e.us(),i=e.ui(),o=e.ub();return 4&o&&(t=[e.i(),e.i(),e.i(),e.i()]),{playerIndex:r,type:s,name:n,index:a,downloadSize:i,flags:o,md5hash:t}}static crosshairAngle(e){return{pitch:e.b(),yaw:e.b()}}static soundFade(e){return{initialPercent:e.ub(),holdTime:e.ub(),fadeOutTime:e.ub(),fadeInTime:e.ub()}}static fileTxferFailed(e){return{filename:e.str()}}static hltv(e){return{mode:e.ub()}}static director(e){let t=e.ub();return{flag:e.ub(),message:e.nstr(t-1)}}static voiceInit(e){return{codecName:e.str(),quality:e.b()}}static voiceData(e){let t=e.ub(),r=e.us();return{playerIndex:t,data:e.arrx(r,i.ReaderDataType.UByte)}}static sendExtraInfo(e){return{fallbackDir:e.str(),canCheat:e.ub()}}static timeScale(e){return{timeScale:e.f()}}static resourceLocation(e){return{url:e.str()}}static sendCvarValue(e){return{name:e.str()}}static sendCvarValue2(e){return{requestId:e.ui(),name:e.str()}}static read(e,t,r){if(0===t)return null;const s=o.handlers[t];return s?s(e,r):null}}t.FrameDataReader=o,o.handlers=[o.bad,o.nop,o.disconnect,o.event,o.version,o.setView,o.sound,o.time,o.print,o.stuffText,o.setAngle,o.serverInfo,o.lightStyle,o.updateUserInfo,o.deltaDescription,o.clientData,o.stopSound,o.pings,o.particle,o.damage,o.spawnStatic,o.eventReliable,o.spawnBaseLine,o.tempEntity,o.setPause,o.signOnNum,o.centerPrint,o.killedMonster,o.foundSecret,o.spawnStaticSound,o.intermission,o.finale,o.cdTrack,o.restore,o.cutscene,o.weaponAnim,o.decalName,o.roomType,o.addAngle,o.newUserMsg,o.packetEntities,o.deltaPacketEntities,o.choke,o.resourceList,o.newMoveVars,o.resourceRequest,o.customization,o.crosshairAngle,o.soundFade,o.fileTxferFailed,o.hltv,o.director,o.voiceInit,o.voiceData,o.sendExtraInfo,o.timeScale,o.resourceLocation,o.sendCvarValue,o.sendCvarValue2],function(e){let t;!function(e){e[e.BAD=0]="BAD",e[e.NOP=1]="NOP",e[e.DISCONNECT=2]="DISCONNECT",e[e.EVENT=3]="EVENT",e[e.VERSION=4]="VERSION",e[e.SETVIEW=5]="SETVIEW",e[e.SOUND=6]="SOUND",e[e.TIME=7]="TIME",e[e.PRINT=8]="PRINT",e[e.STUFFTEXT=9]="STUFFTEXT",e[e.SETANGLE=10]="SETANGLE",e[e.SERVERINFO=11]="SERVERINFO",e[e.LIGHTSTYLE=12]="LIGHTSTYLE",e[e.UPDATEUSERINFO=13]="UPDATEUSERINFO",e[e.DELTADESCRIPTION=14]="DELTADESCRIPTION",e[e.CLIENTDATA=15]="CLIENTDATA",e[e.STOPSOUND=16]="STOPSOUND",e[e.PINGS=17]="PINGS",e[e.PARTICLE=18]="PARTICLE",e[e.DAMAGE=19]="DAMAGE",e[e.SPAWNSTATIC=20]="SPAWNSTATIC",e[e.EVENT_RELIABLE=21]="EVENT_RELIABLE",e[e.SPAWNBASELINE=22]="SPAWNBASELINE",e[e.TEMPENTITY=23]="TEMPENTITY",e[e.SETPAUSE=24]="SETPAUSE",e[e.SIGNONNUM=25]="SIGNONNUM",e[e.CENTERPRINT=26]="CENTERPRINT",e[e.KILLEDMONSTER=27]="KILLEDMONSTER",e[e.FOUNDSECRET=28]="FOUNDSECRET",e[e.SPAWNSTATICSOUND=29]="SPAWNSTATICSOUND",e[e.INTERMISSION=30]="INTERMISSION",e[e.FINALE=31]="FINALE",e[e.CDTRACK=32]="CDTRACK",e[e.RESTORE=33]="RESTORE",e[e.CUTSCENE=34]="CUTSCENE",e[e.WEAPONANIM=35]="WEAPONANIM",e[e.DECALNAME=36]="DECALNAME",e[e.ROOMTYPE=37]="ROOMTYPE",e[e.ADDANGLE=38]="ADDANGLE",e[e.NEWUSERMSG=39]="NEWUSERMSG",e[e.PACKETENTITIES=40]="PACKETENTITIES",e[e.DELTAPACKETENTITIES=41]="DELTAPACKETENTITIES",e[e.CHOKE=42]="CHOKE",e[e.RESOURCELIST=43]="RESOURCELIST",e[e.NEWMOVEVARS=44]="NEWMOVEVARS",e[e.RESOURCEREQUEST=45]="RESOURCEREQUEST",e[e.CUSTOMIZATION=46]="CUSTOMIZATION",e[e.CROSSHAIRANGLE=47]="CROSSHAIRANGLE",e[e.SOUNDFADE=48]="SOUNDFADE",e[e.FILETXFERFAILED=49]="FILETXFERFAILED",e[e.HLTV=50]="HLTV",e[e.DIRECTOR=51]="DIRECTOR",e[e.VOICEINIT=52]="VOICEINIT",e[e.VOICEDATA=53]="VOICEDATA",e[e.SENDEXTRAINFO=54]="SENDEXTRAINFO",e[e.TIMESCALE=55]="TIMESCALE",e[e.RESOURCELOCATION=56]="RESOURCELOCATION",e[e.SENDCVARVALUE=57]="SENDCVARVALUE",e[e.SENDCVARVALUE2=58]="SENDCVARVALUE2"}(t=e.SVC||(e.SVC={}))}(o||(t.FrameDataReader=o={}))},9163:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Replay=void 0;const s=r(605),n=r(6876),a=r(5470),i=r(7022),o=r(8529),l=r(3712),c=r(1752),u=e=>({demoProtocol:e.ui(),netProtocol:e.ui(),mapName:e.nstr(260),modName:e.nstr(260),mapCrc:e.i(),dirOffset:e.ui()}),h=(e,t)=>{e.seek(t);let r=e.ui(),s=[];for(let t=0;t<r;++t)s.push({id:e.ui(),name:e.nstr(64),flags:e.ui(),cdTrack:e.i(),time:e.f(),frames:e.ui(),offset:e.ui(),length:e.ui()});return s},d=(e,t,r)=>{let s={type:e.ub(),time:e.f(),tick:e.ui()};switch(s.type){case 0:case 1:e.skip(4),s.camera={position:[e.f(),e.f(),e.f()],orientation:[e.f(),e.f(),e.f()]},e.skip(436),s.data=((e,t,r)=>{let s=e.ui(),n=e.tell()+s,a=[];for(;e.tell()<n;){let s=e.ub();if(1===s)continue;if(s>=64){r[s]&&r[s].size>-1?e.skip(r[s].size):e.skip(e.ub());continue}let i=l.FrameDataReader.read(e,s,t);i?(39===s&&(r[i.index]=i),a.push({type:s,data:i})):e.seek(n)}return e.seek(n),a})(e,t,r);break;case 2:case 5:break;case 3:s.command=e.nstr(64);break;case 4:e.skip(32);break;case 6:e.skip(84);break;case 7:e.skip(8);break;case 8:s.sound={channel:e.i(),sample:e.nstr(e.ui()),attenuation:e.f(),volume:e.f(),flags:e.ui(),pitch:e.i()};break;case 9:e.skip(e.ui());break;default:s.error=!0}return s};class f{constructor(e,t){this.header=e,this.mapName=this.header.mapName,this.directories=t}static parseFromArrayBuffer(e){let t=new o.Reader(e);if("HLDEMO"!==t.nstr(8))throw new Error("Invalid replay format");let r={};r.demoProtocol=t.ui(),r.netProtocol=t.ui(),r.mapName=t.nstr(260),r.modName=t.nstr(260),r.mapCrc=t.i(),r.dirOffset=t.ui(),t.seek(r.dirOffset);let s=t.ui(),n=[];for(let e=0;e<s;++e)n.push({id:t.ui(),name:t.nstr(64),flags:t.ui(),cdTrack:t.i(),time:t.f(),frames:t.ui(),offset:t.ui(),length:t.ui(),macros:[]});for(let e=0;e<n.length;++e){t.seek(n[e].offset);let r=!1;for(;!r;){let s={type:t.b(),time:t.f(),frame:t.ui()};switch(s.type){case 0:case 1:t.skip(4),s.camera={position:[t.f(),t.f(),t.f()],orientation:[t.f(),t.f(),t.f()]},t.skip(436),t.skip(t.ui());break;case 2:break;case 3:s.command=t.nstr(64);break;case 4:t.skip(32);break;case 5:r=!0;break;case 6:t.skip(84);break;case 7:t.skip(8);break;case 8:t.skip(4),t.skip(t.ui()+16);break;case 9:t.skip(t.ui());break;default:{const e=Number(t.tell()-9).toString(16),r=[`Unexpected macro (${s.type})`,` at offset = ${e}.`].join("");throw new Error(r)}}n[e].macros.push(s)}}return new f(r,n)}static parseFullFromArrayBuffer(e){let t=new o.Reader(e);if("HLDEMO"!==t.nstr(8))throw new Error("Invalid replay format");let r={};r.demoProtocol=t.ui(),r.netProtocol=t.ui(),r.mapName=t.nstr(260),r.modName=t.nstr(260),r.mapCrc=t.i(),r.dirOffset=t.ui(),t.seek(r.dirOffset);let s=t.ui(),n=[];for(let e=0;e<s;++e)n.push({id:t.ui(),name:t.nstr(64),flags:t.ui(),cdTrack:t.i(),time:t.f(),frames:t.ui(),offset:t.ui(),length:t.ui(),macros:[]});let a=(0,c.getInitialDeltaDecoders)(),i=[];for(let e=0;e<n.length;++e){t.seek(n[e].offset);let r=!1;for(;!r;){let s={type:t.b(),time:t.f(),frame:t.ui()};switch(s.type){case 0:case 1:{t.skip(4),s.camera={position:[t.f(),t.f(),t.f()],orientation:[t.f(),t.f(),t.f()],forward:[t.f(),t.f(),t.f()],right:[t.f(),t.f(),t.f()],up:[t.f(),t.f(),t.f()]},s.RefParams={frametime:t.f(),time:t.f(),intermission:t.i(),paused:t.i(),spectator:t.i(),onground:t.i(),waterlevel:t.i(),velocity:[t.f(),t.f(),t.f()],origin:[t.f(),t.f(),t.f()],viewHeight:[t.f(),t.f(),t.f()],idealPitch:t.f(),viewAngles:[t.f(),t.f(),t.f()],health:t.i(),crosshairAngle:[t.f(),t.f(),t.f()],viewSize:t.f(),punchAngle:[t.f(),t.f(),t.f()],maxClients:t.i(),viewEntity:t.i(),playerCount:t.i(),maxEntities:t.i(),demoPlayback:t.i(),hardware:t.i(),smoothing:t.i(),ptr_cmd:t.i(),ptr_movevars:t.i(),viewport:[t.i(),t.i(),t.i(),t.i()],nextView:t.i(),onlyClientDraw:t.i()},s.UserCmd={lerp_msec:t.s(),msec:t.ub(),UNUSED1:t.ub(),viewAngles:[t.f(),t.f(),t.f()],forwardMove:t.f(),sideMove:t.f(),upMove:t.f(),lightLevel:t.b(),UNUSED2:t.ub(),buttons:t.us(),impulse:t.b(),weaponSelect:t.b(),UNUSED:t.s(),impactIndex:t.i(),impactPosition:[t.f(),t.f(),t.f()]},s.MoveVars={gravity:t.f(),stopSpeed:t.f(),maxSpeed:t.f(),spectatorMaxSpeed:t.f(),acceleration:t.f(),airAcceleration:t.f(),waterAcceleration:t.f(),friction:t.f(),edgeFriction:t.f(),waterFriction:t.f(),entityGravity:t.f(),bounce:t.f(),stepSize:t.f(),maxVelocity:t.f(),zMax:t.f(),waveHeight:t.f(),footsteps:t.i(),skyName:t.nstr(32),rollAngle:t.f(),rollSpeed:t.f(),skyColor:[t.f(),t.f(),t.f()],skyVec:[t.f(),t.f(),t.f()]},s.view=[t.f(),t.f(),t.f()],s.viewModel=t.i(),s.incoming_sequence=t.i(),s.incoming_acknowledged=t.i(),s.incoming_reliable_acknowledged=t.i(),s.incoming_reliable_sequence=t.i(),s.outgoing_sequence=t.i(),s.reliable_sequence=t.i(),s.last_reliable_sequence=t.i();let e=t.ui()+t.tell();for(s.frameData=[];t.tell()<e;){let r=t.ub();if(1===r)continue;if(r>=64){i[r]&&i[r].size>-1?t.skip(i[r].size):t.skip(t.ub());continue}let n=l.FrameDataReader.read(t,r,a);n?(39===r&&(i[n.index]=n),s.frameData.push({type:r,frameData:n})):t.seek(e)}t.seek(e);break}case 2:break;case 3:s.command=t.nstr(64);break;case 4:s.clientData={position:[t.f(),t.f(),t.f()],rotation:[t.f(),t.f(),t.f()],weaponFlags:t.ui(),fov:t.f()};break;case 5:r=!0;break;case 6:s.event={flags:t.ui(),index:t.ui(),delay:t.f(),args:{flags:t.ui(),entityIndex:t.ui(),position:[t.f(),t.f(),t.f()],rotation:[t.f(),t.f(),t.f()],velocity:[t.f(),t.f(),t.f()],ducking:t.ui(),fparam1:t.f(),fparam2:t.f(),iparam1:t.i(),iparam2:t.i(),bparam1:t.i(),bparam2:t.i()}};break;case 7:s.weaponAnimation={animation:t.i(),body:t.i()};break;case 8:s.sound={channel:t.i(),sample:t.nstr(t.ui()),attenuation:t.f(),volume:t.f(),flags:t.ui(),pitch:t.i()};break;case 9:t.skip(t.ui());break;default:{const e=Number(t.tell()-9).toString(16),r=`Unexpected macro (${s.type}) at offset = ${e}`;throw new Error(r)}}n[e].macros.push(s)}}return new f(r,n)}static parseCustomFile(e){const t=new n.ReplayCustomMap,r=new DataView(e);let s=0;const a=e=>{const t=[];for(let n=0;n<e;n++){const e=r.getUint8(s++);0!==e&&t.push(String.fromCharCode(e))}return t.join("")},i=a(32),o=a(32),l=a(32);for(t.header={identifier:i,timestamp:o,additionalInfo:l},t.time=t.convertTimestamp(o);s<e.byteLength;){const e=[r.getInt16(s,!0)/5,r.getInt16(s+2,!0)/5,r.getInt16(s+4,!0)/5];s+=6;const n=[r.getInt16(s,!0)/182,r.getInt16(s+2,!0)/182,0];s+=4;const a=r.getUint16(s,!0);s+=2;const i=r.getUint16(s,!0);s+=2;const o=r.getUint8(s++),l=128&o?1:.5,c=127&o,u=r.getUint8(s++),h=r.getInt16(s,!0);s+=2;const d={origin:e,rotation:n,velocity:a,buttons:i,gravity:l,fps:h,strafes:c,sync:u};t.addFrame(d)}return{data:t}}static parseIntoChunks(e){let t=new o.Reader(e);if(!(e=>"HLDEMO"===e.nstr(8))(t))throw new Error("Invalid replay file format");let r,n,f,p,m,g=[],y=(0,c.getInitialDeltaDecoders)(),v=[],b=u(t),_=h(t,b.dirOffset),M=new i.ReplayState;for(m=_[0].offset+_[0].length,t.seek(_[0].offset);t.tell()<m;){let e=d(t,y,v);if(M.feedFrame(e),e.error)throw new Error("Encountered error while reading replay");if(e.type<2){let t=e.data.find((e=>e.type===l.FrameDataReader.SVC.SERVERINFO));t&&(r=new s.ReplayMap(t.data.mapFileName),g.push(r));let n=e.data.find((e=>e.type===l.FrameDataReader.SVC.RESOURCELIST));n&&r&&r.setResources(n.data)}}if(!(r instanceof s.ReplayMap))throw new Error("Error while parsing replay.");for(p=t.tell(),n=new a.ReplayChunk(M,0),r.addChunk(n),m=_[1].offset+_[1].length,t.seek(_[1].offset);;){let e=t.tell();if(e>=m){let r=f.time-n.startTime;n.timeLength=r;let s=e-p;t.seek(p),n.setData(t.arrx(s,o.ReaderDataType.UByte)),t.seek(e);break}let i=d(t,y,v);if(M.feedFrame(i),f=i,i.error)throw new Error("Encountered error while reading replay");if(i.type<2){let c=i.data.find((e=>e.type===l.FrameDataReader.SVC.SERVERINFO));if(c){r=new s.ReplayMap(c.data.mapFileName),g.push(r);let l=f.time-n.startTime;n.timeLength=l;let u=e-p,h=t.tell();t.seek(p),n.setData(t.arrx(u,o.ReaderDataType.UByte)),t.seek(h),p=e,n=new a.ReplayChunk(M,i.time),r.addChunk(n)}let u=i.data.find((e=>e.type===l.FrameDataReader.SVC.RESOURCELIST));if(u&&r.setResources(u.data),c)continue;for(let e=0;e<i.data.length;++e){let t=i.data[e];if(t.type===l.FrameDataReader.SVC.SOUND||t.type===l.FrameDataReader.SVC.SPAWNSTATICSOUND){let e=r.resources.sounds.find((e=>e.index===t.data.soundIndex));e&&(e.used=!0)}else if(t.type===l.FrameDataReader.SVC.STUFFTEXT){let e=r.resources.sounds,s=t.data.commands;for(let t=0;t<s.length;++t){let r=s[t],n=r.func;if(("speak"===n||"spk"===n)&&1===r.params.length){let t=r.params[0]+".wav",s=e.find((e=>e.name===t));s&&(s.used=!0)}}}}}else if(8===i.type){let e=r.resources.sounds.find((e=>e.name===i.sound.sample));e&&(e.used=!0)}if(n.startTime+10<i.time){let s=e-p,l=t.tell();t.seek(p),n.setData(t.arrx(s,o.ReaderDataType.UByte)),t.seek(l),p=e,n=new a.ReplayChunk(M,i.time),r.addChunk(n)}}return{length:_[1].time,maps:g,deltaDecoders:y,customMessages:v}}static readHeader(e){return u(e)}static readDirectories(e,t){return h(e,t)}static readFrame(e,t,r){return d(e,t,r)}static readFrameData(e,t,r){return d(e,t,r)}}t.Replay=f},5470:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ReplayChunk=void 0;const s=r(8529);t.ReplayChunk=class{constructor(e,t){this.state=e.clone(),this.startTime=t,this.timeLength=10,this.data=null,this.reader=null}setData(e){this.data=new Uint8Array(e.length);for(let t=0;t<e.length;++t)this.data[t]=e[t];this.reader=new s.Reader(this.data.buffer)}}},6876:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ReplayCustomMap=t.Vector3=void 0;class r{constructor(e){this.vec=e}lerp(e,t){return new r([this.vec[0]+(e.vec[0]-this.vec[0])*t,this.vec[1]+(e.vec[1]-this.vec[1])*t,this.vec[2]+(e.vec[2]-this.vec[2])*t])}}t.Vector3=r;t.ReplayCustomMap=class{constructor(){this.header={identifier:"",timestamp:"",additionalInfo:""},this.frames=[],this.length=0,this.time=0}addFrame(e){this.frames.push(e),this.length+=1}convertTimestamp(e){return function(e){const t=e.replace("s",""),[r,s]=t.split(":"),n=parseInt(r,10),[a,i]=s.split("."),o=parseInt(a,10),l=parseInt(i||"0",10);return 60*n*1e3+1e3*o+l}(e)}}},605:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ReplayMap=void 0;const s=r(2130);t.ReplayMap=class{constructor(e){this.name=(0,s.basename)(e,".bsp"),this.chunks=[],this.resources={sounds:[],skins:[],models:[],decals:[],custom:[],events:[]}}setResources(e){e.forEach((e=>{switch(e.type){case 0:e.used=!1,this.resources.sounds.push(e);break;case 1:this.resources.skins.push(e);break;case 2:this.resources.models.push(e);break;case 3:this.resources.decals.push(e);break;case 4:this.resources.custom.push(e);break;case 5:this.resources.events.push(e)}}))}addChunk(e){this.chunks.push(e)}}},7022:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ReplayState=void 0;class r{constructor(e=null){e?(this.cameraPos=JSON.parse(JSON.stringify(e.cameraPos)),this.cameraRot=JSON.parse(JSON.stringify(e.cameraRot)),this.entities=JSON.parse(JSON.stringify(e.entities))):(this.cameraPos=[0,0,0],this.cameraRot=[0,0,0],this.entities=[])}feedFrame(e){switch(e.type){case 0:case 1:this.cameraPos[0]=e.camera.position[0],this.cameraPos[1]=e.camera.position[1],this.cameraPos[2]=e.camera.position[2],this.cameraRot[0]=e.camera.orientation[0],this.cameraRot[1]=e.camera.orientation[1],this.cameraRot[2]=e.camera.orientation[2]}}clone(){return new r(this)}}t.ReplayState=r},6231:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.readCoord=function(e){let t=e.readBits(1),r=e.readBits(1);if(!t&&!r)return 0;let s=e.readBits(1),n=0,a=0;t&&(n=e.readBits(12));r&&(a=e.readBits(3));let i=n+a/32;s&&(i=-i);return i}},1752:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getInitialDeltaDecoders=void 0,t.readDelta=function(e,t){let r={},n=e.readBits(3),a=[];for(let t=0;t<n;++t)a.push(e.readBits(8));let i=!1;for(let o=0;o<n;++o){for(let n=0;n<8;++n){let l=n+8*o;if(l===t.length){i=!0;break}if(a[o]&1<<n)if(t[l].flags&s.DeltaType.DT_BYTE)if(t[l].flags&s.DeltaType.DT_SIGNED){let s=e.readBits(1)?-1:1,n=e.readBits(t[l].bits-1),a=t[l].divisor;r[t[l].name]=s*n/a}else{let s=e.readBits(t[l].bits),n=t[l].divisor;r[t[l].name]=s/n}else if(t[l].flags&s.DeltaType.DT_SHORT)if(t[l].flags&s.DeltaType.DT_SIGNED){let s=e.readBits(1)?-1:1,n=e.readBits(t[l].bits-1),a=t[l].divisor;r[t[l].name]=s*n/a}else{let s=e.readBits(t[l].bits),n=t[l].divisor;r[t[l].name]=s/n}else if(t[l].flags&s.DeltaType.DT_INTEGER)if(t[l].flags&s.DeltaType.DT_SIGNED){let s=e.readBits(1)?-1:1,n=e.readBits(t[l].bits-1),a=t[l].divisor;r[t[l].name]=s*n/a}else{let s=e.readBits(t[l].bits),n=t[l].divisor;r[t[l].name]=s/n}else if(t[l].flags&s.DeltaType.DT_FLOAT||t[l].flags&s.DeltaType.DT_TIMEWINDOW_8||t[l].flags&s.DeltaType.DT_TIMEWINDOW_BIG)if(t[l].flags&s.DeltaType.DT_SIGNED){let s=e.readBits(1)?-1:1,n=e.readBits(t[l].bits-1),a=t[l].divisor;r[t[l].name]=s*n/a}else{let s=e.readBits(t[l].bits),n=t[l].divisor;r[t[l].name]=s/n}else if(t[l].flags&s.DeltaType.DT_ANGLE){let s=e.readBits(t[l].bits),n=360/(1<<t[l].bits);r[t[l].name]=s*n}else t[l].flags&s.DeltaType.DT_STRING&&(r[t[l].name]=e.readString())}if(i)break}return r};const s=r(4080);const n={delta_description_t:[{name:"flags",bits:32,divisor:1,flags:s.DeltaType.DT_INTEGER},{name:"name",bits:8,divisor:1,flags:s.DeltaType.DT_STRING},{name:"offset",bits:16,divisor:1,flags:s.DeltaType.DT_INTEGER},{name:"size",bits:8,divisor:1,flags:s.DeltaType.DT_INTEGER},{name:"bits",bits:8,divisor:1,flags:s.DeltaType.DT_INTEGER},{name:"divisor",bits:32,divisor:4e3,flags:s.DeltaType.DT_FLOAT},{name:"preMultiplier",bits:32,divisor:4e3,flags:s.DeltaType.DT_FLOAT}]};t.getInitialDeltaDecoders=()=>Object.assign({},n)},2847:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Sound=void 0;const s=r(9694);class n{constructor(e){this.index=-1,this.name="",this.buffer=e}static create(e){return new Promise(((t,r)=>{s.SoundSystem.getContext().decodeAudioData(e,(e=>{t(new n(e))}),(e=>{r(e)}))}))}}t.Sound=n},9694:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SoundSystem=void 0;const s=r(9431),n=window,a=new(n.AudioContext||n.webkitAudioContext);t.SoundSystem=class{constructor(){this.context=a,this.events=(0,s.createNanoEvents)();const e=parseFloat(localStorage.getItem("volume")||"0.3");localStorage.setItem("volume",e.toString()),this.channels=[],this.preMuteVolume=1,this.masterGain=this.context.createGain(),this.masterGain.gain.value=e,this.masterGain.connect(this.context.destination);for(let e=0;e<8;++e)this.channels.push({source:null,gain:this.context.createGain()}),this.channels[e].gain.connect(this.masterGain)}static getContext(){return a}play(e,t,r){this.stop(t);const s=this.channels[t].gain;s.gain.value=Math.max(0,Math.min(1,r));const n=this.context.createBufferSource();n.buffer=e.buffer,n.connect(s),n.start(0),this.channels[t].source=n}stop(e){const t=this.channels[e].source;t&&t.stop(0)}getVolume(){return this.masterGain.gain.value}setVolume(e){const t=this.masterGain.gain.value;t>0&&0===e&&(this.preMuteVolume=t),this.masterGain.gain.value=e,localStorage.setItem("volume",e.toString()),this.events.emit("volumeChange",e)}toggleMute(){0===this.getVolume()?this.setVolume(this.preMuteVolume):this.setVolume(0)}}},4343:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.formatTime=t.now=void 0;const r=window;let s;"undefined"!=typeof performance&&(performance.now()?s=()=>r.performance.now():r.performance.mozNow?s=()=>r.performance.mozNow():r.performance.msNow?s=()=>r.performance.msNow():r.performance.oNow?s=()=>r.performance.oNow():r.performance.webkitNow?s=()=>r.performance.webkitNow():Date.now&&(s=()=>Date.now())),t.now=s||(()=>(new Date).getTime());t.formatTime=e=>{const t=Math.floor(e/60),r=Math.floor(e-60*t);return(t<10?"0"+t:t.toString())+":"+(r<10?"0"+r:r.toString())}},2130:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.basename=function(e,t){return e.slice(e.lastIndexOf("/")+1).replace(t||"","")},t.extname=function(e){const t=e.lastIndexOf("/"),r=e.lastIndexOf(".");return t<r?e.slice(r):""}},6566:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.xhr=function(e,t){let r=t.method||"GET",s=t.isBinary,n=t.progressCallback;if(!e)throw new Error("Url parameter missing");return new Promise(((t,a)=>{let i=new XMLHttpRequest;s&&(i.responseType="arraybuffer"),s&&n&&i.addEventListener("progress",(e=>{if(e.lengthComputable)n(i,e.loaded/e.total);else{let t=i.getResponseHeader("content-length"),r=0;t&&(r=parseFloat(t));let s=i.getResponseHeader("content-encoding");if(r&&s&&s.indexOf("gzip")>-1){r*=4;let t=Math.min(.99,e.loaded/r);n(i,t)}else n(i,0)}})),i.addEventListener("readystatechange",(e=>{4===e.target.readyState&&(200===e.target.status?(n&&n(i,1),t(e.target.response)):a({status:e.target.status}))})),i.open(r,e,!0),i.send()}))}},8156:(e,t,r)=>{"use strict";const s=r(7484),n=r(4932),a=r(9849);class i{constructor(e){this.game=e}load(e){this.game.load(e)}setTitle(e){this.game.setTitle(e)}getTitle(){return this.game.getTitle()}}var o;i.VERSION="0.7.5",function(e){e.init=function(e,t){const r=document.querySelector(e);if(!r)return null;const o=n.Config.init(t),l=s.Game.init(o);if("success"===l.status){const e=l.game;return new a.PlayerInterface(e,r).draw(),e.draw(),new i(e)}return null}}(o||(o={})),e.exports=o},682:(e,t,r)=>{"use strict";r.r(t),r.d(t,{TypeStyle:()=>R,classes:()=>x,createTypeStyle:()=>V,cssRaw:()=>A,cssRule:()=>C,extend:()=>S,fontFace:()=>D,forceRenderStyles:()=>L,getStyles:()=>F,keyframes:()=>N,media:()=>T,reinit:()=>O,setStylesTarget:()=>P,style:()=>B,stylesheet:()=>U,types:()=>k});let s=0;const n=Object.create(null),a=["animation-iteration-count","border-image-outset","border-image-slice","border-image-width","box-flex","box-flex-group","box-ordinal-group","column-count","columns","counter-increment","counter-reset","flex","flex-grow","flex-positive","flex-shrink","flex-negative","flex-order","font-weight","grid-area","grid-column","grid-column-end","grid-column-span","grid-column-start","grid-row","grid-row-end","grid-row-span","grid-row-start","line-clamp","line-height","opacity","order","orphans","tab-size","widows","z-index","zoom","fill-opacity","flood-opacity","stop-opacity","stroke-dasharray","stroke-dashoffset","stroke-miterlimit","stroke-opacity","stroke-width"];for(const e of a)for(const t of["-webkit-","-ms-","-moz-","-o-",""])n[t+e]=!0;function i(e,t){return t&&"number"==typeof t&&!n[e]?`${e}:${t}px`:`${e}:${t}`}function o(e){return e.sort(((e,t)=>e[0]>t[0]?1:-1))}function l(e){return e.map((([e,t])=>Array.isArray(t)?t.map((t=>i(e,t))).join(";"):i(e,t))).join(";")}function c(e,t){return-1===e.indexOf("&")?`${t} ${e}`:e.replace(/&/g,t)}function u(e,t,r,s,n){const{style:a,nested:i,isUnique:h}=function(e,t){const r=[],s=[];for(const t of Object.keys(e)){const a=t.trim(),i=e[t];36!==a.charCodeAt(0)&&null!=i&&("object"!=typeof i||Array.isArray(i)?r.push([(n=a,n.replace(/[A-Z]/g,(e=>`-${e.toLowerCase()}`)).replace(/^ms-/,"-ms-")),i]):s.push([a,i]))}var n;return{style:l(o(r)),nested:t?s:o(s),isUnique:!!e.$unique}}(t,""!==e);let d=a;if(64===e.charCodeAt(0)){const t={selector:e,styles:[],rules:[],style:n?"":a};r.push(t),a&&n&&t.styles.push({selector:n,style:a,isUnique:h});for(const[e,r]of i)d+=e+u(e,r,t.rules,t.styles,n)}else{const t=n?c(e,n):e;a&&s.push({selector:t,style:a,isUnique:h});for(const[e,n]of i)d+=e+u(e,n,r,s,t)}return d}function h(e,t,r,n,a,i){for(const{selector:r,style:o,isUnique:l}of n){const n=i?c(r,a):r,u=l?`u\0${(++s).toString(36)}`:`s\0${t}\0${o}`,h=new g(o,u);h.add(new m(n,`k\0${t}\0${n}`)),e.add(h)}for(const{selector:s,style:n,rules:o,styles:l}of r){const r=new y(s,n,`r\0${t}\0${s}\0${n}`);h(r,t,o,l,a,i),e.add(r)}}function d(e){let t="";for(let r=0;r<e.length;r++)t+=e[r];return t}const f={add:()=>{},change:()=>{},remove:()=>{}};class p{constructor(e=f){this.changes=e,this.sheet=[],this.changeId=0,this._keys=[],this._children=Object.create(null),this._counters=Object.create(null)}add(e){const t=this._counters[e.id]||0,r=this._children[e.id]||e.clone();if(this._counters[e.id]=t+1,0===t)this._children[r.id]=r,this._keys.push(r.id),this.sheet.push(r.getStyles()),this.changeId++,this.changes.add(r,this._keys.length-1);else if(r instanceof p&&e instanceof p){const t=this._keys.indexOf(e.id),s=r.changeId;r.merge(e),r.changeId!==s&&(this.sheet.splice(t,1,r.getStyles()),this.changeId++,this.changes.change(r,t,t))}}remove(e){const t=this._counters[e.id];if(t){this._counters[e.id]=t-1;const r=this._children[e.id],s=this._keys.indexOf(r.id);if(1===t)delete this._counters[e.id],delete this._children[e.id],this._keys.splice(s,1),this.sheet.splice(s,1),this.changeId++,this.changes.remove(r,s);else if(r instanceof p&&e instanceof p){const t=r.changeId;r.unmerge(e),r.changeId!==t&&(this.sheet.splice(s,1,r.getStyles()),this.changeId++,this.changes.change(r,s,s))}}}values(){return this._keys.map((e=>this._children[e]))}merge(e){for(const t of e.values())this.add(t);return this}unmerge(e){for(const t of e.values())this.remove(t);return this}clone(){return(new p).merge(this)}}class m{constructor(e,t){this.selector=e,this.id=t}getStyles(){return this.selector}clone(){return this}}class g extends p{constructor(e,t){super(),this.style=e,this.id=t}getStyles(){return`${this.sheet.join(",")}{${this.style}}`}clone(){return new g(this.style,this.id).merge(this)}}class y extends p{constructor(e,t,r){super(),this.rule=e,this.style=t,this.id=r}getStyles(){return`${this.rule}{${this.style}${d(this.sheet)}}`}clone(){return new y(this.rule,this.style,this.id).merge(this)}}function v(e,t){const r=`f${function(e){let t=5381,r=e.length;for(;r--;)t=33*t^e.charCodeAt(r);return(t>>>0).toString(36)}(e)}`;return r}class b extends p{constructor(e,t){super(t),this.id=e}registerStyle(e){const t=[],r=[],s=u("&",e,t,r),n=v(s);return h(this,s,t,r,`.${n}`,!0),n}registerKeyframes(e){return this.registerHashRule("@keyframes",e)}registerHashRule(e,t){const r=[],s=[],n=u("",t,r,s),a=v(n),i=new y(`${e} ${a}`,"",`h\0${n}\0${e}`);return h(i,n,r,s,"",!1),this.add(i),a}registerRule(e,t){const r=[],s=[];h(this,u(e,t,r,s),r,s,"",!1)}registerCss(e){return this.registerRule("",e)}getStyles(){return d(this.sheet)}clone(){return new b(this.id,this.changes).merge(this)}}function _(e){var t={};for(var r in e){var s=e[r];if("$nest"===r){var n=s;for(var a in n){var i=n[a];t[a]=_(i)}}else"$debugName"===r?t.$displayName=s:t[r]=s}return t}var M="undefined"==typeof requestAnimationFrame?function(e){return setTimeout(e)}:"undefined"==typeof window?requestAnimationFrame:requestAnimationFrame.bind(window);function x(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return e.map((function(e){return e&&"object"==typeof e?Object.keys(e).map((function(t){return!!e[t]&&t})):[e]})).reduce((function(e,t){return e.concat(t)}),[]).filter((function(e){return!!e})).join(" ")}function S(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];for(var r={},s=0,n=e;s<n.length;s++){var a=n[s];if(null!=a&&!1!==a)for(var i in a){var o=a[i];(o||0===o)&&("$nest"===i&&o?r[i]=r.$nest?S(r.$nest,o):o:-1!==i.indexOf("&")||0===i.indexOf("@media")?r[i]=r[i]?S(r[i],o):o:r[i]=o)}}return r}var T=function(e){for(var t,r=[],s=1;s<arguments.length;s++)r[s-1]=arguments[s];var n=[];return e.type&&n.push(e.type),e.orientation&&n.push("(orientation: "+e.orientation+")"),e.minWidth&&n.push("(min-width: "+E(e.minWidth)+")"),e.maxWidth&&n.push("(max-width: "+E(e.maxWidth)+")"),e.minHeight&&n.push("(min-height: "+E(e.minHeight)+")"),e.maxHeight&&n.push("(max-height: "+E(e.maxHeight)+")"),e.prefersColorScheme&&n.push("(prefers-color-scheme: "+e.prefersColorScheme+")"),{$nest:(t={},t["@media "+n.join(" and ")]=S.apply(void 0,r),t)}},E=function(e){return"string"==typeof e?e:e+"px"},w=function(){return new b(`f${(++s).toString(36)}`,e);var e},R=function(){function e(e){var t=this,r=e.autoGenerateTag;this.cssRaw=function(e){e&&(t._raw+=e||"",t._pendingRawChange=!0,t._styleUpdated())},this.cssRule=function(e){for(var r=[],s=1;s<arguments.length;s++)r[s-1]=arguments[s];var n=_(S.apply(void 0,r));t._freeStyle.registerRule(e,n),t._styleUpdated()},this.forceRenderStyles=function(){var e=t._getTag();e&&(e.textContent=t.getStyles())},this.fontFace=function(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];for(var s=t._freeStyle,n=0,a=e;n<a.length;n++){var i=a[n];s.registerRule("@font-face",i)}t._styleUpdated()},this.getStyles=function(){return(t._raw||"")+t._freeStyle.getStyles()},this.keyframes=function(e){var r=function(e){var t={};for(var r in e)"$debugName"!==r&&(t[r]=e[r]);return e.$debugName&&(t.$displayName=e.$debugName),t}(e),s=t._freeStyle.registerKeyframes(r);return t._styleUpdated(),s},this.reinit=function(){var e=w();t._freeStyle=e,t._lastFreeStyleChangeId=e.changeId,t._raw="",t._pendingRawChange=!1;var r=t._getTag();r&&(r.textContent="")},this.setStylesTarget=function(e){t._tag&&(t._tag.textContent=""),t._tag=e,t.forceRenderStyles()},this.stylesheet=function(e){for(var r={},s=0,n=Object.getOwnPropertyNames(e);s<n.length;s++){var a=n[s],i=e[a];i&&(i.$debugName=a,r[a]=t.style(i))}return r};var s=w();this._autoGenerateTag=r,this._freeStyle=s,this._lastFreeStyleChangeId=s.changeId,this._pending=0,this._pendingRawChange=!1,this._raw="",this._tag=void 0,this.style=this.style.bind(this)}return e.prototype._afterAllSync=function(e){var t=this;this._pending++;var r=this._pending;M((function(){r===t._pending&&e()}))},e.prototype._getTag=function(){if(this._tag)return this._tag;if(this._autoGenerateTag){var e="undefined"==typeof window?{textContent:""}:document.createElement("style");return"undefined"!=typeof document&&document.head.appendChild(e),this._tag=e,e}},e.prototype._styleUpdated=function(){var e=this,t=this._freeStyle.changeId,r=this._lastFreeStyleChangeId;(this._pendingRawChange||t!==r)&&(this._lastFreeStyleChangeId=t,this._pendingRawChange=!1,this._afterAllSync((function(){return e.forceRenderStyles()})))},e.prototype.style=function(){var e=this._freeStyle.registerStyle(_(S.apply(void 0,arguments)));return this._styleUpdated(),e},e}(),k=r(2385),I=new R({autoGenerateTag:!0}),P=I.setStylesTarget,A=I.cssRaw,C=I.cssRule,L=I.forceRenderStyles,D=I.fontFace,F=I.getStyles,N=I.keyframes,O=I.reinit,B=I.style,U=I.stylesheet;function V(e){var t=new R({autoGenerateTag:!1});return e&&t.setStylesTarget(e),t}},2385:()=>{},9431:(e,t,r)=>{"use strict";r.r(t),r.d(t,{createNanoEvents:()=>s});let s=()=>({emit(e,...t){for(let r=0,s=this.events[e]||[],n=s.length;r<n;r++)s[r](...t)},events:{},on(e,t){return(this.events[e]||=[]).push(t),()=>{this.events[e]=this.events[e]?.filter((e=>t!==e))}}})}},t={};function r(s){var n=t[s];if(void 0!==n)return n.exports;var a=t[s]={exports:{}};return e[s].call(a.exports,a,a.exports,r),a.exports}return r.d=(e,t)=>{for(var s in t)r.o(t,s)&&!r.o(e,s)&&Object.defineProperty(e,s,{enumerable:!0,get:t[s]})},r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r(8156)})()));
//# sourceMappingURL=hlviewer.min.js.map